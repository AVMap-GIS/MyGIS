var config={mapserver:"/mapserver/",namespace:"http://mgmapserver2.avmap.gr:8081/geoserver/",folderPath:"/DesktopModules/AVMap.MapDigitizer_v2/",mgreq:"/DesktopModules/AVMap.MapDigitizer_v2/mgreq.ashx"};
Object.defineProperties(config,{mapserver:{value:"/mapserver/",writable:!1,configurable:!1},namespace:{value:"http://mgmapserver2.avmap.gr:8081/geoserver/",writable:!1,configurable:!1},folderPath:{value:"/DesktopModules/AVMap.MapDigitizer_v2/",writable:!1,configurable:!1},mgreq:{value:"/DesktopModules/AVMap.MapDigitizer_v2/mgreq.ashx",writable:!1,configurable:!1}});
var internalConfig={mapTabIndex:1,layerTabIndex:2,searchTabIndex:3,editTabIndex:4,changeDefaultMap:null,apiVersion:"2.0.0",hotSearches:[],myCustomFilters:[],selectionToolbarIndex:1,digitizingToolbarIndex:2,filteringToolbarIndex:4,mediaManagerSearchTimer:null,mmCallback:{fn:null,objectCount:-1,object:null},defaultBG1_index:4,defaultBG2_index:4,isAdminInterfaceLoaded:!1,isUserPageLoaded:!1,uiBlocked:!1,mapThumbCropper:null,mapThumbPreviousBox:"",macroButtons:[],helpTips:{switchBG:!1,switchBG_animPlaying:!1},
moveendEvent:-1,zoomToFeat:-1,legendWidth:20},internalMemory={lastZoom:null,dialogTop:0,dialogLeft:0,unsavedLayerChanges:[],layerFields:{}},backgrounds={},appPath,digimap,criteriaMap,digiContainer,drawControls,infoControls,naviControls,lastCritIndex,countMarkers,countPolygons,countPolylines,digiOutLoc,geoXml,postbackurl,extra,myguid,current,wmsHighlight,cosmeticLayer,selectionLayer,feedbackLayer,selectionWMSLayer,selectionFlasher={timer:null,count:null},featuresUnsaved=[],featuresModified={},featuresDeleted=
[],drawingManager,mapContainerPosition,panTimer,toolbarToggling=!1,filledMode=2,real_editMode=!1,rightmenuOpen=!1,infoWindows,autocomplete,saveFlasher,toolsEnabled={allTools:!1,toolbar:!1,search:!1,maps:!1,layers:!1,marker:!1,filledRect:!1,openRect:!1,filledCircle:!1,openCircle:!1,openPolygon:!1,filledPolygon:!1,polyLine:!1,polyLineDirections:!1,database:!1,undo:!1},cmenu,objcmenu,rightClickedObj;window.trigger_calendar=[];window.lines_id=[[0,!1,!1,!1]];window.current_row=["",""];$.xhrPool=[];
$.xhrPool.abortAll=function(){$(this).each(function(a,b){b.abort()});$.xhrPool.length=0};$.ajaxSetup({beforeSend:function(a){$.xhrPool||($.xhrPool=[]);$.xhrPool.push(a)},complete:function(a){$.xhrPool&&(a=$.xhrPool.indexOf(a),-1<a&&$.xhrPool.splice(a,1))}});window.mygis={};
mygis.Storage={isStorageEnabled:function(){var a=!1;localStorage&&(a=!1);return a},getItem:function(a){var b;mygis.Storage.isStorageEnabled()&&localStorage.length&&a&&(b=localStorage.getItem(a));return b},storeItem:function(a,b){var c=!1;mygis.Storage.isStorageEnabled&&(localStorage.setItem(a,b),c=!0);return c}};
mygis.Drawing={Editing:{isFilledIn:function(a){var b=!1;$.each(a,function(a,d){d&&(b=!0)});return b},editInfoFields:function(a){var b=$(".infoFieldsInnerCont .featureVCell"),c=$(".infoFieldsInnerCont");c.hasClass("editable")||c.addClass("editable");$.each(b,function(b,c){var f=$(c).prev().attr("data-originalName"),g=$(c).prev().attr("data-description"),f=a[f],g={element:$(c).prev(),message:g};singleQTip("editField",g);if(0<f.fieldLists.length){var h="{'':'"+strings.Editing.pleaseSelect+"'";$.each(f.fieldLists,
function(a,b){h+=",";h+="'"+b.value+"'";h+=":";h+="'"+b.name+"'"});h+="}";$(c).editable(function(a){return a},{data:h,type:"select",onblur:"submit",placeholder:'<span class="placeholder">'+strings.Editing.clickToEdit+"</span>",onsubmit:function(a,b){$(b).find("input");$(this).validate({rules:{value:{required:!0}},messages:{"actionItemEntity.name":{number:"Required field"}}});return $(this).valid()}})}else switch(f.originalType){case "bit":$(c).editable(function(a){return a},{data:"{'':'"+strings.Editing.pleaseSelect+
"','True':'"+strings.Editing.trueValue+"','False':'"+strings.Editing.falseValue+"'}",type:"select",onblur:"submit",placeholder:'<span class="placeholder">'+strings.Editing.clickToEdit+"</span>"});case "float":case "double":case "int":case "numeric":$(c).editable(function(a){return a},{onsubmit:function(a,b){$(b).find("input");$(this).validate({rules:{value:{number:!0}},messages:{"actionItemEntity.name":{number:"Only numbers are allowed"}}});return $(this).valid()},type:"text",onblur:"submit",placeholder:'<span class="placeholder">'+
strings.Editing.clickToEdit+"</span>"});break;default:$(c).editable(function(a){return a},{type:"textarea",onblur:"submit",placeholder:'<span class="placeholder">'+strings.Editing.clickToEdit+"</span>"})}})},toggleEditableInfoFields:function(a){var b="",b=a?"enable":"disable";try{mygis.Drawing.Editing.editInfoFields()}catch(c){}$(".infoFieldsInnerCont .featureVCell").editable(b)},checkInfoPopupButtons:function(a,b,c){try{$(".infoPopupBtn").die().remove()}catch(d){}try{$(".infoPopup_saveChangesBtn").die().remove()}catch(e){}try{$(".infoPopup_editBtn").die().remove()}catch(f){}try{$(".infoPopup_deleteBtn").die().remove()}catch(g){}var h=
layerSource.records,k=function(b){return b.layerTABLE==a};if(-1==b){k=$("<a class='infoPopup_addImageBtn infoPopupBtn' href='#'></a>");k.append(strings.Editing.addImage);$(".infoImagesLabel").append(k);k.bind("click",mygis.Drawing.Editing.handlerAttachImage);var l=$("<a class='infoPopup_addFileBtn infoPopupBtn' href='#'></a>");l.append(strings.Editing.addFile);$(".infoFilesLabel").append(l);l.bind("click",mygis.Drawing.Editing.handlerAttachFile);k=$("<a class='infoPopup_saveChangesBtn ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only' href='#'></a>");
k.append('<span class="ui-button-icon-primary ui-icon ui-icon-disk"></span>');l=$(".infoCont.ui-dialog-content").prev();l.append(k);k.bind("click",function(){setTimeout(mygis.Drawing.Editing.attachFieldsToFeature,400)})}else if((h=h.find(k))&&internalMemory.layerRights)if(mygis.Drawing.Exporting.checkRights(b,h.layerID,"update")&&(k=$("<a class='infoPopup_addImageBtn infoPopupBtn' href='#'></a>"),k.append(strings.Editing.addImage),$(".infoImagesLabel").append(k),k.bind("click",function(a,b){return function(){mygis.Drawing.Editing.handlerAttachImage(a,
b)}}(b,h.layerTABLE)),l=$("<a class='infoPopup_addFileBtn infoPopupBtn' href='#'></a>"),l.append(strings.Editing.addFile),$(".infoFilesLabel").append(l),l.bind("click",function(a,b){return function(){mygis.Drawing.Editing.handlerAttachFile(a,b)}}(b,h.layerTABLE)),k=$("<a class='infoPopup_saveChangesBtn ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only' href='#'></a>"),k.append('<span class="ui-button-icon-primary ui-icon ui-icon-disk"></span>'),l=$(".infoCont.ui-dialog-content").prev(),
l.append(k),k.bind("click",function(a,b){return function(c){if(0<$(c.target).closest(".ui-dialog").find("form .error").length)showConfirmationDialog(strings.Editing.loseAllChanges,function(){var a=$(c.target).closest(".ui-dialog").find(".ui-dialog-content");try{a.dialog("destroy"),a.remove()}catch(b){}console.log("removed 1");cosmeticLayer.destroyFeatures();digimap.layers[1].redraw(!0);mygis.UI.activateControl("drag")},function(){console.log("cancelled");return!1});else{var d=layerCurrentEditing;
layerCurrentEditing=mygis.Utilities.mggetLayerIndex(b.layerTABLE);mygis.Drawing.Editing.mg_updateFeature(a,b.layerTABLE);layerCurrentEditing=d;d=$(c.target).closest(".ui-dialog").find(".ui-dialog-content");try{d.dialog("destroy"),d.remove()}catch(e){}}}}(b,h)),mygis.Drawing.Editing.editInfoFields(c),$(".ui-dialog .ui-layout-center h3.ui-accordion-header").show()),mygis.Drawing.Exporting.checkRights(b,h.layerID,"delete"))k=$("<a class='infoPopup_deleteBtn ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only' href='#'></a>"),
k.append('<span class="ui-button-icon-primary ui-icon ui-icon-trash"></span>'),l.append(k),k.bind("click",function(a,b){return function(c){showConfirmationDialog(strings.Editing.deleteObject,function(){var d=layerCurrentEditing;layerCurrentEditing=mygis.Utilities.mggetLayerIndex(b.layerTABLE);mygis.Drawing.Editing.mg_deleteFeature(a,b.layerTABLE);layerCurrentEditing=d;d=$(c.target).closest(".ui-dialog").find(".ui-dialog-content");try{d.dialog("destroy");d.remove()}catch(e){}},function(){return false})}}(b,
h))},clearDigiPopup:function(){$("#appSetting_DigitizeFields").empty();$("#appSetting_DigitizeImages").empty();$("#appSetting_DigitizeFiles").empty();$("#appSetting_DigitizeLinks").empty()},addDigiDefaults:function(){var a=$("<div class='appSetting' />"),b=$("<div class='imageWrapper' />"),c=$("<div id='editImageContainer' />"),d=$("<a href='#' class='defaultAction freshButton' />");d.html(strings.Editing.btnAttachImage);d.bind("click",mygis.Drawing.Editing.handlerAttachImage);b.append(c);a.append(b);
$("#appSetting_DigitizeImages").append(a);a=$("<div class='appSetting' />");b=$("<div id='editFileContainer' />");c=$("<a href='#' class='defaultAction freshButton' />");c.html(strings.Editing.btnAttachFile);c.bind("click",mygis.Drawing.Editing.handlerAttachFile);a.append(b);$("#appSetting_DigitizeFiles").append(a)},handlerAttachImage:function(a,b){internalConfig.mmCallback.fn=mygis.Drawing.Editing.imageAttached;internalConfig.mmCallback.objectCount=1;internalConfig.mmCallback.object=null;internalConfig.mmCallback.oid=
a;internalConfig.mmCallback.layer=b;showMediaManager(!0)},handlerAttachFile:function(a,b){internalConfig.mmCallback.fn=mygis.Drawing.Editing.fileAttached;internalConfig.mmCallback.objectCount=1;internalConfig.mmCallback.object=null;internalConfig.mmCallback.oid=a;internalConfig.mmCallback.layer=b;showMediaManager()},imageAttached:function(a){if("ok"==a){var b,c,d;-1<internalConfig.mmCallback.oid?(a=internalConfig.mmCallback.layer,d=internalConfig.mmCallback.oid,mygis.Drawing.Editing.mg_featureModified(d,
a),b=featuresModified[a+"."+internalConfig.mmCallback.oid]):(b=featuresUnsaved[featuresUnsaved.length-1],a=layerSource.records[layerCurrentEditing].layerTABLE,d=-1);c=a+"."+d;b.attachedImages||(b.attachedImages=[]);b.attachedImagesFull||(b.attachedImagesFull=[]);d=$("#detached"+a+"_"+d+" .popupimageContainer");var e=d.data("images");e&&$.each(e,function(a,c){b.attachedImages.push(c.imageID);b.attachedImagesFull.push(c)});for(e=0;e<this.length;e++){var f=this[e];f.imageID=f.fileID;f.imageTYPE=f.fileTYPE;
f.imageNAME=f.fileNAME;b.attachedImages.push(f.fileID);b.attachedImagesFull.push(f)}d.empty();0<b.attachedImages.length&&(d.append(mygis.UI.getInfoImageGrid(b.attachedImagesFull,c)),a=$("#detached"+a+"_-1").find(".mainImageCont"),a.removeClass("editable"),a.unbind("click"),c=mygis.Utilities.format("url('{0}GetImage.ashx?qType=userFile&qContents={1}&qSize=430')",config.folderPath,b.attachedImages[0]),a.css("background-image",c))}},fileAttached:function(a){if("ok"==a){var b,c,d;-1<internalConfig.mmCallback.oid?
(c=internalConfig.mmCallback.layer,d=internalConfig.mmCallback.oid,mygis.Drawing.Editing.mg_featureModified(d,c),b=featuresModified[c+"."+internalConfig.mmCallback.oid]):(b=featuresUnsaved[featuresUnsaved.length-1],c=layerSource.records[layerCurrentEditing].layerTABLE,d=-1);a=c+"."+d;b.attachedFiles||(b.attachedFiles=[]);b.attachedFilesFull||(b.attachedFilesFull=[]);c=$("#detached"+c+"_"+d+" .popupFileContainer");(d=c.data("files"))&&$.each(d,function(a,c){b.attachedFiles.push(c.imageID);b.attachedFilesFull.push(c)});
for(d=0;d<this.length;d++){var e=this[d];e.imageID=e.fileID;e.imageTYPE=e.fileTYPE;e.imageNAME=e.fileNAME;b.attachedFiles.push(e.fileID);b.attachedFilesFull.push(e)}c.empty();0<b.attachedFiles.length&&c.append(mygis.UI.getInfoFileGrid(b.attachedFilesFull,a))}},imageDetach:function(){for(var a=$("#editImageContainer"),b=featuresUnsaved[featuresUnsaved.length-1],c=a.jqxGrid("getselectedrowindexes"),d=[],e=[],f=0;f<b.attachedImages.length;f++)-1==c.indexOf(f)&&(d.push(b.attachedImages[f]),e.push(b.attachedImagesFull[f]));
b.attachedImages=d;b.attachedImagesFull=e;b=mygis.Utilities.getLocalGridSource(b.attachedImagesFull);a.jqxGrid({source:b});a.jqxGrid("clearselection");a.jqxGrid("refreshdata");mygis.Drawing.Editing.imageGridSelected()},fileDetach:function(){for(var a=$("#editFileContainer"),b=featuresUnsaved[featuresUnsaved.length-1],c=a.jqxGrid("getselectedrowindexes"),d=[],e=[],f=0;f<b.attachedFiles.length;f++)-1==c.indexOf(f)&&(d.push(b.attachedFiles[f]),e.push(b.attachedFilesFull[f]));b.attachedFiles=d;b.attachedFilesFull=
e;b=mygis.Utilities.getLocalGridSource(b.attachedFilesFull);a.jqxGrid({source:b});a.jqxGrid("clearselection");a.jqxGrid("refreshdata");mygis.Drawing.Editing.fileGridSelected()},imageDownload:function(a){a=$(a).parent().find(".inputID")[0];mygis.UI.MediaManager.downloadFile(a.value)},imageZoom:function(a){var a=$(a).parent().find(".inputID")[0],a=mygis.Utilities.format("/DesktopModules/AVMap.MapDigitizer_v2/GetImage.ashx?qType=userFile&qContents={0}",a.value),b=$("<img />");b.attr("src",a);b.attr("class",
"imagePreviewer");var c=$("<div />"),d=$("<div />");c.attr("style","display: table-cell; text-align: center; vertical-align: middle; width: 900px; height: 360px;");d.append(c);b.load(function(){c.append(b);d.dialog({width:900,height:410,modal:!0,draggable:!1,resizable:!1});c.focus()})},fileDownload:function(a){a=$(a).parent().find(".inputID")[0];mygis.UI.MediaManager.downloadFile(a.value)},refreshImageSlider:function(){var a=$("#editImageContainer");a.empty();var b=$("$<ul />");$.each(featuresUnsaved[featuresUnsaved.length-
1].attachedImages,function(a,c){var f=$("<li />"),g=$("<img />"),h=$("<a />");g.attr("src",config.folderPath+"GetImage.ashx?qtype=userFile&qSize=50&qContents="+c);h.bind("click",mygis.Drawing.Editing.imageMenuClick);h.append(g);f.append(h);b.append(f)});var c=$("<div />");c.append(b);c.attr("class","es-carousel");a.append(c);a.elastislide({imageW:50,border:0})},refreshImageGrid:function(){var a=featuresUnsaved[featuresUnsaved.length-1];$("#editImageContainer").removeData().empty();mygis.Drawing.Editing.createImageGrid(a.attachedImagesFull)},
refreshFileGrid:function(){var a=featuresUnsaved[featuresUnsaved.length-1];$("#editFileContainer").removeData().empty();mygis.Drawing.Editing.createFileGrid(a.attachedFilesFull)},createImageGrid:function(a){$.each(a,function(a,b){b.imageSelected=!1});var a=mygis.Utilities.getLocalGridSource(a),b=$("#editImageContainer"),c=function(a,b,c){switch(b){case "fileID":a=mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'><img src='{0}'/></div>",config.folderPath+"GetImage.ashx?qtype=userFile&qSize=48&qContents="+
c,50);break;case "fileNAME":a=mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'>{0}</div>",c,50);break;default:b="",a=this.owner.getrowdata(a).fileID,b+=mygis.Utilities.format("<a href='#' class='freshButton' onclick='{0}'>{1}</a>",'router("editDigi_btnImageDownload",this);',strings.Editing.btnImage_download),b+=mygis.Utilities.format("<a href='#' class='freshButton' onclick='{0}'>{1}</a>",'router("editDigi_btnImageZoom",this);',strings.Editing.btnImage_fullZoom),
b+=mygis.Utilities.format("<input class='inputID' type='hidden' value='{0}' />",a),a=mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'>{0}</div>",b,50)}return a};b.jqxGrid({source:a,width:"100%",height:"300px",autoheight:!1,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"imageSelected",width:45,columntype:"checkbox",renderer:function(){var a=$("#editImageContainer"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?
' checked="checked"':"";return retobject=mygis.Utilities.format("<div style='{2}'><input id='editDigitizeImageAll' type='checkbox' onclick='{0}'{1}/></div>",'router("editPopup_imageSelectAll",this);',a,"text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;")}},{text:strings.Editing.gridFile_colThumb,datafield:"fileID",width:55,cellsrenderer:c,editable:!1},{text:strings.Editing.gridFile_colName,datafield:"fileNAME",cellsrenderer:c,editable:!1},{text:strings.Editing.gridFile_colActions,
datafield:"",width:200,cellsrenderer:c,editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none",rowsheight:50});b.bind("rowselect",mygis.Drawing.Editing.imageGridSelected);b.bind("rowunselect",mygis.Drawing.Editing.imageGridUnselected);b.bind("cellendedit",mygis.Drawing.Editing.imageGridCheckClicked)},createFileGrid:function(a){$.each(a,function(a,b){b.fileSelected=!1});var a=mygis.Utilities.getLocalGridSource(a),b=$("#editFileContainer"),c=function(a,b,c){switch(b){case "fileID":b=
"";a=this.owner.getrowdata(a).fileNAME.split(".");switch(a[a.length-1].toLowerCase()){case "doc":case "docx":b="doc";break;case "xls":case "xlsx":b="xls";break;case "ppt":case "pptx":b="ppt";break;case "pdf":b="pdf";break;case "png":case "jpg":case "jpeg":case "gif":b="image";break;default:b="unknown"}a="image"==b?mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'><img src='{0}'/></div>",config.folderPath+"GetImage.ashx?qtype=userFile&qSize=50&qContents="+c,50):mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;width: {1}px;'><div class='MMFile2 {0}' /></div>",
b,50);break;case "fileNAME":a=mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'>{0}</div>",c,50);break;default:c="",a=this.owner.getrowdata(a).fileID,c+=mygis.Utilities.format("<a href='#' class='freshButton' onclick='{0}'>{1}</a>",'router("editDigi_btnFileDownload",this);',strings.Editing.btnImage_download),c+=mygis.Utilities.format("<input class='inputID' type='hidden' value='{0}' />",a),a=mygis.Utilities.format("<div class='imageVerticalContainer2' style='height: {1}px;'>{0}</div>",
c,50)}return a};b.jqxGrid({source:a,width:"100%",height:"300px",autoheight:!1,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"fileSelected",width:45,columntype:"checkbox",renderer:function(){var a=$("#editFileContainer"),b=a.jqxGrid("getselectedrowindexes"),a=b?b.length==a.jqxGrid("source").records.length?' checked="checked"':"":!1;return retobject=mygis.Utilities.format("<div style='{2}'><input id='editDigitizeFileAll' type='checkbox' onclick='{0}'{1}/></div>",'router("editPopup_fileSelectAll",this);',
a,"text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;")}},{text:strings.Editing.gridFile_colThumb,datafield:"fileID",width:55,cellsrenderer:c,editable:!1},{text:strings.Editing.gridFile_colName,datafield:"fileNAME",cellsrenderer:c,editable:!1},{text:strings.Editing.gridFile_colActions,datafield:"",width:200,cellsrenderer:c,editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none",rowsheight:50});b.bind("rowselect",mygis.Drawing.Editing.fileGridSelected);
b.bind("rowunselect",mygis.Drawing.Editing.fileGridUnselected);b.bind("cellendedit",mygis.Drawing.Editing.fileGridCheckClicked)},imageGridSelected:function(){var a=$("#editImageContainer"),b=a.jqxGrid("getselectedrowindexes");1<=b.length?$("#editDigitizeTabActions .sectionButtons a")[1].ex_RemoveClassName("disabled"):$("#editDigitizeTabActions .sectionButtons a")[1].ex_AddClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("editDigitizeImageAll").checked=!0:
document.getElementById("editDigitizeImageAll").checked=!1},imageGridUnselected:function(){var a=$("#editImageContainer"),b=a.jqxGrid("getselectedrowindexes");1<=b.length?$("#editDigitizeTabActions .sectionButtons a")[1].ex_RemoveClassName("disabled"):$("#editDigitizeTabActions .sectionButtons a")[1].ex_AddClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("editDigitizeImageAll").checked=!0:document.getElementById("editDigitizeImageAll").checked=!1},imageGridCheckClicked:function(a){var b=
$("#editImageContainer");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},imageGridCheckAll:function(a){var b=$("#editImageContainer"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].imageSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].imageSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},fileGridSelected:function(){var a=$("#editFileContainer"),
b=a.jqxGrid("getselectedrowindexes");1<=b.length?$("#editDigitizeTabActions .sectionButtons a")[1].ex_RemoveClassName("disabled"):$("#editDigitizeTabActions .sectionButtons a")[1].ex_AddClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("editDigitizeFileAll").checked=!0:document.getElementById("editDigitizeFileAll").checked=!1},fileGridUnselected:function(){var a=$("#editFileContainer"),b=a.jqxGrid("getselectedrowindexes");1<=b.length?$("#editDigitizeTabActions .sectionButtons a")[1].ex_RemoveClassName("disabled"):
$("#editDigitizeTabActions .sectionButtons a")[1].ex_AddClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("editDigitizeFileAll").checked=!0:document.getElementById("editDigitizeFileAll").checked=!1},fileGridCheckClicked:function(a){var b=$("#editFileContainer");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},fileGridCheckAll:function(a){var b=$("#editFileContainer"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");
if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].fileSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].fileSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},createFieldDiv:function(a,b){var c;c=$("<div />");c.attr("class","appSetting");var d=$("<label />");d.attr("for","inp__"+a.name);d.html(a.name);var e;switch(b){case "text":e=$("<input type='text' />");break;case "dropdown":e=$("<select />");mygis.Utilities.populateSelect(e[0],a.fieldLists,!0);break;
case "datetime":e=$("<div />"),e.attr("class","datetime")}e.attr("id","inp__"+a.name);c.append(d);c.append(e);return c},isValidOutput:function(a,b){var c=!0;switch(b){case "fields":c=mygis.Drawing.Editing.isValidOutputIntern(a.name);break;case "links":0!=a.name.indexOf("__LNK")&&(c=!1);break;case "images":case "files":c=!1}return c},isValidOutputIntern:function(a){var b=!0;if(a.endsWith("__"))b=!1;else switch(a){case "Geometry":case "GeometryText":case "OID":case "Center_X":case "Center_Y":b=!1}return b},
getInputType:function(a){return 0<a.fieldLists.length?"dropdown":-1<a.originalType.indexOf("char")||-1<a.originalType.indexOf("nchar")||-1<a.originalType.indexOf("varchar")||-1<a.originalType.indexOf("nvarchar")||-1<a.originalType.indexOf("Text")||-1<a.originalType.indexOf("nText")?"text":-1<a.originalType.indexOf("date")?"datetime":"text"},fillDigiPopup:function(a){mygis.Drawing.Editing.clearDigiPopup();mygis.Drawing.Editing.addDigiDefaults();$.each(a,function(a,c){if(mygis.Drawing.Editing.isValidOutput(c,
"fields")){var d=mygis.Drawing.Editing.getInputType(c);$("#appSetting_DigitizeFields").append(mygis.Drawing.Editing.createFieldDiv(c,d))}});$("#appSetting_DigitizeFields .datetime").jqxDateTimeInput({width:"430px",height:"20px"})},checkValidInfo:function(){return!0},digiPopupResult:function(a){!a||"ok"!=a?mygis.UI.cosmeticPop(featuresUnsaved[featuresUnsaved.length-1]):mygis.Drawing.Editing.attachFieldsToFeature()},attachFieldsToFeature:function(a,b){var c;if(c=null==b?featuresUnsaved[featuresUnsaved.length-
1]:b){var d=$(".infoCont.ui-dialog-content .infoFieldsInnerCont .featureVCell");$.each(d,function(a,b){var d=$(b).data("fieldInfo").name,e=$(b).text()==strings.Editing.clickToEdit?"":$(b).text();c.data||(c.data={});c.data[d]=e});a||displayNotify(strings.Editing.tempNewObj+layerSource.records[layerCurrentEditing].layerNAME)}else{cosmeticLayer.destroyFeatures();d=$(".ui-dialog").find(".ui-dialog-content");try{d.dialog("destroy"),d.remove()}catch(e){}displayError(strings.Editing.temporaryError)}},switchToTab:function(a){for(var b=
$("#editDigitizeLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#editDigitizeTab").find(".appSettingFrame");for(c=0;c<b.length;c++)if(c!=a)$(b[c]).hide(),b[c].ex_RemoveClassName("active");else{$(b[c]).show();b[c].ex_AddClassName("active");var d=$(b[c]).find(".sectionButtons");$("#editDigitizeTabActions").empty();$("#editDigitizeTabActions").append(d.clone())}},mg_removeFeature:function(a){cosmeticLayer.deletedFeatures||
(cosmeticLayer.deletedFeatures=[]);for(;0<cosmeticLayer.selectedFeatures.length;){var a=cosmeticLayer.selectedFeatures[0],b={};b.fid=a.fid;cosmeticLayer.deletedFeatures.push(b);featuresDeleted.push(a.fid);drawControls.modify.selectControl.unselect(a);cosmeticLayer.removeFeatures(a)}mygis.UI.notifyUnsavedLayer(layerCurrentEditing)},mg_deleteFeature:function(a,b){featuresDeleted.push(b+"."+a);mygis.Drawing.Exporting.saveDigitizing()},mg_featureModified:function(a,b){var c=b+"."+a;featuresModified[c]||
(featuresModified[c]={});featuresModified[c].data={};featuresModified[c].data.OID=a;mygis.Drawing.Editing.attachFieldsToFeature(!0,featuresModified[c])},mg_updateFeature:function(a,b){mygis.Drawing.Editing.mg_featureModified(a,b);mygis.Drawing.Exporting.saveDigitizing()},editLayer:function(a){a={strategies:[new mygis.Map.strategies.BBOXUnique({ratio:1,resFactor:1})],protocol:new OpenLayers.Protocol.WFS({url:config.mapserver+"wfs",version:"1.1.0",featureType:a,featureNS:config.namespace+"MyGIS",geometryName:"Geometry",
type:"Geometry"}),styleMap:new OpenLayers.StyleMap,preFeatureInsert:function(a){a.geometry.getCentroid()}};digimap.removeLayer(cosmeticLayer);cosmeticLayer.events.unregister("afterfeaturemodified");cosmeticLayer=new OpenLayers.Layer.Vector("Cosmetic Layer",a);digimap.addLayer(cosmeticLayer);digimap.removeControl(drawControls.modify);drawControls.modify=new OpenLayers.Control.ModifyFeature(cosmeticLayer,{createVertices:!1,standalone:!1});switch(featureEditMode){case 4:case 0:drawControls.modify.mode=
OpenLayers.Control.ModifyFeature.DRAG;break;case 1:drawControls.modify.mode=OpenLayers.Control.ModifyFeature.ROTATE;break;case 2:drawControls.modify.mode=OpenLayers.Control.ModifyFeature.RESIZE;break;case 3:drawControls.modify.mode=OpenLayers.Control.ModifyFeature.RESHAPE}OpenLayers.Util.extend(drawControls.modify.selectControl.callbacks,{over:function(a){-1<OpenLayers.Util.indexOf(this.layer.selectedFeatures,a)||this.highlight(a)},out:function(a){-1<OpenLayers.Util.indexOf(this.layer.selectedFeatures,
a)||this.unhighlight(a)}});drawControls.modify.selectControl.renderIntent="select";drawControls.modify.selectControl.multipleKey="shiftKey";digimap.addControl(drawControls.modify);mygis.UI.activateOLControl(drawControls.modify);cosmeticLayer.events.on({afterfeaturemodified:mygis.UI.featureModified,featureselected:function(a){mygis.UI.editFeatureSelected(a);switch(layerSource.records[layerCurrentEditing].layerGeomType){case "Point":document.getElementById("editModeRotate").ex_AddClassName("disabled");
document.getElementById("editModeResize").ex_AddClassName("disabled");document.getElementById("editModeReshape").ex_AddClassName("disabled");break;case "Line":case "Mixed":case "Polygon":document.getElementById("editModeRotate").ex_RemoveClassName("disabled"),document.getElementById("editModeResize").ex_RemoveClassName("disabled"),document.getElementById("editModeReshape").ex_RemoveClassName("disabled")}document.getElementById("selectClear").ex_RemoveClassName("disabled")},featureunselected:function(){}})},
getFinalChanges:function(){for(var a=0;a<featuresDeleted.length;a++){var b=featuresDeleted[a];b.fid?mygis.Drawing.Editing.removeFeatureFromChange(b,featuresModified):mygis.Drawing.Editing.removeFeatureFromChange(b,featuresUnsaved)}a={};a.featuresModified=featuresModified;a.featuresDeleted=featuresDeleted;a.featuresUnsaved=featuresUnsaved;return a},removeFeatureFromChange:function(a,b){for(var c=!1,d=0;d<b.length&&!c;)b[x].fid==a.fid?(c=!0,b.splice(d,1)):d++}},Styling:{polyStyle:{strokeColor:"#FF0000",
fillColor:"#FF0000",strokeOpacity:1,fillOpacity:0.5,strokeWidth:3},lineStyle:{color:"#FF0000",width:3,opacity:1},pointStyle:{icon:config.folderPath+"Images/Styles/marker/location.png",size:32,defaultIcon:config.folderPath+"Images/Styles/marker/location.png"},getOLStyle:function(a){var b;switch(a){case "point":var c=OpenLayers.Util.applyDefaults(c,OpenLayers.Feature.Vector.style.temporary);c.externalGraphic=mygis.Drawing.Styling.pointStyle.icon;c.graphicWidth=mygis.Drawing.Styling.pointStyle.size;
c.graphicHeight=mygis.Drawing.Styling.pointStyle.size;c.graphicOpacity=1;c.graphicXOffset=-16;c.graphicYOffset=-32;b=c;break;case "line":var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Feature.Vector.style.temporary);d.strokeColor=mygis.Drawing.Styling.lineStyle.color;d.strokeOpacity=mygis.Drawing.Styling.lineStyle.opacity;d.strokeWidth=mygis.Drawing.Styling.lineStyle.width;d.strokeDashstyle="longdashdot";b=d;break;case "polygon":var e=OpenLayers.Util.applyDefaults(e,OpenLayers.Feature.Vector.style.temporary);
e.fillColor=mygis.Drawing.Styling.polyStyle.fillColor;e.fillOpacity=mygis.Drawing.Styling.polyStyle.fillOpacity;e.strokeColor=mygis.Drawing.Styling.polyStyle.strokeColor;e.strokeOpacity=mygis.Drawing.Styling.polyStyle.strokeOpacity;e.strokeWidth=mygis.Drawing.Styling.polyStyle.strokeWidth;b=e;break;case "selectPolygon":e=OpenLayers.Util.applyDefaults(e,OpenLayers.Feature.Vector.style.temporary);e.strokeColor="#000000";e.fillColor="#FF00FF";e.strokeOpacity=1;e.fillOpacity=0.5;e.strokeWidth=0.7;b=e;
break;case "selectLine":d=OpenLayers.Util.applyDefaults(d,OpenLayers.Feature.Vector.style.temporary);d.strokeColor="#FF0000";d.fillColor="#FF0000";d.strokeOpacity=1;d.fillOpacity=0.7;d.strokeWidth=0.7;b=d;break;case "selectPoint":c=OpenLayers.Util.applyDefaults(c,OpenLayers.Feature.Vector.style.temporary),c.strokeColor="#000000",c.fillColor="#000000",c.fillOpacity=0.7,b=c}return b},getSymbolizer:function(a){var b={},c;switch(a){case "Point":c={strokeColor:"",strokeOpacity:1,strokeWidth:1,strokeLinecap:"square",
fillColor:"#FF0000",fillOpacity:1,pointRadius:5,externalGraphic:"",graphicWidth:16,graphicHeight:16,graphicOpacity:1,graphicXOffset:0,graphicYOffset:0,rotation:0,graphicName:""};break;case "Line":c={strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,strokeLinecap:"square"};break;case "Polygon":c={strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,strokeLinecap:"square",fillColor:"#FF0000",fillOpacity:1}}b[a]=c;return b},createSLD:function(a,b){var c={version:"1.0.0",namedLayers:{}},d={};d.name=
a;d.userStyles=[];d.userStyles[0]={rules:[]};switch(b){case "Point":d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("","Point",a));break;case "Line":d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("","Line",a));break;case "Polygon":d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("","Polygon",a));break;case "Mixed":d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("","Point",a)),d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("",
"Line",a)),d.userStyles[0].rules.push(new mygis.Drawing.Styling.createSLDRule("","Polygon",a))}c.namedLayers[a]=d;return c},createSLDRule:function(a,b,c){if(!a)switch(b){case "Point":a=c+" - Points";break;case "Line":a=c+" - Lines";break;case "Polygon":a=c+" - Polygons";break;case "Text":a=c+" - labels";break;default:a=c}b?(c=new mygis.Drawing.Styling.getSymbolizer(b),b=new OpenLayers.Rule({name:a,title:a,description:"",symbolizer:c,filter:mygis.Drawing.Styling.getSLDFilter("EQ","Geometry",b)})):
b=new OpenLayers.Rule({name:a,title:a,description:""});return b},getSLDFilter:function(a,b,c){var d,e;switch(a){case "EQ":e=OpenLayers.Filter.Comparison.EQUAL_TO;break;case "LIKE":e=OpenLayers.Filter.Comparison.LIKE;break;case "NEQ":e=OpenLayers.Filter.Comparison.NOT_EQUAL_TO;break;case "GEQ":e=OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO;break;case "GT":e=OpenLayers.Filter.Comparison.GREATER_THAN;break;case "LT":e=OpenLayers.Filter.Comparison.LESS_THAN;break;case "LEQ":e=OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO}if("Geometry"==
b&&"Point"!=c)switch(c){case "Polygon":d=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:e,property:b,value:c}),new OpenLayers.Filter.Comparison({type:e,property:b,value:"MultiPolygon"})]});break;case "Line":d=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:e,property:b,value:"LineString"}),new OpenLayers.Filter.Comparison({type:e,property:b,value:"MultiLineString"})]})}else d=
new OpenLayers.Filter.Comparison({type:e,property:b,value:c});return d},showStyleManager:function(){$("#styleManagerTitleElem").html("Manager");$("#styleManager").dialog({autoOpen:!0,modal:!0,resizable:!1,width:900,height:510,title:"",closeOnEscape:!1})},styleManager_switchTab:function(a){for(var b=$("#styleManagerLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#styleManagerHeaderTab").find(".appSettingFrame");for(c=
0;c<b.length;c++)c!=a?$(b[c]).hide():$(b[c]).show()}},Exporting:{exportMapAs:function(a){var b,c=digimap.getExtent().toBBOX(),d=digimap.projection.toString(),e=digimap.getSize(),f=mygis.Utilities.getVisibleLayerString(currentAppName),g;switch(digimap.baseLayer.params.LAYERS){case "landsat5":case "KTBASEMAP":case "landsat":case "openstreetmap":case "bluemarble":g=digimap.baseLayer.params.LAYERS;break;default:g="openstreetmap"}switch(a){case "jpg":b="image/jpeg";break;case "png":b="image/png";break;
case "pdf":b="application/pdf";break;case "kml":b="application/vnd.google-earth.kml+xml";break;case "kmz":b="application/vnd.google-earth.kmz+xml"}a=mygis.Utilities.format(config.mapserver+"wms?service=WMS&version=1.1.0&request=GetMap&layers={0}&styles=&bbox={1}&width={2}&height={3}&srs={4}&format={5}&TILED=TRUE",g+","+f,c,e.w,e.h,d,b);window.open(a)},layerToJSON:function(a){var b="",a=a.features;return b=(new OpenLayers.Format.GeoJSON).write(a)},layerToWKT:function(a){for(var b="",a=a.features,c=
new OpenLayers.Format.WKT,d=0;d<a.length;d++)0<d&&(b+="$"),a[d].geometry.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),b+=c.write(a[d]),a[d].geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));return b},arrayToWKT:function(a){for(var b="",c=new OpenLayers.Format.WKT,d=0;d<a.length;d++)a[d].geometry.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),0<d&&(b+="$"),b+=
c.write(a[d]);return b},checkDigitizing:function(a){mygis.Drawing.Editing.attachFieldsToFeature(!0);if(mygis.Drawing.Editing.isFilledIn(featuresUnsaved[featuresUnsaved.length-1].data))return 0<$(a.target).closest(".ui-dialog").find("form .error").length?showConfirmationDialog(strings.Editing.loseAllChanges,function(){var b=$(a.target).closest(".ui-dialog").find(".ui-dialog-content");try{b.dialog("destroy"),b.remove()}catch(c){}console.log("removed 1");mygis.UI.clearUnsavedLayer(layerCurrentEditing);
digimap.layers[1].redraw(!0);mygis.UI.activateControl("drag")},function(){console.log("cancelled");return!1}):showConfirmationDialog(strings.Editing.saveNewObjQuestion,function(){var b=$(a.target).closest(".ui-dialog").find(".ui-dialog-content");try{b.dialog("destroy"),b.remove()}catch(c){}console.log("removed 2");mygis.Drawing.Exporting.saveDigitizing()},function(){console.log("cancelled");return!1}),!1;cosmeticLayer.destroyFeatures();var b=$(a.target).closest(".ui-dialog").find(".ui-dialog-content");
try{b.dialog("destroy"),b.remove()}catch(c){}console.log("removed 3")},checkRights:function(a,b,c){retvalue=!1;if(!$.isEmptyObject(internalMemory.layerRights)){var d=function(b){return b.objectID==a};if(internalMemory.layerRights[b]&&(b=internalMemory.layerRights[b].find(d))){if(("update"==c||null==c)&&(b.hasUpdate||b.isOwner))retvalue=!0;if(("delete"==c||null==c)&&(b.hasDelete||b.isOwner))retvalue=!0}}return retvalue},saveDigitizing:function(){var a=layerSource.records[layerCurrentEditing].layerTABLE,
b={},c="",d="",e="",f=mygis.Drawing.Editing.getFinalChanges();$.each(f.featuresUnsaved,function(a,b){0<a&&(c+="$",d+="$",e+="$");var f=0;$.each(b.data,function(a,b){f>0&&(c=c+"#");c=c+(a.toString()+"%"+b.toString());f++});var g=0;b.attachedImages&&$.each(b.attachedImages,function(a,b){g>0&&(d=d+"#");d=d+b.toString();g++});var n=0;b.attachedFiles&&$.each(b.attachedFiles,function(a,b){n>0&&(e=e+"#");e=e+b.toString();n++})});b.layerID=layerSource.records[layerCurrentEditing].layerID;b.layername=a;b.featureAttr=
c;b.featureImages=d;b.featureFiles=e;b.geometry=mygis.Drawing.Exporting.arrayToWKT(f.featuresUnsaved);b.crs=digimap.displayProjection.toString();new OpenLayers.Format.WKT;var g=[];$.each(f.featuresModified,function(a,b){var c="";counter=0;var d={},c="";counter=0;b.attachedImages&&$.each(b.attachedImages,function(a,b){0<counter&&(c+="#");c+=b.toString();counter+=1});d.images=c;c="";counter=0;b.attachedFiles&&$.each(b.attachedFiles,function(a,b){0<counter&&(c+="#");c+=b.toString();counter+=1});d.files=
c;d.data=b.data;g.push(d)});b.modified=JSON.stringify(g);g="";counter=0;$.each(f.featuresDeleted,function(a,b){0<counter&&(g+="#");g+=b;counter+=1});b.deleted=g;$.ajax({type:"POST",url:config.mgreq+"?qtype=SaveDigitizing",data:b,success:mygis.UI.saveDigiResults})},updateStyle:function(){var a={};a.layer=layername;a.sld=null;$.ajax({type:"POST",url:config.mgreq+"?qtype=updateStyle",data:a,success:null})},attachInfoToFeature:function(){var a=featuresUnsaved[featuresUnsaved.length-1],b=$("#editableInfo"),
c=b.find(".infoFields span.featureHCell"),b=b.find(".infoFields input.featureVCell");$.each(b,function(b,e){a.data[$(c[b]).html()]=e.value;e.value=""});displayNotify(strings.Editing.tempNewObj+layerSource.records[layerCurrentEditing].layerNAME)}},Importing:{loadKML:function(a,b){var c=new OpenLayers.Format.KML({internalProjection:digimap.baseLayer.projection,externalProjection:new OpenLayers.Projection("EPSG:4326"),extractStyles:!0,extractAttributes:!0}),d=new OpenLayers.Layer.Vector(b);setTimeout(function(){d.addFeatures(c.read(a))},
25);digimap.addLayers([d])}}};
mygis.OLOverrides={CustomDragControl:OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{stopDown:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Drag(this,{down:this.onDown,move:this.onMove,up:this.onUp},this.handlerOptions)},onDown:function(){},onMove:function(){},onUp:function(){internalMemory.lastZoom=digimap.getExtent()}}),mygis_Control:{mygis_GetFeature:{mygis_request:function(a,
b){var b=b||{},c;if(customFiltered){var d=new OpenLayers.Format.CQL,e=mygis.Map.getCustomFilter(this.protocol.featureType);try{var f=d.read(e),g=this.circle?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,value:a}):new OpenLayers.Filter.Spatial({type:this.filterType,value:a});c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[f,g]})}catch(h){console.log("Error in converting CQL filter: "+h.message),c=this.circle?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,
value:a}):new OpenLayers.Filter.Spatial({type:this.filterType,value:a})}}else c=this.circle?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,value:a}):new OpenLayers.Filter.Spatial({type:this.filterType,value:a});mygis.Utilities.blockUI();c=this.protocol.read({maxFeatures:!0==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){mygis.Utilities.unblockUI();c.success()&&(c.features.length?this.circle?mygis.OLOverrides.mygis_Control.mygis_GetFeature.selectBestFeature_Circle(c.features,
a.getCentroid(),b,this):this.selectBestFeature(c.features,a.getCenterLonLat(),b):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll(),displayShortNotify(strings.Info.noResults),document.getElementById("panel3Out").ex_HasClassName("collapsed")||(document.getElementById("panel3Out").ex_AddClassName("collapsed"),document.getElementById("rpanelCollapseBtn").ex_RemoveClassName("active"),document.getElementById("panel2").ex_RemoveClassName("rightExpanded"))));
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});!0==b.hover&&(this.hoverResponse=c)},mygis_selectBestFeature:function(a,b,c){c=c||{};if(a.length){var d=new OpenLayers.Geometry.Point(b.lon,b.lat),e,f,g=Number.MAX_VALUE,h,k=[];for(h=a.length-1;0<=h;h--)b=a[h],(b.geometry instanceof OpenLayers.Geometry.Polygon||b.geometry instanceof OpenLayers.Geometry.MultiPolygon)&&k.push(a.pop());var l=function(a){a.geometry&&(f=d.distanceTo(a.geometry,{edge:!1}),f<g&&(g=f,e=a))};
if(a.length)for(h=0;h<a.length;++h)b=a[h],l(b);else{k.reverse();for(h=0;h<k.length;++h)b=k[h],l(b)}!0==c.hover?this.hoverSelect(e):this.select(e||a)}},mygis_selectBestFeature_v2:function(a){mygis.UI.isActiveSelectMode("mode_TopSelect")?this.select(mygis.Map.selectTopFeatures(a)):this.select(a)},selectBestFeature_Circle:function(a,b,c,d){c=c||{};if(a.length){for(var e=new OpenLayers.Geometry.Point(b.x,b.y),f,g,h=Number.MAX_VALUE,k=0;k<a.length&&!(b=a[k],b.geometry&&(g=e.distanceTo(b.geometry,{edge:!1}),
g<h&&(h=g,f=b,0==h)));++k);if(!0==c.hover)d.hoverSelect(f);else if(a=a||f,!d.multiple&&!d.toggle&&d.unselectAll(),OpenLayers.Util.isArray(a)||(a=[a]),c=d.events.triggerEvent("beforefeaturesselected",{features:a}),!1!==c){f=[];k=0;for(e=a.length;k<e;++k)b=a[k],d.features[b.fid||b.id]?d.toggle&&d.unselect(d.features[b.fid||b.id]):(c=d.events.triggerEvent("beforefeatureselected",{feature:b}),!1!==c&&(d.features[b.fid||b.id]=b,f.push(b),d.events.triggerEvent("featureselected",{feature:b})));d.events.triggerEvent("featuresselected",
{features:f})}}}}}};
mygis.Map={overrideDefaults:function(a){internalConfig.changeDefaultMap=a},setDigiVars:function(a,b,c){backgrounds={google:{terrain:{name:strings.BackgroundLayers.google_terrain,options:{type:google.maps.MapTypeId.TERRAIN,numZoomLevels:20,sphericalMercator:!0,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),attribution:"Map data \u00a92014 Basarsoft,Google"},isWMS:!1},roadmap:{name:strings.BackgroundLayers.google_roadmap,options:{type:google.maps.MapTypeId.ROADMAP,numZoomLevels:20,
sphericalMercator:!0,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),attribution:"Map data \u00a92014 Basarsoft,Google"},isWMS:!1},satellite:{name:strings.BackgroundLayers.google_satellite,options:{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:20,sphericalMercator:!0,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),attribution:"Map data \u00a92014 Basarsoft,Google"},isWMS:!1},hybrid:{name:strings.BackgroundLayers.google_hybrid,
options:{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20,sphericalMercator:!0,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),attribution:"Map data \u00a92014 Basarsoft,Google"},isWMS:!1}},ktimatologio:{name:strings.BackgroundLayers.ktimatologio,url:"http://gis.ktimanet.gr/wms/wmsopen/wmsserver.aspx",options:{layers:"KTBASEMAP",TILED:"true",format:"image/png",CRS:"EPSG:4326"},secondaryOptions:{tileSize:new OpenLayers.Size(256,256),isBaseLayer:!0,attribution:strings.BackgroundLayers.ktimatologio_attrib,
buffer:0},mg_MinScale:-1,mg_MaxScale:27E6,isWMS:!0},opengeo_BLUEMARBLE:{name:strings.BackgroundLayers.opengeo_BLUEMARBLE,url:"http://map1.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi",options:{layers:"BlueMarble_NextGeneration",TILED:"true",format:"image/jpeg",CRS:"EPSG:4326"},secondaryOptions:{tileSize:new OpenLayers.Size(256,256),isBaseLayer:!0,attribution:strings.BackgroundLayers.opengeo_BLUEMARBLE_attrib,buffer:0},mg_MinScale:8E5,mg_MaxScale:-1},opengeo_OSM:{name:"OpenStreetMap",url:"http://maps.opengeo.org/geowebcache/service/wms",
options:{layers:"openstreetmap",TILED:"true",format:"image/png",CRS:"EPSG:4326"},secondaryOptions:{tileSize:new OpenLayers.Size(256,256),isBaseLayer:!0,attribution:strings.BackgroundLayers.opengeo_OSM_attrib},mg_MinScale:-1,mg_MaxScale:-1,isWMS:!0},nasa_LANDSAT:{name:strings.BackgroundLayers.nasa_LANDSAT,url:"http://irs.gis-lab.info/",options:{layers:"landsat",TILED:"true",format:"image/jpeg",CRS:"EPSG:4326"},secondaryOptions:{tileSize:new OpenLayers.Size(256,256),isBaseLayer:!0,attribution:strings.BackgroundLayers.nasa_LANDSAT_attrib},
mg_MinScale:-1,mg_MaxScale:-1,isWMS:!0}};digiContainer=document.getElementById(a);if(c)try{c[0]&&(appPath=c[0]),c[2]&&(postbackurl=c[2]),c[3]&&(extra=c[3]),c[4]&&(myguid=c[4]),c[5]&&(postbackurl=c[5])}catch(d){}if(b)for(a=0;a<b.length;a++)switch(b[a]){case 0:toolsEnabled.allTools=!0;break;case 1:toolsEnabled.toolbar=!0;break;case 2:toolsEnabled.search=!0;break;case 3:toolsEnabled.maps=!0;break;case 4:toolsEnabled.layers=!0;break;case 5:toolsEnabled.marker=!0;break;case 6:toolsEnabled.filledRect=!0;
break;case 7:toolsEnabled.openRect=!0;break;case 8:toolsEnabled.filledCircle=!0;break;case 9:toolsEnabled.openCircle=!0;break;case 10:toolsEnabled.openPolygon=!0;break;case 11:toolsEnabled.filledPolygon=!0;break;case 12:toolsEnabled.polyLine=!0;break;case 13:toolsEnabled.polyLineDirections=!0;break;case 14:toolsEnabled.database=!0}mygis.Map.initMap()},initMap:function(){$.when(loadGoogleMaps(3,null,"el-GR")).then(function(){mygis.Utilities.googleAutoComplete()});var a=new OpenLayers.Projection("EPSG:900913"),
b=new OpenLayers.Projection("EPSG:4326");naviControls={navigation:new OpenLayers.Control.Navigation({handleRightClicks:!1,autoActive:!0,dragPanOptions:{enableKinetic:!0}}),zoomBox:new OpenLayers.Control.ZoomBox};var c=new OpenLayers.Layer.OSM;digimap=new OpenLayers.Map(digiContainer.id,{units:"m",projection:a,displayProjection:b,fractionalZoom:!1,minResolution:1.0E-8,maxResolution:"auto",controls:[new OpenLayers.Control.ScaleBar({div:OpenLayers.Util.getElement("olScaleLine_wrapper"),geodesic:!0,minWidth:150,
abbreviateLabel:!0}),new OpenLayers.Control.Permalink({id:"permalink",element:OpenLayers.Util.getElement("permaElem"),div:OpenLayers.Util.getElement("permaContainer")}),new OpenLayers.Control.Attribution({template:"\u00a9 2012 AVMap GIS S.A., MyGIS\u2122 , ${layers}",div:OpenLayers.Util.getElement("customAttribution")}),new OpenLayers.Control.MousePosition({div:OpenLayers.Util.getElement("ll_mouse"),id:"ll_mouse",formatOutput:mygis.Utilities.formatLonlats})]});digimap.addControl(naviControls.navigation);
digimap.addControl(naviControls.zoomBox);digimap.addControl(new mygis.OLOverrides.CustomDragControl({autoActivate:!0}));a=new OpenLayers.Layer("No Basemap",{isBaseLayer:!0});a=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:40});digimap.addLayers([a]);naviControls.overview=new OpenLayers.Control.OverviewMap({div:OpenLayers.Util.getElement("customOverview"),size:new OpenLayers.Size(245,104),layers:[c.clone()],maximized:!0,autoPan:!0,mapOptions:{tileSize:new OpenLayers.Size(104,
104),zoom:5}});naviControls.overview.isSuitableOverview=function(){return!1};digimap.addControl(naviControls.overview);digimap.events.register("zoomend",digimap,function(){document.getElementById("currentScale").innerHTML="<span class='scalepart1'>1</span><span class='scalepart2'>:</span><span class='scalepart3'> "+mygis.Utilities.addCommas(digimap.getScale().toFixed(0))+"</span>";document.getElementById("currentScale").innerHTML="1: "+mygis.Utilities.addCommas(digimap.getScale().toFixed(0));mygis.Map.checkScaleConstraints()});
digimap.events.register("moveend",digimap,function(){clearTimeout(internalConfig.moveendEvent);internalConfig.moveendEvent=setTimeout(mygis.Map.moveEnd,500)});mygis.UI.createContextMenu("map");c=new OpenLayers.StyleMap(OpenLayers.Util.applyDefaults({externalGraphic:config.folderPath+"Images/target4.png",graphicWidth:24,graphicHeight:24,graphicXOffset:-12,graphicYOffset:-12,graphicOpacity:1},OpenLayers.Feature.Vector.style["default"]));cosmeticLayer=new OpenLayers.Layer.Vector("Cosmetic Layer",{preFeatureInsert:function(){}});
selectionLayer=new OpenLayers.Layer.Vector("Selection Layer",{styleMap:c,preFeatureInsert:function(a){var b=a.geometry.getCentroid().y;90>b&&-190<b&&a.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))}});feedbackLayer=new OpenLayers.Layer.Vector("Feedback Layer",{preFeatureInsert:function(a){var b=a.geometry.getCentroid().y;90>b&&-190<b&&a.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))}});digimap.addLayers([cosmeticLayer,
selectionLayer,feedbackLayer]);var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Feature.Vector.style.temporary);drawControls={marker:new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.Point,{featureAdded:function(a){a.overlaytype="marker";mygis.UI.increaseMarkers(a)}}),polyline:new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.Path,{featureAdded:function(a){a.overlaytype="polyline";mygis.UI.increasePolylines(a)}}),polygon:new OpenLayers.Control.DrawFeature(cosmeticLayer,
OpenLayers.Handler.Polygon,{featureAdded:function(a){a.overlaytype="polygon";mygis.UI.increasePolygons(a)}}),rectangle:new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.RegularPolygon,{featureAdded:function(a){a.overlaytype="rectangle";mygis.UI.increasePolygons(a)}}),modify:new OpenLayers.Control.ModifyFeature(cosmeticLayer,{mode:OpenLayers.Control.ModifyFeature.RESHAPE,createVertices:!0}),selection:new OpenLayers.Control.DrawFeature(selectionLayer,OpenLayers.Handler.Point,{handlerOptions:{style:mygis.Drawing.Styling.getOLStyle("point")},
featureAdded:function(a){a.style=mygis.Drawing.Styling.getOLStyle("point");this.layer.redraw()}})};for(var e in drawControls)digimap.addControl(drawControls[e]);d=mygis.Map.createLogo();$("#avlogo_wrapper").append(d);mygis.UI.setProjectionTip();mygis.UI.createEditableInfo();mygis.Map.infoInit();$(document).bind("keydown",function(a){if(a.ctrlKey||a.metaKey)switch(String.fromCharCode(a.which).toLowerCase()){case "i":a.preventDefault();router("selectCtrl",document.getElementById("infoTool"));break;
case "f":a.preventDefault(),router("mapFeatureSearchOpen")}else switch(a.which){case 27:$("#mapFeatureSearchBar").is(":visible")&&(a.preventDefault(),router("mapFeatureSearchClose"));try{$.xhrPool.abortAll(),mygis.Utilities.unblockUI()}catch(b){}}});$("#mapFeatureSearch").bind("keydown",function(a){13==a.keyCode&&(internalMemory.searchKeyword=$("#mapFeatureSearch").val(),$("#mapFeaturesCont").is(":visible")?mygis.Map.gotoNextFeatureResult():($("#mapFeaturesCont").show(),$("#mapResultsToggleBtn").attr("class",
"pressed"),mygis.Map.moveEnd()))})},createNewLayer:function(a){var b={};$.each(layerSource.records[0],function(a){b[a]=""});b.mapID=$("#mapsList").jqxListBox("getSelectedItem").originalItem.id;b.layerNAME=a;b.layerTABLE=currentAppName+"_"+a;layerSource.records.splice(0,0,b);mygis.UI.updateLayerGrid()},moveEnd:function(){naviControls.overview.ovmap.setCenter(digimap.getCenter());if($("#mapFeaturesCont").is(":visible")){var a=digimap.getExtent().transform(digimap.getProjection(),new OpenLayers.Projection("EPSG:4326")).toString();
clearTimeout(internalConfig.moveendEvent);digimap.events.remove("moveend");var b=[];$.each(layerSource.records,function(a,d){!0!==Boolean(d.hidden)&&!0===Boolean(d.Selectable)&&b.push(d.layerTABLE)});a=config.mgreq+"?qtype=GetFeatureCount&qContents="+JSON.stringify({extent:a,layers:b});$("#mapFeaturesCont").die().empty();$("#mapFeaturesCont").addClass("loading");$.ajax({type:"GET",url:a,success:function(a){a=eval(a);$("#mapFeaturesCont").data("results",a);var b=0;$.each(a,function(a,c){var e=$("<div id='featureResult_"+
b+"' class='featureResult' />"),k=$("<h3 class='resultLabel'>"+mygis.Utilities.getFriendlyName(c.TableName)+"</h3>");e.append("<div id='featureResultGrid_"+b+"' />");$("#mapFeaturesCont").append(k);$("#mapFeaturesCont").append(e);b++});b=0;$.each(a,function(a,c){var e=[],k=[],l=mygis.Utilities.mggetLayerID(c.TableName);$.each(c.Fields,function(a,b){mygis.Drawing.Editing.isValidOutputIntern(b.Name)&&k.push({text:internalMemory.layerFields[l][b.Name].friendlyName,datafield:b.Name})});$.each(c.Rows,
function(a,b){var c={};$.each(b.Cells,function(a,b){mygis.Drawing.Editing.isValidOutputIntern(b.ColumnName)&&(c[b.ColumnName]=b.Value)});e.push(c)});var m={datatype:"array",localdata:e};$("#featureResultGrid_"+b).jqxGrid({source:m,width:"100%",rowheight:29,autoheight:!0,theme:"pk_mg",columns:k,enableanimations:!0,enabletooltips:!0,rowdetails:!1,sortable:!0,groupable:!1,showheader:!0,showgroupsheader:!1,editable:!1,pageable:!1,columnsresize:!0,columnsmenu:!1,columnsreorder:!0,pageable:!0,pagesize:5,
pagesizeoptions:[5,10,20,50,100,200],selectionmode:"singlecell"});b++});try{$("#mapFeaturesCont").accordion("destroy")}catch(e){}$("#mapFeaturesCont").accordion({fillSpace:!0,heightStyle:"auto",active:0,collapsible:!0,activate:function(a,b){var c=b.newPanel[0].id.split("_")[1];$("#featureResultGrid_"+c).jqxGrid("render");$("#mapFeaturesCont").scrollTo($("#mapFeaturesCont .resultLabel.ui-state-active"))},create:function(){internalMemory.mapFeatureResults=null;internalMemory.searchKeyword&&mygis.Map.highlightMapFeatureResult(internalMemory.searchKeyword)}});
$("#mapFeaturesCont").removeClass("loading")}});digimap.events.register("movestart",digimap,function(){$("#mapFeaturesCont").die().empty();$("#mapFeaturesCont").addClass("loading")});digimap.events.register("moveend",digimap,function(){clearTimeout(internalConfig.moveendEvent);internalConfig.moveendEvent=setTimeout(mygis.Map.moveEnd,500)})}},getFieldDescriptions:function(){$.each(layerSource.records,function(a,b){$.ajax({type:"GET",url:config.mgreq+"?qtype=GetLayerFields&qContents="+escape(b.layerTABLE.replace(/ /g,
"_")),success:function(a){a=eval(a);$.each(a,function(a,b){internalMemory.layerFields[b.layerID]||(internalMemory.layerFields[b.layerID]={});internalMemory.layerFields[b.layerID][b.fieldNAME]=b})}})})},showSearchPanel:function(){mygis.UI.resetControls();$("#mapFeatureSearchBar").show();$("#mapFeatureSearch").focus()},hideSearchPanel:function(){$("#mapFeatureSearchBar").hide();mygis.UI.Help.shortcutStart();$("#mapFeatureSearch").val("");internalMemory.searchKeyword=""},highlightMapFeatureResult:function(a){var b=
a.toUpperCase(),a=$("#mapFeaturesCont").data("results"),c=[];$.each(a,function(a,e){var f=e.TableName;$.each(e.Rows,function(e,h){$.each(h.Cells,function(h,l){mygis.Drawing.Editing.isValidOutputIntern(l.ColumnName)&&l.Value.toUpperCase().contains(b)&&c.push({tableName:f,tableIndex:a,rowIndex:e,cellIndex:h,cellName:l.ColumnName})})})});internalMemory.mapFeatureResults=c;internalMemory.mapFeatureCurrentIndex=-1;mygis.Map.gotoNextFeatureResult()},gotoNextFeatureResult:function(){if(internalMemory.mapFeatureResults){var a=
internalMemory.mapFeatureCurrentIndex;a+1>=internalMemory.mapFeatureResults.length?a=0:a++;internalMemory.mapFeatureCurrentIndex=a;mygis.Map.showFeatureResult()}else(a=$("#mapFeatureSearch").val())&&mygis.Map.highlightMapFeatureResult(a)},gotoPreviousFeatureResult:function(){if(internalMemory.mapFeatureResults){var a=internalMemory.mapFeatureResults.length,b=internalMemory.mapFeatureCurrentIndex;0>b-1?b=a-1:b--;internalMemory.mapFeatureCurrentIndex=b;mygis.Map.showFeatureResult()}else(a=$("#mapFeatureSearch").val())&&
mygis.Map.highlightMapFeatureResult(a)},showFeatureResult:function(){var a=internalMemory.mapFeatureResults[internalMemory.mapFeatureCurrentIndex];try{$("#mapFeaturesCont").accordion("option","active",a.tableIndex)}catch(b){}$("#featureResultGrid_"+a.tableIndex).jqxGrid("ensurerowvisible",a.rowIndex);$("#featureResultGrid_"+a.tableIndex).jqxGrid("selectcell",a.rowIndex,a.cellName)},getBackgroundWMS:function(a){var a=backgrounds[a],b;a&&(b=new OpenLayers.Layer.WMS(a.name,a.url,a.options,a.secondaryOptions));
b.mg_MinScale=a.mg_MinScale;b.mg_MaxScale=a.mg_MaxScale;return b},getBackground:function(a){var b=a.split("."),c;if(1<b.length)switch(b[0]){case "google":a=backgrounds[b[0]][b[1]],c=new OpenLayers.Layer.Google(a.name,a.options)}else switch(a){case "opengeo_BLUEMARBLE":c=new OpenLayers.Layer.WMTS({name:backgrounds.opengeo_BLUEMARBLE.name,url:["//map1a.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi","//map1a.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi","//map1a.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi"],
layer:"BlueMarble_NextGeneration",style:"",matrixSet:"GoogleMapsCompatible_Level8",maxResolution:156543.03390625,numZoomLevels:8,maxExtent:[-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7],tileSize:new OpenLayers.Size(256,256),format:"image/jpeg",projection:"EPSG:3857",isBaseLayer:!0});c.mergeNewParams({time:"2015-10-28"});break;case "opengeo_OSM":c=new OpenLayers.Layer.OSM;break;default:c=mygis.Map.getBackgroundWMS(a)}return c},switchBackground:function(a,b){var c=mygis.Map.getBackground(a),
d=digimap.layers[b];digimap.addLayer(c);d.isBaseLayer&&digimap.setBaseLayer(c);digimap.removeLayer(d);digimap.setLayerIndex(c,b);mygis.UI.updateLayerGrid()},getCustomFilter:function(a){var b="",c=layerSource.records,d=internalConfig.myCustomFilters,e=[];if(void 0==a)for(a=c.length-1;0<=a;a--)!0!==Boolean(c[a].hidden)&&e.push(c[a].layerTABLE);else e=a;for(a=0;a<e.length;a++)if(0<a&&(b+=";"),d[e[a]])for(prop in c=0,d[e[a]]){var f=d[e[a]][prop],g=!1;0<c&&null!=f&&(b+=" AND (",g=!0);f&&(b+=f,g&&(b+=")"));
c+=1}else b+="1=1";return b},ZoomOut:function(){digimap.zoomTo(digimap.getZoom()-1)},infoInit:function(){infoControls={click:new OpenLayers.Control.WMSGetFeatureInfo({url:config.mapserver+"wms",title:"Identify features by clicking",drillDown:!0,infoFormat:"text/html",maxFeatures:10,layers:[digimap.layers[1]],vendorParams:{EXCEPTIONS:"XML"}}),select:new OpenLayers.Control.GetFeature({protocol:null,box:!0,hover:!1,multipleKey:"",toggleKey:""}),select_circle:new OpenLayers.Control.GetFeature({protocol:null,
circle:!0,hover:!1,multipleKey:"",toggleKey:""})};infoControls.click.events.register("getfeatureinfo",this,mygis.Map.showInfo2);for(var a in infoControls)digimap.addControl(infoControls[a])},elementPosition:function(a){var b=0,c=0;if(a="string"==typeof a?document.getElementById(a):a)for(var b=a.offsetLeft,c=a.offsetTop,d=document.getElementsByTagName("body")[0];a.offsetParent&&a!=d;)b+=a.offsetParent.offsetLeft,c+=a.offsetParent.offsetTop,a=a.offsetParent;a={};a.x=b;a.y=c;mapContainerPosition=a},
createLogo:function(){var a=document.createElement("DIV"),b=document.createElement("INPUT");b.id="AVLogoBtn";b.type="button";$(b).bind("click",function(){window.open("http://www.avmap.gr/")});a.appendChild(b);return a},createLogoSmartest:function(){var a=document.createElement("DIV"),b=document.createElement("a");b.id="SmartestBtn";a.appendChild(b);$(a).css({position:"absolute",bottom:0,"z-index":999,left:10});return a},createLogoCordis:function(){var a=document.createElement("DIV"),b=document.createElement("a");
b.id="CordisBtn";a.appendChild(b);$(a).css({position:"absolute",bottom:0,"z-index":999,left:10});return a},createLogoEU:function(){var a=document.createElement("DIV"),b=document.createElement("a");b.id="EUBtn";a.appendChild(b);$(a).css({position:"absolute",bottom:0,"z-index":999,left:10});return a},styleButton:function(){$("#editmodeButton").button()},clearMap:function(){try{mygis.Map.deleteOverlays(),mygis.Map.clearSelection()}catch(a){}},clearSelection:function(a){selectionLayer.removeAllFeatures();
drawControls.modify.selectControl.unselectAll();infoWindows=[];infoWindowInitialized||initializeInfoWindow();a&&$("#infoLeftList").jqxListBox({source:layerSource,displayMember:"layerNAME",valueMember:"layerID"});document.getElementById("selectClear").ex_AddClassName("disabled");mygis.UI.queryResultsReset()},setSelectableLayers:function(a,b){b.jqxListBox("uncheckAll");$.each(a,function(a,d){if("True"==d.Selectable||d.Selectable){for(var e=d.layerTABLE,f=!1,g=null,h=0,k=b.jqxListBox("getItems");!f&&
h<k.length;){var l=b.jqxListBox("getItem",h);l.value==e?(f=!0,g=l):h++}(d=g)&&b.jqxListBox("checkIndex",d.index)}})},determineSelectionToggleStatus:function(a){var b=0,c="";switch(a){case "#layerSelectionList":c="#layerSelectionToggleBtn";break;case "#layerWithinSelectionList":c="#layerWithinSelectionToggleBtn"}var d=$(a),a=d.jqxListBox("getItems"),d=d.jqxListBox("getCheckedItems");a.length==d.length?b=2:a.length>d.length&&0<d.length&&(b=1);$(c).removeClass("checked");$(c).removeClass("indeterminate");
switch(b){case 2:$(c).addClass("checked");break;case 1:$(c).addClass("indeterminate")}},switchSelectionToggleBtn:function(a){var b="";switch(a){case "#layerSelectionToggleBtn":b="#layerSelectionList";break;case "#layerWithinSelectionToggleBtn":b="#layerWithinSelectionList"}a=$(a);b=$(b);a.hasClass("checked")?(a.removeClass("checked"),b.jqxListBox("uncheckAll")):(a.removeClass("indeterminate"),a.addClass("checked"),b.jqxListBox("checkAll"))},deleteOverlays:function(){for(var a,b=0;b<digimap.getNumLayers();)if(a=
digimap.layers[b],a.events.remove("loadend"),!a.isBaseLayer&&!("Cosmetic Layer"==a.name||"Selection Layer"==a.name||"Feedback Layer"==a.name))try{a.destroy(!1)}catch(c){}else b++},getMapServerLayer:function(a,b,c){c.split(",");return new OpenLayers.Layer.WMS(a,config.mapserver+"wms",{layers:customStyleApplied?null:a,EXCEPTIONS:"BLANK",FORMAT:"image/png",transparent:"true",VERSION:"1.1.1",CQL_FILTER:customFiltered?mygis.Map.getCustomFilter():null,sld_body:customStyleApplied?mygis.Map.getCustomAppliedStyle():
null},{isBaseLayer:!1,alpha:!0,singleTile:!0,ratio:2,transitionEffect:"null",buffer:2,attribution:""})},markSelectionPoint:function(a,b){b&&feedbackLayer.removeAllFeatures();if(a){var c=OpenLayers.Util.applyDefaults(c,OpenLayers.Feature.Vector.style.temporary),d=new OpenLayers.Geometry.Point(a.lon,a.lat),d=new OpenLayers.Feature.Vector(d,null,c);c.externalGraphic=config.folderPath+"Images/target2.png";c.graphicWidth=64;c.graphicHeight=64;c.graphicOpacity=1;feedbackLayer.addFeatures(d)}},markFeatures:function(a){selectionLayer.removeAllFeatures();
a&&(clearTimeout(internalConfig.zoomToFeat),internalConfig.zoomToFeat=setTimeout(function(a){return function(){selectionLayer.addFeatures(a);digimap.zoomToExtent(selectionLayer.getDataExtent())}}(a),1E3))},clearFeedback:function(){feedbackLayer.removeAllFeatures()},layerHasProperty:function(a,b){for(var c=!1,d=0,e=!1,f;!e&&d<layerSource.records.length;)f=layerSource.records[d],f.layerTABLE==a?e=!0:d++;if(e)switch(b){case "selectable":c=f.Selectable;break;case "editable":c=f.Editable;break;case "locked":c=
f.Locked}return c},selectTopFeatures:function(a){var a=mygis.Utilities.categorizeFeatures(a),b=999999,c;$.each(a,function(a){var e=mygis.Utilities.mggetLayerIndex(a);e<b&&(c=a,b=e)});0<a[c].length&&(a[c].length=1);return a[c]},showInfo2:function(a){console.log("showInfo2");var b=a.text.split("</table>"),a=digimap.getLonLatFromPixel(a.xy);mygis.Map.markSelectionPoint(a,!0);var c,d=[];infoWindows=[];$("#infoRightGrid").hide();$("#infoLeftList").hide();for(var e=0;e<b.length-1;e++)if(c=b[e].indexOf("<table"),
-1<c){var f="",g;c=b[e].substring(c).trim()+"</table>";g=$(c);c=g.find("tr");g=g.find("caption").html();mygis.Map.layerHasProperty(g,"selectable")&&(d.push(g),c.each(function(a,b){var c=$(b).find("td");1<=a&&(1<a&&(f+=","),f+=$(c[1]).html())}),c=config.mgreq+"?qtype=GetFeatureList&qContents="+escape(g+"$"+f),g=d[d.length-1],d[d.length-1]={},d[d.length-1].text=g,d[d.length-1].dataurl=c)}infoWindowInitialized||initializeInfoWindow();b={};b.text=strings.Info.infoAt+a.lon+" , "+a.lat;displaySuccess(b.text);
b.value=-1;b.isInitialized=!0;b.linkedResults=d;b.isDBQuery=!1;b.isMapSelect=!1;b.centerPoint=a;querySource.push(b);mygis.UI.updateQueryList();b=$("#infoLeftList");b.show();a=b.jqxListBox("getItems").length;b.jqxListBox("selectIndex",a-1);mygis.UI.queryResultsRun()},checkScaleConstraints:function(){},getLayerSLD:function(a){var b=mygis.Storage.getItem("layerStyle_"+a);b?mygis.Map.getLayerSLDComplete(eval(b),a,!0):(b=config.folderPath+"Proxy.ashx?u="+escape(config.namespace+"styles/"+a+".sld"),OpenLayers.Request.GET({url:b,
headers:{"Content-Type":"text/xml;charset=utf-8"},success:function(b){b.responseText=b.responseText.replace(config.namespace,config.mapserver);mygis.Storage.storeItem("layerStyle_"+a,JSON.stringify(b.responseText));mygis.Map.getLayerSLDComplete(b,a)}}))},getLayerSLDComplete:function(a,b,c){var d=new OpenLayers.Format.SLD({multipleSymbolizers:!0,namedLayersAsArray:!1});layerStyles[b]=c?d.read(a):d.read(a.responseXML||a.responseText)},getCustomAppliedStyle:function(){var a=mygis.Map.combineLayerSLDs(),
a=(new OpenLayers.Format.SLD).write(a),a=a.replace(/<ogc:PropertyName>Geometry<\/ogc:PropertyName>/g,'<ogc:Function name="geometryType"><ogc:PropertyName>Geometry</ogc:PropertyName></ogc:Function>');return'<?xml version="1.0" encoding="utf-8"?>'+a},getSingleAppliedStyle:function(a){var b={version:"1.0.0",namedLayers:{}};b.namedLayers[a]=layerStyles[a].namedLayers[a];a=(new OpenLayers.Format.SLD).write(b);a=a.replace(/<ogc:PropertyName>Geometry<\/ogc:PropertyName>/g,'<ogc:Function name="geometryType"><ogc:PropertyName>Geometry</ogc:PropertyName></ogc:Function>');
return'<?xml version="1.0" encoding="utf-8"?>'+a},combineLayerSLDs:function(){for(var a={version:"1.0.0",namedLayers:{}},b=layerSource.records,c=b.length-1;0<=c;c--)if(!0!==Boolean(b[c].hidden)){var d=b[c].layerTABLE;a.namedLayers[d]=layerStyles[d].namedLayers[d]}return a},buildSLDArray:function(){var a=layerSource.records;layerStyles={};for(var b=a.length-1;0<=b;b--)!0!==Boolean(a[b].hidden)&&mygis.Map.getLayerSLD(a[b].layerTABLE)},getUniqueGraphics:function(){var a=[],b;$.each(layerStyles,function(c,
d){for(var e=d.namedLayers[c].userStyles[0],f=0;f<e.rules.length;f++){var g=e.rules[f].symbolizer,h;for(h in g)"Point"==h.toString()&&g[h].graphic&&(b={},b.layer=c,b.graphicUrl=g[h].externalGraphic,a.push(b))}});return a},strategies:{BBOXUnique:OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,
scope:this}),this.update());return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});return a},update:function(a){var b=this.getMapBounds();if(null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b)))this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a)},getMapBounds:function(){if(null===
this.layer.map)return null;var a=this.layer.map.getExtent();a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return a},invalidBounds:function(a){a||(a=this.getMapBounds());a=!this.bounds||!this.bounds.containsBounds(a);!a&&this.resFactor&&(a=this.resolution/this.layer.map.getResolution(),a=a>=this.resFactor||a<=1/this.resFactor);return a},calculateBounds:function(a){a||(a=this.getMapBounds());
var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,a=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)},triggerRead:function(a){this.response&&!(a&&!0===a.noAbort)&&(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},a))},createFilter:function(){var a;
a=[];if(0<this.layer.features.length)for(var b=0;b<this.layer.features.length;b++)if(this.layer.features[b].fid){var c=this.layer.features[b].fid.split(".")[1],c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"OID",value:c});a.push(c)}if(this.layer.deletedFeatures&&0<this.layer.deletedFeatures.length)for(b=0;b<this.layer.deletedFeatures.length;b++)c=this.layer.deletedFeatures[b].fid.split(".")[1],c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,
property:"OID",value:c}),a.push(c);0<a.length?(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:a}),a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT,filters:[a]}),b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection}),a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[a,b]})):a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,
projection:this.layer.projection});this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]}));return a},merge:function(a){if((a=a.features)&&0<a.length){var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b))for(var d,e=0,f=a.length;e<f;++e)(d=a[e].geometry)&&d.transform(b,c);this.layer.addFeatures(a)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOXUnique"})}};
mygis.Printing={templates:{},templateConfig:{generic:"",stats:config.folderPath+"Scripts/printing/statResults.html?"+Date.UTC(new Date)},printWindow:function(a,b){if(mygis.Printing.templates[a]){var c=config.folderPath+"Scripts/printing/print.html?"+Date.UTC(new Date),d=window.open(c,"_blank");d.onload=function(){d.document.write(mygis.Printing.templates[a](b));d.document.close();setTimeout(function(){d.print()},1E3)}}else mygis.Printing.initTemplate(a,b)},initTemplate:function(a,b){$.get(mygis.Printing.templateConfig[a]).then(function(c){mygis.Printing.templates[a]=
Handlebars.compile(c);var d=window.open(config.folderPath+"Scripts/printing/print.html","_blank");d.onload=function(){d.document.write(mygis.Printing.templates[a](b));d.document.close();setTimeout(function(){d.print()},1E3)}})},models:{printModel:function(){return{parentDirectory:config.folderPath+"Scripts/printing",pageTitle:strings.Printing.statsWindowTitle,appLogo:$(".domainLogoWrapper2 a img").attr("src"),appTitle:$(".domainStaticText2 div div").html().trim(),results:[]}}}};
mygis.UI={Hooks:{infoWindowShown:function(){}},MediaManager:{sortBy:function(a){var b="",c=$("#"+a).attr("class").split(" "),d="",e="";1<c.length&&(d=c[1]);switch(a){case "userFiles_nameSort":b="fileNAME";break;case "userFiles_typeSort":b="fileTYPE";break;case "userFiles_dateSort":b="fileINSERT";break;case "userFiles_inuseSort":b="fileINUSE";break;case "userFiles_sizeSort":b="fileSIZE"}switch(d){case "desc":e="asc";break;case "asc":e="";break;default:e="desc"}b&&($("#userFilesList").jqxGrid("sortby",
b,e),e?(d&&document.getElementById(a).ex_RemoveClassName(d),document.getElementById(a).ex_AddClassName(e)):document.getElementById(a).ex_RemoveClassName(d))},clearFilterImages:function(){var a=$("#userFilesList");try{a.jqxGrid("clearfilters")}catch(b){}a.removeData("imageFilter");a.removeData("imageFilterDataField")},filterImages:function(){var a=$("#userFilesList");a.jqxGrid("clearfilters");for(var b=new $.jqx.filter,c,d=0;4>d;d++){var e;switch(d){case 0:e=".PNG";break;case 1:e=".JPG";break;case 2:e=
".JPEG";break;case 3:e=".GIF"}c=b.createfilter("stringfilter",e,"EQUAL");b.addfilter(1,c);c=b.createfilter("stringfilter",e.toLowerCase(),"EQUAL");b.addfilter(1,c)}a.jqxGrid("addfilter","fileTYPE",b,!0);a.data("imageFilter",b);a.data("imageFilterDataField","fileTYPE")},filterBy:function(){var a=$("#userFiles_SearchInput");if(a.data("oldVal")!=a.val()){a.data("oldVal",a.val());var b=a.val(),a=$("#userFilesList");a.jqxGrid("clearfilters");var c=document.getElementById("userFiles_Search");b?(c.ex_HasClassName("populated")||
c.ex_AddClassName("populated"),c=new $.jqx.filter,b=c.createfilter("stringfilter",b,"CONTAINS"),c.addfilter(0,b),a.jqxGrid("addfilter","fileNAME",c,!0)):c.ex_RemoveClassName("populated");a.data("imageFilter")&&a.jqxGrid("addfilter",a.data("imageFilterDataField"),a.data("imageFilter"),!0)}},toggleFilterFocus:function(a){var b=document.getElementById("userFiles_Search");a?b.ex_HasClassName("focused")||b.ex_AddClassName("focused"):b.ex_HasClassName("focused")&&b.ex_RemoveClassName("focused")},fileSelected:function(){$("#userFiles_SelectedActions").show();
$("#userFiles_SortContainer").hide();1<$("#userFilesList").jqxGrid("getselectedrowindexes").length&&(document.getElementById("userFiles_replace").ex_AddClassName("disabled"),document.getElementById("userFiles_download").ex_AddClassName("disabled"))},fileUnselected:function(){var a=$("#userFilesList").jqxGrid("getselectedrowindexes");0==a.length?($("#userFiles_SelectedActions").hide(),$("#userFiles_SortContainer").show()):1==a.length&&(document.getElementById("userFiles_replace").ex_RemoveClassName("disabled"),
document.getElementById("userFiles_download").ex_RemoveClassName("disabled"))},fullImgPreview:function(a){var a=a.src,a=a.substring(0,a.indexOf("&qSize")),b=$("<img />");b.attr("src",a);b.attr("class","imagePreviewer");var c=$("<div />"),d=$("<div />");c.attr("style","display: table-cell; text-align: center; vertical-align: middle; width: 900px; height: 360px;");d.append(c);b.load(function(){c.append(b);d.dialog({width:900,height:410,modal:!0,draggable:!1,resizable:!1});c.focus()})},deleteFiles:function(){for(var a=
$("#userFilesList"),b=a.jqxGrid("getselectedrowindexes"),c=[],d,e=0;e<b.length;e++)d=a.jqxGrid("getrowdata",b[e]),c.push(d.fileID);0<c.length&&(a=config.mgreq+"?qtype=RemoveUserFile&qContents="+c.join(","),$.ajax({type:"GET",url:a,success:function(a){try{var b=eval(a);mygis.UI.MediaManager.refreshFileList();"success"==b.iotype?console.log("success"):console.log(b.iomsg)}catch(c){console.log(c.message)}}}))},detachFile:function(a,b,c){mygis.Utilities.blockUI();a=mygis.Utilities.format("{0}%23{1}%23{2}",
c,a,b);$.ajax({type:"GET",url:config.mgreq+"?qtype=Detachfile&qContents="+a,success:function(a){try{var b=eval(a);mygis.Utilities.unblockUI();propertiesVisibility("",!1);"success"==b.iotype?displaySuccess("File detached. Please reselect the object to see the new results"):displayError(b.iomsg)}catch(c){console.log(c.message)}}})},replaceFile:function(a,b,c,d){mygis.Utilities.blockUI();a=mygis.Utilities.format("{0}%23{1}%23{2}%23{3}",c,a,b,d);$.ajax({type:"GET",url:config.mgreq+"?qtype=ReplaceAttached&qContents="+
a,success:function(a){try{var b=eval(a);mygis.Utilities.unblockUI();propertiesVisibility("",!1);"success"==b.iotype?displaySuccess("File replaced. Please reselect the object to see the new results"):displayError(b.iomsg)}catch(c){console.log(c.message)}}})},bindManagerHandlers:function(){$("#userFiles_uploadNew").bind("click",function(){"VariousPopUps"==$("#fileUploaderCont").parent().attr("id")&&$("#userFilesSpaceCont").append($("#fileUploaderCont"));document.getElementById("userFiles_uploadNew").ex_HasClassName("done")?
($("#fileUploaderCont").hide(),mygis.UI.MediaManager.refreshFileList(),document.getElementById("userFiles_uploadNew").ex_RemoveClassName("done"),$("#userFiles_uploadNew").html(strings.MediaManager.btnAttachFile)):($("#fileUploaderCont").show(),$("#fileUploaderCont .ruFileInput").trigger("click"),$("#userFiles_uploadNew").trigger("click"),document.getElementById("userFiles_uploadNew").ex_AddClassName("done"),$("#userFiles_uploadNew").html(strings.MediaManager.btnAttachComplete));return!1});$("#userFiles_nameSort").bind("click",
function(){mygis.UI.MediaManager.sortBy("userFiles_nameSort");return!1});$("#userFiles_typeSort").bind("click",function(){mygis.UI.MediaManager.sortBy("userFiles_typeSort");return!1});$("#userFiles_sizeSort").bind("click",function(){mygis.UI.MediaManager.sortBy("userFiles_sizeSort");return!1});$("#userFiles_dateSort").bind("click",function(){mygis.UI.MediaManager.sortBy("userFiles_dateSort");return!1});$("#userFiles_inuseSort").bind("click",function(){mygis.UI.MediaManager.sortBy("userFiles_inuseSort");
return!1});$("#userFiles_refreshList").bind("click",function(){mygis.UI.MediaManager.refreshFileList();return!1});var a=$("#userFiles_SearchInput");a.data("oldVal","");a.bind("propertychange keyup input paste",mygis.UI.MediaManager.filterBy);a.bind("focus",function(){mygis.UI.MediaManager.toggleFilterFocus(!0)});a.bind("blur",function(){mygis.UI.MediaManager.toggleFilterFocus(!1)});$("#userFiles_delete").bind("click",mygis.UI.MediaManager.deleteFiles);$("#userFiles_download").bind("click",function(){mygis.UI.MediaManager.downloadFile()});
$("#userFiles_CANCEL").bind("click",mygis.UI.MediaManager.closeWindow);$("#userFiles_OK").bind("click",mygis.UI.MediaManager.acceptWindow)},refreshFileList:function(){var a=$("#userFilesList");a.jqxGrid("clearselection");mygis.UI.MediaManager.fileUnselected();a.jqxGrid("updatebounddata");$.ajax({url:config.mgreq+"?qtype=GetUserSpace",type:"GET",success:function(a){mygis.UI.MediaManager.setupGaugeValue(parseFloat(a))}})},setupGaugeFeedback:function(){var a=Math.floor(5),b=Math.floor(7),c=Math.floor(9);
$("#userFilesSpace").jqxGauge({ranges:[{startValue:0,endValue:a,style:{fill:"#4bb648",stroke:"#4bb648"},endWidth:5,startWidth:1},{startValue:a,endValue:b,style:{fill:"#fbd109",stroke:"#fbd109"},endWidth:10,startWidth:5},{startValue:b,endValue:c,style:{fill:"#ff8000",stroke:"#ff8000"},endWidth:13,startWidth:10},{startValue:c,endValue:10,style:{fill:"#e02629",stroke:"#e02629"},endWidth:16,startWidth:13}],ticksMinor:{interval:0.5,size:"5%"},ticksMajor:{interval:1,size:"9%"},value:0,colorScheme:"scheme09",
animationDuration:1200,width:80,height:80,max:10,caption:{value:"0 MB",position:"bottom",offset:[0,0],visible:!0},labels:{visible:!1}})},setupGaugeValue:function(a){$("#userFilesSpace").jqxGauge({caption:{value:a+" MB"}});$("#userFilesSpace").jqxGauge({value:a});a=mygis.Utilities.format(" {0} MB {1} {2} MB",a,"out of",10);$("#currentUsedSpaceSpan").html(a)},acceptWindow:function(){var a=$("#userFilesList"),b=a.jqxGrid("getselectedrowindexes");if(null!=internalConfig.mmCallback.fn){var c=internalConfig.mmCallback.objectCount;
if(b.length<c&&-1<c)alert(mygis.Utilities.format(strings.MediaManager.mm_err_notEnoughSelected,c));else{for(var c=[],d=0;d<b.length;d++)c.push(a.jqxGrid("getrowdata",b[d]));$("#userFiles").dialog("close");internalConfig.mmCallback.fn.call(c,"ok");mygis.UI.MediaManager.resetConfig()}}},closeWindow:function(){null!=internalConfig.mmCallback.fn&&(internalConfig.mmCallback.fn.call(null,null),mygis.UI.MediaManager.resetConfig());$("#userFiles").dialog("close")},resetConfig:function(){internalConfig.mmCallback.fn=
null;internalConfig.mmCallback.objectCount=-1;internalConfig.mmCallback.object=null;internalConfig.mmCallback.oid=null;internalConfig.mmCallback.layer=null;$("#fileUploaderCont").hide()},downloadFile:function(a){if(!a){var b=$("#userFilesList"),c=b.jqxGrid("getselectedrowindexes");0<c.length&&(a=b.jqxGrid("getrowdata",c[0]).fileID)}a=mygis.Utilities.format(config.mgreq+"?qtype=DownloadFile&qContents={0}",a);window.open(a)},toggleSelection:function(a){var b=$("#userFilesList"),c=b.jqxGrid("selectedrowindexes"),
d=b.jqxGrid("source").records.length;if(c.length<d){for(var e=0;e<d;e++)-1==c.indexOf(e)&&b.jqxGrid("selectrow",e);$(a).html(strings.MediaManager.btnUnselectAll)}else b.jqxGrid("clearselection"),mygis.UI.MediaManager.fileUnselected(),$(a).html(strings.MediaManager.btnSelectAll)}},Macros:{createNew:function(a,b,c,d,e,f,g,h,k,l){c?(c=$(e),e=$("<a />"),l=$("<span class='"+l+"' />"),e.attr("id","macro_"+a+"_cont"),e.attr("class",k),l.attr("id","macro_"+a),l.append(b),e.bind("click",new Function(d)),e.append(l),
e.attr("style",f),l.attr("style",g),c.append(e),internalConfig.macroButtons.push("macro_"+a)):(mygis.Macros||(mygis.Macros={}),mygis.Macros[b]=new Function(d),mygis.Macros[b]())},clearButtons:function(){$.each(internalConfig.macroButtons,function(a,b){var c=$("#"+b),d=$("#"+b+"_cont");c.remove();d.remove()});internalConfig.macroButtons.length=0},getList:function(){var a;a=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"macroID"},{name:"mapID"},{name:"appID"},{name:"name"},{name:"commands"},
{name:"parentSelector"},{name:"cont_css"},{name:"btn_css"},{name:"options"},{name:"contClass"},{name:"btnClass"},{name:"isButton"}],id:"macroIDSource",url:config.folderPath+"mgreq.ashx?qtype=getMacros&qContents="+currentMapID},{async:!1});a.dataBind();return a},init:function(){try{mygis.UI.Macros.clearButtons();for(var a=mygis.UI.Macros.getList(),b=0;b<a.records.length;b++){var c=a.records[b];mygis.UI.Macros.createNew(c.macroID,c.name,mygis.Utilities.stringToBoolean(c.isButton),c.commands,c.parentSelector,
c.cont_css,c.btn_css,c.options,c.contClass,c.btnClass)}}catch(d){console.log(d.message)}}},Help:{createPopup:function(a,b,c,d,e,f,g,h){d=$("<div />");d.attr("id",a);a=$("<div />");a.html(b);d.append(a);e?d.dialog({autoOpen:!0,modal:!0,resizable:!1,width:h[0],height:h[1],title:c,closeOnEscape:!1,draggable:f,close:function(){$(this).dialog("destroy").remove()},position:g||"center"}):d.dialog({autoOpen:!0,modal:!0,resizable:!1,width:h[0],height:h[1],title:c,closeOnEscape:!1,draggable:f,close:function(){$(this).dialog("destroy").remove()},
position:g||"center"}).siblings("div.ui-dialog-titlebar").remove()},showManual:function(){var a=!1,b="";switch(currentAppName){case "ToBeParks":a=!0;b="/mgManual.pdf";break;case "psyhat":a=!0;b="/psyhatManual.pdf";break;case "epic":a=!0;b="/epicManual.pdf";break;case "ecoplatform":a=!0,b="/ecoflowManual.pdf"}if(a)if(0<$("#mygis_manual").children().length)$("#mygis_manual").dialog("show");else{var a=$("<div />"),c=$("<iframe />");c.attr("id","mygis_manual");c.attr("src",b);c.css({width:"100%",height:"100%"});
a.append(c);a.dialog({modal:!0,autoOpen:!1,width:900,height:500,title:strings.HelpSystem.manual,resizable:!0});a.dialog("open")}else displayNotify(msg_errFeatureNotImplemented)},shortcutsReset:function(){$("#pageHelpActions a[id^='pageHelp']").attr("class","");QuerySettingsVisibility(!1)},shortcutStart:function(){mygis.UI.Help.shortcutsReset();mygis.UI.toggleActiveList(internalConfig.layerTabIndex);$("#pageHelpStartHere").attr("class","active")},shortcutMaps:function(){$("#mapsPanel").is(":visible")?
($("#mapsPanel").slideUp("fast"),$("#mapsPanelOverlay").hide().unbind("click")):($("#mapsPanelOverlay").show().click(function(){mygis.UI.Help.shortcutMaps()}),$("#mapsPanel").slideDown({duration:"slow",complete:function(){$("#mapsAnalysis")[0].ex_AddClassName("active");$("#mapsList").jqxListBox("width",243);$("#mapsList").jqxListBox("width",244)}}),$("#mapsPanel").css("left",$("#mapDescription").offset().left-7));return!1},shortcutSearch:function(){mygis.UI.Help.shortcutsReset();mygis.UI.toggleActiveList(internalConfig.searchTabIndex);
$("#pageHelpSearchMap").attr("class","active")},tutorial:function(a,b){var c,d=0,e,f=!1;switch(a){case "changeBG":internalConfig.helpTips.switchBG_animPlaying||(internalConfig.helpTips.switchBG_animPlaying=!0,d=$("#layersList"),d=d.jqxGrid("getrowid",d.jqxGrid("source").localdata.length-1),e=1,e=Sys.Services.AuthenticationService.get_isLoggedIn()?7:5,c=$(mygis.Utilities.format("#row{0}layersList div:nth-child({1})",d,e)),d=10,f=!0,e=function(){singleQTip("switchBG",[c]);internalConfig.helpTips.switchBG_animPlaying=
!1})}if(f){var g=$(b).offset(),f=g.top,g=g.left,h=c.offset();mygis.UI.Help.animateCursor([f,g],[h.top+d,h.left+0],e)}},animateCursor:function(a,b,c){var d=$("<div class='tutorialCursor' />");$("body").append(d);d.css({top:a[0]+"px",left:a[1]+"px"});d.animate({top:b[0]+"px",left:b[1]+"px"},{duration:4E3,complete:function(){d.remove();c()}})}},attachFileToRecord:function(a){internalConfig.mmCallback.fn=mygis.UI.attachFileToRecordResult;internalConfig.mmCallback.objectCount=1;internalConfig.mmCallback.object=
a;showMediaManager()},layerCloneInit:function(){$("#layersList");var a=$("#layerlistClone"),b=layerSource.getrecords(),c={Unknown:[]};$.each(b,function(a,b){b.folderName?(c[b.folderName]||(c[b.folderName]=[]),c[b.folderName].push(b)):c.Unknown.push(b)});var d=0,e=1,f=[];$.each(c,function(a){0<c[a].length&&(c[a].length>d&&(d=c[a].length),c[a].length<e&&(e=c[a].length),f.push({Visible:!0,Name:a}))});b=new $.jqx.dataAdapter({datafields:[{name:"Visible"},{name:"Name",type:"string"}],id:"asdf2",localdata:f},
{autoBind:!0});a.jqxGrid({width:241,height:"100%",source:b,rowdetails:!0,autorowheight:!0,autoheight:!0,initrowdetails:mygis.UI.layerNestedCloneInit([],c),rowdetailstemplate:{rowdetails:"<div id='layerClonedGrid' style='margin: 10px;'></div>",rowdetailsheight:29*d+10,rowdetailshidden:!0},columns:[{text:"",datafield:"Visible",width:20,cellsrenderer:function(a,b,c){var d="",e="",f="",o="";switch(b){case "Visible":d="layer_visible",e=mygis.Utilities.stringToBoolean(c)?"pressed":"",f=strings.LayerControl.columnVisible,
o="router('tlvm',"+a+");"}return'<a href="#" onclick="'+o+'return false;" class="'+d+"  "+e+'" title="'+f+'"></a>'}},{text:"Folder",datafield:"Name",editable:!1}],showheader:!1,showgroupsheader:!1,theme:"pk_mg"})},layerNestedCloneInit:function(a,b){var c=function(a,b,c,g){return""+b+" ("+g.rows.length+")"};return function(d,e,f,g){f=g.Name;e=$($(e).children()[0]);a[d]=e;d=[];for(g=0;g<b[f].length;g++)d.push(b[f][g]);d=new $.jqx.dataAdapter({datafields:[{name:"mapID"},{name:"layerID"},{name:"layerNAME"},
{name:"layerDESCRIPTION"},{name:"layerTABLE"},{name:"layerORDER"},{name:"layerEXTENTS"},{name:"hidden"},{name:"Editable"},{name:"Selectable"},{name:"layerMinScale"},{name:"layerMaxScale"},{name:"manualVisibility"},{name:"layerGeomType"},{name:"folderName"}],id:"asdf3",localdata:d});d.dataBind();layergridSource={localdata:mygis.UI.buildGridSource(d,"layers",!1),datatype:"array"};null!=e&&(e.jqxGrid({source:layergridSource,width:200,columns:[{text:"",datafield:"Visible",width:13,cellsrenderer:mygis.UI.layerInnerCellRenderer()},
{text:"",datafield:"Image",width:26,cellsrenderer:mygis.UI.layerGraphicCellRenderer(),editable:!1},{text:strings.LayerControl.columnName,datafield:"Name",cellsrenderer:mygis.UI.layerInnerCellRenderer(),editable:!1},{text:"",datafield:"Selectable",width:16,cellsrenderer:mygis.UI.layerInnerCellRenderer(),editable:!1}],autorowheight:!0,height:"90%",theme:"pk_mg",rowdetails:!1,sortable:!0,groupable:!0,showheader:!1,showgroupsheader:!1,editable:!1,selectionmode:"none",groupsrenderer:c,scrollbarsize:5,
rendered:layerGridRendered}),e.find(".layerLegendGraphic").live({mouseenter:layerStyleFullZoom,mouseleave:layerStyleFullZoomOff}))}},layerGraphicCellRenderer:function(){return function(a,b,c){if(c)try{var d=layerSource.records[a].layerTABLE,e=layerStyles[d].namedLayers[d].userStyles[0],a=!1,b="";if(1==e.rules.length||"Large"==e.rules[0].name){var f=layerStyles[d].namedLayers[d].userStyles[0].rules[0].symbolizers[0];f.externalGraphic&&(b=f.externalGraphic,a=!0)}if(a){var g=b.replace(config.namespace,
config.mapserver),h=g.length-4,g=g.substr(0,h)+"_legend"+g.substr(h),k='<div class="layerLegendGraphic normalLayer" style="background-image:url('+g+');"><img style="pointer-events: none;width: 20px; height: 20px;" src="'+g+'"/></div>';$.ajax({type:"HEAD",url:g,async:!1,success:function(){k='<div class="layerLegendGraphic normalLayer" style="background-image:url('+g+');"><img style="pointer-events: none;width: 20px; height: 20px;" src="'+g+'"/></div>'},error:function(){k='<div class="layerLegendGraphic normalLayer" style="background-image:url('+
c+');"><img style="pointer-events: none;" src="'+c+'"/></div>'}});return k}return'<div class="layerLegendGraphic normalLayer" style="background-image:url('+c+');"><img style="pointer-events: none;" src="'+c+'"/></div>'}catch(l){return'<div class="layerLegendGraphic normalLayer" style="background-image:url('+c+');"><img style="pointer-events: none;" src="'+c+'"/></div>'}else return d=config.folderPath+"Images/layerList/tilecache-layer.png",'<div class="layerLegendGraphic background" style="background-image: url('+
d+');"><img style="pointer-events: none;" src="'+d+'"/></div>'}},buildSelectionListSource:function(a){var b=[];$.each(a.records,function(a,d){!0!==Boolean(d.hidden)&&b.push(d)});a=new $.jqx.dataAdapter({localdata:b,datatype:"array"});a.dataBind();return a},getLayerCheckStatus:function(a){var b=!1,c=!1;if(0<internalMemory.unsavedLayerChanges.length)for(var d=0,e=internalMemory.unsavedLayerChanges;!c&&d<e.length;){var f=e[d];a.layerID==f.layerID&&(c=!0,b=!mygis.Utilities.stringToBoolean(f.hidden));
d++}c||(b=!mygis.Utilities.stringToBoolean(a.hidden));return b},applyLayerChanges:function(){$("#applyLayersCont").hide("slide",{direction:"down"},300);mygis.Utilities.blockUI();$.each(internalMemory.unsavedLayerChanges,function(a,c){for(var a=0,d=!1,e=layerSource.records;!d&&a<e.length;){var f=e[a];c.layerID==f.layerID&&(d=!0,f.hidden=c.hidden,f.manualVisibility=!0);a++}});internalMemory.unsavedLayerChanges.length=0;var a=$("#mapsList").jqxListBox("getSelectedItem").originalItem;loadMapSequence(a);
mygis.UI.updateLayerGrid()},cancelLayerChanges:function(){$("#applyLayersCont").hide("slide",{direction:"down"},300);internalMemory.unsavedLayerChanges.length=0;mygis.UI.updateLayerGrid(!0)},buildGridSource:function(a,b){var c=a.records;switch(b){case "layers":for(var d=[],e=0;e<c.length;e++){var f=c[e],g=f.layerNAME,h={};h["#"]=e+1;h.Name=g;h.Visible=mygis.UI.getLayerCheckStatus(f);f.mygisImageSrc?h.Image=f.mygisImageSrc:(g=mygis.UI.getSingleLegend(f.layerTABLE,f.layerGeomType),h.Image=g.src);h.Type=
strings.LayerControl.typeData;h.Savable=f.Savable;h.Editable=f.Editable;h.Selectable=f.Selectable;h.manualVisibility=f.manualVisibility;h.folderName=f.folderName?f.folderName:strings.LayerControl.noFolderName;d.push(h)}for(e=0;e<digimap.layers.length;e++)if(c=digimap.layers[e],c.isBaseLayer)for(var k in backgrounds)if(backgrounds[k].hasOwnProperty("name"))f={"#":99999},f.Name=backgrounds[k].name,f.Visible=c.visibility&&c.name==backgrounds[k].name,f.Image="",f.Type=strings.LayerControl.typeBackground,
f.Savable=!1,f.Editable=!1,f.Selectable=!1,f.manualVisibility=c.manualVisibility,f.folderName=strings.LayerControl.labelBackground,d.push(f);else for(var l in backgrounds[k])f={"#":99999},f.Name=backgrounds[k][l].name,f.Visible=c.visibility&&c.name==backgrounds[k][l].name,f.Image="",f.Type=strings.LayerControl.typeBackground,f.Savable=!1,f.Editable=!1,f.Selectable=!1,f.manualVisibility=c.manualVisibility,f.folderName=strings.LayerControl.labelBackground,d.push(f);return d}},layerInnerCellRenderer:function(){return function(a,
b,c){var d="",e="",f="",g="",h="",k="";switch(b){case "#":d="layer_options";99999!=c?(h="router('codingTLD',"+(c-1)+");",g=strings.LayerControl.columnProperties):(h="router('cycleBG',['"+this.owner.getrowdata(a).Name+"',"+a+"]);",g=strings.LayerControl.columnCycle);break;case "Name":var l=this.owner.getrowdata(a)["#"],h=mygis.Utilities.format("switchBG_{0}",a-layerSource.records.length),k=99999==l?mygis.Utilities.format("<div title='{0}' class='imageVerticalContainer2' style='font-size: 11px;height: {1}px;text-align:left;'>{0}</div>",
c,21):mygis.Utilities.format("<div title='{0}' class='imageVerticalContainer2' style='font-size: 11px;height: {1}px;'>{0}</div>",c,21);break;case "Visible":l=this.owner.getrowdata(a)["#"];d=99999==l?"layer_visible background":"layer_visible";e=c?"pressed":"";f=c?"jqx-checkbox-default jqx-checkbox-default-pk_mg jqx-rc-all jqx-rc-all-pk_mg jqx-checkbox-check-checked":"jqx-checkbox-default jqx-checkbox-default-pk_mg jqx-fill-state-normal jqx-fill-state-normal-pk_mg jqx-rc-all jqx-rc-all-pk_mg";g=strings.LayerControl.columnVisible;
h="router('tlvm',"+a+");return true;";break;case "Savable":d="layer_savable";e=Boolean(c)?"pressed":"";h="router('codingSaveLayer',"+(c-1)+");";g=strings.LayerControl.saveChanges;break;case "Editable":d="layer_editable";e=mygis.Utilities.stringToBoolean(c)?"pressed":"";f=mygis.Utilities.stringToBoolean(this.owner.getrowdata(a).Locked)?"disabled":"";g=strings.LayerControl.columnEditable;h="router('codingTLE',"+a+");";break;case "Selectable":d="layer_selectable";e=mygis.Utilities.stringToBoolean(c)?
"pressed":"";g=strings.LayerControl.columnSelectable;h="router('codingTLS',"+a+");";break;case "Locked":d="layer_locked";e=mygis.Utilities.stringToBoolean(c)?"pressed":"";g=strings.LayerControl.columnLocked;break;case "Type":d="layer_type";e=c==strings.LayerControl.typeData?"layer_type_data":"layer_type_bg";g=c==strings.LayerControl.typeData?strings.LayerControl.typeData:strings.LayerControl.typeBackground;break;case "folderName":console.log("value: "+c),k=mygis.Utilities.format("<div class='imageVerticalContainer2' style='font-size: 11px;height: {1}px;'>{0}</div>",
c,20)}return"Name"!=b&&"folderName"!=b?"#"==b&&99999==c?"":'<a href="#" onclick="'+h+'return false;" class="'+d+" "+f+" "+e+'" title="'+g+'"></a>':k}},replaceFileInRecord:function(a,b,c){internalConfig.mmCallback.fn=mygis.UI.replaceFileInRecordResult;internalConfig.mmCallback.objectCount=1;internalConfig.mmCallback.object={called_table:a,called_oid:b,called_fileID:c};showMediaManager()},attachFileToRecordResult:function(a){var b;b=this[0];!a||"ok"!=a?a&&displayError(a):(mygis.Utilities.blockUI(),
$.ajax({type:"GET",url:config.mgreq+"?qtype=AttachFileToFeature&qContents="+b.fileID+"%23"+internalConfig.mmCallback.object,success:function(a){try{mygis.Utilities.unblockUI();propertiesVisibility("",!1);var b=eval(a);"success"==b.iotype?displaySuccess("File attached. Please reselect the object to see the new results"):displayError(b.iomsg)}catch(e){displayError(e.message)}}}))},replaceFileInRecordResult:function(a){var b;b=this[0];!a||"ok"!=a?a&&displayError(a):(a=internalConfig.mmCallback.object,
mygis.UI.MediaManager.replaceFile(a.called_table,a.called_oid,a.called_fileID,b.fileID))},objectImageGrid:function(a,b,c){var d=b+"."+a,e=mygis.UI.getObjectGridSource(c,d),f="Images"==c?"image":"file",g=e.records.length?"imagegrid":"imagegrid norecords",h=$("<div id='"+d.replace(".","_")+mygis.Utilities.format("__{0}grid",f)+"' class='"+g+"' />");$.each(e.records,function(d,e){var f=$("<div />"),g=$("<div />"),o=$("<div />"),q=$("<div />");f.attr("class","objectFilePanel");g.attr("class","objectFileTitle");
o.attr("class","objectFileContents");q.attr("class","objectFileActions");f.append(o);f.append(q);f.append(g);!e.imageFRIENDLY||""==e.imageFRIENDLY?g.append(e.imageNAME):g.append(e.imageFRIENDLY);if("Images"==c)retobject=mygis.Utilities.format('<div style="" title="{3}"><img onclick="{0}" style="margin: 4px;" src="{1}GetImage.ashx?qType=userFile&qContents={2}&qSize=45" /></div>',"router('infopopup_previewImg',this);",config.folderPath,e.imageID,e.imageNAME);else{g="";g=e.imageNAME.split(".");switch(g[g.length-
1].toLowerCase()){case "doc":case "docx":g="doc";break;case "xls":case "xlsx":g="xls";break;case "ppt":case "pptx":g="ppt";break;case "pdf":g="pdf";break;default:g="unknown"}retobject=mygis.Utilities.format('<div title="{0}"><div class="MMLargeFile {1}" /></div>',e.imageNAME,g)}o.html(retobject);var o=$("<div />"),g=$("<a />"),t=$("<a />"),r=$("<a />"),s=!Sys.Services.AuthenticationService.get_isLoggedIn()?" disabled":"";o.attr("class","objectFileActionCont");g.attr("class","btnTool imageDownload");
r.attr("class","btnTool imageDelete"+s);t.attr("class","btnTool imageReplace"+s);o.append(g);o.append(t);o.append(r);g.attr("onclick",mygis.Utilities.format("router('infoPopup_download',{0});",e.imageID));r.attr("onclick",mygis.Utilities.format("router('infoPopup_detach',['{0}','{1}',{2}]);",b,a,e.imageID));t.attr("onclick",mygis.Utilities.format("router('infoPopup_replace',['{0}','{1}',{2}]);",b,a,e.imageID));q.append(o);h.append(f)});return h},getObjectGridSource:function(a,b){var c=mygis.Utilities.format(config.mgreq+
"?qtype=GetObject{0}&qContents={1}",a,b),d;switch(a){case "Images":d={datatype:"json",datafields:[{name:"imageID"},{name:"imageNAME"},{name:"imageFRIENDLY"}],id:"ImagesSource",url:c};break;case "Files":d={datatype:"json",datafields:[{name:"imageID"},{name:"imageNAME"},{name:"imageFRIENDLY"}],id:"FilesSource",url:c}}mygis.Utilities.blockUI();c=new $.jqx.dataAdapter(d,{async:!1});c.dataBind();mygis.Utilities.unblockUI();return c},getInfoImageGrid:function(a,b){var c=$("<div id='"+b.replace(".","_")+
mygis.Utilities.format("__{0}grid","image")+"' class='imagegrid' />");b.split(".");b.split(".");$.each(a,function(a,e){c.append(mygis.UI.buildImageCell(e,b))});return c},getInfoFileGrid:function(a,b){var c=$("<div id='"+b.replace(".","_")+mygis.Utilities.format("__{0}grid","image")+"' class='imagegrid' />");b.split(".");b.split(".");$.each(a,function(a,e){c.append(mygis.UI.buildFileCell(e,b))});return c},buildImageCell:function(a,b){var c=b.split(".")[0],d=b.split(".")[1],e=$("<div />"),f=$("<div />"),
g=$("<div />"),h=$("<div />");e.attr("class","objectFilePanel");f.attr("class","objectFileTitle");g.attr("class","objectFileContents");h.attr("class","objectFileActions");e.append(f);e.append(g);e.append(h);!a.imageFRIENDLY||""==a.imageFRIENDLY?f.append(a.imageNAME):f.append(a.imageFRIENDLY);retobject=mygis.Utilities.format('<div style="" title="{3}"><img onclick="{0}" style="margin: 4px;" src="{1}GetImage.ashx?qType=userFile&qContents={2}&qSize=45" /></div>',"router('infopopup_previewImg',this);",
config.folderPath,a.imageID,a.imageNAME);g.html(retobject);var f=$("<div />"),g=$("<a />"),k=$("<a />"),l=$("<a />"),m=!Sys.Services.AuthenticationService.get_isLoggedIn()?" disabled":"";f.attr("class","objectFileActionCont");g.attr("class","btnTool imageDownload");l.attr("class","btnTool imageDelete"+m);k.attr("class","btnTool imageReplace"+m);f.append(g);f.append(k);f.append(l);g.attr("onclick",mygis.Utilities.format("router('infoPopup_download',{0});",a.imageID));l.attr("onclick",mygis.Utilities.format("router('infoPopup_detach',['{0}','{1}',{2}]);",
c,d,a.imageID));k.attr("onclick",mygis.Utilities.format("router('infoPopup_replace',['{0}','{1}',{2}]);",c,d,a.imageID));h.append(f);return e},buildFileCell:function(a,b){var c=b.split(".")[0],d=b.split(".")[1],e=$("<div />"),f=$("<div />"),g=$("<div />"),h=$("<div />");e.attr("class","objectFilePanel");f.attr("class","objectFileTitle");g.attr("class","objectFileContents");h.attr("class","objectFileActions");e.append(f);e.append(g);e.append(h);!a.imageFRIENDLY||""==a.imageFRIENDLY?f.append(a.imageNAME):
f.append(a.imageFRIENDLY);f="";f=a.imageNAME.split(".");switch(f[f.length-1].toLowerCase()){case "doc":case "docx":f="doc";break;case "xls":case "xlsx":f="xls";break;case "ppt":case "pptx":f="ppt";break;case "pdf":f="pdf";break;default:f="unknown"}retobject=mygis.Utilities.format('<div title="{1}" onclick="{0}"><div class="MMLargeFile {2}" /></div>',"router('infopopup_previewFile',{elem:this,id:"+a.imageID+"});",a.imageNAME,f);g.html(retobject);var g=$("<div />"),f=$("<a />"),k=$("<a />"),l=$("<a />"),
m=!Sys.Services.AuthenticationService.get_isLoggedIn()?" disabled":"";g.attr("class","objectFileActionCont");f.attr("class","btnTool imageDownload");l.attr("class","btnTool imageDelete"+m);k.attr("class","btnTool imageReplace"+m);g.append(f);g.append(k);g.append(l);f.attr("onclick",mygis.Utilities.format("router('infoPopup_download',{0});",a.imageID));l.attr("onclick",mygis.Utilities.format("router('infoPopup_detach',['{0}','{1}',{2}]);",c,d,a.imageID));k.attr("onclick",mygis.Utilities.format("router('infoPopup_replace',['{0}','{1}',{2}]);",
c,d,a.imageID));h.append(g);return e},updateObjectField:function(){var a=$("#fieldEditor").attr("value"),b=$("#editRecordNo").html().split("#")[1],c=$("#editLayerName").html(),d=$("#fieldColumnName").html(),e=cosmeticLayer.getFeatureByFid(c+"."+b);e?(e.data[d]=a,e.modified=!0,e.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:e.modified}),$("#editFieldBox").dialog("close")):displayError("Feature "+c+"."+b+" not found!")},clearObjectField:function(){$("#fieldEditor").attr("value",
"")},cancelObjectEditing:function(){$("#editFieldBox").dialog("close")},createCustomHotSearch:function(a,b,c){var d=config.mgreq+"?qtype="+a+"&qContents="+c;$(document).bind("finishedLoading",function(){$.ajax({type:"GET",url:d,success:function(a){a=eval(a);if("object"==typeof a){var c={};c.text=b;c.value=-1;c.isInitialized=!0;c.linkedResults=a;c.isDBQuery=!0;c.isMapSelect=!1;querySource.push(c);mygis.UI.updateQueryList()}}})})},createHotSearch:function(a,b,c,d,e,f,g,h){var f=$("<div />"),k=$("<div class='divTitle' />"),
l=$("<div class='divContents' />"),m=$("<div />"),n=function(a,b){var c=config.mgreq+"?qtype=GetLayerFields&qContents="+escape(a.replace(/ /g,"_")),d;$.ajax({type:"GET",url:c,async:!1,success:function(a){a=eval(a);$.each(a,function(a,c){c.fieldNAME==b&&(d=c.fieldTYPE)})}});return d},o=function(a,b){var c=[],d=mygis.Utilities.format(config.mgreq+"?qtype=GetLayerDistinct&qContents={0}${1}",escape(a.replace(/ /g,"_")),b);$.ajax({type:"GET",url:d,async:!1,success:function(a){a=eval(a);$.each(a,function(a,
b){row={};row.name=b&&""!=b?b:"-";row.value=b&&""!=b?b:"{NULL}";c.push(row)})}});return c};switch(c){case "distinct":d=o(a,b);switch(e){case "checkbox":d=new $.jqx.dataAdapter({datatype:"local",localdata:d},{async:!1}),d.dataBind(),e=$("<input class='lname' type='hidden' />"),e[0].value=a+"#"+b,m.append(e),$.each(d.records,function(a,b){var c=$("<div class='qsListItem' />"),d=$("<input type='checkbox' onchange='router(\"tHotSearch\",this);' />"),e=$("<a href='#' class='qsListLink' />");e.append(b.name);
c.append(d);c.append(e);c.appendTo(m)})}break;case "input":switch(n(a,b)){default:$("<span />").append("test caption"),a=$("<input type='text' class='userInput' />"),m.append(a),"BETWEEN"==d&&m.append(a.clone())}}l.append(m);a=$("<span />");a.append(g);g=$("<img />");h&&(g[0].src=h,k.append(g));k.append(a);f.append(k);f.append(l);internalConfig.hotSearches.push(f);var q=$("<div />");$.each(internalConfig.hotSearches,function(a,b){q.append(b.html())});q.find(">div");$("#filterContents").empty();$("#filterContents").append(q)},
toggleHotSearchItem:function(a){for(var b=$(a).parent(),c=b.parent().find(".lname")[0].value.split("#"),a=c[0],d=c[1],e="IN",e="=",c=[],b=b.parent().find("input:checked"),f=0;f<b.length;f++){var g=$(b[f]).parent().find(".qsListLink");c.push("'"+g.html()+"'")}if(0==c.length)internalConfig.myCustomFilters[a].fieldname=null;else{null==internalConfig.myCustomFilters[a]&&(internalConfig.myCustomFilters[a]={});var h="";$.each(c,function(a,b){""!=h&&(h+=" OR ");h+=mygis.Utilities.format("{0} {1} {2}",d,
e,b)});""!=h&&(internalConfig.myCustomFilters[a][d]=h)}customFiltered=$("#filterContents .qsListItem input:checked").length?!0:!1;loadMapSequence()},initHotSearches:function(){if(QSSource){if(0!=QSSource.records.length){var a=!1;0==$("#filterContents").children().length&&$.each(QSSource.records,function(b,c){"customSQL"==c.searchType?mygis.UI.createCustomHotSearch(c.customFn,c.windowTitle,c.fieldFill):(a=!0,mygis.UI.createHotSearch(c.layername,c.fieldname,c.searchType,c.searchOperator,c.searchLayout,
c.searchMode,c.windowTitle,c.windowIcon))});a&&(document.getElementById("panel3Out").ex_RemoveClassName("collapsed"),document.getElementById("rpanelCollapseBtn").ex_AddClassName("active"),propertiesVisibility("filterContents",!0),$("#filterTabButton").show(),$("#filterTabButton").bind("click",function(){propertiesVisibility("filterAnalysis",!document.getElementById("filterTabButton").ex_HasClassName("active"))}))}}else document.getElementById("panel3Out").ex_AddClassName("collapsed")},gatherUnsaved:function(){(0<
featuresUnsaved.length||0<featuresDeleted.length||!mygis.Utilities.isEmptyObject(featuresModified))&&mygis.Drawing.Exporting.saveDigitizing()},startSaving:function(){(0<featuresUnsaved.length||0<featuresDeleted.length||!mygis.Utilities.isEmptyObject(featuresModified))&&mygis.Utilities.checkAuthorization("digitize",layerSource.records[layerCurrentEditing].layerID)},resetControls:function(){mygis.Map.clearFeedback();$("#mapContainer").attr("class","olMap");mygis.UI.clearInfoButtons();for(var a in infoControls)infoControls[a].deactivate();
$("#layerSelectionListCont").hide();for(a in naviControls)"navigation"!=a&&naviControls[a].deactivate();for(a=0;4>a;a++){switch(a){case 0:cname="#dragPanBtn";break;case 1:cname="#zoomBoxBtn";break;case 2:cname="#zoomOutBtn";break;case 3:cname="#toggleInfoBtn"}$(cname)[0].ex_RemoveClassName("selected")}mygis.UI.stopDigitize();mygis.Map.hideSearchPanel()},activateOLControl:function(a,b){mygis.UI.resetControls();a.activate();b&&(b.ex_HasClassName("btnTool_selected")||b.ex_AddClassName("btnTool_selected"))},
selectToolbar:function(a,b){for(var c,d=a?a.split(","):[],e=0;3>e;e++)c="selectModeTools_"+e.toString(),-1==d.indexOf(e.toString())||!b?(document.getElementById(c).ex_RemoveClassName("on"),$("#"+c).parent().hide()):(document.getElementById(c).ex_AddClassName("on"),$("#"+c).parent().show())},activateSelectCtrl:function(a){var b=!1;mygis.UI.stopDigitize();document.getElementById("mode_TopSelect").ex_RemoveClassName("drawer");if(!a.ex_HasClassName("disabled")){switch(a.id){case "infoTool":document.getElementById("mode_TopSelect").ex_AddClassName("drawer");
mygis.UI.toggleSelectBtn("info");a.ex_AddClassName("selected");$("#layerSelectionListCont").attr("class","");$("#layerSelectionHeaderLabel").html(strings.MapTools.infoToolExplain);b=!1;document.getElementById("mapContainer").ex_AddClassName("selectMode");break;case "selectObject":-1<layerCurrentEditing?mygis.UI.activateOLControl(drawControls.modify):mygis.UI.toggleSelectBtn("point");a.ex_AddClassName("selected");document.getElementById("mapContainer").ex_AddClassName("selectMode");$("#layerSelectionListCont").attr("class",
"pointSelect");$("#layerSelectionHeaderLabel").html(strings.MapTools.otherToolExplain);b=!0;break;case "selectRect":-1<layerCurrentEditing?mygis.UI.activateOLControl(drawControls.modify):mygis.UI.toggleSelectBtn("rectangle");a.ex_AddClassName("selected");$("#layerSelectionListCont").attr("class","rectSelect");$("#layerSelectionHeaderLabel").html(strings.MapTools.otherToolExplain);document.getElementById("mapContainer").ex_AddClassName("selectMode");b=!0;break;case "selectCircle":-1<layerCurrentEditing?
mygis.UI.activateOLControl(drawControls.modify):mygis.UI.toggleSelectBtn("circle");$("#layerSelectionListCont").attr("class","circleSelect");a.ex_AddClassName("selected");$("#layerSelectionHeaderLabel").html(strings.MapTools.otherToolExplain);b=!0;break;case "selectClear":mygis.Map.clearSelection(),$("#infoAnalysisContents").empty(),$("#queryExpanders").die().empty(),$("#layerSelectionHeaderLabel").html(strings.MapTools.otherToolExplain)}b&&displayNotify(strings.Info.selectDeselect)}},featureModified:function(a){a.modified&&
(a=a.feature,a.fid&&(featuresModified[a.fid]=a),mygis.UI.notifyUnsavedLayer(layerCurrentEditing))},applyLocalStyle:function(){customStyleApplied=!0;mygis.UI.updateLayerGrid()},cancelApplyLocalStyle:function(){customStyleApplied=!1;digimap.layers[1].mergeNewParams({sld_body:null,layers:mygis.Utilities.getVisibleLayerString(currentAppName)});mygis.UI.updateLayerGrid()},resetLocalStyle:function(){},togglePointMode:function(a){0==(a?$(a):$("input[name=PointMode]:checked","#pointModeContainer")).val()?
($("#modeOptions_0").css("display","block"),$("#modeOptions_1").css("display","none"),a=document.getElementById("pointFontFamily"),mygis.UI.populatePointIcons("font",a.options[a.selectedIndex].value)):($("#modeOptions_0").css("display","none"),$("#modeOptions_1").css("display","block"),mygis.UI.populatePointIcons("library"))},initializeStyler:function(a,b){var c=layerStyles[a].namedLayers[a].userStyles[0],d,e,f;switch(c.rules.length){case 3:d=c.rules[0].symbolizer.Point;e=c.rules[1].symbolizer.Line;
f=c.rules[2].symbolizer.Polygon;break;case 1:var c=c.rules[0].symbolizer,g;for(g in c)switch(g.toString()){case "Point":d=c[g];break;case "Line":e=c[g];break;case "Polygon":f=c[g]}}$("#markerChooseStyle").hide();$("#polylineChooseStyle").hide();$("#polygonChooseStyle").hide();switch(b.layerGeomType){case "Point":toggleStylerButton("Point");break;case "Line":toggleStylerButton("Line");break;case "Polygon":toggleStylerButton("Polygon")}d&&($("#markerPreview").attr("class",""),$("#markerPreview").html("<img style='width: 100%; height: 100%;' src='"+
d.externalGraphic+"' />"),document.getElementById("pointGraphicUrl").value=d.externalGraphic,d=d.pointRadius?2*parseFloat(d.pointRadius):8,$("#markerSizeSlider").slider("value",d),markerSizeText.set_value(d.toString()));e&&(d=e.strokeOpacity?parseFloat(e.strokeOpacity):1,$("#lineStrokeOpacitySlider").slider("value",d),lineOpacityText.set_value(d.toString()),d=e.strokeWidth?parseFloat(e.strokeWidth):1,$("#lineStrokeWeightSlider").slider("value",d),lineWeightText.set_value(d.toString()),$("#polylineStrokeColor").mSetInputColor(e.strokeColor),
mygis.UI.updateLinePreview(!0));f&&(f.strokeOpacity&&(d=parseFloat(f.strokeOpacity),$("#polygonStrokeOpacitySlider").slider("value",d),polygonStrokeOpacityText.set_value(d.toString())),f.fillOpacity&&(d=parseFloat(f.fillOpacity),$("#polygonFillOpacitySlider").slider("value",d),polygonFillOpacityText.set_value(d.toString())),d=f.strokeWidth?parseFloat(f.strokeWidth):1,$("#polygonStrokeWeightSlider").slider("value",d),polygonStrokeWeightText.set_value(d.toString()),$("#polygonStrokeColor").mSetInputColor(f.strokeColor),
$("#polygonFillColor").mSetInputColor(f.fillColor),mygis.UI.updatePolyPreview(!0))},getStyleChanges:function(){if(finishApplicationLoad){var a=$("#layersList").jqxGrid("getselectedrowindex"),b=layerSource.records[a].layerTABLE,c=layerSource.records[a].layerGeomType,a=mygis.Drawing.Styling.createSLD(b,c),d,e,f;switch(c){case "Point":d=a.namedLayers[b].userStyles[0].rules[0].symbolizer;break;case "Line":e=a.namedLayers[b].userStyles[0].rules[0].symbolizer;break;case "Polygon":f=a.namedLayers[b].userStyles[0].rules[0].symbolizer;
break;case "Mixed":d=a.namedLayers[b].userStyles[0].rules[0].symbolizer,e=a.namedLayers[b].userStyles[0].rules[1].symbolizer,f=a.namedLayers[b].userStyles[0].rules[2].symbolizer}if(d){var c=document.getElementById("pointGraphicUrl").value,g;if(c&&(g=markerSizeText.get_value(),c)){switch(c.substring(0,4)){case "ttf:":d.Point.graphicName=c;d.Point.externalGraphic=null;break;case "http":d.Point.externalGraphic=c;break;default:d.Point.externalGraphic="http://"+window.location.host+c}d.Point.graphicWidth=
g;d.Point.graphicHeight=g;d.Point.pointRadius=g/2;d.Point.fillColor=document.getElementById("pointColor").value;d.Point.strokeColor=document.getElementById("pointBorderColor").value;d.Point.strokeWidth=pointBorderText.get_value()}}e&&(d=document.getElementById("polylineStrokeColor").value,c=lineOpacityText.get_value(),g=lineWeightText.get_value(),e.Line.strokeWidth=g,e.Line.strokeOpacity=c,e.Line.strokeColor=d);if(f){e=document.getElementById("polygonStrokeColor").value;d=document.getElementById("polygonFillColor").value;
c=polygonStrokeOpacityText.get_value();g=polygonFillOpacityText.get_value();var h=polygonStrokeWeightText.get_value();f.Polygon.fillColor=d;f.Polygon.fillOpacity=g;f.Polygon.strokeColor=e;f.Polygon.strokeOpacity=c;f.Polygon.strokeWidth=h}return[a,b]}return null},saveLayerStyle:function(a){a||(a=$("#layersList").jqxGrid("getselectedrowindex"),a=layerSource.records[a].layerTABLE);var b=mygis.Map.getSingleAppliedStyle(a),c={},d=b.indexOf("<sld:FeatureTypeStyle"),b=b.substring(0,d)+"<sld:Name>"+a+"</sld:Name>"+
b.substring(d);c.layer=a;c.sld=b;c.layerID=mygis.Utilities.mggetLayerID(a);mygis.Utilities.blockUI();$.ajax({type:"POST",url:config.mgreq+"?qtype=updateStyle",data:c,success:function(a){mygis.Utilities.unblockUI();try{var b=eval(a);b.iotype=="success"?displaySuccess("Style updated"):displayError(b.iomsg)}catch(c){displayError(c.message)}}})},previewLayerStyle:function(){if(finishApplicationLoad){var a=mygis.UI.getStyleChanges();layerStyles[a[1]]=a[0];a=mygis.Map.getCustomAppliedStyle();digimap.layers[1].mergeNewParams({sld_body:a,
layers:null})}},clearPreviewLayer:function(){selectionWMSLayer&&(selectionWMSLayer.mergeNewParams({sld_body:null}),digimap.layers[1].setVisibility(!0))},toggleLayerConstraint:function(a){var b=$("#visible"+a),c=b.find(".visible"+a+"Btn")[0],d=b.find(".layerVisibleInput")[0],b=layerSource.records[$("#layersList").jqxGrid("getselectedrowindex")],d=d.value.replace(/\./g,"");c.ex_HasClassName("pressed")?(c.ex_RemoveClassName("pressed"),b.manualVisibility=!0):d?(c.ex_AddClassName("pressed"),b.manualVisibility=
!1,"From"==a?b.layerMinScale=parseFloat(d):b.layerMaxScale=parseFloat(d)):displayError(strings.LayerControl.visibleRangeNotFilled);mygis.Map.checkScaleConstraints();expandLayerDetails(null,!0)},createEditableInfo:function(){0==$("#editDigitize").children().length&&loadFragment("editDigitize",function(){$("#editDigitize").dialog({autoOpen:!1,modal:!0,resizable:!1,width:900,height:510,title:"New object",closeOnEscape:!1});$("#ui-dialog-title-editDigitize").parent().css({background:"url('"+config.folderPath+
"Images/Administration/header/icon-48-cpanel.png') #F6A828 no-repeat 14px 5px","background-size":"auto 18px"})})},toggleEditableInfo:function(){mygis.UI.createEditableInfo();var a=$("#mapFinalToolbar").find(".showInfoOnEdit")[0];(showInfoOnEdit=!showInfoOnEdit)?a.ex_AddClassName("btnTool_selected"):($("#editDigitize").dialog("close"),a.ex_RemoveClassName("btnTool_selected"))},showEditableInfo:function(){showInfoOnEdit&&(console.log("showEditableInfo"),mygis.Admin.UI.dialogConfig.checkfn=mygis.Drawing.Editing.checkValidInfo,
mygis.Admin.UI.dialogConfig.callbackfn=mygis.Drawing.Editing.digiPopupResult,mygis.Admin.UI.dialogConfig.windowTitle="#editDigitize",mygis.Admin.UI.dialogConfig.objectCount=1,$("#editDigitize").dialog("open"))},fixEditableInfo:function(){var a=$("#editableInfo");if(a){var b=a.find(".infoDetachCont")[0];$(b).is(":empty")?setTimeout(mygis.UI.fixEditableInfo,500):($(b).removeData(),b=$("#ui-dialog-title-editableInfo").parent(),b.css({background:"url('"+config.folderPath+"Images/file_edit.png') #F6A828 no-repeat 12px 2px",
"background-size":"auto 25px"}),b.find(".ui-dialog-titlebar-close").css({visibility:"hidden"}),b=b.parent(),$(b.find("#editableInfo")[0]).css({padding:"0","margin-left":"-5px",overflow:"hidden"}),$("#mapContainer"),a.dialog("option","position",[935,120]))}else setTimeout(mygis.UI.fixEditableInfo,500)},activateControl:function(a){mygis.UI.stopDigitize();$("#mapContainer").attr("class","olMap");switch(a){case "drag":mygis.UI.activateOLControl(naviControls.navigation);$("#dragPanBtn")[0].ex_AddClassName("selected");
break;case "zoomBox":mygis.UI.activateOLControl(naviControls.zoomBox);document.getElementById("mapContainer").ex_AddClassName("zoomMode");$("#zoomBoxBtn")[0].ex_AddClassName("selected");break;case "zoomOut":document.getElementById("mapContainer").ex_AddClassName("zoomModeOff")}},toggleOverview:function(){var a=$("#customOverview");a.is(":visible")?(a.hide(),$("#toggleOverviewBtn")[0].ex_RemoveClassName("selected")):(a.show(),$("#toggleOverviewBtn")[0].ex_AddClassName("selected"))},toggleInfoBtn:function(){var a=
!1;infoControls&&infoControls.click.active&&(a=!0);mygis.UI.clearInfoButtons();a?(infoControls.click.deactivate(),mygis.Map.clearSelection(),$("#toggleInfoBtn")[0].ex_RemoveClassName("selected")):(infoControls.click.events.unregister("getfeatureinfo",this,mygis.Map.showInfo2),digimap.removeControl(infoControls.click),infoControls.click=new OpenLayers.Control.WMSGetFeatureInfo({url:config.mapserver+"wms",title:"Identify features by clicking",drillDown:!0,infoFormat:"text/html",maxFeatures:10,layers:[digimap.layers[1]],
vendorParams:{EXCEPTIONS:"XML"}}),infoControls.click.events.register("getfeatureinfo",this,mygis.Map.showInfo2),digimap.addControl(infoControls.click),mygis.UI.activateOLControl(infoControls.click),document.getElementById("mapContainer").ex_AddClassName("selectMode"),$("#toggleInfoBtn")[0].ex_AddClassName("selected"),mygis.UI.stopDigitize())},toggleInfoBtn_V2:function(a){mygis.UI.resetControls();infoControls.select.activate();a?document.getElementById("mode_TopSelect").ex_AddClassName("drawer"):document.getElementById("mode_TopSelect").ex_RemoveClassName("drawer");
document.getElementById("mode_InfoSelect").ex_AddClassName("drawer");document.getElementById("mode_InfoStore").ex_AddClassName("drawer");document.getElementById("mode_AddSelect").ex_RemoveClassName("drawer");document.getElementById("mode_SubtractSelect").ex_RemoveClassName("drawer");a||document.getElementById("toggleInfoBtn").ex_AddClassName("selected");document.getElementById("mapContainer").ex_AddClassName("selectMode");mygis.UI.toggleSelectBtn("point")},addSelectBtn:function(a,b){for(var c=[],
d=[],e=0;e<layerSource.records.length;e++){var f=layerSource.records[e].layerTABLE;mygis.Map.layerHasProperty(f,"selectable")&&!0!==Boolean(layerSource.records[e].hidden)&&(c.push(f),d.push(config.namespace+f.split("_")[0]))}d=infoControls.select.active;digimap.removeControl(infoControls.select);infoControls.select.destroy();infoControls.select=new OpenLayers.Control.GetFeature({protocol:new OpenLayers.Protocol.WFS({version:"1.0.0",url:config.mapserver+"wms",featureType:c,featureNS:config.namespace+
"MyGIS",geometryName:"Geometry",srsName:digimap.projection.getCode()}),box:a,hover:!1,click:!a,single:b,multipleKey:"ctrlKey",toggleKey:"ctrlKey",clickTolerance:10>=digimap.getZoom()?55:15});infoControls.select.request=mygis.OLOverrides.mygis_Control.mygis_GetFeature.mygis_request;infoControls.select.selectBestFeature=mygis.OLOverrides.mygis_Control.mygis_GetFeature.mygis_selectBestFeature_v2;digimap.addControl(infoControls.select);infoControls.select.events.register("featuresselected",this,mygis.UI.selectionMultipleFeaturesSelected);
infoControls.select.events.register("featureselected",this,mygis.UI.selectionFeatureSelected);infoControls.select.events.register("featureunselected",this,mygis.UI.selectionFeatureUnselected);d?(a?document.getElementById("selectRect").ex_AddClassName("selected"):b||document.getElementById("selectObject").ex_AddClassName("selected"),infoControls.select.activate()):mygis.UI.activateOLControl(infoControls.select);$("#layerSelectionListCont").show()},addSelectCircleBtn:function(a){for(var b=[],c=[],d=
0;d<layerSource.records.length;d++){var e=layerSource.records[d].layerTABLE;mygis.Map.layerHasProperty(e,"selectable")&&(b.push(e),c.push(config.namespace+e.split("_")[0]))}c=infoControls.select.active;previouslyBox=infoControls.select.circle;digimap.removeControl(infoControls.select);infoControls.select.destroy();infoControls.select=new OpenLayers.Control.GetFeature({protocol:new OpenLayers.Protocol.WFS({version:"1.1.0",url:config.mapserver+"wms",featureType:b,featureNS:config.namespace+"MyGIS",
geometryName:"Geometry",srsName:digimap.projection.getCode()}),circle:a,hover:!1,click:!0,single:!1,multipleKey:"ctrlKey",toggleKey:"ctrlKey",clickTolerance:10>=digimap.getZoom()?55:15});infoControls.select.request=mygis.OLOverrides.mygis_Control.mygis_GetFeature.mygis_request;infoControls.select.selectBestFeature=mygis.OLOverrides.mygis_Control.mygis_GetFeature.mygis_selectBestFeature_v2;digimap.addControl(infoControls.select);infoControls.select.events.register("featuresselected",this,mygis.UI.selectionMultipleFeaturesSelected);
infoControls.select.events.register("featureselected",this,mygis.UI.selectionFeatureSelected);infoControls.select.events.register("featureunselected",this,mygis.UI.selectionFeatureUnselected);c?(a?document.getElementById("selectCircle").ex_AddClassName("selected"):document.getElementById("selectObject").ex_AddClassName("selected"),infoControls.select.activate()):mygis.UI.activateOLControl(infoControls.select)},selectionMultipleFeaturesSelected:function(a){var b=a.object.modifiers.multiple,c=a.object.modifiers.toggle;
document.getElementById("selectClear").ex_RemoveClassName("disabled");$("#layerSelectionListCont").hide();!b&&!c&&(selectionLayer.removeAllFeatures(),selectionLayer.addFeatures(a.features));a=[];for(b=0;b<selectionLayer.features.length;b++)a.push(selectionLayer.features[b].type);a=mygis.Utilities.arrayUnique(a);mygis.UI.isActiveSelectMode("mode_TopSelect")?mygis.Query.popupInfo(selectionLayer.features[0].data,a[0]):mygis.UI.setupSelectResults(a,selectionLayer.features)},selectionFeatureSelected:function(a){$("#layerSelectionListCont").hide();
mygis.UI.isActiveSelectMode("mode_SubtractSelect")?selectionLayer.removeFeatures([selectionLayer.getFeatureByFid(a.feature.fid)]):a.object.modifiers.multiple&&selectionLayer.addFeatures([a.feature])},selectionFeatureUnselected:function(a){try{mygis.UI.queryResultsReset(),!mygis.UI.isActiveSelectMode("mode_AddSelect")&&!mygis.UI.isActiveSelectMode("mode_SubtractSelect")&&(selectionLayer.removeFeatures([selectionLayer.getFeatureByFid(a.feature.fid)]),$("#infoAnalysisContents").empty(),$("#queryExpanders").die().empty())}catch(b){}},
editFeatureSelected:function(a){var b=[layerSource.records[layerCurrentEditing].layerTABLE];a.feature.type=b;mygis.UI.setupSelectResults(b,[a.feature])},toggleSelectBtn:function(a){var b,c=!1;switch(a){case "info":b=circlemode=!1;c=!0;break;case "point":b=circlemode=!1;break;case "rectangle":circlemode=!1;b=!0;break;case "circle":circlemode=!0,b=!1}a=infoControls.select.active;document.getElementById("mapContainer").ex_HasClassName("selectMode")||document.getElementById("mapContainer").ex_AddClassName("selectMode");
a&&(document.getElementById("infoTool").ex_RemoveClassName("selected"),document.getElementById("selectObject").ex_RemoveClassName("selected"),document.getElementById("selectRect").ex_RemoveClassName("selected"),document.getElementById("selectCircle").ex_RemoveClassName("selected"));!0==circlemode?mygis.UI.addSelectCircleBtn(circlemode):mygis.UI.addSelectBtn(b,c)},setupSelectResults:function(a,b){var c={};c.text=strings.Info.mapSelectionDefaultQText;c.value=mygis.UI.isActiveSelectMode("mode_InfoStore")?
-1:-999;c.isInitialized=!0;c.linkedResults={layers:a,features:b};c.isDBQuery=!1;c.isMapSelect=!0;mygis.UI.pushSelectInQueries(c,mygis.UI.isActiveSelectMode("mode_InfoStore"));c=$("#infoLeftList");c.jqxListBox("getItems");var d=c.jqxListBox("getItemByValue",-999);c.jqxListBox("selectIndex",d.index);mygis.UI.queryResultsRun()},pushSelectInQueries:function(a,b){var c=mygis.Utilities.getQueryByValue(a.value,!0);b||-1==c?(b&&(a.text=strings.Info.mapSelectionQText+(new Date).toString("hh:mm:ss")),querySource.push(a)):
querySource[c].linkedResults=a.linkedResults;mygis.UI.updateQueryList()},removeSavedQuery:function(){var a=$("#infoLeftList").jqxListBox("getSelectedIndex");-1<a&&(querySource.splice(a,1),mygis.UI.updateQueryList())},queryResultsReset:function(){$("#totalResultsCount").html("(0)");$("#queryExpanders").die().empty();$("#showWithinBtn").hide();$("#showQueryStatsBtn").hide();document.getElementById("panel3Out").ex_HasClassName("collapsed")||(document.getElementById("panel3Out").ex_AddClassName("collapsed"),
document.getElementById("rpanelCollapseBtn").ex_RemoveClassName("active"),document.getElementById("panel2").ex_RemoveClassName("rightExpanded"))},queryResultsRun:function(){mygis.UI.queryResultsReset();var a=$("#infoLeftList").jqxListBox("source"),b=$("#infoLeftList").jqxListBox("getSelectedItem");b||(b=$("#infoLeftList").jqxListBox("getItem",0));resultGridButtons.is(":empty")&&loadFragment("resultGridButtons",null,resultGridButtons);expandResultDetails();if(a[b.index].isDBQuery){var c=$("#infoAnalysisContents"),
d=a[b.index].linkedResults;c.empty();$("#queryExpanders").die().empty();a=mygis.UI.buildQueryExpanders(a[b.index].linkedResults);a.appendTo(c);a.find(">div");$("#layerPropertiesWrapper").height();$("#queryExpanders").accordion({fillSpace:!0,heightStyle:"auto",active:!1,collapsible:!0});$("#queryExpanders").data("querySource",b);document.getElementById("selectClear").ex_RemoveClassName("disabled")}else a[b.index].isMapSelect?(c=$("#infoAnalysisContents"),d=a[b.index].linkedResults,c.empty(),$("#queryExpanders").die().empty(),
a=mygis.UI.buildSelectExpanders(d.layers,d.features,d),a.appendTo(c),a.find(">div"),$("#layerPropertiesWrapper").height(),$("#queryExpanders").accordion({fillSpace:!0,heightStyle:"auto",active:!1,collapsible:!0}),$("#queryExpanders").data("querySource",b)):(alert("Error!"),console.log("Not mapselect, not db query. wtf is it?"));$("#totalResultsCount").html("("+$("#queryExpanders .featureTab").length+")");0<$("#queryExpanders .featureTab").length&&($("#showWithinBtn").show(),$("#showQueryStatsBtn").show())},
filterSearchResults:function(){var a=$("#infoAnalysis_SearchInput"),b=mygis.UI.isActiveSelectMode("mode_ResultsList")?0:1;if(a.data("oldVal")!=a.val()){a.data("oldVal",a.val());var a=a.val(),c=document.getElementById("infoAnalysisHeader");a?(c.ex_AddClassName("populated"),0==b&&mygis.UI.filterListResults(a)):(c.ex_RemoveClassName("populated"),0==b&&mygis.UI.clearFilterListResults())}},toggleSearchFilterFocus:function(a){var b=document.getElementById("infoAnalysisHeader");a?b.ex_HasClassName("focused")||
b.ex_AddClassName("focused"):b.ex_HasClassName("focused")&&b.ex_RemoveClassName("focused")},filterListResults:function(a){var a=a.toUpperCase(),b=$("#infoAnalysisContents .featureTabCont");$.each(b,function(b,d){var e=$(d).parent().parent().parent().find(".jqx-widget-header .jqx-expander-header-content"),f=e.html(),f=f.substring(0,f.indexOf("(")),g=$(d).find(".featureTab"),h=0;$.each(g,function(b,c){-1!=$(c).find(".featureTabTitle").html().toUpperCase().indexOf(a)?(h++,c.ex_RemoveClassName("collapsed")):
c.ex_AddClassName("collapsed")});e.html(mygis.Utilities.format("{0} ({1})",f,h))})},clearFilterListResults:function(){var a=$("#infoAnalysisContents .featureTabCont");$.each(a,function(a,c){var d=$(c).parent().parent().parent().find(".jqx-widget-header .jqx-expander-header-content"),e=d.html(),e=e.substring(0,e.indexOf("(")),f=$(c).find(".featureTab"),g=$(c).find(".featureTab.collapsed");$.each(g,function(a,b){b.ex_RemoveClassName("collapsed")});d.html(mygis.Utilities.format("{0} ({1})",e,f.length))})},
buildSelectTabs:function(a){expandResultDetails();var b=a.linkedResults.layers,a=a.linkedResults.features,c=$("#infoRightCol"),d=$("<ul />");d.attr("id","infoRightTabsQ");c.removeData().empty();c.die();c.append(d);1<c.children().length&&c.children().slice(1).remove();for(var e=0;e<b.length;e++){for(var f=[],g=b[e],h=0;h<a.length;h++){var k=a[h];k.type==g&&f.push(k)}var h=$("<div />"),k=$("<li />"),l=$("<div />");l.attr("class","resultGridButtons");l.html(resultGridButtons.html());d.append(k);h.attr("id",
"queryTab_"+e);h.append(l);k.html(g);h.data("result",f);h.data("windowTitle",g);c.append(h)}c.jqxTabs({width:"100%",height:"100%",theme:"pk_mg_white",scrollable:!0,scrollPosition:"right",selectionTracker:!0});c.live("selected",infoTabClickedM);infoTabClickedM(null,0,!1,!0)},buildSelectExpanders:function(a,b,c){for(var d=$("<div id='queryExpanders' />"),e=0;e<a.length;e++){var f=$("<div />"),g=$("<div />"),h=$("<div />"),k=a[e];h.attr("class","featureTabCont");f.html(mygis.Utilities.getFriendlyName(k));
for(var l=[],m=0;m<b.length;m++){var n=b[m];if(n.type==k){var o="featureTab";-1<layerCurrentEditing&&layerSource.records[layerCurrentEditing].layerTABLE==k&&(o+=" editMode");var q=$("<div />");q.attr("class",o);l.push(n.data);var t=0,r=$("<a class='firstLine featureTabExpand' />");$("<div class='secondLine' />");$("<div class='restContent' />");$.each(n.data,function(a,b){if(0==t){var d=$("<span class='featureTabTitle' />");r.click(function(a,b,c){return function(){router("expandSelect",{layername:a,
results:b,isMapSelect:!0,fid:c});return!1}}(k,c,n.fid));r.mouseover(function(a){return function(){router("markHoverResult",{feature:a})}}(n));d.append(b);r.append(d)}t+=1});q.append(r);h.append(q)}}h.data("gridSource",l);f.html(f.html()+"   ("+l.length+")");g.append(h);d.append(f);d.append(g)}return d},buildQueryExpanders:function(a){var b=$("<div id='queryExpanders' />");$.each(a,function(a,d){var e=$("<h3 />"),f=$("<div />"),g=$("<div />"),h=d.TableName;g.attr("class","featureTabCont");e.html(mygis.Utilities.getFriendlyName(h));
var k=[];$.each(d.Rows,function(a,b){var c=$("<div class='featureTab' />"),d=$("<a class='firstLine featureTabExpand' />");$("<div class='secondLine' />");$("<div class='restContent' />");k.push(b);var e=0,f=null;$.each(b.Cells,function(a,c){if(0==e){var g=$("<span class='featureTabTitle' />");d.click(function(a,b,c){return function(){router("expandSelect",{layername:a,results:b,isMapSelect:!1,fid:c});return!1}}(h,b.Cells,"OID"==b.Cells[0].ColumnName?b.Cells[0].Value:b.Cells[1].Value));g.append(c.Value);
d.append(g)}g=b.Cells[e];if("GeometryText"==g.ColumnName&&(f=(new OpenLayers.Format.WKT).read(g.Value)))f.geometry=f.geometry.transform(new OpenLayers.Projection("EPSG:4326"),selectionLayer.projection);e+=1});f&&(d.mouseover(function(a){return function(){router("markHoverResult",{feature:a})}}(f)),d.mouseleave(function(){return function(){mygis.Map.markFeatures();clearTimeout(internalConfig.zoomToFeat);internalConfig.zoomToFeat=setTimeout(function(){digimap.zoomToExtent(internalMemory.lastZoom)},
1E3)}}()));c.append(d);g.append(c)});g.data("gridSource",k);e.html(e.html()+"   ("+k.length+")");f.append(g);b.append(e);b.append(f)});return b},toggleDrawerButton:function(a){a=$(a).parent();a.toggleClass("drawer");switch(a.attr("id")){case "mode_TopSelect":mygis.UI.addSelectBtn(infoControls.select.box);break;case "mode_AddSelect":mygis.UI.isActiveSelectMode("mode_AddSelect")&&document.getElementById("mode_SubtractSelect").ex_RemoveClassName("drawer");break;case "mode_SubtractSelect":mygis.UI.isActiveSelectMode("mode_SubtractSelect")&&
document.getElementById("mode_AddSelect").ex_RemoveClassName("drawer");break;case "mode_ResultsList":var a=$("#infoLeftList"),b=a.jqxListBox("getSelectedIndex");-1<b&&(a.jqxListBox("clearSelection"),a.jqxListBox("selectIndex",b));break;case "mode_NewLayerDB":case "mode_NewLayerStyle":case "mode_NewLayerAdvanced":a=a.parent()[0],a.ex_HasClassName("expanded")?a.ex_RemoveClassName("expanded"):a.ex_AddClassName("expanded")}},isActiveSelectMode:function(a){var b=!1,c=document.getElementById(a);c?b=c.ex_HasClassName("drawer"):
console.log(a);return b},toggleSelectTab:function(a){a=$(a).parent();a[0].ex_HasClassName("expanded")?a[0].ex_RemoveClassName("expanded"):a[0].ex_AddClassName("expanded")},clearInfoButtons:function(){for(var a in infoControls)infoControls[a].deactivate();document.getElementById("infoTool").ex_RemoveClassName("selected");document.getElementById("toggleInfoBtn").ex_RemoveClassName("selected");document.getElementById("selectObject").ex_RemoveClassName("selected");document.getElementById("selectRect").ex_RemoveClassName("selected");
document.getElementById("selectCircle").ex_RemoveClassName("selected");document.getElementById("selectClear").ex_RemoveClassName("selected");mygis.Map.clearSelection()},ToggleFullLegend:function(){var a=mygis.Utilities.getVisibleLayerString(currentAppName,!0);document.getElementById("testLegend").src=config.mapserver+"wms?layer="+a+"&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH="+internalConfig.legendWidth+"&HEIGHT="+internalConfig.legendWidth;$("#testLegend").dialog()},getSingleLegend:function(a,
b){var c=document.createElement("img"),a=mygis.Utilities.nameToUnderscore(a),d;switch(b){case "Point":d=mygis.Utilities.format("&RULE={0} - Points",a);break;case "Line":d=mygis.Utilities.format("&RULE={0} - Lines",a);break;case "Polygon":case "Mixed":d=mygis.Utilities.format("&RULE={0} - Polygons",a);break;default:d=""}c.src=config.mapserver+"wms?layer="+a+"&REQUEST=GetLegendGraphic&transparent=true&VERSION=1.0.0&FORMAT=image/png&WIDTH="+internalConfig.legendWidth+"&HEIGHT="+internalConfig.legendWidth;
customStyleApplied&&(c.src+="&SLD_BODY="+escape(mygis.Map.getSingleAppliedStyle(a)));d=mygis.Utilities.format("{0}wms?layer={1}{2}&REQUEST=GetLegendGraphic&transparent=true&VERSION=1.0.0&FORMAT=image/png&WIDTH="+internalConfig.legendWidth+"&HEIGHT="+internalConfig.legendWidth,config.mapserver,a,d);customStyleApplied&&(d+="&SLD_BODY="+escape(mygis.Map.getSingleAppliedStyle(a)));checkImage(d,function(a){return function(b){mygis.Utilities.updateLayerSource("layerTABLE",a,"mygisImageSrc",b.src)}}(a));
return c},toggleLayerVisibleProperty:function(a){var b=$("#layersList").jqxGrid("getselectedrowindex");mygis.UI.toggleLayerVisible(null,b);a.ex_HasClassName("pressed")?a.ex_RemoveClassName("pressed"):a.ex_AddClassName("pressed")},toggleInfoGroup:function(){var a=$("#dialog-extend-fixed-container");a.hasClass("collapsed")?a.removeClass("collapsed"):a.addClass("collapsed")},toggleLayerGroup:function(a){for(var b=$("#layersList"),c=b.jqxGrid("getrootgroupscount"),d=0,e=!1;!e&&d<c;){var f=b.jqxGrid("getgroup",
d);if(f.group==a){var e=!0,f=f.subrows,g=0;$.each(f,function(a,b){b.Visible&&g++});var h=!0;g==f.length&&(h=!1);$.each(f,function(a,b){mygis.UI.preToggleLayerVisible(null,b["#"]-1,h,!0)})}d++}mygis.UI.updateLayerGrid(!0)},preToggleLayerVisible:function(a,b,c,d){$("#layersList");if(a){var e;layerSource.records.forEach(function(b,c,d){d[c].layerNAME==a&&c&&(e=c)})}else e=b;var f=!1,g=$.extend({},layerSource.records[e]);if(e>layerSource.records.length-1)mygis.UI.toggleLayerVisible(a,b,c),f=!0;else if(0<
internalMemory.unsavedLayerChanges.length)for(var b=0,h=internalMemory.unsavedLayerChanges;!f&&b<h.length;){var k=h[b];g.layerID==k.layerID&&(f=!0,k.hidden=void 0!=c?!c:!Boolean(k.hidden),d||mygis.UI.updateLayerGrid(!0),$("#applyLayersCont").show("slide",{direction:"down"},300));b++}f||(g.manualVisibility=!0,g.hidden=void 0!=c?!c:!Boolean(g.hidden),internalMemory.unsavedLayerChanges.push(g),d||mygis.UI.updateLayerGrid(!0),$("#applyLayersCont").show("slide",{direction:"down"},300))},toggleLayerVisible:function(a,
b,c){$("#initialLoad").find(".mygis_logo").hide();$("#initialLoad").find(".mygis_loader").attr({style:"margin-top:140px;"});var d=$("#mapsList").jqxListBox("getSelectedItem").originalItem;$("#layersList");if(a){var e;layerSource.records.forEach(function(b,c,d){d[c].layerNAME==a&&c&&(e=c)})}else e=b;e>layerSource.records.length-1?(b=layergridSource.localdata[e].Name,b==digimap.layers[0].name?(b=digimap.getLayersByName(b)[0],b.manualVisibility=!0,digimap.baseLayer==b?b.setVisibility(!b.visibility):
(digimap.baseLayer.setVisibility(!1),digimap.setBaseLayer(b))):mygis.Map.switchBackground(mygis.Utilities.getBGIdentifier(b),0)):(layerSource.records[e].hidden=void 0!=c?!c:!Boolean(layerSource.records[e].hidden),layerSource.records[e].manualVisibility=!0,loadMapSequence(d));mygis.UI.updateLayerGrid()},toggleLayerSelectable:function(a,b){var c=null!=a?a:$("#layersList").jqxGrid("getselectedrowindex");c<layerSource.records.length&&(layerSource.records[c].Selectable=!layerSource.records[c].Selectable,
c=infoControls.select.box,infoControls.select.active&&!b&&mygis.UI.addSelectBtn(c),mygis.UI.updateLayerGrid(b))},toggleLayerEditable:function(a){var b=null!=a?a:$("#layersList").jqxGrid("getselectedrowindex");if(b<layerSource.records.length){var c=layerSource.records[b],d=c.Editable;if(unsavedChanges)return showConfirmationDialog(strings.Editing.loseChanges,function(){mygis.UI.clearUnsavedLayer(layerCurrentEditing);mygis.UI.toggleLayerEditable(a)}),!1;mygis.UI.clearEditable();if(d)c.Editable=!1,$("#bottomTabContainer").jqxTabs("disableAt",
internalConfig.editTabIndex),mygis.UI.activateControl("drag"),cosmeticLayer.destroyFeatures(),window.location.reload(),cosmeticLayer=new OpenLayers.Layer.Vector("Cosmetic Layer",{preFeatureInsert:function(a){a.geometry.getCentroid()}}),mygis.Utilities.nudgeMap();else{c.Editable=!0;layerCurrentEditing=b;for(d=0;d<layerSource.records.length;d++)layerSource.records[d].Selectable&&d!=b&&(memory.LayerControl.selectableBeforeEdit.push(d),layerSource.records[d].Selectable=!1);mygis.Drawing.Editing.editLayer(c.layerTABLE);
layerSource.records[a].hidden||(mygis.UI.toggleLayerVisible(null,a,!1),layerToReset=a);mygis.UI.switchEditMode(document.getElementById("editModeDrag"));mygis.UI.activateSelectCtrl(document.getElementById("selectObject"));$("#bottomTabContainer").jqxTabs("enableAt",internalConfig.editTabIndex)}mygis.UI.updateLayerGrid()}},switchEditMode:function(a){if(!a.ex_HasClassName("disabled"))if("editModeDelete"==a.id)showConfirmationDialog(strings.Editing.deleteObject,function(){mygis.Drawing.Editing.mg_removeFeature()});
else{for(var b=$(a).parent().find("a"),c=0;c<b.length;c++)b[c].ex_RemoveClassName("pressed");switch(a.id){case "editModeDrag":featureEditMode=0;drawControls.modify.mode=OpenLayers.Control.ModifyFeature.DRAG;break;case "editModeRotate":featureEditMode=1;drawControls.modify.mode=OpenLayers.Control.ModifyFeature.ROTATE;break;case "editModeResize":featureEditMode=2;drawControls.modify.mode=OpenLayers.Control.ModifyFeature.RESIZE;break;case "editModeReshape":featureEditMode=3,drawControls.modify.mode=
OpenLayers.Control.ModifyFeature.RESHAPE}a.ex_AddClassName("pressed");if(0<cosmeticLayer.selectedFeatures.length){for(a=[];0<cosmeticLayer.selectedFeatures.length;)a.push(cosmeticLayer.selectedFeatures[0]),drawControls.modify.selectControl.unselect(cosmeticLayer.selectedFeatures[0]);for(b=0;b<a.length;b++)drawControls.modify.selectControl.select(a[b])}}},clearEditable:function(){for(var a=0;a<layerSource.records.length;a++)layerSource.records[a].Editable=!1;-1<layerToReset&&(mygis.UI.toggleLayerVisible(null,
layerToReset,!0),layerToReset=-1);for(var b=memory.LayerControl.selectableBeforeEdit,a=0;a<b.length;a++)layerSource.records[b[a]].Selectable=!0;memory.LayerControl.selectableBeforeEdit=[];document.getElementById("selectClear").ex_AddClassName("disabled")},updateLayerGrid:function(a){var b=$("#layersList");layergridSource={localdata:mygis.UI.buildGridSource(layerSource,"layers"),datatype:"array"};b.jqxGrid({source:layergridSource});b.jqxGrid("refreshdata");fixLayerList();a||(mygis.UI.initLayerSelectionList(!1),
mygis.UI.initLayerWithinSelectionList(!1),router("dragPanBtn"),mygis.Map.moveEnd())},initLayerSelectionList:function(a){var b=$("#layerSelectionList");if(a){b.jqxListBox({width:239,source:mygis.UI.buildSelectionListSource(layerSource),checkboxes:!0,height:128,theme:"pk_mg",displayMember:"layerNAME",valueMember:"layerTABLE",autoItemsHeight:!0,renderer:function(a,b){var c=$("#layerSelectionList").jqxListBox("source").records[a];if(c){var g;switch(c.layerGeomType){case "Point":g=strings.LayerControl.layergrid_colPoints;
break;case "Line":g=strings.LayerControl.layergrid_colLines;break;case "Polygon":g=strings.LayerControl.layergrid_colPolygons}return"<span class='"+c.layerGeomType+"' title='"+g+"'></span><span class='label' title='"+b+"'>"+b+"</span>"}}});b.bind("rendered",function(){var a=$("#layerSelectionList").find("#horizontalScrollBarlayerSelectionList"),b=$("#layerSelectionList").find("#bottomRightlayerSelectionList");"visible"===a.css("visibility")&&(a.css("visibility","hidden"),b.css("visibility","hidden"),
$("#layerSelectionList").css("height",$("#layerSelectionList").height()-17))});try{selectionLayers.unbind("checkChange")}catch(c){}}else b.unbind("checkChange"),b.jqxListBox({source:mygis.UI.buildSelectionListSource(layerSource)});b.unbind("checkChange");mygis.Map.setSelectableLayers(layerSource.records,b);mygis.Map.determineSelectionToggleStatus("#layerSelectionList");b.bind("checkChange",function(a){a=mygis.Utilities.mggetLayerIndex(a.args.item.originalItem.layerTABLE);mygis.UI.toggleLayerSelectable(a,
!0);a=infoControls.select.box;infoControls.select.active&&mygis.UI.addSelectBtn(a);internalConfig.updateLayerList&&clearTimeout(internalConfig.updateLayerList);internalConfig.updateLayerList=setTimeout(function(){mygis.UI.updateLayerGrid(!0)},1E3);mygis.Map.determineSelectionToggleStatus("#layerSelectionList")})},initLayerWithinSelectionList:function(a){var b=$("#layerWithinSelectionList");if(a){b.jqxListBox({width:310,source:mygis.UI.buildSelectionListSource(layerSource),checkboxes:!0,height:282,
theme:"pk_mg",displayMember:"layerNAME",valueMember:"layerTABLE",renderer:function(a,b){var c=$("#layerWithinSelectionList").jqxListBox("source").records[a],g;switch(c.layerGeomType){case "Point":g=strings.LayerControl.layergrid_colPoints;break;case "Line":g=strings.LayerControl.layergrid_colLines;break;case "Polygon":g=strings.LayerControl.layergrid_colPolygons}return"<span class='"+c.layerGeomType+"' title='"+g+"'></span><span class='label' title='"+b+"'>"+b+"</span>"}});try{b.unbind("checkChange")}catch(c){}}else b.unbind("checkChange"),
b.jqxListBox({source:mygis.UI.buildSelectionListSource(layerSource)});mygis.Map.setSelectableLayers(layerSource.records,b);mygis.Map.determineSelectionToggleStatus("#layerWithinSelectionList");b.bind("checkChange",function(){mygis.Map.determineSelectionToggleStatus("#layerWithinSelectionList")})},updateQueryList:function(){var a=$("#infoLeftList");a.die();a.jqxListBox({width:244,height:"100%",theme:"pk_mg",source:jQuery.extend(!0,{},querySource),displayMember:"text",renderer:function(a,c){return retobject=
mygis.Utilities.format("<div class='queryListItem'><a class='queryDeleteBtn' href='#' title='{1}'></a><a class='queryRunBtn' href='#' title='{2}'></a><span title='{0}'>{0}</span></div>",c,strings.QBuilder.deleteQuery,strings.QBuilder.runQuery)},valueMember:"value"});a.live("select",queryResultsSelect);a.live("click",queryResultsClick);$(".queryRunBtn").live("click",function(){showConfirmationDialog(strings.QBuilder.runQueryConfirm,function(){mygis.UI.queryResultsRun()});return!1});$(".queryDeleteBtn").live("click",
function(){router("searchDelete");return!1})},zoomToLayer:function(){var a=$("#layersList").jqxGrid("getselectedrowindex"),b=layerSource.records[a].layerEXTENTS.split("$"),c,d,a=parseFloat(b[0].replace(",","."));c=parseFloat(b[1].replace(",","."));d=parseFloat(b[2].replace(",","."));b=parseFloat(b[3].replace(",","."));digimap.zoomToExtent([a,c,d,b],!1)},moveLayerCustom:function(a,b){if(0<=b&&b<=layerSource.records.length-1){var c=$("#layersList");c.jqxGrid("hiderowdetails",a);var d=[];d.push(a);d.push(b);
MakeTimeout(function(a){layerSource.records=mygis.Utilities.arrayMove(layerSource.records,a[0],a[1]);mygis.UI.updateLayerGrid();loadMapSequence();c.jqxGrid("refreshdata")},d,0)}},moveLayerUp:function(){var a=$("#layersList").jqxGrid("getselectedrowindex"),b=document.getElementById("moveLayerStep").value;MakeTimeout(function(a){layerSource.records=mygis.Utilities.arrayMove(layerSource.records,a,a-b);mygis.UI.updateLayerGrid();loadMapSequence()},a,0)},moveLayerDown:function(){var a=$("#layersList").jqxGrid("getselectedrowindex"),
b=document.getElementById("moveLayerStep").value;MakeTimeout(function(a){layerSource.records=mygis.Utilities.arrayMove(layerSource.records,a,a+b);mygis.UI.updateLayerGrid();loadMapSequence()},a,0)},mg_removeLayer:function(){showConfirmationDialog(strings.ConfirmBox.msg_lc_removemap,function(){var a=$("#layersList"),b=a.jqxGrid("getselectedrowindex");a.jqxGrid("clearSelection");MakeTimeout(function(a){layerRemovedSource.push(layerSource.records.splice(a,1));mygis.UI.resetLayerAvailableActions();mygis.UI.updateLayerGrid();
loadMapSequence()},b,0)})},layerGrouping:function(a){"Name"==a.value?$("#layersList").jqxGrid("removegroup","Type"):$("#layersList").jqxGrid("addgroup","Type")},setProjectionTip:function(){var a=digimap.getProjection();$("#map_projection_node").html(a);params=[];var b;switch(a){case mygis.Utilities.projections.wgs84:b=mygis.Utilities.format("Projection: {0}<br/>Ellipsoid: {1}<br/>Datum: {2}","longlat","WGS 1984","WGS 1984");break;case mygis.Utilities.projections.google:b=mygis.Utilities.format("Projection: {0}<br/>Spheroid: {1}<br/>Datum: {2}",
"simple mercator","WGS 1984","WGS 1984")}params.push(b);singleQTip("projection",params)},stopDigitize:function(){mygis.UI.clearmygis();mygis.UI.clearDrawingMode();-1<layerCurrentEditing&&mygis.UI.clearUnsavedLayer()},objRClickHandler:function(a){cmenu.close();rightClickedObj=this;a.pixel=mygis.Utilities.latlngToPoint(digimap,a.latLng,digimap.getZoom());current=a;objcmenu.open(a,"hackMe")},createContextMenu:function(a){switch(a){case "map":cmenu=new contextMenu($(digiContainer));cmenu.add(strings.MapRMenu.zoomin,
"zoomIn",function(){var a=digimap.getLonLatFromLayerPx(new OpenLayers.Pixel(current.layerX,current.layerY));digimap.setCenter(a,digimap.getZoom()+1);internalMemory.lastZoom=digimap.getExtent();cmenu.close()});cmenu.add(strings.MapRMenu.zoomout,"zoomOut",function(){var a=digimap.getLonLatFromLayerPx(new OpenLayers.Pixel(current.layerX,current.layerY));digimap.setCenter(a,digimap.getZoom()-1);internalMemory.lastZoom=digimap.getExtent();cmenu.close()});cmenu.add(strings.MapRMenu.center,"centerHere",
function(){var a=digimap.getLonLatFromLayerPx(new OpenLayers.Pixel(current.layerX,current.layerY));digimap.setCenter(a);internalMemory.lastZoom=digimap.getExtent();cmenu.close()});digimap.div.oncontextmenu=function(a){current=a;cmenu.open(a);return!1};break;case "mapObject":objcmenu=new contextMenu($(digiContainer)),objcmenu.add("","objectTitleRMenu",function(){"marker"==rightClickedObj.overlaytype?rightClickedObj.setDraggable(!rightClickedObj.getDraggable()):rightClickedObj.setOptions({editable:!rightClickedObj.getEditable()})}),
objcmenu.add(strings.ObjRMenu.edit,"objR_edit",function(){"marker"==rightClickedObj.overlaytype?rightClickedObj.setDraggable(!rightClickedObj.getDraggable()):rightClickedObj.setOptions({editable:!rightClickedObj.getEditable()})}),objcmenu.add(strings.ObjRMenu.deleteMe,"objR_deleteMe",function(){mygis.UI.deleteObject(rightClickedObj)}),objcmenu.add(strings.ObjRMenu.styleMe,"objR_styleMe",function(){mygis.UI.editObjectStyle(rightClickedObj.overlaytype)}),objcmenu.add(strings.ObjRMenu.zoomin,"objR_zoomIn",
function(){digimap.setCenter(current.latLng);digimap.setZoom(digimap.getZoom()+1);objcmenu.close()}),objcmenu.add(strings.ObjRMenu.zoomout,"objR_zoomOut",function(){digimap.setCenter(current.latLng);digimap.setZoom(digimap.getZoom()-1);objcmenu.close()}),objcmenu.add(strings.ObjRMenu.fitBounds,"objR_fitBounds",function(){digimap.fitBounds(rightClickedObj.bounds);objcmenu.close()})}},editObjectStyle:function(a){switch(a){case "marker":$("#markerChooseStyle").dialog({modal:!0,resizable:!1,title:strings.ObjRMenu.styleMe,
width:380}).show();break;case "polyline":$("#polylineChooseStyle").dialog({modal:!0,resizable:!1,title:strings.ObjRMenu.styleMe}).show();break;case "rectangle":case "polygon":$("#polygonChooseStyle").dialog({modal:!0,resizable:!1,title:strings.ObjRMenu.styleMe}).show()}},selectMarkerStyle:function(a){var b=markerStyleList.get_selectedItem().get_value();b&&$("#markerPreview").html("<img style='width: 100%; height: 100%;' src='"+b+"' />");a||mygis.UI.previewLayerStyle()},changeLayerOpacity:function(a,
b){var c=b.value;layerOpacityText.set_value(100*c+"%");mygis.UI.previewLayerStyle()},changePointBorder:function(a,b){pointBorderText.set_value(b.value);mygis.UI.previewLayerStyle()},changePointOpacity:function(a,b){var c=b.value;pointOpacityText.set_value(100*c+"%");mygis.UI.previewLayerStyle()},changeMarkerSize:function(a,b){markerSizeText.set_value(b.value);mygis.UI.previewLayerStyle()},changeLineOpacity:function(a,b){lineOpacityText.set_value(b.value);mygis.UI.updateLinePreview()},changeLineWeight:function(a,
b){lineWeightText.set_value(b.value);mygis.UI.updateLinePreview()},changePolyStrokeOpacity:function(a,b){polygonStrokeOpacityText.set_value(b.value);mygis.UI.updatePolyPreview()},changePolyFillOpacity:function(a,b){polygonFillOpacityText.set_value(b.value);mygis.UI.updatePolyPreview()},changePolyWeight:function(a,b){polygonStrokeWeightText.set_value(b.value);mygis.UI.updatePolyPreview()},updateLinePreview:function(a){var b=document.getElementById("polylineStrokeColor").value,c=lineOpacityText.get_value();
lineWeightText.get_value();$("#polylinePreview").css({"background-color":b,opacity:c,height:"2px","margin-top":"18px","margin-bottom":"18px"});a||mygis.UI.previewLayerStyle()},updatePolyPreview:function(a){var b=document.getElementById("polygonStrokeColor").value,c=document.getElementById("polygonFillColor").value,d=polygonStrokeOpacityText.get_value(),e=polygonFillOpacityText.get_value();polygonStrokeWeightText.get_value();b=mygis.Utilities.hexToRGB(b);c=mygis.Utilities.hexToRGB(c);d="rgba("+b[0]+
","+b[1]+","+b[2]+","+d+")";c="rgba("+c[0]+","+c[1]+","+c[2]+","+e+")";$("#polygonPreview").css({"background-color":c,"border-color":d,"border-width":"5px"});a||mygis.UI.previewLayerStyle()},populateMarkerIcons:function(a,b){var c,d,e=!1;markerStyleList.trackChanges();$("#markerPreview").empty();d=markerStyleList.get_items();d.clear();switch(a){case "Default":c=new Telerik.Web.UI.RadListBoxItem;c.set_text("Default");c.set_value(mygis.Drawing.Styling.pointStyle.defaultIcon);c.set_imageUrl(mygis.Drawing.Styling.pointStyle.defaultIcon);
d.add(c);break;case "Google":var f,g,h;switch(b){case "Palette 2":f="pal2/";break;case "Palette 3":f="pal3/";break;case "Palette 4":f="pal4/";break;case "Palette 5":f="pal5/"}for(var k=0;64>k;k++)g="icon"+k.toString(),h="http://maps.google.com/mapfiles/kml/"+f+g+".png",c=new Telerik.Web.UI.RadListBoxItem,c.set_text(g),c.set_value(h),c.set_imageUrl(h),d.add(c);break;case "My uploads":case "My maps":c=new Telerik.Web.UI.RadListBoxItem,c.set_text(strings.Login.notLoggedIn),d.add(c),e=!0}1<=d.get_count()&&
!e&&(d.getItem(0).select(),d.getItem(0).scrollIntoView());markerStyleList.commitChanges()},setPointFont:function(a,b){var c=a.split("_"),c=$("#pointIcons").jqxGrid("getcellvalue",c[0],"_"+c[1]),d=document.getElementById("pointFontFamily"),d=d.options[d.selectedIndex].value,e=$("#markerPreview"),f=$(b).css("background-position");e.empty();e.attr("class",d);e.css("background-position",f);document.getElementById("pointGraphicUrl").value="ttf://"+d+"#"+c;mygis.UI.previewLayerStyle()},setPointImg:function(a){var a=
a.split("#")[1],b=$("<img />");b.attr("src",a);b.attr("class","geolink");var c=$("#markerPreview");c.attr("class","");c.empty();c.append(b);document.getElementById("pointGraphicUrl").value=a;mygis.UI.previewLayerStyle()},populatePointIcons:function(a,b){var c,d=$("#pointColumns").jqxNumberInput("getDecimal"),e=$("#pointIcons"),f=[],g=document.getElementById("pointFontFamily"),g=g.options[g.selectedIndex].value,h=document.getElementById("pointMyIconFolders"),h=h.options[h.selectedIndex].value;switch(a){case "primitive":c=
"image";break;case "font":c="image";f=buildFontSource(g,d);break;case "library":c="image",f=buildLibrarySource(h,d)}g=function(c,e,f){var g="",h="",k="",r,s,p="";switch(a){case "font":g="fontlink";h=b;k="mygis.UI.setPointFont('"+c.toString()+e+"',this);return false;";switch(b){case "Wingdings":r=parseInt(e.split("_")[1]),f=parseInt((c*d+r)/16),r=-1*(5+47*((c*d+r)%16)),s=0+-34*f}break;case "library":g="geolink",s=r=0,f&&(c=f.split("#")[1],p=mygis.Utilities.format("background-image: url('{0}');",c)),
k="mygis.UI.setPointImg('"+f+"',this);return false;"}return mygis.Utilities.format('<a href="#" onclick="{0}return false;" class="{1} {2}" style="background-position: {3}px {4}px;{5}"></a>',k,g,h,r,s,p)};c="image"==c?g:null;f={localdata:f,datatype:"array"};g=[];for(h=1;h<=d;h++){var k={text:""};k.datafield="_"+h.toString();k.width=40;k.cellsrenderer=c;g.push(k)}e.jqxGrid({source:f,width:40*d+20,height:200,autoheight:!1,theme:"pk_mg",enableanimations:!0,rowdetails:!1,sortable:!0,groupable:!1,showheader:!1,
showgroupsheader:!1,editable:!1,selectionmode:"singlecell",columns:g,rowsheight:34})},toggleEditMode:function(a,b){-1<layerCurrentEditing?mygis.UI.continueEditMode(!0,b):displayError(strings.Editing.noEditingForce)},continueEditMode:function(a,b){if(a){var c=!1,d=layerSource.records[layerCurrentEditing].layerGeomType,e=b[0];if("Mixed"==d||!d)c=!0;else switch(!0){case "Point"==d&&"marker"==e:c=!0;break;case "Line"==d&&"polyline"==e:c=!0;break;case "Polygon"==d&&("polygon"==e||"rectangle"==e):c=!0}c?
mygis.UI.activateTool(b):displayError(strings.Editing.wrongLayerType+d)}},cosmeticPush:function(a){featuresUnsaved.push(a);mygis.UI.notifyUnsavedLayer(layerCurrentEditing)},cosmeticPop:function(a){featuresUnsaved.pop();cosmeticLayer.removeFeatures([a])},notifyUnsaved:function(){document.getElementById("mapAction_Save").ex_RemoveClassName("disabled");clearInterval(saveFlasher);saveFlasher=setInterval(function(){var a=document.getElementById("mapAction_Save");a.ex_HasClassName("flash")?a.ex_RemoveClassName("flash"):
a.ex_AddClassName("flash")},500)},notifyUnsavedLayer:function(a){unsavedChanges=layerSource.records[a].Savable=!0},clearUnsavedLayer:function(){unsavedChanges=!1;featuresUnsaved=[];featuresModified={};featuresDeleted=[];cosmeticLayer.destroyFeatures();layerCurrentEditing=-1},disableNotifyUnsaved:function(){var a=document.getElementById("mapAction_Save");clearInterval(saveFlasher);a.ex_HasClassName("flash")&&a.ex_RemoveClassName("flash");a.ex_AddClassName("disabled")},clearmygis:function(a){for(var b,
c,d=0;6>d;d++){switch(d){case 0:c="marker";break;case 1:c="polyline";break;case 2:c="polygon";break;case 3:c="circle";break;case 4:c="rectangle";break;case 5:c="drive"}c!=a&&(b=document.getElementById(c+"Button"))&&b.ex_HasClassName("btnTool_selected")&&b.ex_RemoveClassName("btnTool_selected")}},clearDrawingMode:function(){for(key in drawControls)drawControls[key].deactivate()},setTool:function(a,b){var c=[];c.push(a);c.push(b);b.ex_HasClassName("btnTool_selected")?(b.ex_RemoveClassName("btnTool_selected"),
mygis.UI.clearDrawingMode()):mygis.UI.toggleEditMode(!0,c)},activateTool:function(a){var b=a[0],a=a[1];digimap.removeControl(drawControls[b]);switch(b){case "marker":drawControls.marker=new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.Point,{featureAdded:function(a){a.overlaytype="marker";mygis.UI.increaseMarkers(a);mygis.Utilities.blockUI();var b=layerSource.records[layerCurrentEditing].layerTABLE;$.ajax({type:"GET",url:config.mgreq+"?qtype=GetLayerFields&qContents="+escape(b.replace(/ /g,
"_")),success:function(a){a=mygis.Query.resultLayerDetails(a);mygis.Utilities.unblockUI();mygis.Query.popupInfo(a,b,!0)}})},handlerOptions:{stopDown:!1,stopUp:!1}});break;case "polyline":drawControls.polyline=new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.Path,{featureAdded:function(a){a.overlaytype="polyline";mygis.UI.increasePolylines(a)},handlerOptions:{stopDown:!1,stopUp:!1}});break;case "polygon":drawControls.polygon=new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.Polygon,
{featureAdded:function(a){a.overlaytype="polygon";mygis.UI.increasePolygons(a)},handlerOptions:{stopDown:!1,stopUp:!1}});break;case "rectangle":drawControls.rectangle=new OpenLayers.Control.DrawFeature(cosmeticLayer,OpenLayers.Handler.RegularPolygon,{featureAdded:function(a){a.overlaytype="rectangle";mygis.UI.increasePolygons(a)},handlerOptions:{stopDown:!1,stopUp:!1}})}digimap.addControl(drawControls[b]);var c=layerCurrentEditing;mygis.UI.activateOLControl(drawControls[b],a);layerCurrentEditing=
c;naviControls.navigation.activate();drawControls[b].deactivate();drawControls[b].activate();document.getElementById("mapContainer").ex_AddClassName("digitizeMode")},toggleToolbar:function(){toolbarToggling||(toolbarToggling=!0,$("#mapToolbar").is(":visible")?($("#mapToolbar").hide(),toolbarToggling=!1,document.getElementById("mapAction_Tools").setAttribute("class",""),document.getElementById("mapAction_Tools").setAttribute("className",""),showCosmetic(!1)):(showCosmetic(!0),$("#mapToolbar").show(),
toolbarToggling=!1,document.getElementById("mapAction_Tools").setAttribute("class","pressed"),document.getElementById("mapAction_Tools").setAttribute("className","pressed")));return!1},toggleToolbar2:function(){toolbarToggling||(toolbarToggling=!0,document.getElementById("toggleToolbar2"),$("#searchbar").is(":visible")?($("#searchbar").hide("slide",{direction:"left"},1E3,function(){toolbarToggling=!1}),document.getElementById("toggleToolbar2").setAttribute("class","pressed"),document.getElementById("toggleToolbar2").setAttribute("className",
"pressed")):($("#searchbar").show("slide",{direction:"left"},1E3,function(){toolbarToggling=!1}),document.getElementById("toggleToolbar2").setAttribute("class",""),document.getElementById("toggleToolbar2").setAttribute("className","")));return!1},toggleToolbar3:function(){toolbarToggling||(toolbarToggling=!0,document.getElementById("toggleToolbar3"),$("#miscbar").is(":visible")?($("#miscbar").hide("slide",{direction:"left"},1E3,function(){toolbarToggling=!1}),document.getElementById("toggleToolbar3").setAttribute("class",
"pressed"),document.getElementById("toggleToolbar3").setAttribute("className","pressed")):($("#miscbar").show("slide",{direction:"left"},1E3,function(){toolbarToggling=!1}),document.getElementById("toggleToolbar3").setAttribute("class",""),document.getElementById("toggleToolbar3").setAttribute("className","")));return!1},closeToolbars:function(a){for(var b=0;2>b;b++){var c,d="toggleToolbar"+(b+1).toString();switch(b){case 0:c="mapToolbar";break;case 1:c="searchbar"}c!=a&&$("#"+c).is(":visible")&&
($("#"+c).hide(),document.getElementById(d).setAttribute("class","pressed"),document.getElementById(d).setAttribute("className","pressed"))}},increaseMarkers:function(a){countMarkers++;mygis.UI.cosmeticPush(a)},decreaseMarkers:function(a){countMarkers--;mygis.UI.cosmeticPop(a)},increasePolygons:function(a){countPolygons++;mygis.UI.cosmeticPush(a)},decreasePolygons:function(a){countPolygons--;mygis.UI.cosmeticPop(a)},increasePolylines:function(a){countPolylines++;mygis.UI.cosmeticPush(a)},decreasePolylines:function(a){countPolylines--;
mygis.UI.cosmeticPop(a)},scaleTo:function(a){var b=document.getElementById("olScale_wrapper"),c=b.onchange;b.onchange=null;b.selectedIndex=0;b.onchange=c;a=a.substring(a.indexOf(":")+1);a=a.replace(/\./g,"");digimap.zoomToScale(a)},initializeStyleSheets:function(){mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.base.css"});mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.classic.css"});mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.energyblue.css"});
mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.pk_mg.css"});mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.pk_mg_white.css"});mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/jqwidgets/styles/jqx.pk_mg_jm.css"});mygis.Utilities.add_sheet({url:config.folderPath+"Scripts/css/jqxcalendar-overrides.css"});mygis.Utilities.add_sheet({url:config.folderPath+"GetAppStyle.ashx",title:"myappcust"});mygis.UI.createThemeChooser()},createThemeChooser:function(){$.ajax({type:"GET",
url:config.folderPath+"mgreq.ashx?qtype=GetAvailableThemes",success:function(a){try{if(0<a.length){var b=$("<select />");$("<option />");b.attr("id","themeChooser");$("#bottomPane").append(b);var c=b[0];c.options[0]=new Option(strings.Coding.promptThemeChoose,"-1");c.options[0].setAttribute("class","selectPrompt");$.each(a,function(){c.options[c.options.length]=new Option(this.name,this.value)});b.bind("change",mygis.UI.handleThemeChoose)}}catch(d){}}})},handleThemeChoose:function(){var a=parseInt($("#themeChooser").val());
-1<a?mygis.Utilities.previewCustomization(a):mygis.Utilities.enableCustomization()},createCriteriaMap:function(){if(!criteriaMap){criteriaMap=new OpenLayers.Map("criteriaMap",{fractionalZoom:!0,controls:[new OpenLayers.Control.Navigation({handleRightClicks:!0,autoActive:!0,dragPanOptions:{enableKinetic:!1}})]});var a=document.getElementById("criteriaMapBgSelect"),b=[],c={};c.name=strings.Coding.noBackground;c.value="";b.push(c);for(var d=criteriaMap.countBackgrounds=0;d<digimap.layers.length;d++){var e=
digimap.layers[d];e.isBaseLayer&&(c={},c.name=strings.LayerControl.labelBackground+e.name,c.value=e.name,b.push(c),criteriaMap.addLayer(e.clone()),criteriaMap.countBackgrounds+=1)}mygis.Utilities.populateSelect(a,b,!0);a.selectedIndex=1;a.onchange=function(){var a=document.getElementById("criteriaMapBgSelect");0<a.selectedIndex?(criteriaMap.baseLayer.setVisibility(!1),criteriaMap.setBaseLayer(criteriaMap.layers[a.selectedIndex-1]),criteriaMap.baseLayer.setVisibility(!0)):criteriaMap.baseLayer.setVisibility(!1)};
criteriaMap.setCenter(digimap.getCenter(),digimap.getZoom())}},updateCriteriaMap:function(a,b){var c=a.selectedIndex;if(lastCritIndex!=c){lastCritIndex=c;var d=wmsHighlight?-2:-1;0<c?(b=a.options[c].value,b=mygis.Utilities.nameToUnderscore(b),-2==d&&criteriaMap.layers.length<criteriaMap.countBackgrounds+2||criteriaMap.layers.length==criteriaMap.countBackgrounds?(c=mygis.Map.getMapServerLayer(b,"",currentMapMaxExtent),criteriaMap.addLayer(c)):criteriaMap.layers[criteriaMap.layers.length+d].mergeNewParams({layers:b}),
criteriaMap.layers[criteriaMap.layers.length+d].setVisibility(!0)):criteriaMap.layers[criteriaMap.layers.length+d].setVisibility(!1)}},getCriteriaLayerString:function(){var a="",b=[],c,a=$("#criteriaPanels").find(".dbTableName");$.each(a,function(a,e){0<e.selectedIndex&&(c=e.options[e.selectedIndex].value,c=mygis.Utilities.nameToUnderscore(c),b.push(c))});return a=b.join(",")},dbPopulateDistinct:function(a){var b=$(a).parent(),a=b.find(".dbFieldName")[0],c=a=a.options[a.selectedIndex].value;"%s"==
c.substr(c.length-2)&&(c=c.split("%")[0]);var d=b.parent().find(".dbTableName")[0],d=d.options[d.selectedIndex].value,e=b.find(".dbValueDistinct")[0];d&&a&&(a=config.mgreq+"?qtype=GetLayerDistinct&qContents="+escape(d.replace(/ /g,"_")+"$"+c),$.ajax({type:"GET",url:a,success:function(a){var c=[],d;try{var k=eval(a);$.each(k,function(a,b){d={};d.name=b;d.value=b;c.push(d)});mygis.Utilities.populateSelect(e,c);$(e).css({display:"inline"});b.find(".dbFieldValue")[0].value=""}catch(l){displayError(a)}}}))},
dbGetFromDistinct:function(a){$(a).parent().find(".dbFieldValue")[0].value=a.options[a.selectedIndex].value},dbFieldPopulate:function(a){$("#databaseAnalysis");var b=$(a).parent(),c=b.parent().find(".criteriaSecondRow"),d=c.find(".dbFieldName"),b=b.find(".andButton")[0];1<c.length&&c.slice(1).remove();c.find(".dbValueDistinct").css({display:"none"});0<a.selectedIndex?(b.ex_RemoveClassName("disabled"),a=config.mgreq+"?qtype=GetLayerFields&qContents="+escape(a.options[a.selectedIndex].value.replace(/ /g,
"_")),$.ajax({type:"GET",url:a,success:function(a){var b=mygis.Query.resultLayerDetails(a);$.each(d,function(a,c){mygis.Utilities.populateSelect(c,b)})}})):(b.ex_AddClassName("disabled"),c.css({display:"none"}),b.ex_RemoveClassName("pressed"))},dbQueryResults:function(a,b,c){mygis.Utilities.unblockUI();a=eval(a);if("object"==typeof a){var d={};d.text=b;displaySuccess(strings.QBuilder.feed_SearchSuccess+'"'+d.text+'"');d.value=-1;d.isInitialized=!0;d.linkedResults=a;d.isDBQuery=!0;d.isMapSelect=!1;
querySource.push(d);mygis.UI.updateQueryList();try{$("#databaseAnalysis").dialog("close")}catch(e){}b=$("#infoLeftList");a=b.jqxListBox("getItems").length;(d=b.jqxListBox("getItemByValue",-999))&&!c?b.jqxListBox("selectIndex",d.index):b.jqxListBox("selectIndex",a-1);mygis.UI.queryResultsRun()}else alert(a)},dbCriteriaClick:function(a){var b=$("#criteriaPanels"),c=b.children(),d=a.className.split(" ")[0];switch(d){case "bAnd":case "bOr":case "bXor":case "bNot":var e=$(a).parent(),f=e.find(".pressed")[0];
f!=a&&f.ex_RemoveClassName("pressed");a.ex_AddClassName("pressed");mygis.UI.dbCriteriaUpdateDescription();break;case "addPanel":var e=$(a).parent(),g=e.parent(),a=g.clone(!0);a.find(".closePanel").css({display:"inline"});a.find(".criteriaSecondRow").slice(1).remove();1>window.lines_id.length?(window.lines_id=[[0,!1,!1,!1]],f=0):window.lines_id!=[[0,!1,!1,!1]]&&(f=window.lines_id[window.lines_id.length-1][0]+1,window.lines_id.push([f,window.lines_id[f-1][1],window.lines_id[f-1][2],window.lines_id[f-
1][3]]));a.find(".criteriaSecondRow")[0].id="second_row_"+f.toString();a.find(".cal_button")[0].id="cal_button_"+f.toString();a.find(".dbFieldName")[0].selectedIndex=-1;a.find(".dbFieldOperator")[0].selectedIndex=-1;a.find(".dbFieldValue")[0].value="";a.find(".dbValueDistinct").css({display:"none"});a.find(".criteriaWrapperLegend").html(strings.QBuilder.panelTitle);b.append(a);$("#second_row_"+f.toString()+">.cal_button").hide();break;case "andButton":case "critDuplicate":e=$(a).parent();g=e.parent().parent();
b=$(g.find(".criteriaSecondRow")[0]);c.index(g);"andButton"==d&&!a.ex_HasClassName("disabled")?a.ex_HasClassName("pressed")?(a=b.clone(!0),1>window.lines_id.length?(window.lines_id=[[0,!1,!1,!1]],f=0):window.lines_id!=[[0,!1,!1,!1]]&&(f=window.lines_id[window.lines_id.length-1][0]+1,window.lines_id.push([f,window.lines_id[f-1][1],window.lines_id[f-1][2],window.lines_id[f-1][3]])),a[0].id="second_row_"+f.toString(),a.find(".cal_button")[0].id="cal_button_"+f.toString(),a.find(".dbFieldName")[0].selectedIndex=
-1,a.find(".dbFieldOperator")[0].selectedIndex=-1,a.find(".dbFieldValue")[0].value="",a.find(".dbValueDistinct").css({display:"none"}),a.find(".criteriaMOD").css({display:"block"}),a.find(".critRemove").css({display:"inline"}),g.append(a),$("#second_row_"+f.toString()+">.cal_button").hide()):(b.css({display:"block"}),a.ex_AddClassName("pressed")):(g=e.parent(),a=g.clone(!0),1>window.lines_id.length?(window.lines_id=[[0,!1,!1,!1]],f=0):window.lines_id!=[[0,!1,!1,!1]]&&(f=window.lines_id[window.lines_id.length-
1][0]+1,window.lines_id.push([f,window.lines_id[f-1][1],window.lines_id[f-1][2],window.lines_id[f-1][3]])),a[0].id="second_row_"+f.toString(),a.find(".jqxdatetime")[0].id="datetime_"+f.toString(),a.find(".cal_button")[0].id="cal_button_"+f.toString(),a.find(".dbFieldName")[0].selectedIndex=g.find(".dbFieldName")[0].selectedIndex,a.find(".dbFieldOperator")[0].selectedIndex=g.find(".dbFieldOperator")[0].selectedIndex,a.find(".criteriaMOD").css({display:"block"}),a.find(".dbValueDistinct").css({display:"none"}),
a.find(".critRemove").css({display:"inline"}),a.insertAfter(g),mygis.Utilities.datetime_input_field(document.getElementById("second_row_"+f.toString())));break;case "search":var f=document.getElementById("criteriaURL").value,h=document.getElementById("critFriendlyName").value;f?(f=config.mgreq+"?qtype=DirectQuery&qContents="+escape(f),mygis.Utilities.blockUI(),$.ajax({type:"GET",url:f,success:function(a){mygis.UI.dbQueryResults(a,h,!0)}})):displayError("No query yet");break;case "closePanel":f=$(a).parent().parent();
f.remove();mygis.UI.dbCriteriaUpdateDescription();f=parseInt(f.find(".criteriaSecondRow")[0].id.replace("second_row_",""));for(i=0;i<window.lines_id.length;i++)window.lines_id[i][0]==f&&(index=i);window.lines_id.splice(index,1);for(i=0;i<window.lines_id.length;i++){test=[i,!0,!0,!0,1];for(j=0;j<window.lines_id[i].length;j++)window.lines_id[i][j]!=test[j]&&(test[4]=0);1==test[4]&&mygis.Utilities.datetime_input_field(document.getElementById("second_row_"+i.toString()))}break;case "critRemove":e=$(a).parent().parent();
e.remove();mygis.UI.dbCriteriaUpdateDescription();f=parseInt(e[0].id.replace("second_row_",""));for(i=0;i<window.lines_id.length;i++)window.lines_id[i][0]==f&&(index=i);window.lines_id.splice(index,1);for(i=0;i<window.lines_id.length;i++){test=[i,!0,!0,!0,1];for(j=0;j<window.lines_id[i].length;j++)window.lines_id[i][j]!=test[j]&&(test[4]=0);1==test[4]&&mygis.Utilities.datetime_input_field(document.getElementById("second_row_"+i.toString()))}}},dbCriteriaReset:function(){var a=$("#criteriaPanels").children();
1<a.length&&($(".cal_button").hide(),a.slice(1).remove());var a=$(a[0]),b=a.find(".criteriaSecondRow");1<b.length&&b.slice(1).remove();var b=a.find(".criteriaSecondRow"),c=b.find(".dbFieldName")[0],d=b.find(".dbFieldOperator")[0];b.find(".dbFieldValue")[0].value="";d.selectedIndex=0;c.selectedIndex=0;mygis.UI.dbSelectChanged(d);mygis.UI.dbSelectChanged(c);b.css({display:"none"});a=a.find(".criteriaFirstRow");b=a.find(".dbTableName")[0];a.find(".andButton")[0].ex_RemoveClassName("pressed");b.selectedIndex=
0;mygis.UI.dbFieldPopulate(b);mygis.UI.dbCriteriaUpdateDescription();wmsHighlight=null;window.trigger_calendar=[];window.lines_id=[[0,!1,!1,!1]]},dbSelectChanged:function(a){var b=$(a).parent().parent(),c=a.className.split(" ")[0],d="";id=parseInt(b[0].id.replace("second_row_",""));switch(c){case "dbFieldName":d=".dbFieldOperator";b.find(".dbValueDistinct").css({display:"none"});for(i=0;i<window.trigger_calendar.length;i++)window.lines_id[id][1]=window.trigger_calendar[i][0]==a.selectedIndex?!0:!1;
break;case "dbFieldOperator":d=".dbFieldValue";try{!0==window.lines_id[id][1]&&(window.lines_id[id][2]=!0)}catch(e){}}d=b.find(d)[0];0<a.selectedIndex?($(d).removeAttr("disabled"),"dbFieldOperator"==c?window.lines_id[id][3]=!0:window.lines_id[id][2]=!0):($(d).attr("disabled","disabled"),"dbFieldOperator"==c?window.lines_id[id][3]=!1:window.lines_id[id][2]=!1);try{!1==window.lines_id[id][1]||!1==window.lines_id[id][3]?mygis.Utilities.rm_datetime_input_field(b[0]):!0==window.lines_id[id][2]&&mygis.Utilities.datetime_input_field(b[0])}catch(f){}},
dbCriteriaUpdateDescription:function(){$("#critSearchDescription").empty();var a="",b="",c=$("#criteriaPanels").children(),d=[];$.each(c,function(c,f){var g="",h="",k="",l="",m=!1,n=$(f).find(".dbTableName")[0];0<n.selectedIndex&&(g=g+"<span class='sqlKeyword'>"+strings.QBuilder.keywordSELECT,g=g+"</span>"+mygis.Utilities.format(" {0} ",strings.QBuilder.keywordALL),g=g+"<span class='sqlKeyword'>"+mygis.Utilities.format("{0} ",strings.QBuilder.keywordFROM),g=g+"</span>"+n.options[n.selectedIndex].text,
k+=mygis.Utilities.nameToUnderscore(n.options[n.selectedIndex].value),n=$(f).find(".criteriaSecondRow"),$.each(n,function(a,b){var c=$(b).find(".dbFieldName")[0],d=$(b).find(".dbFieldOperator")[0],e=$(b).find(".dbFieldValue")[0];if(0<c.selectedIndex&&0<d.selectedIndex&&""!=e.value){if(0<a&&m){var f=$(b).find(".criteriaMOD").find(".pressed")[0],g=$(f).html(),f=f.className.split(" ")[0];h+="<span class='sqlKeyword'>";h+=g+" ";h+="</span>";l+="%"+f}m||(h+="<span class='sqlKeyword'>",h+=mygis.Utilities.format("{0} ",
strings.QBuilder.keywordWHERE),h+="</span>",m=!0);h+=c.options[c.selectedIndex].text;h+=" ";h+="<span class='sqlKeyword'>";h+=d.options[d.selectedIndex].text;h+="</span>";h+=" ";h+="<span class='sqlValue'>";h+=e.value;h+="</span>";h+=" ";c=c.options[c.selectedIndex].value;e="%s"==c.substr(c.length-2)&&'"'!=c[0]&&'"'!=c[c.length-1]?mygis.Utilities.format('"{0}"',e.value):e.value;c="%s"==c.substr(c.length-2)?c.split("%")[0]:c;l+=mygis.Utilities.format("#{0}#{1}#{2}",c,d.options[d.selectedIndex].value,
e)}}),m&&(g+=" "+h,k+=l));g&&(a&&(a+="<br />",a+="<span class='sqlKeyword'>",a+=strings.QBuilder.keywordALSO,a+="</span>",a+="<br />",b+="$"),a+=g,b+=k,d.push(k))});a&&(document.getElementById("criteriaURL").value=b,$("#critSearchDescription").html(a))},dbResultsSelect:function(a){var b=$(a).parent().parent().parent(),b=$(b.find(".jqx-grid")[0]),c=b.jqxGrid("selectedrowindexes"),d=b.jqxGrid("source").records.length;if(c.length<d){b.unbind("rowclick");for(var e=0;e<d;e++)-1==c.indexOf(e)&&b.jqxGrid("selectrow",
e);b.bind("rowclick",infoGridRowClick);$(a).html(strings.Info.btnSelectNone)}else b.jqxGrid("clearselection"),$(a).html(strings.Info.btnSelectAll)},dbResultsOnMap:function(a){for(var a=$(a).parent().parent().parent(),a=$(a.find(".jqx-grid")[0]),b=a.data("gridTableName").trim(),c=a.jqxGrid("selectedrowindexes"),d="",b=mygis.Utilities.nameToUnderscore(b),e=0,d=b+"#",b=0;b<c.length;b++){e+=1;1<e&&(d+="%bOr#");var f=a.jqxGrid("getrowdata",c[b]),d=d+mygis.Utilities.format("OID#EQ#{0}",f.OID)}"#"!=d[d.length-
1]?(mygis.Query.highlightSelection([d]),$("#infoAnalysis").dialog("close")):displayError(strings.Info.err_AtLeastOne)},showExportMap:function(){$("#exportMapAs").dialog({width:450,resizable:!1})},saveDigiResults:function(a){var a=a.split("$"),b=a[1];switch(a[0]){case "success":displaySuccess(b);mygis.UI.clearUnsavedLayer(layerCurrentEditing);digimap.layers[1].redraw(!0);mygis.UI.activateControl("drag");mygis.Utilities.nudgeMap();Sys.Services.AuthenticationService.get_isLoggedIn()&&mygis.User.Hooks.loadUserLayerRights();
break;case "error":displayError(b)}},getMgScale:function(a){var b=Math.round(digimap.getScale());$(a).parent().find("input")[0].value=mygis.Utilities.addCommas(b)},resetLoadFeedback:function(){$("#mygis_loadFeedback").empty()},feedback:function(a,b){var c=$(mygis.Utilities.format("<p>{0}</p>",a)),d=$("#mygis_loadFeedback"),e=d.children();0<e.length&&$(e[e.length-1]).attr("class",b?"cross":"checked");d.append(c);d.scrollTo(c)},toggleActiveList:function(a){0!=a&&$.each($("#sidePanel .subPanel"),function(a,
c){c.ex_RemoveClassName("active")});switch(a){case internalConfig.mapTabIndex:$("#mapsAnalysis")[0].ex_AddClassName("active");$("#mapsList").jqxListBox("width",243);$("#mapsList").jqxListBox("width",244);break;case internalConfig.layerTabIndex:$("#layersAnalysis")[0].ex_AddClassName("active");break;case internalConfig.searchTabIndex:$("#objectsAnalysis")[0].ex_AddClassName("active")}fixLayerList()},toggleLayerAvailableActions:function(){var a=$("#layersList").jqxGrid("getselectedrowindexes");mygis.UI.resetLayerAvailableActions();
1<a.length?document.getElementById("btnLayer_Remove").ex_RemoveClassName("disabled"):1==a.length&&(document.getElementById("btnLayer_Remove").ex_RemoveClassName("disabled"),document.getElementById("btnLayer_Up").ex_RemoveClassName("disabled"),document.getElementById("btnLayer_Down").ex_RemoveClassName("disabled"),document.getElementById("btnLayer_ZoomFull").ex_RemoveClassName("disabled"),document.getElementById("btnLayer_ViewMetaData").ex_RemoveClassName("disabled"),document.getElementById("btnLayer_EditStyle").ex_RemoveClassName("disabled"))},
resetLayerAvailableActions:function(){var a=0<layerRemovedSource.length;Sys.Services.AuthenticationService.get_isLoggedIn()?document.getElementById("btnLayer_New").ex_RemoveClassName("disabled"):document.getElementById("btnLayer_New").ex_AddClassName("disabled");a?document.getElementById("btnLayer_Add").ex_RemoveClassName("disabled"):document.getElementById("btnLayer_Add").ex_AddClassName("disabled");document.getElementById("btnLayer_Up").ex_AddClassName("disabled");document.getElementById("btnLayer_Down").ex_AddClassName("disabled");
document.getElementById("btnLayer_Remove").ex_AddClassName("disabled");document.getElementById("btnLayer_ZoomFull").ex_AddClassName("disabled");document.getElementById("btnLayer_ViewMetaData").ex_AddClassName("disabled");document.getElementById("btnLayer_EditStyle").ex_AddClassName("disabled")},toggleSearchAvailableActions:function(){var a=$("#infoLeftList");mygis.UI.resetSearchAvailableActions();a.jqxListBox("getSelectedItem")&&(document.getElementById("btnPlaySearch").ex_RemoveClassName("disabled"),
document.getElementById("btnRemoveSearch").ex_RemoveClassName("disabled"))},resetSearchAvailableActions:function(){document.getElementById("btnPlaySearch").ex_AddClassName("disabled");document.getElementById("btnRemoveSearch").ex_AddClassName("disabled")}};
mygis.Query={highlightSelection:function(a,b){var c;c=b?'<?xml version="1.0" encoding="utf-8"?>'+b:'<?xml version="1.0" encoding="utf-8"?>'+mygis.Query.getSLDBody(a).replace(/#/g,"%23");c=c.replace(/Wingdings%23/g,"Wingdings#");var d=config.mapserver+"wms";selectionWMSLayer?selectionWMSLayer.mergeNewParams({sld_body:c}):(selectionWMSLayer=new OpenLayers.Layer.WMS("HighlightWMS",d,{format:"png",EXCEPTIONS:"BLANK",FORMAT:"image/png",transparent:!0,sld_body:c},{visibility:!0,isBaseLayer:!1,alpha:!0,
singleTile:!1,ratio:1}),digimap.addLayer(selectionWMSLayer));!selectionFlasher.timer&&(!b&&selectionWMSLayer)&&(selectionFlasher.count=0,selectionFlasher.timer=setInterval(function(){selectionFlasher.count=selectionFlasher.count+1;if(selectionFlasher.count>10){clearInterval(selectionFlasher.timer);selectionFlasher.timer=null}else selectionWMSLayer.setVisibility(!selectionWMSLayer.getVisibility())},500))},queryWithinWindow:function(){$("#layerWithinSelectionListCont").toggle();try{$("#statsAnalysis").dialog("close")}catch(a){}},
getLayersWithin:function(){var a=[],b=$("#layerWithinSelectionList").jqxListBox("getCheckedItems");$.each(b,function(b,d){a.push(d.value)});return a},getRowPK:function(a){var b=null;$.each(a.Cells,function(a,d){"OID"==d.ColumnName&&(b=d.Value)});return b},getLayersOutside:function(){var a=[],b=$("#queryExpanders").data("querySource").originalItem.linkedResults;if(b.layers)$.each(b.layers,function(c,d){var e={layer:d,ids:[]};$.each(b.features,function(a,b){var c=b.fid.split(".")[0];d==c&&e.ids.push(b.data.OID)});
a.push(e)});else for(var c,d=0;d<b.length;d++){var e=b[d];c={layer:e.TableName,ids:[]};$.each(e.Rows,function(a,b){c.ids.push(mygis.Query.getRowPK(b))});a.push(c)}return a},queryWithinExecute:function(){var a={layersFrom:mygis.Query.getLayersOutside(),layersSearch:mygis.Query.getLayersWithin()},b=config.mgreq+"?qtype=QueryWithin&qContents=",c=(new Date).toString("hh:mm:ss"),d=strings.QBuilder.friendlyNameDef+c;$("#layerWithinSelectionListCont").hide();mygis.Utilities.blockUI();$.ajax({type:"POST",
url:b,data:JSON.stringify(a),success:function(a){mygis.UI.dbQueryResults(a,d,!0)}})},queryStatsWindow:function(){0==$("#statsAnalysis").children().length?loadFragment("statsAnalysis",mygis.Query.queryStatsShow):mygis.Query.queryStatsShow(!0)},queryStatsPrint:function(){var a=new mygis.Printing.models.printModel;$.each($("#statsResultCont .result"),function(b,c){var d=$(c).find("table tr td"),d={header:$($(c).find(".fieldName")[0]).html(),subheader:$($(c).find(".fieldName.sub")[0]).html(),sumValue:$(d[0]).html(),
minValue:$(d[1]).html(),maxValue:$(d[2]).html(),avgValue:$(d[3]).html()};a.results.push(d)});mygis.Printing.printWindow("stats",a)},queryStatsShow:function(){$("#layerWithinSelectionListCont").hide();var a=$("#panel3Out");$("#statsAnalysis").dialog({modal:!1,resizable:!1,width:900,height:510,position:{my:"right top",at:"left top",of:a},dialogClass:"queryStatsWindowPopup",title:strings.QBuilder.statsTitle,open:function(){$("#statsCont").layout({south__size:430,south__resizable:!1,south__closable:!1,
applyDefaultStyles:!0});mygis.Query.statsActions=$("#statsActions").layout({east__size:900,east__resizable:!1,east__closable:!1,east__initHidden:!0,spacing_open:0,spacing_closed:0});$("#statsCriteria").layout({east__size:430,east__resizable:!1,east__closable:!1,spacing_open:0,spacing_closed:0});mygis.Query.statsBackToSelection();try{$("#statsFieldList").jqxListBox("clear")}catch(a){}mygis.Query.buildStatSource()}})},buildStatSource:function(){var a=$("#queryExpanders").data("querySource").originalItem.linkedResults,
b=[];if(a.layers)for(var c in a.layers)try{var d={},e=a.layers[c];d.name=e;d.value=mygis.Utilities.getFriendlyName(e);d.ids=[];var f=0,g="";$.each(a.features,function(a,b){var c=b.fid.split(".")[0];e==c&&(c=$.keys(b.data)[0],g&&(g+=", "),g+=b.data[c],d.ids.push(e+"."+b.data.OID),f++)});d.flavorName="<b>"+mygis.Utilities.getFriendlyName(e)+"</b> ("+g+")";0<d.ids.length&&b.push(d)}catch(h){}else for(c=0;c<a.length;c++)try{var k=a[c];0<k.Rows.length&&(d={},d.name=k.TableName,d.value=mygis.Utilities.getFriendlyName(k.TableName),
d.ids=[],d.flavorName="<b>"+mygis.Utilities.getFriendlyName(k.TableName)+"</b> ("+k.Rows.length+")",$.each(k.Rows,function(a,b){d.ids.push(k.TableName+"."+mygis.Query.getRowPK(b))}),b.push(d))}catch(l){}var m=$("#statsLayerList");m.jqxListBox({width:"100%",source:b,checkboxes:!0,height:"100%"});m.on("checkChange",function(){mygis.Query.statsClearFields();var a={},b=m.jqxListBox("getCheckedItems"),c=$("#queryExpanders").data("querySource").originalItem.linkedResults;if(c.layers){var d="";$.each(b,
function(a,b){0<d.length&&(d+=",");d+=b.originalItem.name});0<d.length&&OpenLayers.Request.GET({url:config.mapserver+"wfs?service=wfs&version=1.1.0&request=DescribeFeatureType&typeName="+d,success:function(b){b=mygis.Query.getWFSAttributes(b);$.each(b,function(b,c){var d=this;$.each(c.fields,function(b,c){if(!mygis.Utilities.isUnwantedField(c.Name)){var e="",f=!1;switch(c.DataType){case "int":e="System.Int32";f=!0;break;case "double":e="System.Double";f=!0;break;case "string":e="System.String"}f&&
(a[c.Name]?(a[c.Name].layerName+="#"+d.layerName,console.log(c.Name+" relogged, layerName: "+a[c.Name].layerName)):(a[c.Name]={name:c.Name,dataType:e,layerName:d.layerName},console.log(c.Name+" logged, layerName: "+a[c.Name].layerName)))}})});mygis.Query.createStatFieldList(a)}})}else $.each(b,function(b,d){$.each(c,function(b,c){c.TableName==d.originalItem.name&&$.each(c.Fields,function(b,c){var e=!1;switch(c.DataType){case "System.Int32":case "System.Double":e=!0}e&&(a[c.Name]?a[c.Name].layerName+=
"#"+d.originalItem.name:a[c.Name]={name:c.Name,dataType:c.DataType,layerName:d.originalItem.name})})})}),mygis.Query.createStatFieldList(a)})},createStatFieldList:function(a){var b=[];$.each(a,function(a,c){mygis.Utilities.isUnwantedField(c.name)||b.push({name:c.name,value:c.name,fieldType:c.dataType,layerName:c.layerName})});a=$("#statsFieldList");try{a.jqxListBox("clear")}catch(c){}a.jqxListBox({width:"100%",source:b,checkboxes:!0,height:"100%",renderer:function(a,b,c){return"<div class='fieldName'>"+
c+"</div>"}});a.on("checkChange",function(){0<$("#statsFieldList").jqxListBox("getCheckedItems").length?$("#statsCalculate").removeClass("disabled"):$("#statsCalculate").addClass("disabled")})},statsCalculate:function(){var a={layers:[],fields:[],ids:[]},b=$("#statsLayerList").jqxListBox("getCheckedItems");$.each(b,function(b,d){a.layers.push(d.originalItem.name);$.each(d.originalItem.ids,function(b,c){a.ids.push(c)})});b=$("#statsFieldList").jqxListBox("getCheckedItems");$.each(b,function(b,d){a.fields.push({Name:d.originalItem.name,
DataType:d.originalItem.fieldType,layerName:d.originalItem.layerName})});b=config.mgreq+"?qtype=GetQueryStats&qContents=";$("#statsResultCont").die().empty();$.ajax({type:"POST",data:JSON.stringify(a),url:b,success:function(a){a=eval(a);$.each(a,function(a,b){var c=$("<div class='result' />"),g=$("<div class='fieldName' />"),h=$("#statsFieldList").jqxListBox("getItemByValue",b.fieldName),k="";$.each($("#statsLayerList").jqxListBox("getItems"),function(a,b){-1<h.originalItem.layerName.indexOf(b.originalItem.name)&&
(k&&(k+="<br />"),k+=b.originalItem.flavorName)});g.append(strings.QBuilder.statsFieldNameBefore+" '"+b.fieldName+"' "+strings.QBuilder.statsFieldNameAfter+":");var l=$("<div class='fieldName sub' />");l.append(k);c.append(g);c.append(l);var g=$("<table />"),m=$("<tr />");g.append(m);$.each(b.stats,function(a,b){var c="";switch(b.statName){case "fieldSum":c=strings.QBuilder.statSum;break;case "fieldMin":c=strings.QBuilder.statMin;break;case "fieldMax":c=strings.QBuilder.statMax;break;case "fieldAvg":c=
strings.QBuilder.statAvg;break;case "fieldCount":c=strings.QBuilder.statCount}c=$("<td class=''><span class='fieldLabel'>"+c+"</span><span class='fieldValue'>"+mygis.Utilities.addCommas(b.statValue)+"</span></td>");m.append(c)});c.append(g);$("#statsResultCont").append(c)});mygis.Query.statsDisplayResults()}})},statsClearFields:function(){$("#statsResultCont").die().empty()},statsDisplayResults:function(){$("#statsPrint").show();$("#statsBack").show();$("#statsCalculate").hide();$("#statsCriteria").hide();
mygis.Query.statsActions.show("east")},statsBackToSelection:function(){$("#statsCriteria").show();$("#statsPrint").hide();$("#statsBack").hide();$("#statsCalculate").show();mygis.Query.statsActions.hide("east")},getWFSAttributes:function(a){for(var a=(new OpenLayers.Format.WFSDescribeFeatureType).read(a.responseText).featureTypes,b=[],c=0;c<a.length;c++){for(var d={layerName:a[c].typeName,fields:[]},e=0;e<a[c].properties.length;e++)d.fields.push({Name:a[c].properties[e].name,DataType:a[c].properties[e].localType});
b.push(d)}return b},highlightAll:function(a){var a='<?xml version="1.0" encoding="utf-8"?>'+mygis.Query.getSLDBody(a).replace(/#/g,"%23"),b=config.mapserver+"wms";wmsHighlight?wmsHighlight.mergeNewParams({sld_body:a}):(wmsHighlight=new OpenLayers.Layer.WMS("HighlightWMS",b,{format:"png",EXCEPTIONS:"BLANK",FORMAT:"image/png",transparent:!0,sld_body:a},{visibility:!0,isBaseLayer:!1,alpha:!0,singleTile:!1,ratio:1}),criteriaMap.addLayers([wmsHighlight]))},getSLDBody:function(a){for(var b={version:"1.0.0",
namedLayers:{}},c=0;c<a.length;c++){var d=mygis.Query.getTableFilter(a[c]);b.namedLayers[d.name]=d}return(new OpenLayers.Format.SLD).write(b)},getCombinedFilter:function(a,b){var c;switch(a){case "bAnd":c=OpenLayers.Filter.Logical.AND;break;case "bOr":c=OpenLayers.Filter.Logical.OR;break;case "bNot":c=OpenLayers.Filter.Logical.NOT}return new OpenLayers.Filter.Logical({type:c,filters:b})},getTableFilter:function(a){for(var b,a=a.split("%"),c=[],d=!1,e=[],f,g=0;g<a.length;g++){var h=a[g].split("#"),
k,l;0==g?b=h[0]:k=h[0];f=h[1];l=h[2];(h=h[3])&&0==h.indexOf("\\")&&(h=h.substring(3,h.length-6));f=null!=f&&null!=l&&null!=h?mygis.Drawing.Styling.getSLDFilter(l,f,h):null;if(0==g)"bOr"==mygis.Query.peek(a,g+1)?e.push(f):c.push(f);else switch(k){case "bNot":l=mygis.Query.getCombinedFilter(k,[f]);c.push(l);break;case "bAnd":c.push(f);break;case "bOr":0<c.length&&e.push(mygis.Query.getCombinedFilter("bAnd",c)),g==a.length-1||"bOr"==mygis.Query.peek(a,g+1)?e.push(f):(c=[],c.push(f)),d=!0}}1==a.length?
singleRule=f?new OpenLayers.Rule({symbolizer:mygis.Query.getSLDSymbolizer(),filter:f}):new OpenLayers.Rule({symbolizer:mygis.Query.getSLDSymbolizer()}):(0<c.length&&d&&e.push(mygis.Query.getCombinedFilter("bAnd",c)),k=d?mygis.Query.getCombinedFilter("bOr",e):mygis.Query.getCombinedFilter("bAnd",c),singleRule=new OpenLayers.Rule({symbolizer:mygis.Query.getSLDSymbolizer(),filter:k}));b={name:b,userStyles:[]};b.userStyles[0]={rules:[]};b.userStyles[0].rules.push(singleRule);return b},getSLDSymbolizer:function(){return{Polygon:{fillColor:"#FF0000",
stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}}},peek:function(a,b){try{return a[b].split("#")[0]}catch(c){return""}},getLayerDetails:function(a,b){var c=layerSource.records[a].layerTABLE;$.ajax({type:"GET",url:config.mgreq+"?qtype=GetLayerFields&qContents="+escape(c.replace(/ /g,"_")),success:function(a){a=mygis.Query.resultLayerDetails(a);if("editableInfo"==b){var e=!1,f=$("#editableInfo").find(".infoFields"),g=$("#editableInfo").find(".infoImages"),
h=$("#editableInfo").find(".infoFiles "),k=$("#editableInfo").find(".infoLinks "),l=$("<div />"),m=$("<div />"),n=$("<div />"),o=$("<div />"),q=0,t=0,r=0;f.empty();g.empty();h.empty();k.empty();$.each(a,function(a,b){var c=!1;if(b.name.endsWith("__"))switch(c=!0,b.name.substring(2).split("_")[0]){case "IMG":q+=1;break;case "LNK":r+=1;break;case "FILE":t+=1}if("Geometry"==b.name||"OID"==b.name||"Center_X"==b.name||"Center_Y"==b.name)c=!0;if(!c){var c=$("<div />"),d=$("<span />"),f=$("<input type='text' />");
d.html(b.name);d.addClass("featureHCell");f.addClass("featureVCell");c.append(d);c.append(f);l.append(c);e||(e=!0)}});f.append(l);var s=mygis.Utilities.format("{0} {1} {2}","Up to",q,"image fields have already been created"),p=mygis.Utilities.format("{0} {1} {2}","Up to",r,"link fields have already been created"),f=mygis.Utilities.format("{0} {1} {2}","Up to",t,"file fields have already been created"),s=$("<div />").append(s),p=$("<div />").append(p),f=$("<div />").append(f);m.append(s);n.append(f);
o.append(p);f=$("<div class='uploadActionBar' />");$("<a href='#' class='addNew' onclick='displayError('Not authorized');return false;' />").html("Add new");for(s=0;s<q;s++){var p=$("<div />"),u=$("<span />"),v=$("<input type='file' accept='image/jpg,image/gif' />");u.html("Add image");u.addClass("featureHCell");v.addClass("featureVCell");p.append(u);p.append(v)}for(s=0;s<r;s++)p=$("<div />"),u=$("<span />"),v=$("<input type='text' />"),u.html("Add link"),u.addClass("featureHCell"),v.addClass("featureVCell"),
p.append(u),p.append(v),o.append(p);for(s=0;s<t;s++)p=$("<div />"),u=$("<span />"),v=$("<input type='file' accept='image/jpg,image/gif' />"),u.html("Add image"),u.addClass("featureHCell"),v.addClass("featureVCell"),p.append(u),p.append(v);g.append(m);h.append(n);k.append(o);g.append(f.clone());h.append(f.clone());k.append(f.clone())}"editDigitize"==b&&mygis.Drawing.Editing.fillDigiPopup(a,c)}})},resultLayerDetails:function(a){var b={},c,a=eval(a);$.each(a,function(a,e){c={};c.name=e.fieldNAME;c.originalType=
e.fieldTYPE;c.fieldLists=e.fieldLISTS;c.value=-1<e.fieldTYPE.indexOf("char")||-1<e.fieldTYPE.indexOf("nchar")||-1<e.fieldTYPE.indexOf("varchar")||-1<e.fieldTYPE.indexOf("nvarchar")||-1<e.fieldTYPE.indexOf("Text")?e.fieldNAME+"%s":e.fieldNAME;b[e.fieldNAME]=c});return b},getInfoStructure:function(a){return $(["<div id='"+a+"' class='infoCont'>","\t<div class='layoutContainer'>\n\t\t<div class='ui-layout-north'>\n\t\t\t<div class='mainImageCont'></div>\n\t\t\t<a href='#' class='showInfoImagesBtn'></a>\n\t\t</div>\n\t\t<div class='ui-layout-center'>",
"\t\t\t<h3 class='infoImagesLabel'>"+strings.Info.section2+"</h3>","\t\t\t<div class='popupimageContainer' style='display:none'></div>","\t\t\t<h3 class='infoFieldsLabel'>"+strings.Info.section1+"</h3>","\t\t\t<div class='popupFieldContainer'></div>","\t\t\t<h3 class='infoFilesLabel'>"+strings.Info.section3+"</h3>","\t\t\t<div class='popupFileContainer' style='display:none'></div>\n\t\t</div>\n\t\t<div class='ui-layout-east'></div>\n\t</div>\n</div>"].join("\n"))},popupInfo:function(a,b,c){var d,
e=a.OID;d=jQuery.extend({},a);if(c)a={},$.each(d,function(b){a[b]=""}),a.OID=-1,e=a.OID;else{var f=mygis.Utilities.mggetLayerID(b),g=mygis.Query.resultLayerDetails(internalMemory.layerFields[f]);d=jQuery.extend(!0,d,g);if(mygis.Drawing.Exporting.checkRights(a.OID,f)){var h=jQuery.extend({},d);$.each(h,function(b){a[b]&&(h[b]=a[b])});a=jQuery.extend({},h)}}if(0<$("#detached"+b+"_"+e).length)$("#detached"+b+"_"+e).dialogExtend("restore");else{var f=mygis.Query.getInfoStructure("detached"+b+"_"+e),k=
f.find(".popupFieldContainer"),g=f.find(".popupimageContainer"),l=f.find(".popupFileContainer");k.empty();g.empty();l.empty();k.append(mygis.Query.buildInfoFields(a,b));console.log(location.toString());k.append($(["<div class='addthis_toolbox addthis_default_style' data-url='"+location.toString()+"'>","\t<a class='addthis_button_facebook_like'  fb:like:layout='button_count'></a>\n\t<a class='addthis_button_twitter' style='cursor:pointer'></a>\n\t<a class='addthis_button_email' style='cursor:pointer'></a>\n</div>"].join("\n")));
var k=b+"."+e,m=[],n=[];c||(m=mygis.UI.getObjectGridSource("Images",k).records,n=mygis.UI.getObjectGridSource("Files",k).records);var o=a[$.keys(a)[0]];if(-1==o||void 0==o||""==o)o=strings.Editing.newObjTitle;c={hasImages:0<m.length,hasFiles:0<n.length,title:o+"<div class='dialogSub'>"+strings.Info.infoWindowSubPart1+mygis.Utilities.getFriendlyName(b)+strings.Info.infoWindowSubPart2+"</div>",layer:b,oid:e,newWindow:c,fieldInfo:d};0<m.length&&(d=mygis.Utilities.format("url('{0}GetImage.ashx?qType=userFile&qContents={1}&qSize=430')",
config.folderPath,m[0].imageID),f.find(".mainImageCont").css("background-image",d),f.find(".showInfoImagesBtn").html(strings.Info.infoImagesBtn+"("+m.length+")"),g.append(mygis.UI.getInfoImageGrid(m,k)),g.data("images",m));0<n.length&&(l.append(mygis.UI.getInfoFileGrid(n,k)),l.data("files",n));mygis.Query.infoDetach(f,b+"_"+e,c)}},infoImgPreview:function(a){var b=a.src,c=b.substring(0,b.indexOf("&qSize")),b=$("<img />");b.attr("src",c);b.attr("class","imagePreviewer");var a=$(a).closest(".layoutContainer"),
c=a.find(".ui-layout-east"),d=$("<div class='imgPreview' />");d.append(b);c.html(d);b=a.parent().data("outerLayout");a=a.closest(".ui-dialog-content");try{b.hide("east")}catch(e){}c=a.width();$("#"+a.attr("id")).dialog("option","width",938);b.resizeAll();b.sizePane("east",c-20);b.show("east")},infoFilePreview:function(a){var b=mygis.Utilities.format(config.mgreq+"?qtype=DownloadFile&qContents={0}",a.id),a=$(a.elem).closest(".layoutContainer"),c=a.find(".ui-layout-east"),d=$("<div class='imgPreview' />");
c.html(d);var e=a.parent().data("outerLayout"),f=a.closest(".ui-dialog-content"),g=f.width();f.height();PDFJS.workerSrc=config.folderPath+"Scripts/lib/pdf.worker.js";PDFJS.getDocument(b).then(function(a){a.getPage(1).then(function(a){var b=a.getViewport(0.5),c=document.createElement("canvas"),h=c.getContext("2d");c.height=b.height;c.width=b.width;a.render({canvasContext:h,viewport:b}).then(function(){h.globalCompositeOperation="destination-over";h.fillStyle="#ffffff";h.fillRect(0,0,c.width,c.height);
var a=c.toDataURL();d.html('<img class="imagePreviewer" src="'+a+'"/>');$("#"+f.attr("id")).dialog("option","width",938);e.resizeAll();e.sizePane("east",g-20);e.show("east")})})})},breakupMapData:function(a,b,c){for(var a=a.features,b={},d=0;d<a.length;d++){var e=a[d];e.fid==c&&(b=e.data)}return b},breakupQueryData:function(a){var b={};$.each(a,function(a,d){b[d.ColumnName]=d.Value});return b},buildInfoStructure:function(a,b,c,d){var e=a.find(".layoutContainer").layout({north__applyDefaultStyles:!1,
north__size:150,north__closable:!1,north__resizable:!1,north__initClosed:!b,north__initHidden:!b,east__applyDefaultStyles:!0,east__size:300,east__initHidden:!0,east__closable:!0,east__resizable:!0,onclose:function(a,b){"east"==a&&$(b).closest(".ui-dialog-content").dialog("option","width",469)},spacing_closed:0}),f=a.find(".layoutContainer");f.linkify();f.togglepanels();d&&f.find(".mainImageCont").addClass("editable").bind("click",mygis.Drawing.Editing.handlerAttachImage);b||f.find(".infoImagesLabel").hide();
c||f.find(".infoFilesLabel").hide();f.find(".infoFieldsLabel").trigger("click");a.data("outerLayout",e)},buildInfoFields:function(a,b){var c=$("<div class='infoFieldsCont' />"),d=$("<table class='infoFieldsInnerCont' />"),e=mygis.Utilities.mggetLayerID(b);$.each(a,function(a,b){if(mygis.Drawing.Editing.isValidOutputIntern(a)){var c=$("<tr />"),k=$("<td />"),l=$("<td />"),m=internalMemory.layerFields[e][a];k.html(m.friendlyName.replace(/_/g," "));k.attr("data-originalName",a);k.attr("data-description",
m.description);l.html(b);k.addClass("featureHCell");l.addClass("featureVCell edit_area");c.append(k);c.append(l);d.append(c)}});c.append(d);c.append("<a href='#' class='infoPopup_editBtn' style='display:none;' />");c.append("<a href='#' class='infoPopup_deleteBtn' style='display:none;' />");return c},infoDetach:function(a,b,c){if(0<$("#detached"+b).length)$("#detached"+b).dialogExtend("restore");else{a.appendTo("body");contDiv=a;if(c.fieldInfo){var a=contDiv.find(".infoFieldsCont tr .featureVCell"),
d=c.fieldInfo;$.each(a,function(a,b){var c=$(b).prev().attr("data-originalName"),c=d[c];$(b).data("fieldInfo",c)})}a=!0;c.newWindow?a=!1:mygis.Drawing.Exporting.checkRights(c.oid,mygis.Utilities.mggetLayerID(c.layer))&&(a=!1);contDiv.dialog({width:469,height:650,resizable:!0,modal:c.newWindow,autoResize:!0,title:c.title,close:function(){internalMemory.dialogLeft-=10;internalMemory.dialogTop-=10;$(this).remove()},position:{my:"center+"+internalMemory.dialogLeft+" center+"+internalMemory.dialogTop,
at:"center center"},open:function(){internalMemory.dialogLeft+=10;internalMemory.dialogTop+=10;var a=$("#detached"+b).parent().find(".ui-dialog-titlebar");a.parent();$("#detached"+b);a.css({background:"#F6A828 no-repeat 12px 2px"});$(".ui-widget-overlay").bind("click",function(){$(this).siblings(".ui-dialog").find(".ui-dialog-content").dialog("close")});mygis.Query.buildInfoStructure($("#detached"+b),c.hasImages||c.newWindow,c.hasFiles||c.newWindow,c.newWindow);Sys.Services.AuthenticationService.get_isLoggedIn()&&
mygis.Drawing.Editing.checkInfoPopupButtons(c.layer,c.oid,c.fieldInfo);c.newWindow&&mygis.Drawing.Editing.editInfoFields(c.fieldInfo);mygis.UI.Hooks.infoWindowShown()},beforeClose:function(a){if(c.newWindow)return mygis.Drawing.Exporting.checkDigitizing(a),!1}}).dialogExtend({minimizable:a,beforeMinimize:function(){$("#dialog-extend-fixed-container").show();$("#panel1 .ui-layout-center").animate({scrollTop:0},0)},minimize:function(){$("#dialog-extend-fixed-title").show()},restore:function(){0==$("#dialog-extend-fixed-container .ui-dialog").length&&
($("#dialog-extend-fixed-title").hide(),$("#dialog-extend-fixed-container").hide())}})}}};
mygis.Utilities={updateLayerSource:function(a,b,c,d){for(var e=0,f=!1;!f&&e<layerSource.records.length;)layerSource.records[e][a]==b?f=!0:e++;f?(layerSource.records[e][c]=d,internalConfig.updateLayerSource&&clearTimeout(internalConfig.updateLayerSource),internalConfig.updateLayerSource=setTimeout(function(){mygis.UI.updateLayerGrid()},5E3)):console.log(a+" not found. Search value: "+b)},isUnwantedField:function(a){var b=!1;switch(a){case "OID":case "Geometry":case "GeometryText":b=!0}a.endsWith("__")&&
(b=!0);return b},populateBGselect:function(a,b){a.empty();for(var c in backgrounds)if(backgrounds[c].hasOwnProperty("name")){var d=$("<option />");d.attr("value",c);d.html(backgrounds[c].name);c.toString()==b&&d.attr("selected","selected");a.append(d)}else for(var e in backgrounds[c])d=$("<option />"),d.attr("value",c+"."+e),d.html(backgrounds[c][e].name),c+"."+e==b&&d.attr("selected","selected"),a.append(d)},getBGIdentifier:function(a){var b="",c;for(c in backgrounds)if(backgrounds[c].hasOwnProperty("name"))backgrounds[c].name==
a&&(b=c.toString());else for(var d in backgrounds[c])backgrounds[c][d].name==a&&(b=c+"."+d);return b},enableCustomization:function(){mygis.Utilities.disableCustomization();mygis.Utilities.add_sheet({url:config.folderPath+"GetAppStyle.ashx?ut="+(new Date).getTime(),title:"myappcust"})},disableCustomization:function(){mygis.Utilities.remove_sheet("myappcust")},previewCustomization:function(a){mygis.Utilities.disableCustomization();mygis.Utilities.add_sheet({url:config.folderPath+"GetAppStyle.ashx?st="+
a+"&ut="+(new Date).getTime(),title:"myappcust"})},add_sheet:function(a){var b=!1,c=!0;return a.str?(a.title&&(b=$("style[id='"+a.title+"-stylesheet']")[0]),b?c=!1:(b=document.createElement("style"),b.setAttribute("type","text/css"),a.title&&b.setAttribute("id",a.title+"-stylesheet")),b.styleSheet?c?(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet.cssText=a.str):b.styleSheet.cssText=b.styleSheet.cssText+" "+a.str:(b.appendChild(document.createTextNode(a.str)),document.getElementsByTagName("head")[0].appendChild(b)),
b.sheet||b.styleSheet):a.url?(b=document.createElement("link"),b.rel="stylesheet",b.type="text/css",b.media="all",b.href=a.url,a.title&&(b.id=a.title),document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet):null},remove_sheet:function(a){(a=document.getElementById(a))&&document.getElementsByTagName("head")[0].removeChild(a)},mergeOptions:function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c},blockUI:function(a){try{internalConfig.uiBlocked||(a?($("#initialLoad").find(".mygis_logo").show(),
$("#initialLoad").find(".mygis_loader").attr({style:"display: none;margin-top:0px;"}),$.blockUI({message:$("#initialLoad")})):($("#initialLoad").find(".mygis_logo").hide(),$("#initialLoad").find(".mygis_loader").attr({style:"display: block;margin-top:140px;"}),$.blockUI({message:$("#initialLoad"),css:{backgroundColor:"transparent"},overlayCSS:{opacity:0}})),internalConfig.uiBlocked=!0)}catch(b){console.log(b.message)}},unblockUI:function(){$.unblockUI();internalConfig.uiBlocked=!1},resetBlockUI:function(){var a=
$("#VariousPopUps"),b=$("<div />");b.attr("id","initialLoad");b.attr("style","display:none");var c=$("<div />");c.attr("class","mygis_logo");var d=$("<img />");d.attr("src",config.folderPath+"GetImage.ashx?qType=GetAppLogo");var e=$("<div />");e.attr("id","mygis_loadFeedback");c.append(d);c.append(e);d=$("<div />");e=$("<img />");d.attr("class","mygis_loader");e.attr("src",config.folderPath+"Images/mygis_loader.gif");d.append(e);b.append(c);b.append(d);a.append(b)},categorizeFeatures:function(a){for(var b=
{},c=0;c<a.length;c++){var d=a[c];b[d.type]||(b[d.type]=[]);b[d.type].push(d)}return b},mggetLayerIndex:function(a){for(var b=-1,c=0,d=!1;!d&&c<layerSource.records.length;)layerSource.records[c].layerTABLE==a?(d=!0,b=c):c++;return b},mggetLayerID:function(a){for(var b=-1,c=0,d=!1;!d&&c<layerSource.records.length;){var e=layerSource.records[c];e.layerTABLE==a?(d=!0,b=e.layerID):c++}return b},getQueryByValue:function(a,b){for(var c=0,d=!1;!d&&c<querySource.length;){var e;e=querySource[c];e.value==a?
d=!0:c++}return b&&!d?-1:b?c:e},checkAuthorization:function(a,b){$.ajax({url:config.mgreq+"?qtype=isAuthorized&qContents="+a+"&qParams="+b,type:"GET",success:function(){return function(a){a=eval(a);if("success"==a.type)switch(a.operation){case "digitize":mygis.Drawing.Exporting.saveDigitizing()}else displayError(a.message)}}()})},getFriendlyName:function(a){for(var b=0,c=!1,d=a;!c&&b<layerSource.records.length;){var e=layerSource.records[b];e.layerTABLE==a?(c=!0,d=e.layerNAME):b++}return d},arrayUnique:function(a){var b=
{},c,d=a.length,e=[];for(c=0;c<d;c+=1)b[a[c]]=a[c];for(c in b)e.push(b[c]);return e},arrayMove:function(a,b,c){for(;0>b;)b+=a.length;for(;0>c;)c+=a.length;if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a},isNumeric:function(a){a=a.toString();return a-0==a&&0<a.length},isEmptyObject:function(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0},populateSelect:function(a,b,c){a.options.length=0;!$.isEmptyObject(b)&&!c&&(a.options[0]=
new Option("",""));var d=0;$.each(b,function(){d++;try{if("datetime"==this.originalType||"date"==this.originalType)if(a.options[a.options.length]=new Option(this.name,this.value),0==window.trigger_calendar.length)window.trigger_calendar.push([d.toString(),this.name]);else for(d=0;d<window.trigger_calendar.length;d++)window.trigger_calendar[d][1]!=this.name&&window.trigger_calendar.push([d.toString(),this.name]);else a.options[a.options.length]=new Option(this.name,this.value)}catch(b){a.options[a.options.length]=
new Option(this.name,this.value)}})},array_keys:function(a,b,c){var d="undefined"!==typeof b,e=[],f=!!c,g=!0,h="";if(a&&"object"===typeof a&&a.change_key_case)return a.keys(b,c);for(h in a)a.hasOwnProperty(h)&&(g=!0,d&&(f&&a[h]!==b?g=!1:a[h]!=b&&(g=!1)),g&&(e[e.length]=h));return e},stringToBoolean:function(a){switch(a){case "True":case "true":case "yes":case "1":return!0;case "False":case "false":case "no":case "0":case null:return!1;default:return Boolean(a)}},formatLonlats:function(a){var b=a.lon,
a=a.lat,c=OpenLayers.Util.getFormattedLonLat(b),d=OpenLayers.Util.getFormattedLonLat(a,"lon"),c=c.substring(0,c.length-2),d=d.substring(0,d.length-2),b=mygis.Utilities.format("<div class='coord'>X: {0} ({1}\u00b0)</div>",c,Math.round(1E4*b)/1E4),a=mygis.Utilities.format("<div class='coord'>Y: {0} ({1}\u00b0)</div>",d,Math.round(1E4*a)/1E4);return b+a},unbindGlobalHandlers:function(){var a=$(document).data("events").mousedown,b=[];$.each(a,function(a,d){b.push(d.handler)});window.globalHandlers=b;
$(document).unbind("mousedown")},rebindGlobalHandlers:function(){window.globalHandlers&&0<window.globalHandlers.length&&($.each(window.globalHandlers,function(a,b){$(document).bind("mousedown",b)}),window.globalHandlers=[])},addCommas:function(a){x=(a+"").split(".");x1=x[0];x2=1<x.length?"."+x[1]:"";for(a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1.$2");return x1+x2},ConvertJsonToTable:function(a,b,c,d){var d=d?'<a href="{0}">'+d+"</a>":'<a href="{0}">{0}</a>',b='<table border="1" cellpadding="1" cellspacing="1"'+
(b?' id="'+b+'"':"")+(c?' class="'+c+'"':"")+">{0}{1}</table>",c="<thead>{0}</thead>",e="<tbody>{0}</tbody>",f="",g="",h="";if(a){var k="string"==typeof a[0],l;if(k)f+="<th>{0}</th>".format("value");else if("object"==typeof a[0]){l=mygis.Utilities.array_keys(a[0]);for(i=0;i<l.length;i++)f+="<th>{0}</th>".format(l[i])}c=c.format("<tr>{0}</tr>".format(f));if(k)for(i=0;i<a.length;i++)g+="<td>{0}</td>".format(a[i]),h+="<tr>{0}</tr>".format(g),g="";else if(l){f=RegExp(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig);
k=RegExp(/(^javascript:[\s\S]*;$)/ig);for(i=0;i<a.length;i++){for(j=0;j<l.length;j++)var m=a[i][l[j]],g=f.test(m)||k.test(m)?g+"<td>{0}</td>".format(d.format(m)):m?g+"<td>{0}</td>".format(m):g+"<td>{0}</td>".format("<i>{0}</i>".format(m).toUpperCase());h+="<tr>{0}</tr>".format(g);g=""}}e=e.format(h);return b=b.format(c,e)}return null},nameToUnderscore:function(a){0<a.indexOf(" ")&&(a=a.split(" ").join("_"));return a},getVisibleLayerString:function(a,b){for(var c="",c=layerSource.records,d=[],e=c.length-
1;0<=e;e--)!0!==Boolean(c[e].hidden)&&(layername=c[e].layerTABLE,layername=mygis.Utilities.nameToUnderscore(layername),d.push(layername));return c=d.join(b?"+":",")},format:function(a){for(i=1;i<arguments.length;i++)a=a.replace(RegExp("\\{"+(i-1)+"}","g"),arguments[i]);return a},roundVal:function(a){return 9>a.toString().length?a:Math.round(a*Math.pow(10,6))/Math.pow(10,6)},checkKeypress:function(a){var b;window.event?b=a.keyCode:a.which&&(b=a.which);if(13==b)return mygis.Map.showAddress(document.getElementById("searchBtn").value),
!1},isMouseLeaveOrEnter:function(a,b){if("mouseout"!=a.type&&"mouseover"!=a.type)return!1;for(var c=a.relatedTarget?a.relatedTarget:"mouseout"==a.type?a.toElement:a.fromElement;c&&c!=b;)c=c.parentNode;return c!=b},latlngToPoint:function(a,b){return a.getProjection().fromLatLngToPoint(b)},deg2rad:function(a){return a/180*Math.PI},circle2polygon:function(a){mygis.Utilities.deg2rad(a.lat());mygis.Utilities.deg2rad(a.lng());for(a=0;360>=a;a++)mygis.Utilities.deg2rad(a)},randomXToY:function(a,b,c){a+=
Math.random()*(b-a);return"undefined"==typeof c?Math.round(a):a.toFixed(c)},opacityToHex:function(a){var b;1>=a&&0<=a&&(b=Math.floor(255*a).toString(16),1==b.length&&(b="0"+b));return b},cutHex:function(a){return"#"==a.charAt(0)?a.substring(1,7):a},hexToRGB:function(a){var b=[],c,d;d=mygis.Utilities.cutHex(a);a=parseInt(d.substring(0,2),16);c=parseInt(d.substring(2,4),16);d=parseInt(d.substring(4,6),16);b.push(a);b.push(c);b.push(d);return b},rgbaToHex:function(a){var b=a.indexOf("rgba(")+5,c=a.indexOf(")"),
c=a.substring(b,c).split(","),a=parseInt(c[0]).toString(16),b=parseInt(c[1]).toString(16),c=parseInt(c[2]).toString(16);return"#"+a+b+c},getOpacityRGBA:function(a){if(0==a.indexOf("#"))return 1;var b=a.indexOf("rgba(")+5,c=a.indexOf(")");return a.substring(b,c).split(",")[3]},getLocalGridSource:function(a){a=new $.jqx.dataAdapter({datatype:"local",localdata:a},{async:!1});a.dataBind();return a},projections:{google:"EPSG:900913",wgs84:"EPSG:4326"},googleAutoComplete:function(){$("#autoComplete").attr("placeholder",
strings.QuickJump.placeholder);(function(a){function b(d,g){if("keydown"==d)var h=g,g=function(b){var d=0<$(".pac-item-selected").length;13==b.which&&!d&&(d=$.Event("keydown",{keyCode:40,which:40}),h.apply(a,[d]));h.apply(a,[b])};e.apply(a,[d,g])}var e=a.addEventListener?a.addEventListener:a.attachEvent;a.addEventListener=b;a.attachEvent=b})(document.getElementById("autoComplete"));var a=new google.maps.LatLngBounds(new google.maps.LatLng(-33.8902,151.1759),new google.maps.LatLng(-33.8474,151.2631)),
b=document.getElementById("autoComplete");autocomplete=new google.maps.places.SearchBox(b,{bounds:a,types:["(regions)","address"]});google.maps.event.addListener(autocomplete,"places_changed",function(){var a=autocomplete.getPlaces()[0];console.log("types: ");console.log(a.types);var b=a.types[0],e=digimap.getZoom();switch(b){case "country":e=6;break;case "administrative_area_level_1":e=8;break;case "administrative_area_level_2":e=10;break;case "administrative_area_level_3":e=12;break;case "administrative_area_level_4":e=
14;break;case "administrative_area_level_5":e=16;break;case "street_address":e=17;break;case "route":case "intersection":e=17;break;case "locality":e=14}a.geometry?(a=a.geometry.location,a=new OpenLayers.LonLat(a.lng(),a.lat()),b={lon:a.lon,lat:a.lat},a.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),digimap.setCenter(a),mygis.Map.markSelectionPoint(b,!0),digimap.zoomTo(e)):feedbackLayer.removeAllFeatures()})},nudgeMap:function(){var a=digimap.getCenter();
digimap.panTo(new OpenLayers.LonLat(a.lon+1.0E-10,a.lat))},testReverseGeo:function(a,b){var c=new google.maps.Map(document.getElementById("dummyGoogle"),{mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(34,23),zoom:15}),c=new google.maps.places.PlacesService(c),d={location:new google.maps.LatLng(b,a),bounds:new google.maps.LatLngBounds(google.maps.LatLng(-89.999999,-179.999999),google.maps.LatLng(89.999999,179.999999)),types:["country"]};c.search(d,function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&
alert(a[0].name)})},datetime_input_field:function(a){try{$("#"+a.id.replace("second_row_","cal_button_")).show(),but_idname=a.id.replace("second_row_","cal_button_"),$("#"+a.id+">.cal_button").id=but_idname,mygis.Utilities.button_set(document.getElementById(but_idname)),$("#"+a.id+" > .dbFieldGetList").hide(),0==!$("#datetime").length&&($("#datetime").jqxCalendar({width:380,height:274}),""==a.getElementsByClassName("dbFieldValue")[0].value&&(new_date=$("#datetime").jqxCalendar("getDate"),str_new_date=
new_date.getDate().toString()+"/"+(new_date.getMonth()+1).toString()+"/"+new_date.getFullYear().toString(),a.getElementsByClassName("dbFieldValue")[0].value=str_new_date,a.getElementsByClassName("dbFieldValue")[0].onchange())),$("#datetime").hide(),$("#datetime").bind("cellSelected",function(a){if(window.current_row[0]!=""){a=a.args.date;window.current_row[1]=a.getDate().toString()+"/"+(a.getMonth()+1).toString()+"/"+a.getFullYear().toString();$(".jqxdatetime").hide();if(window.current_row[0]!=""){if(window.current_row[1]==
""){a=$("#datetime").jqxCalendar("getDate");window.current_row[1]=a.getDate().toString()+"/"+(a.getMonth()+1).toString()+"/"+a.getFullYear().toString()}window.current_row[0].getElementsByClassName("dbFieldValue")[0].value=window.current_row[1];window.current_row[0].getElementsByClassName("dbFieldValue")[0].onchange();window.current_row=["",""]}}})}catch(b){console.log("calendar error :"+b)}},rm_datetime_input_field:function(a){try{$("#"+a.id+" > .cal_button").hide(),$("#"+a.id+" > .dbFieldGetList").show()}catch(b){}try{if("number"===
typeof a){elements=document.getElementsByClassName("criteriaSecondRow");for(a=0;a<elements.length;a++)$("#"+document.getElementById(elements.id.replace("second_row_","cal_button_"))).hide()}else document.getElementById(a.id.replace("second_row_","cal_button_")).style.display="none"}catch(c){console.log("error at calendar remove: "+c)}},button_set:function(a){cal_idname=a.id.replace("cal_button_","datetime_");a.onclick=function(){try{"none"==$("#datetime")[0].style.display?($("#datetime").show(),window.current_row[0]=
document.getElementById(a.id.replace("cal_button_","second_row_"))):($(".jqxdatetime").hide(),""!=window.current_row[0]&&(""==window.current_row[1]&&(new_date=$("#datetime").jqxCalendar("getDate"),window.current_row[1]=new_date.getDate().toString()+"/"+(new_date.getMonth()+1).toString()+"/"+new_date.getFullYear().toString()),window.current_row[0].getElementsByClassName("dbFieldValue")[0].value=window.current_row[1],window.current_row[0].getElementsByClassName("dbFieldValue")[0].onchange(),window.current_row=
["",""]))}catch(b){}}}};mygis.User={Hooks:{initialLoad:function(){},beforeProfileUpdate:function(){},afterProfileUpdate:function(){},getProfilePageData:function(){return null},updateProfileURL:config.mgreq+"?qtype=updateUserProfile",getAppUsersURL:config.mgreq+"?qtype=GetAppUserList&qContents=",getUserGridColumnSource:function(a){return{datatype:"json",datafields:[{name:"userID"},{name:"username"},{name:"firstName"},{name:"lastName"},{name:"email"},{name:"isSelected",type:"boolean"}],id:"adminUserList",url:a}},getUserGridColumns:function(){return[{text:"",
datafield:"isSelected",width:20,columntype:"checkbox"},{text:strings.UserManager.col_userLastname,datafield:"lastName",editable:!1},{text:strings.UserManager.col_userFirstname,datafield:"firstName",editable:!1},{text:strings.UserManager.col_userName,datafield:"username",editable:!1},{text:strings.UserManager.col_userEmail,datafield:"email",editable:!1},{text:strings.UserManager.col_userID,datafield:"userID",editable:!1}]},loadUserLayerRights:function(){var a=config.mgreq+"?qtype=getUserLayerRights",
b={layers:[]};$.each(layerSource.records,function(a,d){b.layers.push(d.layerID)});$.ajax({type:"POST",data:JSON.stringify(b),url:a,success:function(a){a=eval(a);internalMemory.layerRights={};$.each(a,function(a,b){var c={objectID:b.objectID,hasUpdate:b.hasUpdate,hasDelete:b.hasDelete,isOwner:b.isOwner};internalMemory.layerRights[b.layerID]||(internalMemory.layerRights[b.layerID]=[]);internalMemory.layerRights[b.layerID].push(c)})}})},AdminTabActions:function(){},UserManager:{afterSingleCheckClicked:function(){},
afterUserSelected:function(){},afterUserUnselected:function(){},beforeUserDelete:function(){return!0},afterUserDelete:function(){},getUserDeleteURL:function(){return config.mgreq+"?qtype=deleteUsers"}}},ProfileInfo:{getProfileDetails:function(){var a=config.mgreq+"?qtype=GetCurrentUserDetails";mygis.Utilities.blockUI();$.ajax({type:"GET",url:a,success:function(a){mygis.Utilities.unblockUI();try{var c=eval(a);mygis.User.ProfileInfo.buildCategories(c)}catch(d){displayError("There was an error in the request."),
console.log(d.message)}}})},categorizeProperties:function(a){var b={};$.each(a,function(a,d){b[d.PropertyCategory]||(b[d.PropertyCategory]=[]);b[d.PropertyCategory].push(d)});return b},updateProfile:function(){mygis.User.Hooks.beforeProfileUpdate();var a=mygis.User.Hooks.getProfilePageData();mygis.Utilities.blockUI();$.ajax({type:"POST",data:{qContents:JSON.stringify(a)},url:mygis.User.Hooks.updateProfileURL,success:function(a){mygis.Utilities.unblockUI();a=eval(a);"success"==a.iotype?displaySuccess(strings.UserProfile.updateSuccess):
displayError(a.iomsg);mygis.User.Hooks.afterProfileUpdate()}})},buildCategories:function(a){var a=mygis.User.ProfileInfo.categorizeProperties(a),b=$("<div />");b.attr("id","profileInfoForm");var c=0,d=!0;$.each(a,function(a,f){if("Hidden"!=a){var g=$("<div class='sectionHeader' />"),h=$(mygis.Utilities.format("<a href='#' onclick='router(\"accountInfo_Config_Tab\",{0});' />",c));h.append(a);g.append(h);var k=$("<div class='sectionContent' />"),h=$("<div class='sectionButtons' />");k.append(h);d&&
(d=!1,k.css("display","block"));$.each(f,function(a,b){k.append(mygis.User.ProfileInfo.buildProfileEntry(b.DataType,b.PropertyName,b.PropertyValue,b.PropertyValue))});b.append(g);b.append(k);c+=1}});$("#up_AccountTab_Info").empty();$("#up_AccountTab_Info").append(b);mygis.User.UI.setTabs(b.find(".sectionHeader").clone());router("amenu_Apps_Config_Tab",0)},buildProfileEntry:function(a,b,c,d){a=null;try{var a=$("<div class='editAppRow' />"),e=$("<span class='editAppLabel' />"),f=$("<input class='editAppInput "+
b.replace(" ","_")+"' type='text' />");e.append(b);f.val(d);a.append(e);a.append(f)}catch(g){a=null}return a},switchToTab:function(a){for(var a=a.item,b=$("#up_contentLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#profileInfoForm").find(".sectionContent");for(c=0;c<b.length;c++)if(c!=a)$(b[c]).hide();else{$(b[c]).show();var d=$(b[c]).find(".sectionButtons");$("#up_contentSpecificToolbar").empty();$("#up_contentSpecificToolbar").append(d.clone())}},
decodeDNNDataType:function(a){var b="";switch(a){case 349:b="Text";break;case 352:b="Timezone";break;case 353:b="Locale";break;case 355:b="Rich Text";break;case 356:b="Country";break;case 357:b="Region";break;case 358:b="List";break;case 361:b="Image";break;case 1414:b="TimeZoneInfo";break;default:b="Unknown datatype: "+a}return b}},UI:{switchToApp:function(){$("#page_administration").hide();$("#page_userProfile").hide();$("#page_effect").show();$(window).resize()},resetTabs:function(){$("#up_contentLinkTabsRound").empty();
$("#up_contentLinkTabs").css("display","none");$("#up_contentSpecificToolbar").empty()},setTabs:function(a){mygis.User.UI.resetTabs();$("#up_contentLinkTabsRound").append(a);$("#up_contentLinkTabs").css("display","table-row")},loadUserPage:function(){0==$("#page_userProfile").children().length?(mygis.Utilities.blockUI(),loadFragment("page_userProfile",mygis.User.UI.initialize)):mygis.User.UI.initialize()},initialize:function(){mygis.Utilities.unblockUI();internalConfig.isUserPageLoaded=!0;$("#up_menuTabs").jqxMenu({width:"635",
height:"30",mode:"horizontal",showTopLevelArrows:!0,theme:"classic"});$("#up_menuTabs").bind("itemclick",function(a){MakeTimeout(mygis.User.UI.menuClick,a,800,this)});mygis.User.UI.switchToUserPage();mygis.User.UI.menuClick(null,"up_menuAccount_Info");router("accountInfo_Config_Tab",0)},switchToUserPage:function(){internalConfig.isUserPageLoaded?($("#page_effect").hide(),$("#page_administration").hide(),$("#page_userProfile").show()):mygis.User.UI.loadUserPage()},menuClick:function(a,b){var c=(b?
document.getElementById(b):a.args).id,d=-1;b&&(a=$("#up_menuTabs"));if(c){var e=c.split("_"),d=e.length-1;1<d&&(b?e=$(a).find(mygis.Utilities.format("#{0}_{1}",e[0],e[1])):(a.currentTarget=this,e=$(a.currentTarget).find(mygis.Utilities.format("#{0}_{1}",e[0],e[1]))),e.find("a").html())}if(1<d)switch(c.split("_"),mygis.User.UI.resetTabs(),c){case "up_menuAccount_Info":mygis.User.UI.activateTab("up_AccountTab_Info"),mygis.User.UI.createGenericActions(c),$("up_contentActionsTitle").attr("class",""),
mygis.User.ProfileInfo.getProfileDetails()}},activateTab:function(a){var b=$("#up_contentTabs").find(".contentTab");$.each(b,function(b,d){$(d).attr("id")==a?$(d).attr("class","contentTab active"):$(d).attr("class","contentTab")})},btnGenerator:function(a,b,c,d,e){var f=$("<a />");f.attr("href","#");f.attr("id",a);f.attr("title",c);e?f.attr("class","adminGenericAction disabled"):f.attr("class","adminGenericAction");d&&f.attr("onclick",d);a=$("<span />");a.attr("class",mygis.Utilities.format("adminActionImg {0}",
b));f.append(a);f.append(c);return f},createGenericActions:function(a){var b=0,c=[],d=[],e=[],f=[],g=[],h=$("<div />");switch(a){case "up_menuAccount_Info":b=2,c=[mygis.Utilities.format("{0}_{1}",a,"save"),mygis.Utilities.format("{0}_{1}",a,"cancel")],d=[strings.AppManager.upmenu_ProfileInfo_Save,strings.AppManager.upmenu_ProfileInfo_Cancel],e=["imgSave","imgCancel"],f=[mygis.Utilities.format("router('{0}','{1}');return false;",a,"save"),mygis.Utilities.format("router('{0}','{1}');return false;",
a,"cancel")],g=[!1]}for(a=0;a<b;a++)h.append(mygis.User.UI.btnGenerator(c[a],e[a],d[a],f[a],g[a]));0<b&&$("#up_contentToolbar").html(h.html())}}};mygis.Admin={AppManager:{updateConfig:{appID:-1,maps:[],urls:[],styles:[],logo:{changed:!1,newValue:null,oldValue:null},logo1:{changed:!1,newValue:null,oldValue:null},logo2:{changed:!1,newValue:null,oldValue:null},appName:{changed:!1,newValue:null,oldValue:null},appAlias:{changed:!1,newValue:null,oldValue:null},appText:{changed:!1,newValue:null,oldValue:null}},Apps:{showAddNewApp:function(){var a=mygis.Admin.UI.dialogConfig;a.checkfn=mygis.Admin.AppManager.Apps.addNewAppCheck;a.callbackfn=mygis.Admin.AppManager.Apps.createNewApp;
a.objectCount=1;a.windowTitle="#addAppNamePop";$(a.windowTitle).dialog({autoOpen:!0,modal:!0,resizable:!1,width:480,height:130,title:strings.AppManager.addApp_WindowTitle,closeOnEscape:!1});$("#ui-dialog-title-addAppNamePop").parent().css({background:"url('"+config.folderPath+"Images/Administration/menu/icon-16-component.png') #F6A828 no-repeat 12px 8px","background-size":"auto 18px"})},addNewAppCheck:function(){var a=!1,b=$("#addAppNameInp").val();if(b){for(var c="`~!@#$%^&*-+=[]{}\\|:;\"'<>,./?".split(""),
d=!1,e=0;e<c.length;e++)-1<b.indexOf(c[e])&&(d=!0);d?alert(strings.AppManager.addApp_err_InvalidName):(mygis.Admin.UI.dialogConfig.object=b,a=!0)}else alert(strings.AppManager.addApp_err_NotFilled);return a},createNewApp:function(a){if("ok"==a){mygis.Admin.AppManager.resetConfigObject();a=mygis.Admin.AppManager.updateConfig;a.appName.changed=!0;a.appName.newValue=this;var a=JSON.stringify(a),b=config.mgreq+"?qtype=CreateNewApp&qContents="+a,c={};c.qContents=a;mygis.Utilities.blockUI();$.ajax({type:"POST",
data:c,url:b,success:function(a){try{var b=eval(a);"success"==b.iotype?(mygis.Admin.AppManager.Apps.refreshAppGrid(),displaySuccess(strings.AppManager.addApp_msg_Success)):displayError(b.iomsg)}catch(c){console.log(c.message)}mygis.Utilities.unblockUI()}})}},appClicked:function(a){var b=$("#myAppGrid");b.jqxGrid("clearselection");b.jqxGrid("selectrow",a);mygis.Admin.UI.menuClick(null,"amenu_Apps_Config")},singleCheckClicked:function(a){var b=$("#myAppGrid");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):
b.jqxGrid("unselectrow",a.args.rowindex)},allCheckClicked:function(a){var b=$("#myAppGrid"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].appSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].appSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},appSelected:function(){var a=$("#myAppGrid"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("amenu_Apps_Manager_edit").ex_AddClassName("disabled"),
document.getElementById("amenu_Apps_Manager_style").ex_AddClassName("disabled"),document.getElementById("amenu_Apps_Manager_delete").ex_RemoveClassName("disabled")):(document.getElementById("amenu_Apps_Manager_edit").ex_RemoveClassName("disabled"),document.getElementById("amenu_Apps_Manager_style").ex_RemoveClassName("disabled"),document.getElementById("amenu_Apps_Manager_delete").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllApps").checked=
!0:document.getElementById("adminSelectAllApps").checked=!1},appUnselected:function(){var a=$("#myAppGrid"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("amenu_Apps_Manager_edit").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Manager_edit").ex_AddClassName("disabled"),document.getElementById("amenu_Apps_Manager_style").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Manager_style").ex_AddClassName("disabled"),document.getElementById("amenu_Apps_Manager_delete").ex_RemoveClassName("disabled")):
(1==b.length?(document.getElementById("amenu_Apps_Manager_edit").ex_RemoveClassName("disabled"),document.getElementById("amenu_Apps_Manager_style").ex_RemoveClassName("disabled")):(document.getElementById("amenu_Apps_Manager_edit").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Manager_edit").ex_AddClassName("disabled"),document.getElementById("amenu_Apps_Manager_style").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Manager_style").ex_AddClassName("disabled")),
document.getElementById("amenu_Apps_Manager_delete").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Manager_delete").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllApps").checked=!0:document.getElementById("adminSelectAllApps").checked=!1},createAppGrid:function(){mygis.Utilities.blockUI();var a=$("#myAppGrid"),b=function(a,b,c){var d,k=this.owner.getrowdata(a).appID;d="router('mm_imgclick',this);";switch(b){case "appSelected":d=
'router("adminAppClick",this);';var b=mygis.Utilities.format("row_{0}",a),a=-1<this.owner.getselectedrowindexes().indexOf(a)?' checked="checked"':"",l=strings.AppManager.grid_selectBox;d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 30px;'><input class='{1}' type='checkbox' title='{3}' onclick='{0}'{2}/></div>",d,b,a,l);break;case "hasLogo1":d=c?mygis.Utilities.format('<div class="imageVerticalContainer"><img onclick="{0}" src="{1}GetImage.ashx?qType=GetAppLogo1&qContents={2}&qSize=112" /></div>',
d,config.folderPath,k):"<span style='margin:9px 4px; float: left;'></span>";break;case "hasLogo2":d=c?mygis.Utilities.format('<div class="imageVerticalContainer"><img onclick="{0}" src="{1}GetImage.ashx?qType=GetAppLogo2&qContents={2}&qSize=112" /></div>',d,config.folderPath,k):"<span style='margin:9px 4px; float: left;'></span>";break;case "appURLS":d=""!=c?c.split(","):[];d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 120px;'><span >{0}</span></div>",d.length);break;
case "appMAPS":d=""!=c?c.split(","):[];l="";$.each(d,function(a,b){var c=b.split("$")[0];0<a&&(l+=",");l+=c});d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 120px;'><span title='{1}'>{0}</span></div>",d.length,l);break;case "appName":d=mygis.Utilities.format('router("appNameClick",{0});',a);d=mygis.Utilities.format("<div class='imageVerticalContainer'><a href='#' onclick='{1}'>{0}</a></div>",c,d);break;case "appOwner":d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 100px;'><span >{0}</span></div>",
c);break;case "appPrefix":d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 100px;'><span >{0}</span></div>",c);break;default:d=mygis.Utilities.format("<div class='imageVerticalContainer'><span >{0}</span></div>",c)}return d},c=function(a){switch(a){case strings.AppManager.grid_AppOwner:case strings.AppManager.grid_AppPrefix:case strings.AppManager.grid_AppWelcome:case strings.AppManager.grid_AppURLS:case strings.AppManager.grid_AppMAPS:a=mygis.Utilities.format("<a href='#' style='text-align: center;'>{0}</a>",
a);break;default:a=$("#myAppGrid"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?' checked="checked"':"",a=mygis.Utilities.format("<div style='text-align: center; margin-top: 5px;position: absolute;left: 9px;z-index: 1;'><input id='adminSelectAllApps' type='checkbox' onclick='{0}'{1}/></div>",'router("adminAllClick",this);',a)}return a},d=mygis.Admin.AppManager.Apps.createAppGridSource();a.jqxGrid({source:d,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,
columns:[{text:"",datafield:"appSelected",width:30,renderer:c,columntype:"checkbox"},{text:strings.AppManager.grid_AppName,datafield:"appName",width:150,cellsrenderer:b,editable:!1},{text:strings.AppManager.grid_AppOwner,datafield:"appOwner",width:100,cellsrenderer:b,renderer:c,editable:!1},{text:strings.AppManager.grid_AppPrefix,datafield:"appPrefix",width:100,cellsrenderer:b,renderer:c,editable:!1},{text:strings.AppManager.grid_AppWelcome,datafield:"appWelcomeText",cellsrenderer:b,renderer:c,editable:!1},
{text:strings.AppManager.grid_AppURLS,datafield:"appURLS",width:120,cellsrenderer:b,renderer:c},{text:strings.AppManager.grid_AppMAPS,datafield:"appMAPS",width:120,cellsrenderer:b,renderer:c}],enableanimations:!1,showheader:!0,columnsmenu:!0,editable:!0,selectionmode:"none"});a.bind("rowselect",mygis.Admin.AppManager.Apps.appSelected);a.bind("rowunselect",mygis.Admin.AppManager.Apps.appUnselected);a.bind("cellendedit",mygis.Admin.AppManager.Apps.singleCheckClicked);mygis.Utilities.unblockUI()},createAppGridSource:function(){return new $.jqx.dataAdapter({datatype:"json",
datafields:[{name:"appSelected",type:"boolean"},{name:"appID"},{name:"appOwner"},{name:"appName"},{name:"appPrefix"},{name:"appWelcomeText"},{name:"appURLS"},{name:"appMAPS"},{name:"hasLogo1",type:"boolean"},{name:"hasLogo2",type:"boolean"}],id:"myapps",url:config.mgreq+"?qtype=GetMyApps"},{async:!1})},refreshAppGrid:function(){$("#myAppGrid").jqxGrid("updatebounddata")},inputChanged:function(a){var a=a.currentTarget,b=mygis.Admin.AppManager.updateConfig,c;switch(a.id){case "editAppName":c=b.appName;
break;case "editAppAlias":c=b.appAlias;break;case "editAppWelcomeText":c=b.appText}c.changed=!0;c.newValue=a.value;mygis.Admin.AppManager.notifyUnsaved()},inputStore:function(a){var a=a.currentTarget,b=mygis.Admin.AppManager.updateConfig,c;switch(a.id){case "editAppName":c=b.appName;break;case "editAppAlias":c=b.appAlias;break;case "editAppWelcomeText":c=b.appText}c.changed||(c.oldValue=a.value)}},Maps:{mapCheckClicked:function(a){var b=$("#adminMapList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):
b.jqxGrid("unselectrow",a.args.rowindex)},mapAllCheck:function(a){var b=$("#adminMapList"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].mapSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].mapSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},mapSelected:function(){var a=$("#adminMapList"),b=a.jqxGrid("getselectedrowindexes");if(1<b.length){for(var c=1;3>c;c++){var d=$("#contentSpecificToolbar .sectionButtons a")[c];
d.ex_HasClassName("disabled")||d.ex_AddClassName("disabled")}for(c=3;5>c;c++)d=$("#contentSpecificToolbar .sectionButtons a")[c],d.ex_HasClassName("disabled")&&d.ex_RemoveClassName("disabled")}else if(1==b.length)for(c=1;5>c;c++)d=$("#contentSpecificToolbar .sectionButtons a")[c],d.ex_HasClassName("disabled")&&d.ex_RemoveClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllMaps").checked=!0:document.getElementById("adminSelectAllMaps").checked=
!1},mapUnselected:function(){var a=$("#adminMapList"),b=a.jqxGrid("getselectedrowindexes");if(1<b.length){for(var c=1;3>c;c++){var d=$("#contentSpecificToolbar .sectionButtons a")[c];d.ex_HasClassName("disabled")||d.ex_AddClassName("disabled")}for(c=3;5>c;c++)d=$("#contentSpecificToolbar .sectionButtons a")[c],d.ex_HasClassName("disabled")&&d.ex_RemoveClassName("disabled")}else if(1==b.length)for(c=1;5>c;c++)d=$("#contentSpecificToolbar .sectionButtons a")[c],d.ex_HasClassName("disabled")&&d.ex_RemoveClassName("disabled");
else for(c=1;5>c;c++)d=$("#contentSpecificToolbar .sectionButtons a")[c],d.ex_HasClassName("disabled")||d.ex_AddClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllMaps").checked=!0:document.getElementById("adminSelectAllMaps").checked=!1},mapResetSelection:function(){$("#adminMapList").jqxGrid("clearselection");mygis.Admin.AppManager.Maps.mapSelected()},createAppMapGrid:function(a){mygis.Utilities.blockUI();var a=mygis.Admin.AppManager.Maps.createAppMapGridSource(a),
b=$("#adminMapList"),c=function(){var a=$("#adminMapList"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?' checked="checked"':"";return retobject=mygis.Utilities.format("<div style='{2}'><input id='adminSelectAllMaps' type='checkbox' onclick='{0}'{1}/></div>",'router("adminMapAllClick",this);',a,"text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;")},d=function(a,b,c){switch(b){case "mapSelected":c=mygis.Utilities.format("row_{0}",a);a=-1<
this.owner.getselectedrowindexes().indexOf(a)?' checked="checked"':"";a=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 30px;'><input class='{1}' type='checkbox' title='{3}' onclick='{0}'{2}/></div>",'router("adminMapClick",this);',c,a,strings.AppManager.grid_selectBox);break;case "mapName":a=this.owner.getrowdata(a).mapDescription;a=mygis.Utilities.format("<div class='imageVerticalContainer'><a href='#' title='{1}'>{0}</a></div>",c,a);break;case "defaultLoad":a=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 80px;line-height:25px;'><div class='btnStarCheck{0}'></div></div>",
c?" checked":"");break;default:a=mygis.Utilities.format("<div class='imageVerticalContainer'><span >{0}</span></div>",c)}return a};b.bind("bindingcomplete",function(){mygis.Admin.AppManager.setConfigMaps($("#adminMapList").jqxGrid("source").records);setTimeout(function(){$("#adminMapList").find("a[title]").qtip()},1E3)});0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"mapSelected",width:45,columntype:"checkbox",
renderer:c},{text:strings.MapControl.col_mapName,datafield:"mapName",width:200,cellsrenderer:d,editable:!1},{text:strings.MapControl.col_mapLCount,datafield:"mapLayerCount",editable:!1,cellsrenderer:d,width:80},{text:strings.MapControl.col_mapDefault,datafield:"defaultLoad",editable:!1,cellsrenderer:d,width:80},{text:strings.MapControl.col_mapCreate,datafield:"mapCreateDate",editable:!1},{text:strings.MapControl.col_mapUpdate,datafield:"mapUpdateDate",editable:!1},{text:strings.MapControl.col_mapDeveloped,
datafield:"mapDevelopedBy",editable:!1},{text:strings.MapControl.col_mapOwner,datafield:"mapOwner",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"mapSelected",width:45,columntype:"checkbox",renderer:c},{text:strings.MapControl.col_mapName,datafield:"mapName",width:200,cellsrenderer:d,editable:!1},{text:strings.MapControl.col_mapLCount,
datafield:"mapLayerCount",editable:!1,cellsrenderer:d,width:80},{text:strings.MapControl.col_mapDefault,datafield:"defaultLoad",editable:!1,cellsrenderer:d,width:80},{text:strings.MapControl.col_mapCreate,datafield:"mapCreateDate",editable:!1},{text:strings.MapControl.col_mapUpdate,datafield:"mapUpdateDate",editable:!1},{text:strings.MapControl.col_mapDeveloped,datafield:"mapDevelopedBy",editable:!1},{text:strings.MapControl.col_mapOwner,datafield:"mapOwner",editable:!1}],enableanimations:!1,showheader:!0,
columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.AppManager.Maps.mapSelected);b.bind("rowunselect",mygis.Admin.AppManager.Maps.mapUnselected);b.bind("cellendedit",mygis.Admin.AppManager.Maps.mapCheckClicked);mygis.Utilities.unblockUI()},createAppMapGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"mapSelected",type:"boolean"},{name:"mapName"},{name:"mapDescription"},{name:"mapLayerCount"},{name:"id"},{name:"defaultLoad",type:"boolean"},
{name:"maxExtent"},{name:"appName"},{name:"mapCenter"},{name:"mapZoom"},{name:"mapCreateDate"},{name:"mapUpdateDate"},{name:"mapDevelopedBy"},{name:"mapOwner"}],id:"adminMapList",url:config.mgreq+"?qtype=GetAppMaps&qContents="+a},{async:!1})},addAppMap:function(){var a=mygis.Admin.UI.dialogConfig;a.checkfn=mygis.Admin.AppManager.Maps.addAppMapCheck;a.callbackfn=mygis.Admin.AppManager.Maps.addAppMapResult;a.objectCount=1;a.windowTitle="#mapManager";for(var a=$("#adminMapList").jqxGrid("source").records,
b="",c=0;c<a.length;c++)0<c&&(b+="%23"),b+=a[c].id;showMapManager(b)},addAppMapCheck:function(){var a=!1,b=$("#mapManagerList"),c=mygis.Admin.UI.dialogConfig,d=b.jqxGrid("getselectedrowindexes"),e=c.objectCount;if(d.length<e&&-1<e)alert(mygis.Utilities.format(strings.MapManager.err_notEnoughSelected,e));else{a=[];for(e=0;e<d.length;e++)a.push(b.jqxGrid("getrowdata",d[e]));c.object=a;a=!0}return a},addAppMapResult:function(a){if("ok"==a){for(var a=[],b=$("#adminMapList").jqxGrid("source").records,
c=mygis.Admin.AppManager.updateConfig,b=b[0]?b[0].appName:"",d=0;d<this.length;d++){a.push(this[d].id);var e=this[d],e={mapSelected:!1,mapName:e.mapName,mapDescription:e.mapDescription,mapLayerCount:e.mapLayerCount,id:e.id,defaultLoad:!1,maxExtent:e.maxExtent,appName:b,mapCenter:e.mapCenter,mapZoom:e.mapZoom,mapCreateDate:e.mapCreateDate,mapUpdateDate:e.mapUpdateDate,mapDevelopedBy:e.mapDevelopedBy,mapOwner:e.mapOwner};$("#adminMapList").jqxGrid("addrow",null,e);e={changed:!0,oldValue:null,newValue:JSON.stringify(e)};
c.maps.push(e)}mygis.Admin.AppManager.notifyUnsaved();$("#adminMapList").jqxGrid("refreshdata")}},mapMakeDefault:function(){for(var a=$("#adminMapList"),b=a.jqxGrid("getselectedrowindexes")[0],c=a.jqxGrid("source").records,d=!1,e=mygis.Admin.AppManager.updateConfig,f,g=0;g<c.length;g++)c[g].defaultLoad&&g!=b?(c[g].defaultLoad=!1,d=!0,f=g):g==b&&(d=c[g].defaultLoad=!0);d&&(a.jqxGrid("refreshdata"),mygis.Admin.AppManager.setConfigMaps(c),f&&(e.maps[f].changed=!0),e.maps[b].changed=!0,mygis.Admin.AppManager.notifyUnsaved());
mygis.Admin.AppManager.Maps.mapResetSelection()},mapUnpublish:function(){var a=$("#adminMapList"),b=a.jqxGrid("getselectedrowindexes"),c=a.jqxGrid("source").records,d=mygis.Admin.AppManager.updateConfig;if(0<b.length){for(var e=0;e<b.length;e++)a.jqxGrid("deleterow",b[e]);a.jqxGrid("refreshdata");mygis.Admin.AppManager.setConfigMaps(c);for(e=0;e<d.maps.length;e++)d.maps[e].changed=!0;mygis.Admin.AppManager.notifyUnsaved()}mygis.Admin.AppManager.Maps.mapResetSelection()},mapDelete:function(){displayNotify(msg_errFeatureNotImplemented)}},
URLs:{showAddAlias:function(){var a=mygis.Admin.UI.dialogConfig;a.callbackfn=mygis.Admin.AppManager.URLs.addAliasResult;a.objectCount=1;a.windowTitle="#addAppAliasPop";a.checkfn=mygis.Admin.AppManager.URLs.checkAliasValidity;$("#addAppAliasPop").dialog({autoOpen:!0,modal:!0,resizable:!1,width:480,height:200,title:strings.AppManager.addAlias_WindowTitle,closeOnEscape:!1});$("#ui-dialog-title-addAppAliasPop").parent().css({background:"url('"+config.folderPath+"Images/Administration/url_add.png') #F6A828 no-repeat 12px 8px",
"background-size":"auto 18px"})},addAliasResult:function(a){var b=this.toString();!a||"ok"!=a?a&&displayError(a):mygis.Admin.AppManager.URLs.addAppAlias(b)},checkAliasValidity:function(){var a=mygis.Admin.UI.dialogConfig,b=$("#chooseHost").val(),b=b.toLowerCase(),c=$("#chooseProtocol").val(),d=$("#choosePort").val();$("#addAppAlias_err_WrongHostname").css("visibility","hidden");!b.match(/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/gi)||!mygis.Admin.AppManager.URLs.checkPortValidity()?
($("#addAppAlias_err_WrongHostname").html(strings.AppManager.addAlias_err_InvalidUrl),$("#addAppAlias_err_WrongHostname").css("visibility","visible")):(mygis.Utilities.blockUI(),b=config.mgreq+"?qtype=CheckAlias&qContents="+mygis.Utilities.format("{0}://{1}:{2}/",c,b,d),$.ajax({type:"GET",url:b,async:!1,success:function(b){mygis.Utilities.unblockUI();try{var c=eval(b);if("success"==c.iotype){var d=$("#chooseProtocol").val(),h=$("#choosePort").val(),k=$("#chooseHost").val().toLowerCase();a.object=
mygis.Utilities.format("{0}://{1}:{2}/",d,k,h);console.log("Success!")}else console.log(c.iomsg),$("#addAppAlias_err_WrongHostname").html(strings.AppManager.addAlias_err_PlatformRejected),$("#addAppAlias_err_WrongHostname").css("visibility","visible")}catch(l){console.log(l.message)}}}));return null!=a.object},checkPortValidity:function(){var a=!1,b=$("#choosePort").val();"0"!=b&&(b.match(/^(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{1,3}|[0-9])$/gi)&&(a=!0),
a?$("#addAppAlias_err_WrongPort").css("visibility","hidden"):($("#addAppAlias_err_WrongPort").html(strings.AppManager.addAlias_err_PortNumber),$("#addAppAlias_err_WrongPort").css("visibility","visible")));return a},addAppAlias:function(a){var a=mygis.Utilities.format("{0}#{1}",mygis.Admin.AppManager.updateConfig.appID,a),b={};b.qContents=a;$.ajax({type:"POST",data:b,url:config.mgreq+"?qtype=AddAppAlias",success:function(a){try{var b=eval(a);"success"==b.iotype?(displaySuccess(strings.AppManager.addAlias_operationSuccess),
$("#adminURLList").jqxGrid("updatebounddata")):displayError(b.iomsg)}catch(e){console.log(e.message)}}})},urlDelete:function(){var a=$("#adminURLList"),b=a.jqxGrid("getselectedrowindexes"),a=a.jqxGrid("source").records.length;b.length==a||1==a?displayError(strings.AppManager.deleteAlias_err_NotAll):(b=mygis.Utilities.format(strings.AppManager.deleteAlias_err_YouSure,b.length),showConfirmationDialog(b,function(){for(var a=$("#adminURLList"),b=a.jqxGrid("getselectedrowindexes"),e=[],f=0;f<b.length;f++)e.push(a.jqxGrid("getrowdata",
b[f]).appURL);a=config.mgreq+"?qtype=RemoveAppAlias";b={};b.qContents=e.join("#");mygis.Utilities.blockUI();$.ajax({type:"POST",data:b,url:a,success:function(a){mygis.Utilities.unblockUI();try{var b=eval(a);"success"==b.iotype?(displaySuccess(strings.AppManager.urls_updated),$("#adminURLList").jqxGrid("updatebounddata")):displayError(b.iomsg)}catch(c){console.log(c.message)}}})}))},urlCheckClicked:function(a){var b=$("#adminURLList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",
a.args.rowindex)},urlAllCheck:function(a){var b=$("#adminURLList"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].urlSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].urlSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},urlSelected:function(){var a=$("#adminURLList"),b=a.jqxGrid("getselectedrowindexes");$("#contentSpecificToolbar .sectionButtons a")[1].ex_RemoveClassName("disabled");
b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllUrls").checked=!0:document.getElementById("adminSelectAllUrls").checked=!1},urlUnselected:function(){var a=$("#adminURLList"),b=a.jqxGrid("getselectedrowindexes");0<b.length?$("#contentSpecificToolbar .sectionButtons a")[1].ex_RemoveClassName("disabled"):$("#contentSpecificToolbar .sectionButtons a")[1].ex_HasClassName("disabled")||$("#contentSpecificToolbar .sectionButtons a")[1].ex_AddClassName("disabled");b.length==
a.jqxGrid("source").records.length?document.getElementById("adminSelectAllUrls").checked=!0:document.getElementById("adminSelectAllUrls").checked=!1},createAppURLGrid:function(a){mygis.Utilities.blockUI();var a=mygis.Admin.AppManager.URLs.createAppURLGridSource(a),b=$("#adminURLList"),c=function(a){switch(a){case strings.AppManager.urlgrid_URL:a=mygis.Utilities.format("<a href='#' style='text-align: center;'>{0}</a>",a);break;default:a=$("#adminURLList"),a=a.jqxGrid("getselectedrowindexes").length==
a.jqxGrid("source").records.length?' checked="checked"':"",a=mygis.Utilities.format("<div style='{2}'><input id='adminSelectAllUrls' type='checkbox' onclick='{0}'{1}/></div>",'router("adminURlAllClick",this);',a,"text-align: center; margin-top: 5px;position: absolute;left: 9px;z-index: 1;")}return a};b.bind("bindingcomplete",function(){mygis.Admin.AppManager.setConfigUrls($("#adminURLList").jqxGrid("source").records)});0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",
altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"urlSelected",width:30,renderer:c,columntype:"checkbox"},{text:strings.AppManager.urlgrid_URL,datafield:"appURL"}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"urlSelected",width:30,renderer:c,columntype:"checkbox"},{text:strings.AppManager.urlgrid_URL,datafield:"appURL"}],
enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.AppManager.URLs.urlSelected);b.bind("rowunselect",mygis.Admin.AppManager.URLs.urlUnselected);b.bind("cellendedit",mygis.Admin.AppManager.URLs.urlCheckClicked);mygis.Utilities.unblockUI()},createAppURLGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"urlSelected",type:"boolean"},{name:"appURL"}],id:"aliasList",url:config.mgreq+"?qtype=GetAppURLs&qContents="+
a},{async:!1})}},Styles:{editor:null,stylePreview:function(a,b){mygis.Utilities.previewCustomization(a);$("#page_administration").animate({opacity:0},1E3);$("#page_effect").css({display:"block",opacity:0});$("#page_effect").animate({opacity:1},1E3,null,function(){setTimeout(mygis.Admin.AppManager.Styles.cancelPreview,1E3*b)})},cancelPreview:function(){$("#page_effect").css({display:"none",opacity:1});$("#page_administration").animate({opacity:1},1E3);mygis.Utilities.enableCustomization()},singleCheckClicked:function(a){var b=
$("#adminStyleList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},allCheckClicked:function(a){var b=$("#adminStyleList"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].styleSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].styleSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},styleSelected:function(){var a=$("#adminStyleList"),b=a.jqxGrid("getselectedrowindexes");
1<b.length?(document.getElementById("appStyle_Edit").ex_HasClassName("disabled")||document.getElementById("appStyle_Edit").ex_AddClassName("disabled"),document.getElementById("appStyle_Copy").ex_HasClassName("disabled")||document.getElementById("appStyle_Copy").ex_AddClassName("disabled"),document.getElementById("appStyle_CopyTo").ex_HasClassName("disabled")||document.getElementById("appStyle_CopyTo").ex_AddClassName("disabled"),document.getElementById("appStyle_MakeDefault").ex_HasClassName("disabled")||
document.getElementById("appStyle_MakeDefault").ex_AddClassName("disabled")):(document.getElementById("appStyle_Edit").ex_HasClassName("disabled")&&document.getElementById("appStyle_Edit").ex_RemoveClassName("disabled"),document.getElementById("appStyle_Copy").ex_HasClassName("disabled")&&document.getElementById("appStyle_Copy").ex_RemoveClassName("disabled"),document.getElementById("appStyle_CopyTo").ex_HasClassName("disabled")&&document.getElementById("appStyle_CopyTo").ex_RemoveClassName("disabled"),
document.getElementById("appStyle_MakeDefault").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakeDefault").ex_RemoveClassName("disabled"));document.getElementById("appStyle_MakePublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakePublish").ex_RemoveClassName("disabled");document.getElementById("appStyle_MakeUnpublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakeUnpublish").ex_RemoveClassName("disabled");document.getElementById("appStyle_Remove").ex_HasClassName("disabled")&&
document.getElementById("appStyle_Remove").ex_RemoveClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllStyles").checked=!0:document.getElementById("adminSelectAllStyles").checked=!1},styleUnselected:function(){var a=$("#adminStyleList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("appStyle_Edit").ex_HasClassName("disabled")||document.getElementById("appStyle_Edit").ex_AddClassName("disabled"),document.getElementById("appStyle_Copy").ex_HasClassName("disabled")||
document.getElementById("appStyle_Copy").ex_AddClassName("disabled"),document.getElementById("appStyle_CopyTo").ex_HasClassName("disabled")||document.getElementById("appStyle_CopyTo").ex_AddClassName("disabled"),document.getElementById("appStyle_MakeDefault").ex_HasClassName("disabled")||document.getElementById("appStyle_MakeDefault").ex_AddClassName("disabled"),document.getElementById("appStyle_MakePublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakePublish").ex_RemoveClassName("disabled"),
document.getElementById("appStyle_MakeUnpublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakeUnpublish").ex_RemoveClassName("disabled"),document.getElementById("appStyle_Remove").ex_HasClassName("disabled")&&document.getElementById("appStyle_Remove").ex_RemoveClassName("disabled")):1==b.length?(document.getElementById("appStyle_Edit").ex_HasClassName("disabled")&&document.getElementById("appStyle_Edit").ex_RemoveClassName("disabled"),document.getElementById("appStyle_Copy").ex_HasClassName("disabled")&&
document.getElementById("appStyle_Copy").ex_RemoveClassName("disabled"),document.getElementById("appStyle_CopyTo").ex_HasClassName("disabled")&&document.getElementById("appStyle_CopyTo").ex_RemoveClassName("disabled"),document.getElementById("appStyle_MakeDefault").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakeDefault").ex_RemoveClassName("disabled"),document.getElementById("appStyle_MakePublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakePublish").ex_RemoveClassName("disabled"),
document.getElementById("appStyle_MakeUnpublish").ex_HasClassName("disabled")&&document.getElementById("appStyle_MakeUnpublish").ex_RemoveClassName("disabled"),document.getElementById("appStyle_Remove").ex_HasClassName("disabled")&&document.getElementById("appStyle_Remove").ex_RemoveClassName("disabled")):(document.getElementById("appStyle_Edit").ex_HasClassName("disabled")||document.getElementById("appStyle_Edit").ex_AddClassName("disabled"),document.getElementById("appStyle_Copy").ex_HasClassName("disabled")||
document.getElementById("appStyle_Copy").ex_AddClassName("disabled"),document.getElementById("appStyle_CopyTo").ex_HasClassName("disabled")||document.getElementById("appStyle_CopyTo").ex_AddClassName("disabled"),document.getElementById("appStyle_MakeDefault").ex_HasClassName("disabled")||document.getElementById("appStyle_MakeDefault").ex_AddClassName("disabled"),document.getElementById("appStyle_MakePublish").ex_HasClassName("disabled")||document.getElementById("appStyle_MakePublish").ex_AddClassName("disabled"),
document.getElementById("appStyle_MakeUnpublish").ex_HasClassName("disabled")||document.getElementById("appStyle_MakeUnpublish").ex_AddClassName("disabled"),document.getElementById("appStyle_Remove").ex_HasClassName("disabled")||document.getElementById("appStyle_Remove").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllStyles").checked=!0:document.getElementById("adminSelectAllStyles").checked=!1},createAppStylesGrid:function(a){mygis.Utilities.blockUI();
var a=mygis.Admin.AppManager.Styles.createAppStylesGridSource(a),b=$("#adminStyleList"),c=function(a){var b="",c=$("#adminStyleList");switch(a){case strings.AppManager.grid_Style_IsActive:case strings.AppManager.grid_Style_Published:retobject=mygis.Utilities.format("<div style='text-align: center; width: 100%;height: 100%;'><a href='#'>{0}</a>",a);break;default:b='router("adminStyleAllClick",this);',a=c.jqxGrid("getselectedrowindexes").length==c.jqxGrid("source").records.length?' checked="checked"':
"",retobject=mygis.Utilities.format("<div style='{2}'><input id='adminSelectAllStyles' type='checkbox' onclick='{0}'{1}/></div>",b,a,"text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;")}return retobject},d=function(a,b,c){var d;switch(b){case "layoutName":a=mygis.Utilities.format('router("app_directEditStyle",{0});',a);d=mygis.Utilities.format("<div style='{2}'><a href='#' onclick='{0}' style='margin-left: 5px;margin-top: 6px;display:block;font-size:11px;'>{1}</a></div>",
a,c,"text-align: left; width: 200px;");break;case "isActive":d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 80px;line-height:25px;'><div class='btnStarCheck{0}'></div></div>",c?" checked":"");break;case "isPublished":d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 80px;line-height:25px;'><a href='#' class='btnTickCheck{0}'></a></div>",c?" checked":"");break;case "id":a=mygis.Utilities.format('router("adminStylePreview",{0});',c),b="text-align: center; width: 200px;",
d=mygis.Utilities.format("<select id='stylePreviewTimer_{6}'><option value='{1}' selected='selected'>{1}{0}</option><option value='{2}'>{2}{0}</option><option value='{3}'>{3}{0}</option><option value='{4}'>{4}{0}</option><option value='{5}'>{5}{0}</option></select>",strings.Coding.seconds,2,5,10,30,60,c),d=c?mygis.Utilities.format("<div style='{2}'><a href='#' onclick='{0}' style='margin-top: 6px;width: 100px;display:inline-block;font-size:11px;'>{1}</a>{3}</div>",a,"\u03a0\u03c1\u03bf\u03b5\u03c0\u03b9\u03c3\u03ba\u03cc\u03c0\u03b7\u03c3\u03b7",
b,d):""}return d};b.bind("bindingcomplete",function(){mygis.Admin.AppManager.Styles.setConfigStyles($("#adminStyleList").jqxGrid("source").records)});0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"",datafield:"styleSelected",width:45,renderer:c,columntype:"checkbox"},{text:strings.AppManager.grid_Style_Name,datafield:"layoutName",cellsrenderer:d,editable:!1},{text:strings.AppManager.grid_Style_IsActive,datafield:"isActive",
renderer:c,width:80,editable:!1,cellsrenderer:d},{text:strings.AppManager.grid_Style_Published,datafield:"isPublished",renderer:c,width:80,editable:!1,cellsrenderer:d},{text:"",datafield:"id",editable:!1,cellsrenderer:d,width:200}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"",datafield:"styleSelected",width:45,renderer:c,columntype:"checkbox"},
{text:strings.AppManager.grid_Style_Name,datafield:"layoutName",cellsrenderer:d,editable:!1},{text:strings.AppManager.grid_Style_IsActive,datafield:"isActive",renderer:c,width:80,editable:!1,cellsrenderer:d},{text:strings.AppManager.grid_Style_Published,datafield:"isPublished",renderer:c,width:80,editable:!1,cellsrenderer:d},{text:"",datafield:"id",editable:!1,cellsrenderer:d,width:200}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.AppManager.Styles.styleSelected);
b.bind("rowunselect",mygis.Admin.AppManager.Styles.styleUnselected);b.bind("cellendedit",mygis.Admin.AppManager.Styles.singleCheckClicked);mygis.Utilities.unblockUI()},createAppStylesGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"styleSelected",type:"boolean"},{name:"id"},{name:"layoutName"},{name:"isActive",type:"boolean"},{name:"isPublished",type:"boolean"},{name:"headerOn",type:"boolean"},{name:"headerHeight"},{name:"headerBG"},{name:"headerTextColor"},
{name:"textBG"},{name:"textRadius"},{name:"theme1_FillSelectBG"},{name:"theme1_FillSelectBorderColor"},{name:"theme1_FillBG"},{name:"theme1_FillBorderColor"},{name:"menuColor"},{name:"menuActiveColor"},{name:"rightPanel_TopBG"},{name:"rightPanel_TabsBG"},{name:"rightPanel_TopColor"},{name:"rightPanel_TabColor"},{name:"rightPanel_TabActiveColor"},{name:"mapHeaderBG"},{name:"mapDescriptionSize"},{name:"mapDescriptionColor"},{name:"mapFooterBG"},{name:"mapFooterFontColor"},{name:"customCSS_enabled",
type:"boolean"},{name:"customCSS"}],id:"madminStyleList",url:config.mgreq+"?qtype=GetAppStyles&qContents="+a},{async:!1})},setConfigStyles:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.AppManager.updateConfig.styles=b},showEditStyle:function(a){var b,c=mygis.Admin.UI.dialogConfig;a?($("#editStyleActionsTitle").attr("class","newStyle"),b=strings.AppManager.window_NewStyle):($("#editStyleActionsTitle").attr("class",
"editStyle"),b=strings.AppManager.window_EditStyle);$("#editActionsTitleElem").html(b);c.checkfn=mygis.Admin.AppManager.Styles.editStyleCheck;c.callbackfn=mygis.Admin.AppManager.Styles.editStyleResult;c.objectCount=-1;c.windowTitle="#editStylePop";a?(a={customCSS:"",customCSS_enabled:!1,headerBG:"#FAA419",headerHeight:"60px",headerOn:!0,headerTextColor:"white",layoutName:strings.AppManager.addStyle_NewStyleName+" "+(new Date).toString(Date.CultureInfo.formatPatterns.fullDateTime),mapDescriptionColor:"#FFFFFF",
mapDescriptionSize:"20px",mapFooterBG:"rgba(0, 0, 0, 0.45)",mapFooterFontColor:"#FFFFFF",mapHeaderBG:"rgba(0, 0, 0, 0.5)",menuActiveColor:"#333333",menuColor:"#333333",rightPanel_TabActiveColor:"#FFFFFF",rightPanel_TabColor:"#FFFFFF",rightPanel_TabsBG:"#777777",rightPanel_TopBG:"#555555",rightPanel_TopColor:"#FFFFFF",textBG:"rgba(141, 141, 141, 0.4)",textRadius:"15px",theme1_FillBG:"#FAA419",theme1_FillBorderColor:"#FAA419",theme1_FillSelectBG:"#FAA419",theme1_FillSelectBorderColor:"#FAA419"},mygis.Admin.AppManager.Styles.setupEditStyleButtons(a)):
(b=$("#adminStyleList"),a=b.jqxGrid("source").records,b=b.jqxGrid("getselectedrowindexes"),a=a[b[0]],mygis.Admin.AppManager.Styles.setupEditStyleButtons(a),c.objectCount=a.id,c.callbackfn=mygis.Admin.AppManager.Styles.editStyleUpdateResult);$("#editStylePop").dialog({autoOpen:!0,modal:!0,resizable:!1,width:900,height:510,title:strings.AppManager.window_StyleManager,closeOnEscape:!1})},setupEditStyleButtons:function(a){$("#saveStyleAs").val(a.layoutName);$("#appSetting_HeaderBG").val(mygis.Utilities.rgbaToHex(a.headerBG));
$("#appSetting_HeaderTextBG").val(mygis.Utilities.rgbaToHex(a.textBG));$("#appSetting_HeaderTextColor").val(a.headerTextColor);$("#appSetting_menuBackground").val(mygis.Utilities.rgbaToHex(a.theme1_FillBG));$("#appSetting_menuBackgroundBorder").val(a.theme1_FillBorderColor);$("#appSetting_menuColor").val(a.menuColor);$("#appSetting_menuBackgroundActive").val(mygis.Utilities.rgbaToHex(a.theme1_FillSelectBG));$("#appSetting_menuBackgroundBorderActive").val(a.theme1_FillSelectBorderColor);$("#appSetting_menu\u0391ctiveColor").val(a.menuActiveColor);
$("#appSetting_TopBackground").val(mygis.Utilities.rgbaToHex(a.rightPanel_TopBG));$("#appSetting_TopColor").val(a.rightPanel_TopColor);$("#appSetting_MidBackground").val(mygis.Utilities.rgbaToHex(a.rightPanel_TabsBG));$("#appSetting_MidColor").val(a.rightPanel_TabColor);$("#appSetting_MidActiveColor").val(a.rightPanel_TabActiveColor);$("#appSetting_mapHeaderBG").val(mygis.Utilities.rgbaToHex(a.mapHeaderBG));$("#appSetting_mapFooterBG").val(mygis.Utilities.rgbaToHex(a.mapFooterBG));$("#appSetting_mapDescriptionColor").val(a.mapDescriptionColor);
$("#appSetting_mapFooterFontColor").val(a.mapFooterFontColor);$("#editStyleContent input[type=hidden]").prop("type","color");$("#editStyleContent span.mColorPicker").remove();$("#editStyleContent input[type=color]").mColorPicker();$("#appSetting_HeaderHeight").jqxNumberInput({width:"40px",height:"17px",inputMode:"simple",min:1,decimal:parseInt(a.headerHeight),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_HeaderTextRadius").jqxNumberInput({width:"40px",height:"17px",inputMode:"simple",
min:0,decimal:parseInt(a.textRadius),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_mapHeaderOpacity").jqxNumberInput({width:"40px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.mapHeaderBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_mapFooterOpacity").jqxNumberInput({width:"40px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.mapFooterBG)),decimalDigits:0,
spinButtons:!0,theme:"classic"});$("#appSetting_MidBGOpacity").jqxNumberInput({width:"45px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.rightPanel_TabsBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_TopBGOpacity").jqxNumberInput({width:"45px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.rightPanel_TopBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_menuBGActiveOpacity").jqxNumberInput({width:"45px",
height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.theme1_FillSelectBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_menuBGOpacity").jqxNumberInput({width:"45px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.theme1_FillBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_HeaderTextOpacity").jqxNumberInput({width:"45px",height:"17px",inputMode:"simple",min:0,
max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.textBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_HeaderOpacity").jqxNumberInput({width:"45px",height:"17px",inputMode:"simple",min:0,max:100,decimal:100*parseFloat(mygis.Utilities.getOpacityRGBA(a.headerBG)),decimalDigits:0,spinButtons:!0,theme:"classic"});$("#appSetting_mapDescriptionSize").jqxNumberInput({width:"40px",height:"17px",inputMode:"simple",min:8,max:40,decimal:parseInt(a.mapDescriptionSize),decimalDigits:0,
spinButtons:!0,theme:"classic"});mygis.Admin.AppManager.Styles.createEditor();mygis.Admin.AppManager.Styles.bindHandlers()},bindHandlers:function(){$("#appSetting_enableHeader").bind("change",function(){mygis.Admin.AppManager.Styles.toggleSubMenu(this)});$("#appSetting_expertModeToggle").bind("change",function(){mygis.Admin.AppManager.Styles.toggleSubMenu(this)})},editStyleCheck:function(){$("#adminStyleList");var a=mygis.Admin.UI.dialogConfig,b;b=[];var c={styleSelected:!1,id:null,layoutName:$("#saveStyleAs").val(),
isActive:!1,isPublished:!1,headerOn:$("#appSetting_enableHeader").is(":checked"),headerHeight:$("#appSetting_HeaderHeight").jqxNumberInput("decimal")+"px",headerBG:mygis.Admin.Utilities.getRGBA($("#appSetting_HeaderBG").val(),$("#appSetting_HeaderOpacity").jqxNumberInput("decimal")),headerTextColor:$("#appSetting_HeaderTextColor").val(),textBG:mygis.Admin.Utilities.getRGBA($("#appSetting_HeaderTextBG").val(),$("#appSetting_HeaderTextOpacity").jqxNumberInput("decimal")),textRadius:$("#appSetting_HeaderTextRadius").jqxNumberInput("decimal")+
"px",theme1_FillSelectBG:mygis.Admin.Utilities.getRGBA($("#appSetting_menuBackgroundActive").val(),$("#appSetting_menuBGActiveOpacity").jqxNumberInput("decimal")),theme1_FillSelectBorderColor:$("#appSetting_menuBackgroundBorderActive").val(),theme1_FillBG:mygis.Admin.Utilities.getRGBA($("#appSetting_menuBackground").val(),$("#appSetting_menuBGOpacity").jqxNumberInput("decimal")),theme1_FillBorderColor:$("#appSetting_menuBackgroundBorder").val(),menuColor:$("#appSetting_menuColor").val(),menuActiveColor:$("#appSetting_menu\u0391ctiveColor").val(),
rightPanel_TopBG:mygis.Admin.Utilities.getRGBA($("#appSetting_TopBackground").val(),$("#appSetting_TopBGOpacity").jqxNumberInput("decimal")),rightPanel_TabsBG:mygis.Admin.Utilities.getRGBA($("#appSetting_MidBackground").val(),$("#appSetting_MidBGOpacity").jqxNumberInput("decimal")),rightPanel_TopColor:$("#appSetting_TopColor").val(),rightPanel_TabColor:$("#appSetting_MidColor").val(),rightPanel_TabActiveColor:$("#appSetting_MidActiveColor").val(),mapHeaderBG:mygis.Admin.Utilities.getRGBA($("#appSetting_mapHeaderBG").val(),
$("#appSetting_mapHeaderOpacity").jqxNumberInput("decimal")),mapDescriptionSize:$("#appSetting_mapDescriptionSize").jqxNumberInput("decimal")+"px",mapDescriptionColor:$("#appSetting_mapDescriptionColor").val(),mapFooterBG:mygis.Admin.Utilities.getRGBA($("#appSetting_mapFooterBG").val(),$("#appSetting_mapFooterOpacity").jqxNumberInput("decimal")),mapFooterFontColor:$("#appSetting_mapFooterFontColor").val(),customCSS_enabled:$("#appSetting_expertModeToggle").is(":checked"),customCSS:""};b.push(c);a.object=
b;return!0},saveAsCopy:function(){var a=$("#adminStyleList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),c=b[c[0]],b=mygis.Admin.AppManager.updateConfig,c={styleSelected:!1,id:-1,layoutName:(c.layoutName+strings.AppManager.addStyle_CopySuffix+(new Date).toString(Date.CultureInfo.formatPatterns.fullDateTime)).substring(0,99),isActive:c.isActive,isPublished:c.isPublished,headerOn:c.headerOn,headerHeight:c.headerHeight,headerBG:c.headerBG,headerTextColor:c.headerTextColor,textBG:c.textBG,
textRadius:c.textRadius,theme1_FillSelectBG:c.theme1_FillSelectBG,theme1_FillSelectBorderColor:c.theme1_FillSelectBorderColor,theme1_FillBG:c.theme1_FillBG,theme1_FillBorderColor:c.theme1_FillBorderColor,menuColor:c.menuColor,menuActiveColor:c.menuActiveColor,rightPanel_TopBG:c.rightPanel_TopBG,rightPanel_TabsBG:c.rightPanel_TabsBG,rightPanel_TopColor:c.rightPanel_TopColor,rightPanel_TabColor:c.rightPanel_TabColor,rightPanel_TabActiveColor:c.rightPanel_TabActiveColor,mapHeaderBG:c.mapHeaderBG,mapDescriptionSize:c.mapDescriptionSize,
mapDescriptionColor:c.mapDescriptionColor,mapFooterBG:c.mapFooterBG,mapFooterFontColor:c.mapFooterFontColor,customCSS_enabled:c.customCSS_enabled,customCSS:c.customCSS};a.jqxGrid("addrow",null,c);c={changed:!0,oldvalue:null,newValue:JSON.stringify(c)};b.styles.push(c);mygis.Admin.AppManager.notifyUnsaved();a.jqxGrid("refreshdata")},editStyleResult:function(a){if("ok"==a){a=$("#adminStyleList");a.jqxGrid("source");for(var b=mygis.Admin.AppManager.updateConfig,c=0;c<this.length;c++){var d=this[c],d=
{styleSelected:!1,id:-1,layoutName:d.layoutName,isActive:d.isActive,isPublished:d.isPublished,headerOn:d.headerOn,headerHeight:d.headerHeight,headerBG:d.headerBG,headerTextColor:d.headerTextColor,textBG:d.textBG,textRadius:d.textRadius,theme1_FillSelectBG:d.theme1_FillSelectBG,theme1_FillSelectBorderColor:d.theme1_FillSelectBorderColor,theme1_FillBG:d.theme1_FillBG,theme1_FillBorderColor:d.theme1_FillBorderColor,menuColor:d.menuColor,menuActiveColor:d.menuActiveColor,rightPanel_TopBG:d.rightPanel_TopBG,
rightPanel_TabsBG:d.rightPanel_TabsBG,rightPanel_TopColor:d.rightPanel_TopColor,rightPanel_TabColor:d.rightPanel_TabColor,rightPanel_TabActiveColor:d.rightPanel_TabActiveColor,mapHeaderBG:d.mapHeaderBG,mapDescriptionSize:d.mapDescriptionSize,mapDescriptionColor:d.mapDescriptionColor,mapFooterBG:d.mapFooterBG,mapFooterFontColor:d.mapFooterFontColor,customCSS_enabled:d.customCSS_enabled,customCSS:d.customCSS};a.jqxGrid("addrow",null,d);d={changed:!0,oldvalue:null,newValue:JSON.stringify(d)};b.styles.push(d)}mygis.Admin.AppManager.notifyUnsaved();
a.jqxGrid("refreshdata")}},editStyleUpdateResult:function(a){if("ok"==a){for(var a=$("#adminStyleList"),b=a.jqxGrid("source").records,c=mygis.Admin.AppManager.updateConfig,d=mygis.Admin.UI.dialogConfig,e=this[0],f=!1,g=0,h=-1;!f&&g<b.length;)b[g].id==d.objectCount&&(f=!0,h=g),g++;f?($.extend(b[h],{layoutName:e.layoutName,isActive:e.isActive,isPublished:e.isPublished,headerOn:e.headerOn,headerHeight:e.headerHeight,headerBG:e.headerBG,headerTextColor:e.headerTextColor,textBG:e.textBG,textRadius:e.textRadius,
theme1_FillSelectBG:e.theme1_FillSelectBG,theme1_FillSelectBorderColor:e.theme1_FillSelectBorderColor,theme1_FillBG:e.theme1_FillBG,theme1_FillBorderColor:e.theme1_FillBorderColor,menuColor:e.menuColor,menuActiveColor:e.menuActiveColor,rightPanel_TopBG:e.rightPanel_TopBG,rightPanel_TabsBG:e.rightPanel_TabsBG,rightPanel_TopColor:e.rightPanel_TopColor,rightPanel_TabColor:e.rightPanel_TabColor,rightPanel_TabActiveColor:e.rightPanel_TabActiveColor,mapHeaderBG:e.mapHeaderBG,mapDescriptionSize:e.mapDescriptionSize,
mapDescriptionColor:e.mapDescriptionColor,mapFooterBG:e.mapFooterBG,mapFooterFontColor:e.mapFooterFontColor,customCSS_enabled:e.customCSS_enabled,customCSS:e.customCSS}),c.styles[h].changed=!0,c.styles[h].newValue?c.styles[h].newValue=JSON.stringify(b[h]):c.styles[h].oldValue=JSON.stringify(b[h])):console.log("An error occured in editStyleUpdateResult");mygis.Admin.AppManager.notifyUnsaved();a.jqxGrid("refreshdata")}},directStyleEdit:function(a){var b=$("#adminStyleList");b.jqxGrid("clearselection");
b.jqxGrid("selectrow",a);mygis.Admin.AppManager.Styles.styleSelected();mygis.Admin.AppManager.Styles.showEditStyle(!1)},switchToTab:function(a){for(var b=$("#editStyleLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#editHeaderTab").find(".appSettingFrame");for(c=0;c<b.length;c++)c!=a?$(b[c]).hide():$(b[c]).show()},toggleSubMenu:function(a){var b=a.checked;switch(a.id){case "appSetting_enableHeader":b?$("#appSetting_HeaderSettings").show():
$("#appSetting_HeaderSettings").hide();break;case "appSetting_expertModeToggle":b?$("#appSetting_ExpertSettings").show():$("#appSetting_ExpertSettings").hide()}},createEditor:function(){mygis.Admin.AppManager.Styles.editor||(mygis.Admin.AppManager.Styles.editor=CodeMirror.fromTextArea(document.getElementById("expertModeCss"),{mode:"css",lineNumbers:!0,matchBrackets:!0,theme:"default",tabindex:0}))},makeDefault:function(){var a=$("#adminStyleList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),
d=!1,e=-1;if(1<c.length)displayError("Only one style can be set as active");else{for(var f=0;f<b.length;f++){var g=b[f];g.isActive&&f!=c[0]?(g.isActive=!1,d=!0,e=f):f==c[0]&&(g.isActive=!g.isActive,d=!0)}d&&(-1<e&&(d=mygis.Admin.AppManager.updateConfig.styles[e],d.changed=!0,d.newValue?d.newValue=JSON.stringify(b[e]):d.oldValue=JSON.stringify(b[e])),e=mygis.Admin.AppManager.updateConfig.styles[c[0]],e.changed=!0,e.newValue?e.newValue=JSON.stringify(b[c[0]]):e.oldValue=JSON.stringify(b[c[0]]),mygis.Admin.AppManager.notifyUnsaved(),
a.jqxGrid("refreshdata"))}},publishStyles:function(){for(var a=$("#adminStyleList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),d=!1,e=0;e<c.length;e++){var f=b[c[e]];if(!f.isPublished){d=!0;f.isPublished=!0;var g=mygis.Admin.AppManager.updateConfig.styles[c[e]];g.changed=!0;g.newValue?g.newValue=JSON.stringify(f):g.oldValue=JSON.stringify(f)}}d&&(mygis.Admin.AppManager.notifyUnsaved(),a.jqxGrid("refreshdata"))},unpublishStyles:function(){for(var a=$("#adminStyleList"),b=a.jqxGrid("source").records,
c=a.jqxGrid("getselectedrowindexes"),d=!1,e=0;e<c.length;e++){var f=b[c[e]];if(f.isPublished){d=!0;f.isPublished=!1;var g=mygis.Admin.AppManager.updateConfig.styles[c[e]];g.changed=!0;g.newValue?g.newValue=JSON.stringify(f):g.oldValue=JSON.stringify(f)}}d&&(mygis.Admin.AppManager.notifyUnsaved(),a.jqxGrid("refreshdata"))},deleteStyles:function(){for(var a=$("#adminStyleList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),d=!1,e=0;e<c.length;e++){var f=b[c[e]],g=mygis.Admin.AppManager.updateConfig.styles[c[e]];
g.newValue?(b.splice(c[e],1),mygis.Admin.AppManager.updateConfig.styles.splice(c[e],1)):(d=$.extend({},f),d.id=-1,g.newValue=JSON.stringify(d),d=g.changed=!0,b.splice(c[e],1))}d&&(mygis.Admin.AppManager.notifyUnsaved(),a.jqxGrid("refreshdata"))}},expandDetails:function(a){a=a.item;mygis.Utilities.blockUI();for(var b=$("#contentLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#editAppForm").find(".sectionContent");
for(c=0;c<b.length;c++)if(c!=a)$(b[c]).hide();else{$(b[c]).show();var d=$(b[c]).find(".sectionButtons");$("#contentSpecificToolbar").empty();$("#contentSpecificToolbar").append(d.clone())}mygis.Admin.AppManager.createGrid(a);mygis.Utilities.unblockUI()},createGrid:function(a){var b=mygis.Admin.AppManager.updateConfig;switch(a){case 1:0==b.maps.length?mygis.Admin.AppManager.Maps.createAppMapGrid(b.appID):$("#adminMapList").jqxGrid("render");break;case 2:0==b.urls.length?mygis.Admin.AppManager.URLs.createAppURLGrid(b.appID):
$("#adminURLList").jqxGrid("render");break;case 3:0==b.users.length?mygis.Admin.AppManager.createAppUserGrid(b.appID):$("#adminAppUserList").jqxGrid("render");break;case 4:0==b.styles.length?mygis.Admin.AppManager.Styles.createAppStylesGrid(b.appID):$("#adminStyleList").jqxGrid("render")}},getAppDetails:function(a){for(var b=$("#myAppGrid").jqxGrid("source").records,c=!1,d=0,e;!c&&d<b.length;)a?b[d].appID==a&&(c=!0,e=b[d]):b[d].appPrefix==currentAppName&&(c=!0,e=b[d]),d++;c?(mygis.Admin.AppManager.storeAppDetails(e),
document.getElementById("editAppName").value=e.appName,document.getElementById("editAppAlias").value=e.appPrefix,document.getElementById("editAppWelcomeText").value=e.appWelcomeText,document.getElementById("editAppLogo").src=mygis.Utilities.format("{0}GetImage.ashx?qType=GetAppLogo&qContents={1}&qSize=142",config.folderPath,e.appID),e.hasLogo1?document.getElementById("editAppLogo1").src=mygis.Utilities.format("{0}GetImage.ashx?qType=GetAppLogo1&qContents={1}&qSize=142",config.folderPath,e.appID):
document.getElementById("editAppLogo1").src="",e.hasLogo2?document.getElementById("editAppLogo2").src=mygis.Utilities.format("{0}GetImage.ashx?qType=GetAppLogo2&qContents={1}&qSize=142",config.folderPath,e.appID):document.getElementById("editAppLogo2").src=""):displayError(strings.AppManager.err_notAuthorized)},storeAppDetails:function(a){var b=mygis.Admin.AppManager.updateConfig;a.appMAPS.split("#");a.appURLS.split(",");b.appID=a.appID;b.maps=[];b.urls=[];b.users=[]},createAppUserGrid:function(a){mygis.Utilities.blockUI();
a=mygis.Admin.AppManager.createAppUserGridSource(a);$("#adminAppUserList").jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:strings.AppManager.usergrid_UserFirstName,datafield:"firstName"},{text:strings.AppManager.usergrid_UserLastName,datafield:"lastName"},{text:strings.AppManager.usergrid_UserEmail,datafield:"email"},{text:strings.AppManager.usergrid_Username,datafield:"username"},{text:strings.AppManager.usergrid_UserID,datafield:"userID"}],
enableanimations:!1,showheader:!0,columnsmenu:!0,editable:!0,selectionmode:"none"});mygis.Utilities.unblockUI()},createAppUserGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"userID"},{name:"username"},{name:"firstName"},{name:"lastName"},{name:"email"}],id:"userlist",url:config.mgreq+"?qtype=GetAppUserList&qContents="+a},{async:!1})},setConfigMaps:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);
b.push(d)}mygis.Admin.AppManager.updateConfig.maps=b},setConfigUrls:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.AppManager.updateConfig.urls=b},logoBtnClick:function(a){var b=-1;switch(a.id){case "replaceAppLogo":b=0;break;case "replaceAppLogo1":b=1;break;case "replaceAppLogo2":b=2}-1<b&&(internalConfig.mmCallback.fn=mygis.Admin.AppManager.newlogoSelected,internalConfig.mmCallback.objectCount=1,internalConfig.mmCallback.object=
{logo_id:b},showMediaManager())},logoRemoveBtnClick:function(a){var b=mygis.Admin.AppManager.updateConfig;switch(a.id){case "removeAppLogo1":b.logo1.changed=!0;b.logo1.newValue=-1;document.getElementById("editAppLogo1").src="";break;case "removeAppLogo2":b.logo2.changed=!0,b.logo2.newValue=-1,document.getElementById("editAppLogo2").src=""}mygis.Admin.AppManager.notifyUnsaved()},newlogoSelected:function(a){var b;b=this[0];if(!a||"ok"!=a)a&&displayError(a);else{var a=internalConfig.mmCallback.object,
c=mygis.Admin.AppManager.updateConfig,d,e="";switch(a.logo_id){case 0:d=c.logo;e="editAppLogo";break;case 1:d=c.logo1;e="editAppLogo1";break;case 2:d=c.logo2,e="editAppLogo2"}d.changed||(d.oldValue=document.getElementById(e).src);d.changed=!0;d.newValue=b.fileID;b=mygis.Utilities.format("{0}GetImage.ashx?qType=userFile&qContents={1}",config.folderPath,b.fileID);document.getElementById(e).src=b+"&qSize=142";mygis.Admin.AppManager.notifyUnsaved();mygis.Admin.AppManager.previewAppLogo(a.logo_id,b);displayNotify(strings.AppManager.logo_selected)}},
replaceLogo:function(a,b){mygis.Utilities.blockUI();var c=mygis.Utilities.format("{0}%23{1}",a,b);$.ajax({type:"GET",url:config.mgreq+"?qtype=ReplaceLogo&qContents="+c,success:function(a){try{var b=eval("("+a+")");"success"==b.iotype?(mygis.Admin.UI.refreshPageLogos(),mygis.Admin.AppManager.resetConfigObject(),displaySuccess(strings.AppManager.logo_updated)):displayError(b.iomsg)}catch(c){console.log(c.message)}mygis.Utilities.unblockUI()}})},previewAppLogo:function(a,b){var c=$(".domainLogoWrapper2").find("img");
(c[a].src=b)?c[a].style.display="":0<a&&(c[a].style.display="none")},notifyUnsaved:function(){document.getElementById("amenu_Apps_Config_save").ex_RemoveClassName("disabled");$("#amenu_Apps_Config_save").qtip({content:{text:strings.AppManager.msg_NotifyUnsaved},position:{my:"center right",at:"center left"},show:{event:"mouseover",ready:!0,solo:!0},hide:{event:"unfocus",inactive:!1},events:{hide:function(a,b){b.destroy()}},style:{classes:"ui-tooltip-shadow",tip:{border:1},border:1}})},saveChanges:function(){var a=
JSON.stringify(mygis.Admin.AppManager.updateConfig),b=config.mgreq+"?qtype=UpdateAppSettings",c={};c.qContents=a;mygis.Utilities.blockUI();$.ajax({type:"POST",data:c,url:b,success:function(a){try{var b=eval("("+a+")");"success"==b.iotype?(mygis.Admin.UI.refreshPageLogos(),mygis.Admin.AppManager.resetConfigObject(),displaySuccess(strings.AppManager.settings_updated),setTimeout(function(){var a=$("#contentLinkTabsRound").find(".sectionHeader.active");mygis.Admin.AppManager.createGrid(a.index())},250)):
displayError(b.iomsg)}catch(c){console.log(c.message)}mygis.Utilities.unblockUI()}})},revertChanges:function(){var a=mygis.Admin.AppManager.updateConfig;a.logo.changed&&(document.getElementById("editAppLogo").src=a.logo.oldValue);a.logo1.changed&&(document.getElementById("editAppLogo1").src=a.logo1.oldValue);a.logo2.changed&&(document.getElementById("editAppLogo2").src=a.logo2.oldValue);a.appName.changed&&(document.getElementById("editAppName").value=a.appName.oldValue);a.appAlias.changed&&(document.getElementById("editAppAlias").value=
a.appAlias.oldValue);a.appText.changed&&(document.getElementById("editAppWelcomeText").value=a.appText.oldValue);mygis.Admin.AppManager.resetConfigObject()},resetConfigObject:function(){try{document.getElementById("amenu_Apps_Config_save").ex_HasClassName("disabled")||document.getElementById("amenu_Apps_Config_save").ex_AddClassName("disabled")}catch(a){}mygis.Admin.AppManager.updateConfig=mygis.Utilities.mergeOptions(mygis.Admin.AppManager.updateConfig,{maps:[],urls:[],users:[],styles:[],logo:{changed:!1,
newValue:null,oldValue:null},logo1:{changed:!1,newValue:null,oldValue:null},logo2:{changed:!1,newValue:null,oldValue:null},appName:{changed:!1,newValue:null,oldValue:null},appAlias:{changed:!1,newValue:null,oldValue:null},appText:{changed:!1,newValue:null,oldValue:null}})}},MapManager:{updateConfig:{mapID:-1,layers:[],tags:[],quickSearches:[],permissions:[],macros:[],mapName:{changed:!1,oldValue:"",newValue:""},mapDescription:{changed:!1,oldValue:"",newValue:""},mapExtent:{changed:!1,oldValue:"",
newValue:""},mapCenter:{changed:!1,oldValue:"",newValue:""},mapZoom:{changed:!1,oldValue:"",newValue:""},mapDeveloped:{changed:!1,oldValue:"",newValue:""},mapOwner:{changed:!1,oldValue:"",newValue:""},mapThumb:{changed:!1,oldValue:"",newValue:""},mapDefaultBG:{changed:!1,oldValue:"",newValue:""}},Maps:{showAddNewMap:function(){var a=mygis.Admin.UI.dialogConfig;a.checkfn=mygis.Admin.MapManager.Maps.addNewMapCheck;a.callbackfn=mygis.Admin.MapManager.Maps.createNewMap;a.objectCount=1;a.windowTitle="#addMapNamePop";
$(a.windowTitle).dialog({autoOpen:!0,modal:!0,resizable:!1,width:480,height:130,title:strings.MapManager.addMap_windowTitle,closeOnEscape:!1});$("#ui-dialog-title-addMapNamePop").parent().css({background:"url('"+config.folderPath+"Images/Administration/menu/icon-16-banner-tracks.png') #F6A828 no-repeat 12px 8px","background-size":"auto 18px"})},addNewMapCheck:function(){var a=!1,b=$("#addMapNameInp").val();if(b){for(var c="`~!@#$%^&*-+=[]{}\\|:;\"'<>,./?".split(""),d=!1,e=0;e<c.length;e++)-1<b.indexOf(c[e])&&
(d=!0);d?alert(strings.MapManager.addMap_err_InvalidName):(mygis.Admin.UI.dialogConfig.object=b,a=!0)}else alert(strings.MapManager.addMap_err_NotFilled);return a},createNewMap:function(a){if("ok"==a){mygis.Admin.MapManager.resetConfigObject();a=mygis.Admin.MapManager.updateConfig;a.mapName.changed=!0;a.mapName.newValue=this;var a=JSON.stringify(a),b=config.mgreq+"?qtype=CreateNewMap",c={};c.qContents=a;mygis.Utilities.blockUI();$.ajax({type:"POST",data:c,url:b,success:function(a){try{var b=eval("("+
a+")");"success"==b.iotype?(mygis.Admin.MapManager.Maps.refreshMapGrid(),displaySuccess(strings.MapManager.addMap_msg_Success)):displayError(b.iomsg)}catch(c){console.log(c.message)}mygis.Utilities.unblockUI()}})}},createMapGrid:function(){mygis.Utilities.blockUI();var a=$("#myMapsGrid"),b=function(a,b,c){var d;switch(b){case "mapName":a=mygis.Utilities.format('router("mapnameClicked",{0});',a),d=mygis.Utilities.format("<div class='imageVerticalContainer'><a href='#' onclick='{1}'>{0}</a></div>",
c,a)}return d},c={groupsheaderstring:strings.Grid.groupsheaderstring,sortascendingstring:strings.Grid.sortascendingstring,sortdescendingstring:strings.Grid.sortdescendingstring,sortremovestring:strings.Grid.sortremovestring,groupbystring:strings.Grid.groupbystring,groupremovestring:strings.Grid.groupremovestring},d=mygis.Admin.MapManager.createPotentialMapSource();a.jqxGrid({source:d,width:"100%",height:"100%",autoheight:!1,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"mapSelected",
width:45,columntype:"checkbox",renderer:function(){var a=$("#myMapsGrid"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?' checked="checked"':"";return mygis.Utilities.format("<div style='{0}'><input id='{1}' type='checkbox' onclick='{2}'{3}/></div>","text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;","admin_Maps_selectAllMaps",'router("admin_Maps_allClick",this);',a)}},{text:strings.MapControl.col_mapName,datafield:"mapName",width:200,
cellsrenderer:b,editable:!1},{text:strings.MapControl.col_mapOwner,datafield:"mapOwner",editable:!1},{text:strings.MapControl.col_mapLCount,datafield:"mapLayerCount",editable:!1,cellsrenderer:b,width:80},{text:strings.MapControl.col_mapCreate,datafield:"mapCreateDate",editable:!1},{text:strings.MapControl.col_mapUpdate,datafield:"mapUpdateDate",editable:!1},{text:strings.MapControl.col_mapDeveloped,datafield:"mapDevelopedBy",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,sortable:!0,
editable:!0,groupable:!0,showgroupsheader:!0,selectionmode:"none"});a.jqxGrid("localizestrings",c);a.bind("rowselect",mygis.Admin.MapManager.Maps.mapSelected);a.bind("rowunselect",mygis.Admin.MapManager.Maps.mapUnselected);a.bind("cellendedit",mygis.Admin.MapManager.Maps.singleCheckClicked);mygis.Utilities.unblockUI()},refreshMapGrid:function(){$("#myMapsGrid").jqxGrid("updatebounddata")},mapSelected:function(){var a=$("#myMapsGrid"),b=a.jqxGrid("getselectedrowindexes");1<b.length?document.getElementById("amenu_Maps_Manager_edit").ex_HasClassName("disabled")||
document.getElementById("amenu_Maps_Manager_edit").ex_AddClassName("disabled"):document.getElementById("amenu_Maps_Manager_edit").ex_RemoveClassName("disabled");document.getElementById("amenu_Maps_Manager_delete").ex_RemoveClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("admin_Maps_selectAllMaps").checked=!0:document.getElementById("admin_Maps_selectAllMaps").checked=!1},mapUnselected:function(){var a=$("#myMapsGrid"),b=a.jqxGrid("getselectedrowindexes");
1<b.length?(document.getElementById("amenu_Maps_Manager_edit").ex_HasClassName("disabled")||document.getElementById("amenu_Maps_Manager_edit").ex_AddClassName("disabled"),document.getElementById("amenu_Maps_Manager_delete").ex_RemoveClassName("disabled")):1==b.length?(document.getElementById("amenu_Maps_Manager_edit").ex_RemoveClassName("disabled"),document.getElementById("amenu_Maps_Manager_delete").ex_RemoveClassName("disabled")):(document.getElementById("amenu_Maps_Manager_edit").ex_HasClassName("disabled")||
document.getElementById("amenu_Maps_Manager_edit").ex_AddClassName("disabled"),document.getElementById("amenu_Maps_Manager_delete").ex_HasClassName("disabled")||document.getElementById("amenu_Maps_Manager_delete").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("admin_Maps_selectAllMaps").checked=!0:document.getElementById("admin_Maps_selectAllMaps").checked=!1},singleCheckClicked:function(a){var b=$("#myMapsGrid");a.args.value?b.jqxGrid("selectrow",
a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},allCheckClicked:function(a){var b=$("#myMapsGrid"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].mapSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].mapSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},mapClicked:function(a){var b=$("#myMapsGrid");b.jqxGrid("clearselection");b.jqxGrid("selectrow",a);mygis.Admin.UI.menuClick(null,
"amenu_Maps_Config")},getCurrentExtent:function(){var a=digimap.getExtent().toBBOX();$("#editMapExtent").val(a)},getCurrentCenter:function(){var a=digimap.getCenter().toShortString();$("#editMapCenter").val(a)},getCurrentZoom:function(){var a=digimap.getZoom();$("#editMapZoom").val(a)},replaceMapThumbDialog:function(){internalConfig.mmCallback.fn=mygis.Admin.MapManager.Maps.newMapThumbSelected;internalConfig.mmCallback.objectCount=1;internalConfig.mmCallback.object={};showMediaManager()},newMapThumbSelected:function(a){var b;
b=this[0];!a||"ok"!=a?a&&displayError(a):(a=mygis.Admin.MapManager.updateConfig,a.mapThumb.changed=!0,a.mapThumb.newValue=b.fileID,b=mygis.Utilities.format("{0}GetImage.ashx?qType=userFile&qContents={1}",config.folderPath,b.fileID),document.getElementById("editMapThumb").src=b+"&qSize=120",mygis.Admin.MapManager.notifyUnsaved())},replaceMapThumbAuto:function(a){var b=mygis.Admin.MapManager.updateConfig,a=a?a:b.mapExtent.newValue?b.mapExtent.newValue:b.mapExtent.oldValue;internalConfig.mapThumbPreviousBox=
a;for(var c=digimap.projection.toString(),d=[],e=0;e<b.layers.length;e++){var f=JSON.parse(b.layers[e].oldValue);d.push(f.layerTABLE)}b=mygis.Utilities.format("{0}wms?service=WMS&version=1.1.0&request=GetMap&layers={1}&styles=&bbox={2}&width={3}&height={3}&srs={4}&format={5}&TILED=TRUE&TRANSPARENT=TRUE",config.mapserver,d.join(","),a,120,c,"image/png");$("#editMapThumb").bind("load",function(){$("#editMapThumb").unbind("load");var a=document.getElementById("editMapThumb"),b=document.createElement("canvas");
b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a,0,0);a=mygis.Admin.MapManager.updateConfig;a.mapThumb.changed=!0;a.mapThumb.newValue=b.toDataURL();a.mapThumb.oldValue="fromData";mygis.Admin.MapManager.Maps.mapThumbSelector();mygis.Utilities.unblockUI();mygis.Admin.MapManager.notifyUnsaved()});document.getElementById("editMapThumb").src=b},mapThumbSelector:function(){$("#editMapThumb").Jcrop({onSelect:mygis.Admin.MapManager.Maps.mapThumbSelectorChanged,aspectRatio:1},function(){internalConfig.mapThumbCropper=
this})},mapThumbSelectorChanged:function(a){var b=a.x,c=a.x2,d=a.y,e=a.y2;internalConfig.mapThumbCropper.destroy();$("#editMapThumb").css({display:"inline-block",visibility:"visible"});var f=internalConfig.mapThumbPreviousBox,f=f.split(","),a=[],g=parseFloat(f[2])-parseFloat(f[0]),h=parseFloat(f[3])-parseFloat(f[1]),g=g/120,h=h/120,b=parseFloat(f[0])+g*b,c=parseFloat(f[0])+g*c,e=parseFloat(f[1])+h*(120-e),d=parseFloat(f[1])+h*(120-d);a.push(b);a.push(e);a.push(c);a.push(d);mygis.Admin.MapManager.Maps.replaceMapThumbAuto(a.join(","))},
inputChanged:function(a){var a=a.currentTarget,b=mygis.Admin.MapManager.updateConfig,c;switch(a.id){case "editMapName":c=b.mapName;break;case "editMapDescription":c=b.mapDescription;break;case "editMapExtent":c=b.mapExtent;break;case "editMapCenter":c=b.mapCenter;break;case "editMapZoom":c=b.mapZoom;break;case "editMapDeveloper":c=b.mapDeveloped;break;case "editMapOwner":c=b.mapOwner;break;case "editMapDefaultBG":c=b.mapDefaultBG}c.changed=!0;c.newValue="editMapDefaultBG"==a.id?$(a).find("option:selected")[0].value:
a.value;mygis.Admin.MapManager.notifyUnsaved()}},Layers:{moveUp:function(){var a=$("#mapLayerList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes")[0],d=0>c-1?b.length-1:c-1,b=mygis.Utilities.arrayMove(b,c,c-1);a.jqxGrid("refreshdata");a.jqxGrid("unselectrow",c);a.jqxGrid("selectrow",d);mygis.Admin.MapManager.setConfigLayers(b,!0);mygis.Admin.MapManager.notifyUnsaved()},moveDown:function(){var a=$("#mapLayerList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes")[0],
d=c+1>=b.length-1?0:c+1,b=mygis.Utilities.arrayMove(b,c,c+1);a.jqxGrid("refreshdata");a.jqxGrid("refreshdata");a.jqxGrid("unselectrow",c);a.jqxGrid("selectrow",d);mygis.Admin.MapManager.setConfigLayers(b,!0);mygis.Admin.MapManager.notifyUnsaved()},deleteLayer:function(){for(var a=$("#mapLayerList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),d=!1,b=[],e=mygis.Admin.MapManager.updateConfig.layers,f=0;f<e.length;f++)e[f].newValue&&-1<c.indexOf(f)?(a.jqxGrid("deleterow",c[c.indexOf(f)]),
c.splice(c.indexOf(f),1)):b.push(e[f]);mygis.Admin.MapManager.updateConfig.layers=b;a.jqxGrid("refreshdata");b=a.jqxGrid("source").records;for(f=0;f<c.length;f++)d=mygis.Admin.MapManager.updateConfig.layers[c[f]],e=$.extend({},b[c[f]]),e.layerID=-1,d.newValue=JSON.stringify(e),d=d.changed=!0,a.jqxGrid("deleterow",c[f]);d&&(mygis.Admin.MapManager.notifyUnsaved(),a.jqxGrid("clearselection"),a.jqxGrid("refreshdata"),mygis.Admin.MapManager.Layers.layerUnselected());mygis.Admin.MapManager.Layers.layerUnselected()},
addMapLayer:function(){var a=mygis.Admin.UI.dialogConfig;a.checkfn=mygis.Admin.MapManager.Layers.addLayerCheck;a.callbackfn=mygis.Admin.MapManager.Layers.addLayerResult;a.objectCount=1;a.windowTitle="#layerManager";for(var a=$("#mapLayerList").jqxGrid("source").records,b="",c=0;c<a.length;c++)0<c&&(b+="%23"),b+=a[c].id;showLayerManager(b)},showAddLayer:function(a){a||$("#layerManager").dialog({autoOpen:!1,modal:!0,resizable:!1,width:900,height:510,title:strings.MapManager.window_LayerManager,closeOnEscape:!1});
mygis.Admin.MapManager.Layers.createPotentialLayerGrid();$("#layerManager").dialog("open");null==mygis.Admin.UI.dialogConfig.callbackfn?$("#layerManagerDialogButtons").hide():$("#layerManagerDialogButtons").show();$("#ui-dialog-title-layerManager").parent().css({background:"url('"+config.folderPath+"Images/administration/menu/icon-16-banner.png') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"})},addLayerCheck:function(){var a=!1,b=$("#layerManagerList"),c=mygis.Admin.UI.dialogConfig,d=
b.jqxGrid("getselectedrowindexes"),e=c.objectCount;if(d.length>=e&&-1<e){a=[];for(e=0;e<d.length;e++)a.push(b.jqxGrid("getrowdata",d[e]));c.object=a;a=!0}else alert(mygis.Utilities.format(strings.LayerControl.err_notEnoughSelected,e));return a},addLayerResult:function(a){if("ok"==a){a=$("#mapLayerList");a.jqxGrid("source");for(var b=mygis.Admin.MapManager.updateConfig,c=0;c<this.length;c++){var d=this[c],d={layerSelected:!1,layerID:d.layerID,layerNAME:d.layerNAME,layerDESCRIPTION:d.layerDESCRIPTION,
layerTABLE:d.layerTABLE,hidden:d.hidden,Editable:d.Editable,Selectable:d.Selectable,Locked:d.Locked,layerMinScale:d.layerMinScale,layerMaxScale:d.layerMaxScale,layerGeomType:d.layerGeomType,layerEXTENTS:"",manualVisibility:!1,layerORDER:"",folderName:d.folderName};a.jqxGrid("addrow",null,d);d={changed:!0,oldValue:null,newValue:JSON.stringify(d)};b.layers.push(d)}mygis.Admin.MapManager.notifyUnsaved();a.jqxGrid("refreshdata")}},createPotentialLayerGrid:function(){var a=mygis.Admin.MapManager.Layers.createPotentialLayerGridSource(),
b=$("#layerManagerList"),c={groupsheaderstring:strings.Grid.groupsheaderstring,sortascendingstring:strings.Grid.sortascendingstring,sortdescendingstring:strings.Grid.sortdescendingstring,sortremovestring:strings.Grid.sortremovestring,groupbystring:strings.Grid.groupbystring,groupremovestring:strings.Grid.groupremovestring};b.jqxGrid({source:a,width:880,height:414,autoheight:!1,theme:"pk-mg-jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"layerSelected",width:45,renderer:function(){return mygis.Utilities.format("<div style='text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;'><input id='adminSelectAllApps' type='checkbox' onclick='{0}'{1}/></div>",
"","")},columntype:"checkbox"},{text:strings.LayerControl.layergrid_colName,datafield:"layerNAME",editable:!1},{text:strings.LayerControl.layergrid_colTableApp,datafield:"layerAppOrigin",editable:!1,width:140},{text:strings.LayerControl.layergrid_colTable,datafield:"layerTABLE",editable:!1,width:200},{text:strings.LayerControl.layergrid_colGeom,datafield:"layerGeomType",editable:!1,width:200,cellsrenderer:function(a,b,c){var g,a=this.owner.getrowdata(a);switch(b){case "layerNAME":g=mygis.Utilities.format("<div class='imageVerticalContainer'><a href='#' onclick='{1}'>{0}</a></div>",
c,h);break;case "layerTABLE":c=c.split("_")[0];g=mygis.Utilities.format("<span style='{0}'>{1}</span>","width: 96%; margin: 6px 5px; float: left;",c);break;case "layerGeomType":var h="return false;",b="";switch(c){case "Point":b=strings.LayerControl.layergrid_colPoints;g=a.layerPoints;b=mygis.Utilities.format("{0}: {1}",b,g);break;case "Line":b=strings.LayerControl.layergrid_colLines;g=a.layerLines;b=mygis.Utilities.format("{0}: {1}",b,g);break;case "Polygon":b=strings.LayerControl.layergrid_colPolygons;
g=a.layerPolygons;b=mygis.Utilities.format("{0}: {1}",b,g);break;case "Mixed":var b=strings.LayerControl.layergrid_colPoints,k=strings.LayerControl.layergrid_colLines,l=strings.LayerControl.layergrid_colPolygons;g=a.layerPoints;b=mygis.Utilities.format("{0}: {1}, {2}: {3}, {4}: {5}",b,g,k,a.layerLines,l,a.layerPolygons)}g=mygis.Utilities.format("<span title='{2}' style='width: 96%; margin:6px 5px; float: left;'><a href='#' onclick='{1}' title='{2}'>{0}</a></span>",c,h,b)}return g}}],enableanimations:!1,
showheader:!0,columnsmenu:!1,editable:!0,groupable:!0,showgroupsheader:!0,selectionmode:"none"});b.jqxGrid("localizestrings",c);b.bind("cellendedit",mygis.Admin.MapManager.Layers.potentialLayer_checkClicked)},createPotentialLayerGridSource:function(){var a;a=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"layerSelected",type:"boolean"},{name:"layerID"},{name:"layerNAME"},{name:"layerDESCRIPTION"},{name:"layerTABLE"},{name:"layerAppOrigin"},{name:"hidden"},{name:"Editable"},{name:"Selectable"},
{name:"Locked"},{name:"layerMinScale"},{name:"layerMaxScale"},{name:"layerGeomType"},{name:"layerPoints"},{name:"layerLines"},{name:"layerPolygons"}],id:"adminPotentialLayerList",url:config.mgreq+"?qtype=GetPotentialLayers"},{async:!1});a.dataBind();return a},potentialLayer_checkClicked:function(a){var b=$("#layerManagerList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},potentialLayer_allCheckClicked:function(a){var b=$("#layerManagerList"),c=b.jqxGrid("source").records,
d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].layerSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].layerSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},createLayerGrid:function(a){mygis.Utilities.blockUI();var a=mygis.Admin.MapManager.Layers.createLayerGridSource(a),b=$("#mapLayerList"),c=function(){var a=$("#mapLayerList"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?' checked="checked"':
"";return retobject=mygis.Utilities.format("<div style='text-align: center; margin-top: 5px;position: absolute;left: 8px;z-index: 1;'><input id='map_selectAllLayers' type='checkbox' onclick='{0}'{1}/></div>",'router("mapLayerAllClick",this);',a)};0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"layerSelected",width:22,columntype:"checkbox",renderer:c},{text:strings.LayerControl.layergrid_colName,datafield:"layerNAME",
editable:!1},{text:strings.LayerControl.layergrid_colDescription,datafield:"layerDESCRIPTION",editable:!1},{text:strings.LayerControl.layergrid_colTable,datafield:"layerTABLE",editable:!1},{text:strings.LayerControl.layergrid_colFolder,datafield:"folderName",editable:!0},{text:strings.LayerControl.layergrid_colGeom,datafield:"layerGeomType",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",
altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"layerSelected",width:22,columntype:"checkbox",renderer:c},{text:strings.LayerControl.layergrid_colName,datafield:"layerNAME",editable:!1},{text:strings.LayerControl.layergrid_colDescription,datafield:"layerDESCRIPTION",editable:!1},{text:strings.LayerControl.layergrid_colTable,datafield:"layerTABLE",editable:!1},{text:strings.LayerControl.layergrid_colFolder,datafield:"folderName",editable:!0},{text:strings.LayerControl.layergrid_colGeom,
datafield:"layerGeomType",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.MapManager.Layers.layerSelected);b.bind("rowunselect",mygis.Admin.MapManager.Layers.layerUnselected);b.bind("cellendedit",mygis.Admin.MapManager.Layers.layerCheckClicked);mygis.Utilities.unblockUI()},createLayerGridSource:function(a){a=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"layerSelected",type:"boolean"},{name:"layerID"},{name:"layerNAME"},
{name:"layerDESCRIPTION"},{name:"layerTABLE"},{name:"layerORDER"},{name:"layerEXTENTS"},{name:"hidden"},{name:"Editable"},{name:"Selectable"},{name:"Locked"},{name:"layerMinScale"},{name:"layerMaxScale"},{name:"manualVisibility"},{name:"layerGeomType"},{name:"folderName"}],id:"adminLayerList",url:config.mgreq+"?qtype=GetLayerList&qContents="+a},{async:!1});a.dataBind();mygis.Admin.MapManager.setConfigLayers(a.records);return a},layerSelected:function(){var a=$("#mapLayerList"),b=a.jqxGrid("getselectedrowindexes");
1<b.length?(document.getElementById("map_layerUpBtn").ex_HasClassName("disabled")||document.getElementById("map_layerUpBtn").ex_AddClassName("disabled"),document.getElementById("map_layerDownBtn").ex_HasClassName("disabled")||document.getElementById("map_layerDownBtn").ex_AddClassName("disabled")):(document.getElementById("map_layerUpBtn").ex_RemoveClassName("disabled"),document.getElementById("map_layerDownBtn").ex_RemoveClassName("disabled"));document.getElementById("map_layerDeleteBtn").ex_RemoveClassName("disabled");
b.length==a.jqxGrid("source").records.length?document.getElementById("map_selectAllLayers").checked=!0:document.getElementById("map_selectAllLayers").checked=!1},layerUnselected:function(){var a=$("#mapLayerList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("map_layerUpBtn").ex_HasClassName("disabled")||document.getElementById("map_layerUpBtn").ex_AddClassName("disabled"),document.getElementById("map_layerDownBtn").ex_HasClassName("disabled")||document.getElementById("map_layerDownBtn").ex_AddClassName("disabled"),
document.getElementById("map_layerDeleteBtn").ex_RemoveClassName("disabled")):1==b.length?(document.getElementById("map_layerUpBtn").ex_RemoveClassName("disabled"),document.getElementById("map_layerDownBtn").ex_RemoveClassName("disabled"),document.getElementById("map_layerDeleteBtn").ex_RemoveClassName("disabled")):(document.getElementById("map_layerUpBtn").ex_HasClassName("disabled")||document.getElementById("map_layerUpBtn").ex_AddClassName("disabled"),document.getElementById("map_layerDownBtn").ex_HasClassName("disabled")||
document.getElementById("map_layerDownBtn").ex_AddClassName("disabled"),document.getElementById("map_layerDeleteBtn").ex_HasClassName("disabled")||document.getElementById("map_layerDeleteBtn").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("map_selectAllLayers").checked=!0:document.getElementById("map_selectAllLayers").checked=!1},layerCheckClicked:function(a){var b=$("#mapLayerList");switch(a.args.datafield){case "folderName":var b=$("#mapLayerList"),
c=b.jqxGrid("getrowdata",a.args.rowindex);c.folderName=a.args.value;b.jqxGrid("updaterow",b.jqxGrid("getrowid",a.args.rowindex),c);a=b.jqxGrid("source").records;mygis.Admin.MapManager.setConfigLayers(a,!0);mygis.Admin.MapManager.notifyUnsaved();break;case "layerSelected":a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)}},layerAllCheckClicked:function(a){var b=$("#mapLayerList"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=
0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].layerSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].layerSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")}},Permissions:{},Macros:{showEditMacro:function(a){var b,c=mygis.Admin.UI.dialogConfig;a?($("#editMacroActionsTitle").attr("class","newMacro"),b=strings.MapManager.window_NewMacro):($("#editMacroActionsTitle").attr("class","editMacro"),b=strings.MapManager.window_EditMacro);$("#editMacroTitleElem").html(b);c.checkfn=
mygis.Admin.MapManager.Macros.editMacroCheck;c.callbackfn=mygis.Admin.MapManager.Macros.editMacroResult;c.objectCount=-1;c.windowTitle="#editMacroPop";var d;a||(b=$("#mapMacroList"),a=b.jqxGrid("source").records,b=b.jqxGrid("getselectedrowindexes"),d=a[b[0]],c.objectCount=d.id);$("#editMacroPop").dialog({autoOpen:!0,modal:!0,resizable:!1,width:900,height:510,title:strings.MapManager.window_MacroManager,closeOnEscape:!1});$("#ui-dialog-title-editMacroPop").parent().css({background:"url('"+config.folderPath+
"Images/Administration/header/icon-48-cpanel.png') #F6A828 no-repeat 14px 5px","background-size":"auto 18px"});mygis.Admin.MapManager.Macros.setupMacroWindow(d)},setupMacroWindow:function(a){singleQTip("tip_MacroName",[strings.MapManager.macroTip_name]);singleQTip("tip_MacroSelector",[strings.MapManager.macroTip_jselector]);singleQTip("tip_MacroButton",[strings.MapManager.macroTip_button]);singleQTip("tip_MacroRegistered",[strings.MapManager.macroTip_registered]);singleQTip("tip_MacroApp",[strings.MapManager.macroTip_app]);
a?($("#appSetting_MacroName").val(a.name),$("#appSetting_parentSelector").val(a.parentSelector),$("#appSetting_IsButton").attr("checked",a.isButton),$("#appSetting_IsForRegistered").attr("checked",a.isForRegistered),$("#macroCommandsEditor").val(a.commands.replace(/\%/g,",").replace(/\#/g,"\r\n")),$("#macroContainerStyle").val(a.cont_css.replace(/\;/g,";\r\n")),$("#macroBtnStyle").val(a.btn_css.replace(/\;/g,";\r\n"))):($("#appSetting_MacroName").val(""),$("#appSetting_parentSelector").val(""),$("#appSetting_IsButton").attr("checked",
!0),$("#appSetting_IsForRegistered").attr("checked",!1),$("#macroCommandsEditor").val(""),$("#macroContainerStyle").val(""),$("#macroBtnStyle").val(""));var b=[],c=0,d=-1;$.each($("#myAppGrid").jqxGrid("source").records,function(e,f){var g={name:f.appName,value:f.appID};a&&a.appID==f.appID&&(d=c);c++;b.push(g)});mygis.Utilities.populateSelect(document.getElementById("appsetting_chooseMacroApp"),b,!0);a&&-1<d&&$("#appsetting_chooseMacroApp option").eq(d).attr("selected","selected")},editMacroCheck:function(){$("#mapMacroList");
var a=mygis.Admin.UI.dialogConfig,b;b=[];var c={macroSelected:!1,macroID:-1,mapID:mygis.Admin.MapManager.updateConfig.mapID,appID:$("#appsetting_chooseMacroApp").val(),name:$("#appSetting_MacroName").val(),commands:$("#macroCommandsEditor").val().replace(/\r\n/g,"#").replace(/\,/g,"%"),parentSelector:$("#appSetting_parentSelector").val(),cont_css:$("#macroContainerStyle").val().replace(/\r\n/g,""),btn_css:$("#macroBtnStyle").val().replace(/\r\n/g,""),options:null,isButton:$("#appSetting_IsButton").is(":checked"),
isForRegistered:$("#appSetting_IsForRegistered").is(":checked")};b.push(c);a.object=b;return!0},editMacroResult:function(a){if("ok"==a){a=$("#mapMacroList");a.jqxGrid("source");for(var b=mygis.Admin.MapManager.updateConfig,c=0;c<this.length;c++){var d=this[c];a.jqxGrid("addrow",null,d);d={changed:!0,oldvalue:null,newValue:JSON.stringify(d)};b.macros.push(d)}mygis.Admin.MapManager.notifyUnsaved();a.jqxGrid("refreshdata")}},deleteMacros:function(){for(var a=$("#mapMacroList"),b=a.jqxGrid("source").records,
c=a.jqxGrid("getselectedrowindexes"),d=!1,e=0;e<c.length;e++){var f=b[c[e]],g=mygis.Admin.MapManager.updateConfig.macros[c[e]];g.newValue?(b.splice(c[e],1),mygis.Admin.MapManager.updateConfig.macros.splice(c[e],1)):(d=$.extend({},f),d.id=-1,g.newValue=JSON.stringify(d),d=g.changed=!0,b.splice(c[e],1))}d&&(mygis.Admin.MapManager.notifyUnsaved(),a.jqxGrid("refreshdata"))},switchToTab:function(a){for(var b=$("#editMacroLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=a?b[c].ex_RemoveClassName("active"):
b[c].ex_AddClassName("active");b=$("#editMacroTab").find(".appSettingFrame");for(c=0;c<b.length;c++)c!=a?$(b[c]).hide():$(b[c]).show()},createMacroGrid:function(a){mygis.Utilities.blockUI();var a=mygis.Admin.MapManager.Macros.createMacroGridSource(a),b=$("#mapMacroList");b.bind("bindingcomplete",function(){mygis.Admin.MapManager.setConfigMacros($("#mapMacroList").jqxGrid("source").records)});var c=function(){var a=$("#mapMacroList"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?
' checked="checked"':"";return mygis.Utilities.format("<div style='{2}'><input id='adminSelectAllMacros' type='checkbox' onclick='{0}'{1}/></div>",'router("adminMacroAllClick",this);',a,"text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;")},d=function(a,b,c){var d;switch(b){case "isButton":case "isForRegistered":d=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 25px;line-height:25px;'><a href='#' class='btnTickCheck{0}'></a></div>",c?" checked":
"")}return d};0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"sel",datafield:"macroSelected",width:45,columntype:"checkbox",renderer:c},{text:strings.MapManager.macroGrid_colID,datafield:"macroID",editable:!1},{text:strings.MapManager.macroGrid_colName,datafield:"name",editable:!1},{text:strings.MapManager.macroGrid_colApp,datafield:"appID",editable:!1},{text:strings.MapManager.macroGrid_colBtn,datafield:"isButton",editable:!1,
cellsrenderer:d},{text:strings.MapManager.macroGrid_colRegister,datafield:"isForRegistered",editable:!1,cellsrenderer:d}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"sel",datafield:"macroSelected",width:45,columntype:"checkbox",renderer:c},{text:strings.MapManager.macroGrid_colID,datafield:"macroID",editable:!1},{text:strings.MapManager.macroGrid_colName,
datafield:"name",editable:!1},{text:strings.MapManager.macroGrid_colApp,datafield:"appID",editable:!1},{text:strings.MapManager.macroGrid_colBtn,datafield:"isButton",editable:!1,cellsrenderer:d},{text:strings.MapManager.macroGrid_colRegister,datafield:"isForRegistered",editable:!1,cellsrenderer:d}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.MapManager.Macros.macroSelected);b.bind("rowunselect",mygis.Admin.MapManager.Macros.macroUnselected);
b.bind("cellendedit",mygis.Admin.MapManager.Macros.singleCheckClick);mygis.Utilities.unblockUI()},createMacroGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"macroSelected"},{name:"macroID"},{name:"mapID"},{name:"appID"},{name:"name"},{name:"commands"},{name:"parentSelector"},{name:"cont_css"},{name:"btn_css"},{name:"options"},{name:"isButton",type:"boolean"},{name:"isForRegistered",type:"boolean"}],id:"macroEditSource",url:config.folderPath+"mgreq.ashx?qtype=GetMapMacros&qContents="+
a},{async:!1})},refreshMacroGrid:function(){$("#mapMacroList").jqxGrid("updatebounddata")},macroSelected:function(){var a=$("#mapMacroList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?document.getElementById("map_editMacrobtn").ex_HasClassName("disabled")||document.getElementById("map_editMacrobtn").ex_AddClassName("disabled"):document.getElementById("map_editMacrobtn").ex_HasClassName("disabled")&&document.getElementById("map_editMacrobtn").ex_RemoveClassName("disabled");document.getElementById("map_deleteMacrobtn").ex_HasClassName("disabled")&&
document.getElementById("map_deleteMacrobtn").ex_RemoveClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllMacros").checked=!0:document.getElementById("adminSelectAllMacros").checked=!1},macroUnselected:function(){var a=$("#mapMacroList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("map_editMacrobtn").ex_HasClassName("disabled")||document.getElementById("map_editMacrobtn").ex_AddClassName("disabled"),document.getElementById("map_deleteMacrobtn").ex_HasClassName("disabled")&&
document.getElementById("map_deleteMacrobtn").ex_RemoveClassName("disabled")):1==b.length?(document.getElementById("map_editMacrobtn").ex_HasClassName("disabled")&&document.getElementById("map_editMacrobtn").ex_RemoveClassName("disabled"),document.getElementById("map_deleteMacrobtn").ex_HasClassName("disabled")&&document.getElementById("map_deleteMacrobtn").ex_RemoveClassName("disabled")):(document.getElementById("map_editMacrobtn").ex_HasClassName("disabled")||document.getElementById("map_editMacrobtn").ex_AddClassName("disabled"),
document.getElementById("map_deleteMacrobtn").ex_HasClassName("disabled")||document.getElementById("map_deleteMacrobtn").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("adminSelectAllMacros").checked=!0:document.getElementById("adminSelectAllMacros").checked=!1},singleCheckClick:function(a){var b=$("#mapMacroList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},allCheckClicked:function(a){var b=$("#mapMacroList"),
c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].macroSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].macroSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")},showPopupWizard:function(){$("#popupWiz").dialog({autoOpen:!0,modal:!1,resizable:!1,width:600,height:510,title:strings.MapManager.macroPopup_window,closeOnEscape:!1,draggable:!0,position:"center"});$("#popupWiz_id").bind("propertychange keyup input paste",
mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_header").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_width").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_height").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_position").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
$("#popupWiz_dispHeader").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_dispClose").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_isMovable").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput);$("#popupWiz_textArea").bind("propertychange keyup input paste",mygis.Admin.MapManager.Macros.updatePopupWizardOutput)},updatePopupWizardOutput:function(){var a=
$("#popupWiz_id").val(),b=$("#popupWiz_header").val(),c=$("#popupWiz_width").val(),d=$("#popupWiz_height").val(),e=$("#popupWiz_position").val(),f=$("#popupWiz_dispHeader").is(":checked"),g=$("#popupWiz_dispClose").is(":checked"),h=$("#popupWiz_isMovable").is(":checked"),k=$("#popupWiz_textArea").val(),a=mygis.Utilities.format("mygis.UI.Help.createPopup('{0}','{1}','{2}',{3},{4},{5},'{6}',[{7},{8}]);",a,k,b,f,g,h,e,c,d);$("#popupWiz_output").val(a)},copyPopupOutput:function(){var a=$("#popupWiz_id").val(),
b=$("#popupWiz_header").val(),c=$("#popupWiz_width").val(),d=$("#popupWiz_height").val(),e=$("#popupWiz_position").val(),f=$("#popupWiz_dispHeader").is(":checked"),g=$("#popupWiz_dispClose").is(":checked"),h=$("#popupWiz_isMovable").is(":checked"),k=$("#popupWiz_textArea").val(),a=mygis.Utilities.format("'{0}','{1}','{2}',{3},{4},{5},'{6}',[{7},{8}]",a,k,b,f,g,h,e,c,d);$("#macroCommandsEditor").val($("#macroCommandsEditor").val()+"\r\nmygis.UI.Help.createPopup,"+a);$("#popupWiz").dialog("close")},
testPopupOutput:function(){var a=$("#popupWiz_output").val();try{(new Function(a))()}catch(b){alert("Error in syntax. Have you filled in all the fields?")}}},QuickSearches:{showEditQS:function(a){var b,c=mygis.Admin.UI.dialogConfig;a?($("#editQSActionsTitle").attr("class","newQS"),b=strings.MapManager.window_NewQS):($("#editQSActionsTitle").attr("class","editQS"),b=strings.MapManager.window_EditQS);$("#editQSTitleELem").html(b);c.checkfn=mygis.Admin.MapManager.QuickSearches.editQSCheck;c.callbackfn=
mygis.Admin.MapManager.QuickSearches.editQSResult;c.objectCount=-1;c.windowTitle="#editQSPop";a?(a={mapID:mygis.Admin.MapManager.updateConfig.mapID,quickID:-1},mygis.Admin.MapManager.QuickSearches.setupEditQSButtons(a)):(b=$("#mapHotSearchList"),a=b.jqxGrid("source").records,b=b.jqxGrid("getselectedrowindexes"),a=a[b[0]],mygis.Admin.MapManager.QuickSearches.setupEditQSButtons(a),c.objectCount=a.id);$("#editQSPop").dialog({autoOpen:!0,modal:!0,resizable:!1,width:900,height:510,title:strings.MapManager.window_QSManager,
closeOnEscape:!1});$("#ui-dialog-title-editQSPop").parent().css({background:"url('"+config.folderPath+"Images/Administration/header/icon-48-cpanel.png') #F6A828 no-repeat 14px 5px","background-size":"auto 18px"})},setupEditQSButtons:function(a){$("#qs_quickID").val(a.quickID);mygis.Admin.MapManager.QuickSearches.qsLoadLayers(a.mapID,a);if(-1!=a.quickID){switch(a.searchType){case "distinct":$("#editQSTab input[name='qs_layerSearchType']")[0].checked="checked";break;case "input":$("#editQSTab input[name='qs_layerSearchType']")[1].checked=
"checked";break;case "customSQL":$("#editQSTab input[name='qs_layerSearchType']")[2].checked="checked"}switch(a.searchLayout){case "checkbox":$("#editQSTab input[name='qs_searchLayout']")[0].checked="checked";break;case "dropdown":$("#editQSTab input[name='qs_searchLayout']")[1].checked="checked"}switch(a.searchMode){case "auto":$("#editQSTab input[name='qs_searchMode']")[0].checked="checked";break;case "buttons":$("#editQSTab input[name='qs_searchMode']")[1].checked="checked"}$("#qs_windowTitle").val(a.windowTitle)}},
qsLoadLayers:function(a,b){var c=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"layerID"},{name:"layerNAME"},{name:"layerTABLE"}],id:"qsLayers",url:config.folderPath+"mgreq.ashx?qtype=GetLayerList&qContents="+a},{loadComplete:function(){for(var a=c.records,e=[],f=-1,g=0;g<a.length;g++){var h=a[g],k={};k.name=h.layerNAME;k.value=h.layerTABLE;e.push(k);b&&b.layername==h.layerTABLE&&(f=g)}mygis.Utilities.populateSelect($("#qs_layernameInp")[0],e);-1<f&&(document.getElementById("qs_layernameInp").selectedIndex=
f+1,mygis.Admin.MapManager.QuickSearches.qsLoadFields(b))}});c.dataBind();$("#qs_layernameInp").bind("change",mygis.Admin.MapManager.QuickSearches.qsLoadFields)},qsLoadFields:function(a){var b=document.getElementById("qs_layernameInp");0<b.selectedIndex&&(b=config.mgreq+"?qtype=GetLayerFields&qContents="+escape(b.options[b.selectedIndex].value.replace(/ /g,"_")),$.ajax({type:"GET",url:b,success:function(b){var d=document.getElementById("qs_layerfieldInp"),b=mygis.Query.resultLayerDetails(b);mygis.Utilities.populateSelect(d,
b);a&&$("#qs_layerfieldInp option:contains('"+a.fieldname+"')").attr("selected","selected")}}))},editQSCheck:function(){var a=!1,b=0<$("#qs_layernameInp")[0].selectedIndex,c=0<$("#qs_layerfieldInp")[0].selectedIndex,d=""!=$("#qs_windowTitle").val();b&&c&&d?(a=!0,mygis.Admin.UI.dialogConfig.object={layername:$("#qs_layernameInp").val(),fieldname:$("#qs_layerfieldInp").val().split("%")[0],searchType:$("#editQSTab input[name='qs_layerSearchType']:checked").val(),searchOperator:$("#qs_searchOp").val(),
searchLayout:$("#editQSTab input[name='qs_searchLayout']:checked").val(),searchMode:$("#editQSTab input[name='qs_searchMode']:checked").val(),windowTitle:$("#qs_windowTitle").val(),mapID:mygis.Admin.MapManager.updateConfig.mapID,quickID:$("#qs_quickID").val()}):b?c?d||alert(strings.MapManager.qsNew_err_NoTitle):alert(strings.MapManager.qsNew_err_NoField):alert(strings.MapManager.qsNew_err_NoLayer);return a},editQSResult:function(){var a=JSON.stringify(this),b=config.mgreq+"?qtype=CreateNewQS",c={};
c.qContents=a;mygis.Utilities.blockUI();$.ajax({type:"POST",data:c,url:b,success:function(a){try{var b=eval("("+a+")");"success"==b.iotype?(mygis.Admin.MapManager.QuickSearches.refreshQSGrid(),displaySuccess(strings.MapManager.qsNew_msg_Success)):displayError(b.iomsg)}catch(c){console.log(c.message)}mygis.Utilities.unblockUI()}})},directQSEdit:function(a){var b=$("#mapHotSearchList");b.jqxGrid("clearselection");b.jqxGrid("selectrow",a);mygis.Admin.MapManager.QuickSearches.qsSelected();mygis.Admin.MapManager.QuickSearches.showEditQS(!1)},
deleteQS:function(){for(var a=$("#mapHotSearchList"),b=a.jqxGrid("source").records,c=a.jqxGrid("getselectedrowindexes"),d=!1,e=0;e<c.length;e++){var d=mygis.Admin.MapManager.updateConfig.quickSearches[c[e]],f=$.extend({},b[c[e]]);f.quickID=-1;d.newValue=JSON.stringify(f);d=d.changed=!0;b.splice(c[e],1)}d&&(mygis.Admin.MapManager.notifyUnsaved(),a.jqxGrid("clearselection"),a.jqxGrid("refreshdata"),mygis.Admin.MapManager.QuickSearches.qsUnselected())},createQSGrid:function(a){mygis.Utilities.blockUI();
var a=mygis.Admin.MapManager.QuickSearches.createQSGridSource(a),b=$("#mapHotSearchList");b.bind("bindingcomplete",function(){mygis.Admin.MapManager.setConfigQS($("#mapHotSearchList").jqxGrid("source").records)});var c=function(){var a=$("#mapHotSearchList"),a=a.jqxGrid("getselectedrowindexes").length==a.jqxGrid("source").records.length?' checked="checked"':"";return retobject=mygis.Utilities.format("<div style='text-align: center; margin-top: 5px;position: absolute;left: 8px;z-index: 1;'><input id='map_selectAllQS' type='checkbox' onclick='{0}'{1}/></div>",
'router("mapQSAllClick",this);',a)},d=function(a,b,c){var d;switch(b){case "windowTitle":a=mygis.Utilities.format('router("qsTitleClick",{0});',a),d=mygis.Utilities.format("<div class='imageVerticalContainer'><a href='#' onclick='{1}'>{0}</a></div>",c,a)}return d};0<a.records.length?b.jqxGrid({source:a,width:"100%",autoheight:!0,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"qsSelected",width:22,columntype:"checkbox",renderer:c},{text:strings.MapManager.qsGrid_colWindowName,
datafield:"windowTitle",editable:!1,cellsrenderer:d},{text:strings.MapManager.qsGrid_colLayerName,datafield:"layername",editable:!1},{text:strings.MapManager.qsGrid_colFieldName,datafield:"fieldname",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"}):b.jqxGrid({source:a,width:"100%",autoheight:!1,height:200,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"qsSelected",width:22,columntype:"checkbox",renderer:c},{text:strings.MapManager.qsGrid_colWindowName,
datafield:"windowTitle",editable:!1,cellsrenderer:d},{text:strings.MapManager.qsGrid_colLayerName,datafield:"layername",editable:!1},{text:strings.MapManager.qsGrid_colFieldName,datafield:"fieldname",editable:!1}],enableanimations:!1,showheader:!0,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.MapManager.QuickSearches.qsSelected);b.bind("rowunselect",mygis.Admin.MapManager.QuickSearches.qsUnselected);b.bind("cellendedit",mygis.Admin.MapManager.QuickSearches.qsCheckClicked);
mygis.Utilities.unblockUI()},createQSGridSource:function(a){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"qsSelected",type:"boolean"},{name:"mapID"},{name:"quickID"},{name:"layername"},{name:"fieldname"},{name:"searchType"},{name:"searchOperator"},{name:"searchLayout"},{name:"searchMode"},{name:"windowTitle"},{name:"windowIcon"}],id:"asdfg",url:config.folderPath+"mgreq.ashx?qtype=GetMapQuickSearches&qContents="+a},{async:!1})},refreshQSGrid:function(){$("#mapHotSearchList").jqxGrid("updatebounddata")},
qsSelected:function(){var a=$("#mapHotSearchList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?document.getElementById("map_editQSbtn").ex_HasClassName("disabled")||document.getElementById("map_editQSbtn").ex_AddClassName("disabled"):document.getElementById("map_editQSbtn").ex_RemoveClassName("disabled");document.getElementById("map_deleteQSbtn").ex_RemoveClassName("disabled");b.length==a.jqxGrid("source").records.length?document.getElementById("map_selectAllQS").checked=!0:document.getElementById("map_selectAllQS").checked=
!1},qsUnselected:function(){var a=$("#mapHotSearchList"),b=a.jqxGrid("getselectedrowindexes");1<b.length?(document.getElementById("map_editQSbtn").ex_HasClassName("disabled")||document.getElementById("map_editQSbtn").ex_AddClassName("disabled"),document.getElementById("map_deleteQSbtn").ex_RemoveClassName("disabled")):1==b.length?(document.getElementById("map_editQSbtn").ex_RemoveClassName("disabled"),document.getElementById("map_deleteQSbtn").ex_RemoveClassName("disabled")):(document.getElementById("map_editQSbtn").ex_HasClassName("disabled")||
document.getElementById("map_editQSbtn").ex_AddClassName("disabled"),document.getElementById("map_deleteQSbtn").ex_HasClassName("disabled")||document.getElementById("map_deleteQSbtn").ex_AddClassName("disabled"));b.length==a.jqxGrid("source").records.length?document.getElementById("map_selectAllQS").checked=!0:document.getElementById("map_selectAllQS").checked=!1},qsCheckClicked:function(a){var b=$("#mapHotSearchList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},
qsAllCheckClicked:function(a){var b=$("#mapHotSearchList"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked)for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].qsSelected=!0,b.jqxGrid("selectrow",a));else for(a=0;a<c.length;a++)c[a].qsSelected=!1,b.jqxGrid("unselectrow",a);b.jqxGrid("refreshdata")}},getMapDetails:function(a){$("#myMapsGrid").jqxGrid("source")||mygis.Admin.MapManager.Maps.createMapGrid();for(var b=$("#myMapsGrid").jqxGrid("source").records,c=!1,d=0,e;!c&&
d<b.length;)a?b[d].id==a&&(c=!0,e=b[d]):b[d].id==currentMapID&&(c=!0,e=b[d]),d++;c&&(mygis.Admin.MapManager.storeMapDetails(e),document.getElementById("editMapName").value=e.mapName,document.getElementById("editMapDescription").value=e.mapDescription,document.getElementById("editMapExtent").value=e.maxExtent,document.getElementById("editMapCenter").value=e.mapCenter,document.getElementById("editMapZoom").value=e.mapZoom,document.getElementById("editMapDeveloper").value=e.mapDevelopedBy,document.getElementById("editMapOwner").value=
e.mapOwner,document.getElementById("editMapThumb").src=config.folderPath+"GetImage.ashx?qType=mapThumb&qsize=120&qContents="+e.id,mygis.Utilities.populateBGselect($("#editMapDefaultBG"),e.mapDefaultBG),mygis.Admin.MapManager.Layers.createLayerGrid(e.id))},storeMapDetails:function(a){mygis.Admin.MapManager.resetConfigObject();var b=mygis.Admin.MapManager.updateConfig;b.mapID=a.id;b.mapName.oldValue=a.mapName;b.mapDescription.oldValue=a.mapDescription;b.mapExtent.oldValue=a.maxExtent;b.mapCenter.oldValue=
a.mapCenter;b.mapZoom.oldValue=a.mapZoom;b.mapDeveloped.oldValue=a.mapDevelopedBy;b.mapOwner.oldValue=a.mapOwner;b.mapDefaultBG.oldValue=a.mapDefaultBG},setConfigLayers:function(a,b){for(var c=[],d=0;d<a.length;d++){var e={changed:b?b:!1,newValue:null,oldValue:null};e.oldValue=JSON.stringify(a[d]);c.push(e)}mygis.Admin.MapManager.updateConfig.layers=c},setConfigTags:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.MapManager.updateConfig.tags=
b},setConfigQS:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.MapManager.updateConfig.quickSearches=b},setConfigMacros:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.MapManager.updateConfig.macros=b},setConfigPermissions:function(a){for(var b=[],c=0;c<a.length;c++){var d={changed:!1,newValue:null,oldValue:null};
d.oldValue=JSON.stringify(a[c]);b.push(d)}mygis.Admin.MapManager.updateConfig.permissions=b},resetConfigObject:function(){try{document.getElementById("amenu_Maps_Config_save").ex_HasClassName("disabled")||document.getElementById("amenu_Maps_Config_save").ex_AddClassName("disabled")}catch(a){}mygis.Admin.MapManager.updateConfig=mygis.Utilities.mergeOptions(mygis.Admin.MapManager.updateConfig,{layers:[],permissions:[],macros:[],mapName:{changed:!1,oldValue:"",newValue:""},mapDescription:{changed:!1,
oldValue:"",newValue:""},mapExtent:{changed:!1,oldValue:"",newValue:""},mapCenter:{changed:!1,oldValue:"",newValue:""},mapZoom:{changed:!1,oldValue:"",newValue:""},mapDeveloped:{changed:!1,oldValue:"",newValue:""},mapOwner:{changed:!1,oldValue:"",newValue:""},mapThumb:{changed:!1,oldValue:"",newValue:""},mapDefaultBG:{changed:!1,oldValue:"",newValue:""}})},expandDetails:function(a){a=a.item;mygis.Utilities.blockUI();for(var b=$("#contentLinkTabsRound").find(".sectionHeader"),c=0;c<b.length;c++)c!=
a?b[c].ex_RemoveClassName("active"):b[c].ex_AddClassName("active");b=$("#editMapForm").find(".sectionContent");for(c=0;c<b.length;c++)if(c!=a)$(b[c]).hide();else{$(b[c]).show();var d=$(b[c]).find(".sectionButtons");$("#contentSpecificToolbar").empty();$("#contentSpecificToolbar").append(d.clone())}mygis.Admin.MapManager.createGrid(a);mygis.Utilities.unblockUI()},createGrid:function(a){var b=mygis.Admin.MapManager.updateConfig;switch(a){case 1:0==b.layers.length?mygis.Admin.MapManager.Layers.createLayerGrid(b.mapID):
$("#mapLayerList").jqxGrid("render");break;case 3:0==b.quickSearches.length?mygis.Admin.MapManager.QuickSearches.createQSGrid(b.mapID):$("#mapHotSearchList").jqxGrid("render");break;case 4:0==b.macros.length?mygis.Admin.MapManager.Macros.createMacroGrid(b.mapID):$("#mapMacroList").jqxGrid("render")}},notifyUnsaved:function(){document.getElementById("amenu_Maps_Config_save").ex_RemoveClassName("disabled");$("#amenu_Maps_Config_save").qtip({content:{text:strings.AppManager.msg_NotifyUnsaved},position:{my:"center right",
at:"center left"},show:{event:"mouseover",ready:!0,solo:!0},hide:{event:"unfocus",inactive:!1},events:{hide:function(a,b){b.destroy()}},style:{classes:"ui-tooltip-shadow",tip:{border:1},border:1}})},saveChanges:function(){var a=JSON.stringify(mygis.Admin.MapManager.updateConfig),b=config.mgreq+"?qtype=UpdateMapSettings",c={};c.qContents=a;mygis.Utilities.blockUI();$.ajax({type:"POST",data:c,url:b,success:function(a){a=eval(a);"success"==a.iotype?(mygis.Utilities.unblockUI(),mygis.Admin.MapManager.resetConfigObject(),
displaySuccess(strings.MapManager.settings_updated),setTimeout(function(){var a=$("#contentLinkTabsRound").find(".sectionHeader.active");mygis.Admin.MapManager.createGrid(a.index())},250)):displayError(a.iomsg)}})},bindManagerHandlers:function(){for(var a=0;5>a;a++){var b="";switch(a){case 0:b="mapManager_sortName";break;case 1:b="mapManager_sortLayerCount";break;case 2:b="mapManager_sortCreateDate";break;case 3:b="mapManager_sortUpdateDate";break;case 4:b="mapManager_sortOwnershipType"}$("#"+b).bind("click",
function(){mygis.Admin.MapManager.sortBy(b);return!1})}a=$("#mapManager_SearchInput");a.data("oldVal","");a.bind("focus",function(){mygis.Admin.MapManager.toggleFilterFocus(!0)});a.bind("blur",function(){mygis.Admin.MapManager.toggleFilterFocus(!1)});var c=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();a.bind("propertychange input keyup",function(){c(mygis.Admin.MapManager.filterPotentialMaps,300)});a.bind("propertychange input keyup",mygis.Admin.MapManager.toggleFilterDecoration)},
createPotentialMapGrid:function(a){var a=mygis.Admin.MapManager.createPotentialMapSource(a),b=$("#mapManagerList"),c=function(a,b,c){var g;switch(b){case "mapName":a=this.owner.getrowdata(a).mapDescription;g=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 100px;line-height:25px;'><a href='#' title='{1}' style='font-size: 11px;'>{0}</a></div>",c,a);break;case "mapOwnershipDesc":c=this.owner.getrowdata(a);a="";c.mapAmOwner&&c.mapAmCreator?a=strings.MapManager.mapOwnershipType1:
c.mapAmOwner?a=strings.MapManager.mapOwnershipType2:c.mapAmCreator?a=strings.MapManager.mapOwnershipType3:c.mapAmSubscriber?a=strings.MapManager.mapOwnershipType4:c.mapIsPublic&&(a=strings.MapManager.mapOwnershipType5);g=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 160px;line-height:25px;text-align:center;'><a href='#' title='{1}' style='font-size: 11px;'>{0}</a></div>",a,a);break;case "mapIsPublic":case "mapAmOwner":case "mapAmCreator":case "mapAmSubscriber":g=mygis.Utilities.format("<div class='imageVerticalContainer' style='width: 80px;line-height:25px;'><div class='btnToggleCheck{0}'></div></div>",
c?" checked":"")}return g};b.jqxGrid({source:a,width:760,height:294,autoheight:!1,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:[{text:"asdf",datafield:"mapSelected",width:20,columntype:"checkbox"},{text:strings.MapControl.col_mapName,datafield:"mapName",cellsrenderer:c,editable:!1},{text:strings.MapControl.col_mapLCount,datafield:"mapLayerCount",editable:!1,width:50,cellsalign:"right"},{text:strings.MapControl.col_mapCreate,datafield:"mapCreateDate",editable:!1,width:130},{text:strings.MapControl.col_mapUpdate,
datafield:"mapUpdateDate",editable:!1,width:130},{text:strings.MapControl.col_mapOwnership,datafield:"mapOwnershipDesc",editable:!1,width:160,cellsrenderer:c}],enableanimations:!1,showheader:!1,columnsmenu:!1,editable:!0,selectionmode:"none"});b.bind("rowselect",mygis.Admin.MapManager.mapSelected);b.bind("rowunselect",mygis.Admin.MapManager.mapUnselected);b.bind("cellendedit",mygis.Admin.MapManager.singleMapCheck)},createPotentialMapSource:function(a){var b=config.mgreq+"?qtype=AppAvailableMaps";
a&&(b+="&qContents="+a);return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"mapSelected",type:"boolean"},{name:"mapOwnershipDesc"},{name:"id"},{name:"mapName"},{name:"mapDescription"},{name:"mapLayerCount"},{name:"maxExtent"},{name:"mapCenter"},{name:"mapZoom"},{name:"mapCreateDate"},{name:"mapUpdateDate"},{name:"mapDevelopedBy"},{name:"mapOwner"},{name:"mapDefaultBG"},{name:"mapIsPublic",type:"boolean"},{name:"mapAmOwner",type:"boolean"},{name:"mapAmCreator",type:"boolean"},{name:"mapAmSubscriber",
type:"boolean"}],id:"adminPotentialMapList",url:b},{async:!1})},filterPotentialMaps:function(){var a=$("#mapManagerList");a.jqxGrid("clearfilters");var b=$("#mapManager_SearchInput").val(),c=parseInt($("#mapManager_filterOwnership").val()),d="1"==$("#mapManager_filterPublic").val()?!0:!1,e="1"==$("#mapManager_filterOwner").val()?!0:!1,f="1"==$("#mapManager_filterCreator").val()?!0:!1,g="1"==$("#mapManager_filterSubscriber").val()?!0:!1;if(b||-1<c||d||e||f||g){for(var h=0;6>h;h++){var k,l,m,n;switch(h){case 0:k=
b;n="mapName";l="stringfilter";m="CONTAINS";break;case 1:k=d;n="mapIsPublic";l="booleanfilter";m="EQUAL";break;case 2:k=e;n="mapAmOwner";l="booleanfilter";m="EQUAL";break;case 3:k=f;n="mapAmCreator";l="booleanfilter";m="EQUAL";break;case 4:k=g;n="mapAmSubscriber";l="booleanfilter";m="EQUAL";break;case 5:k=c,l="numericfilter",m="EQUAL",n="mapOwnershipDesc"}if(k){var o=new $.jqx.filter;if(5!=h){var q=o.createfilter(l,k,m);o.addfilter(0,q);a.jqxGrid("addfilter",n,o)}else switch(c){case 0:var q=o.createfilter(l,
1,m),t=o.createfilter(l,3,m);o.addfilter(1,q);o.addfilter(1,t);a.jqxGrid("addfilter",n,o);break;case 1:q=o.createfilter(l,2,m);t=o.createfilter(l,5,m);o.addfilter(1,q);o.addfilter(1,t);a.jqxGrid("addfilter",n,o);break;case 2:q=o.createfilter(l,4,m),o.addfilter(0,q),a.jqxGrid("addfilter",n,o)}}}mygis.Admin.MapManager.clearSelection();a.jqxGrid("applyfilters")}},sortBy:function(a){var b="",c=$("#"+a).attr("class").split(" "),d="",e="";1<c.length&&(d=c[1]);switch(a){case "mapManager_sortName":b="mapName";
break;case "mapManager_sortLayerCount":b="mapLayerCount";break;case "mapManager_sortCreateDate":b="mapCreateDate";break;case "mapManager_sortUpdateDate":b="mapUpdateDate";break;case "mapManager_sortOwnershipType":b="mapOwnershipDesc"}switch(d){case "desc":e="asc";break;case "asc":e="";break;default:e="desc"}b&&($("#userFilesList").jqxGrid("sortby",b,e),e?(d&&document.getElementById(a).ex_RemoveClassName(d),document.getElementById(a).ex_HasClassName(e)||document.getElementById(a).ex_AddClassName(e)):
document.getElementById(a).ex_RemoveClassName(d))},showMapManagerMaps:function(a,b){a||(mygis.Admin.MapManager.bindManagerHandlers(),$("#mapManager").dialog({autoOpen:!1,modal:!0,resizable:!1,width:780,height:510,title:strings.MapManager.loadWindowTitle,closeOnEscape:!1}),$("#ui-dialog-title-mapManager").parent().css({background:"url('"+config.folderPath+"Images/pictures_folder.png') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"}));$("#mapManager").dialog("open");var c=$("#mapManagerList");
a&&(c.jqxGrid("clearselection"),c.jqxGrid("clear"));a?mygis.Admin.MapManager.refreshMapList():(mygis.Admin.MapManager.createPotentialMapGrid(b),c.bind("rowselect",mygis.Admin.MapManager.mapSelected),c.bind("rowunselect",mygis.Admin.MapManager.mapUnselected));null==mygis.Admin.UI.dialogConfig.callbackfn?$("#mapManagerDialogButtons").hide():$("#mapManagerDialogButtons").show()},refreshMapList:function(){var a=$("#mapManagerList");a.jqxGrid("clearselection");a.jqxGrid("updatebounddata")},mapSelected:function(){var a=
$("#mapManager_toggleSelection"),b=$("#mapManagerList");b.jqxGrid("getselectedrowindexes").length==b.jqxGrid("source").records.length?a.html(strings.MapManager.mapUncheckAllTitle):a.html(strings.MapManager.mapCheckAllTitle)},mapUnselected:function(){var a=$("#mapManager_toggleSelection"),b=$("#mapManagerList");b.jqxGrid("getselectedrowindexes").length==b.jqxGrid("source").records.length?a.html(strings.MapManager.mapUncheckAllTitle):a.html(strings.MapManager.mapCheckAllTitle)},singleMapCheck:function(a){var b=
$("#mapManagerList");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex)},allMapToggle:function(a){var b=$("#mapManagerList"),c=b.jqxGrid("source").records;if(b.jqxGrid("getselectedrowindexes").length==c.length){b.jqxGrid("clearselection");for(var d=0;d<c.length;d++)c[d].mapSelected=!1;b.jqxGrid("refreshdata");$(a).html(strings.MapManager.mapCheckAllTitle)}else{b.jqxGrid("clearselection");for(d=0;d<c.length;d++)c[d].mapSelected=!0,b.jqxGrid("selectrow",d);
b.jqxGrid("refreshdata");$(a).html(strings.MapManager.mapUncheckAllTitle)}},clearSelection:function(){for(var a=$("#mapManagerList"),b=a.jqxGrid("getselectedrowindexes"),c=0;c<b.length;c++)a.jqxGrid("getrowdata",b[c]).mapSelected=!1;a.jqxGrid("clearselection");a.jqxGrid("refreshdata")},toggleFilterFocus:function(a){var b=document.getElementById("mapManager_Search");a?b.ex_HasClassName("focused")||b.ex_AddClassName("focused"):b.ex_HasClassName("focused")&&b.ex_RemoveClassName("focused")},toggleFilterDecoration:function(){var a=
$("#mapManager_SearchInput").val(),b=$("#mapManager_Search")[0];a?b.ex_HasClassName("populated")||b.ex_AddClassName("populated"):b.ex_HasClassName("populated")||b.ex_RemoveClassName("populated")}},LayerManager:{},UserManager:{Users:{createUserSource:function(){var a=mygis.User.Hooks.getUserGridColumnSource(mygis.User.Hooks.getAppUsersURL);return new $.jqx.dataAdapter(a)},userSelected:function(){mygis.Admin.UserManager.Users.checkButtonState();mygis.User.Hooks.UserManager.afterUserSelected()},userUnselected:function(){mygis.Admin.UserManager.Users.checkButtonState();
mygis.User.Hooks.UserManager.afterUserUnselected()},clearSelection:function(){var a=$("#myUsersGrid"),b=a.jqxGrid("source").records;a.jqxGrid("clearselection");for(var c=0;c<b.length;c++)b[c].isSelected=!1;a.jqxGrid("refreshdata");mygis.Admin.UserManager.Users.checkButtonState()},checkButtonState:function(){var a=$("#myUsersGrid").jqxGrid("getselectedrowindexes");1<a.length?(document.getElementById("amenu_Users_Manager_edit").ex_HasClassName("disabled")||document.getElementById("amenu_Users_Manager_edit").ex_AddClassName("disabled"),
document.getElementById("amenu_Users_Manager_delete").ex_RemoveClassName("disabled")):1==a.length?(document.getElementById("amenu_Users_Manager_edit").ex_RemoveClassName("disabled"),document.getElementById("amenu_Users_Manager_delete").ex_RemoveClassName("disabled")):(document.getElementById("amenu_Users_Manager_edit").ex_HasClassName("disabled")||document.getElementById("amenu_Users_Manager_edit").ex_AddClassName("disabled"),document.getElementById("amenu_Users_Manager_delete").ex_HasClassName("disabled")||
document.getElementById("amenu_Users_Manager_delete").ex_AddClassName("disabled"))},singleCheckClicked:function(a){var b=$("#myUsersGrid");a.args.value?b.jqxGrid("selectrow",a.args.rowindex):b.jqxGrid("unselectrow",a.args.rowindex);mygis.User.Hooks.UserManager.afterSingleCheckClicked(a)},allCheckClicked:function(a){var b=$("#myUsersGrid"),c=b.jqxGrid("source").records,d=b.jqxGrid("getselectedrowindexes");if(a.checked){for(a=0;a<c.length;a++)-1==d.indexOf(a)&&(c[a].isSelected=!0,b.jqxGrid("selectrow",
a));b.jqxGrid("refreshdata")}else mygis.Admin.UserManager.Users.clearSelection()},bindManagerHandlers:function(){},userDelete:function(){if(mygis.User.Hooks.UserManager.beforeUserDelete()){var a=$("#myUsersGrid").jqxGrid("getselectedrowindexes").length,a=mygis.Utilities.format(strings.UserManager.deleteConfirmation,a);showConfirmationDialog(a,function(){var a=mygis.User.Hooks.UserManager.getUserDeleteURL(),c=[],d=$("#myUsersGrid").jqxGrid("getselectedrowindexes");$.each(d,function(a,b){var d=$("#myUsersGrid").jqxGrid("getrowdata",
b);c.push(d.userID)});d={};d.qContents=JSON.stringify({users:c});mygis.Utilities.blockUI();$.ajax({type:"POST",url:a,data:d,success:function(a){mygis.Utilities.unblockUI();mygis.Admin.UserManager.Users.clearSelection();try{var b=eval("("+a+")");"success"==b.iotype?displaySuccess(strings.UserManager.userDeletedFeedback):displayError(strings.UserManager.usersNotDeleted+b.iomsg)}catch(c){displayError(c.message)}$("#myUsersGrid").jqxGrid("updatebounddata")}})},mygis.Admin.UserManager.Users.clearSelection)}mygis.User.Hooks.UserManager.afterUserDelete()},
createUserGrid:function(){mygis.Utilities.blockUI();var a=$("#myUsersGrid"),b=mygis.Admin.UserManager.Users.createUserSource();a.jqxGrid({source:b,width:"100%",height:"100%",autoheight:!1,theme:"pk_mg_jm",altrows:!0,enabletooltips:!0,columns:mygis.User.Hooks.getUserGridColumns(),enableanimations:!1,showheader:!0,columnsmenu:!1,sortable:!0,editable:!0,groupable:!1,selectionmode:"none"});a.bind("rowselect",mygis.Admin.UserManager.Users.userSelected);a.bind("rowunselect",mygis.Admin.UserManager.Users.userUnselected);
a.bind("cellendedit",mygis.Admin.UserManager.Users.singleCheckClicked);mygis.Utilities.unblockUI()}},Groups:{}},LogManager:{},UI:{internalConfig:{lastMenuActive:-1},showManual:function(){var a=!1,b="";switch(currentAppName){case "psyhat":a=!0,b="/psyhatManualAdmin.pdf"}if(a)if(0<$("#mygis_manual").children().length)$("#mygis_manual").dialog("show");else{var a=$("<div />"),c=$("<iframe />");c.attr("id","mygis_manual");c.attr("src",b);c.css({width:"99%",height:"100%"});a.append(c);a.dialog({modal:!0,
autoOpen:!1,width:920,height:500,title:strings.HelpSystem.manual,resizable:!0});a.dialog("open")}else displayNotify(msg_errFeatureNotImplemented)},activateTab:function(a){var b=$("#contentTabs").find(".contentTab");$.each(b,function(b,d){$(d).attr("id")==a?$(d).attr("class","contentTab active"):$(d).attr("class","contentTab")})},menuClick:function(a,b){var c=b?document.getElementById(b):a.args,d=c.id,e=-1;b&&(a=$("#menuTabs"));if(d){var f=d.split("_"),e=f.length-1,g;1<e&&(b?g=$(a).find(mygis.Utilities.format("#{0}_{1}",
f[0],f[1])):(a.currentTarget=this,g=$(a.currentTarget).find(mygis.Utilities.format("#{0}_{1}",f[0],f[1]))),g=g.find("a").html());g&&"amenu_Files_Manager"!=d&&(c=$(c).find("a span").html(),$("#contentActionsTitleElem").html(mygis.Utilities.format("{0}: {1}",g,c)))}if(1<e){f=d.split("_");switch(f[1]){case "Apps":mygis.Admin.UI.internalConfig.lastMenuActive=0;break;case "Maps":mygis.Admin.UI.internalConfig.lastMenuActive=1;break;case "Layers":mygis.Admin.UI.internalConfig.lastMenuActive=2;break;case "Users":mygis.Admin.UI.internalConfig.lastMenuActive=
3;break;case "Data":mygis.Admin.UI.internalConfig.lastMenuActive=4;break;case "Files":mygis.Admin.UI.internalConfig.lastMenuActive=5;break;case "Logs":mygis.Admin.UI.internalConfig.lastMenuActive=6;break;case "Help":mygis.Admin.UI.internalConfig.lastMenuActive=7}mygis.Admin.UI.resetTabs();switch(d){case "amenu_Apps_Manager":mygis.Admin.UI.activateTab("appManagerTab");mygis.Admin.UI.createGenericActions(d);$("#contentActionsTitle").attr("class","appManager");mygis.Admin.AppManager.Apps.createAppGrid();
break;case "amenu_Apps_Config":mygis.Admin.UI.activateTab("editAppTab");mygis.Admin.UI.createGenericActions(d);$("#contentActionsTitle").attr("class","appConfig");b?(d=$("#myAppGrid"),e=d.jqxGrid("getselectedrowindex"),d=d.jqxGrid("getrowdata",e),e=d.appID,$("#contentActionsTitleElem").html(mygis.Utilities.format("{0}: {1} '{2}'",g,strings.AppManager.appSetings_Label,d.appName)),mygis.Admin.AppManager.getAppDetails(e)):mygis.Admin.AppManager.getAppDetails();router("amenu_Apps_Config_Tab",0);break;
case "amenu_Files_Manager":showMediaManager(null,!0);break;case "amenu_Maps_Manager":mygis.Admin.UI.activateTab("mapManagerTab");mygis.Admin.UI.createGenericActions(d);$("#contentActionsTitle").attr("class","mapManager");mygis.Admin.MapManager.Maps.createMapGrid();break;case "amenu_Maps_Config":mygis.Admin.UI.activateTab("editMapTab");mygis.Admin.UI.createGenericActions(d);b?(d=$("#myMapsGrid"),e=d.jqxGrid("getselectedrowindex"),d=d.jqxGrid("getrowdata",e),e=d.id,$("#contentActionsTitleElem").html(mygis.Utilities.format("{0}: {1} '{2}'",
g,strings.MapManager.mapSettingsLabel,d.mapName)),mygis.Admin.MapManager.getMapDetails(e)):mygis.Admin.MapManager.getMapDetails();router("amenu_Maps_Config_Tab",0);break;case "amenu_Help_Manual":router("amenu_Help_Manual");break;case "amenu_Users_Manager":mygis.Admin.UI.activateTab("userManagerTab");mygis.Admin.UI.createGenericActions(d);$("#contentActionsTitle").attr("class","userManager");mygis.Admin.UserManager.Users.createUserGrid();break;default:mygis.Admin.UI.activateTab(""),$("#contentActionsTitle").attr("class",
""),$("#contentToolbar").empty(),displayNotify(msg_errFeatureNotImplemented)}}},createGenericActions:function(a){var b=0,c=[],d=[],e=[],f=[],g=[],h=$("<div />");switch(a){case "amenu_Apps_Manager":b=4;c=[mygis.Utilities.format("{0}_{1}",a,"new"),mygis.Utilities.format("{0}_{1}",a,"edit"),mygis.Utilities.format("{0}_{1}",a,"style"),mygis.Utilities.format("{0}_{1}",a,"delete")];d=[strings.AppManager.amenu_Apps_Manager_ActionNew,strings.AppManager.amenu_Apps_Manager_ActionEdit,strings.AppManager.amenu_Apps_Manager_ActionStyle,
strings.AppManager.amenu_Apps_Manager_ActionDelete];e=["imgNew","imgSettings","imgStyle","imgDelete"];f=[mygis.Utilities.format("router('{0}','{1}');return false;",a,"new"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"edit"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"style"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"delete")];g=[!1,!0,!0,!0];break;case "amenu_Apps_Config":b=2;c=[mygis.Utilities.format("{0}_{1}",a,"save"),mygis.Utilities.format("{0}_{1}",
a,"cancel")];d=[strings.AppManager.amenu_Apps_Config_ActionSave,strings.AppManager.amenu_Apps_Config_ActionCancel];e=["imgSave","imgReset"];f=[mygis.Utilities.format("router('{0}','{1}');return false;",a,"save"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"cancel")];g=[!0,!1];mygis.Admin.UI.setTabs($("#editAppForm").find(".sectionHeader").clone());$("#editAppName").bind("focus",mygis.Admin.AppManager.Apps.inputStore);$("#editAppAlias").bind("focus",mygis.Admin.AppManager.Apps.inputStore);
$("#editAppWelcomeText").bind("focus",mygis.Admin.AppManager.inputStore);$("#editAppName").bind("propertychange keyup input paste",mygis.Admin.AppManager.Apps.inputChanged);$("#editAppAlias").bind("propertychange keyup input paste",mygis.Admin.AppManager.Apps.inputChanged);$("#editAppWelcomeText").bind("propertychange keyup input paste",mygis.Admin.AppManager.Apps.inputChanged);$("#chooseHost").bind("blur",mygis.Admin.AppManager.checkAliasValidity);$("#choosePort").bind("propertychange keyup input paste",
mygis.Admin.AppManager.checkPortValidity);break;case "amenu_Maps_Manager":b=3;c=[mygis.Utilities.format("{0}_{1}",a,"new"),mygis.Utilities.format("{0}_{1}",a,"edit"),mygis.Utilities.format("{0}_{1}",a,"delete")];d=[strings.AppManager.amenu_Maps_Manager_ActionNew,strings.AppManager.amenu_Maps_Manager_ActionEdit,strings.AppManager.amenu_Maps_Manager_ActionDelete];e=["imgNew","imgSettings","imgDelete"];f=[mygis.Utilities.format("router('{0}','{1}');return false;",a,"new"),mygis.Utilities.format("router('{0}','{1}');return false;",
a,"edit"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"delete")];g=[!1,!0,!0];break;case "amenu_Users_Manager":b=3;c=[mygis.Utilities.format("{0}_{1}",a,"new"),mygis.Utilities.format("{0}_{1}",a,"edit"),mygis.Utilities.format("{0}_{1}",a,"delete")];d=[strings.UserManager.amenu_Users_Manager_ActionNew,strings.UserManager.amenu_Users_Manager_ActionEdit,strings.UserManager.amenu_Users_Manager_ActionDelete];e=["imgNew","imgSettings","imgDelete"];f=[mygis.Utilities.format("router('{0}','{1}');return false;",
a,"new"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"edit"),mygis.Utilities.format("router('{0}','{1}');return false;",a,"delete")];g=[!1,!0,!0];break;case "amenu_Maps_Config":b=2,c=[mygis.Utilities.format("{0}_{1}",a,"save"),mygis.Utilities.format("{0}_{1}",a,"cancel")],d=[strings.AppManager.amenu_Apps_Config_ActionSave,strings.AppManager.amenu_Apps_Config_ActionCancel],e=["imgSave","imgReset"],f=[mygis.Utilities.format("router('{0}','{1}');return false;",a,"save"),mygis.Utilities.format("router('{0}','{1}');return false;",
a,"cancel")],g=[!0,!1],mygis.Admin.UI.setTabs($("#editMapForm").find(".sectionHeader").clone()),$("#editMapName").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapDescription").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapExtent").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapCenter").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),
$("#editMapZoom").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapDeveloper").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapOwner").bind("propertychange keyup input paste",mygis.Admin.MapManager.Maps.inputChanged),$("#editMapDefaultBG").bind("change",mygis.Admin.MapManager.Maps.inputChanged)}for(var k=0;k<b;k++)h.append(mygis.Admin.UI.btnGenerator(c[k],e[k],d[k],f[k],g[k]));0<b&&$("#contentToolbar").html(h.html());
mygis.User.Hooks.AdminTabActions(a,h.html())},btnGenerator:function(a,b,c,d,e){var f=$("<a />");f.attr("href","#");f.attr("id",a);f.attr("title",c);e?f.attr("class","adminGenericAction disabled"):f.attr("class","adminGenericAction");d&&f.attr("onclick",d);a=$("<span />");a.attr("class",mygis.Utilities.format("adminActionImg {0}",b));f.append(a);f.append(c);return f},loadAdministration:function(){0==$("#page_administration").children().length?(mygis.Utilities.blockUI(),loadFragment("page_administration",
mygis.Admin.UI.initialize)):mygis.Admin.UI.initialize()},initialize:function(){mygis.Utilities.unblockUI();internalConfig.isAdminInterfaceLoaded=!0;$("#menuTabs").jqxMenu({width:"635",height:"30",mode:"horizontal",showTopLevelArrows:!0,theme:"classic"});$("#menuTabs").bind("itemclick",function(a){MakeTimeout(mygis.Admin.UI.menuClick,a,800,this)});mygis.Admin.UI.switchToAdmin();mygis.Admin.UI.menuClick(null,"amenu_Apps_Manager")},switchToAdmin:function(){if(internalConfig.isAdminInterfaceLoaded){$("#page_effect").hide();
$("#page_userProfile").hide();$("#page_administration").show();var a=$("#contentLinkTabsRound").find(".sectionHeader.active");if(a)switch(mygis.Admin.UI.internalConfig.lastMenuActive){case 0:0<=a.index()&&mygis.Admin.AppManager.createGrid(a.index());break;case 1:0<=a.index()&&mygis.Admin.MapManager.createGrid(a.index())}}else mygis.Admin.UI.loadAdministration()},refreshPageLogos:function(){var a=$(".domainLogoWrapper2").find("img");$.each(a,function(a,c){var d=c.src;d&&(-1<d.indexOf("&ut=")&&(d=d.substring(0,
d.indexOf("&ut="))),c.src=d+"&ut="+(new Date).getTime())});a=$("#editAppForm .editAppRow").find("img");$.each(a,function(a,c){var d=c.src;d&&(d=d.substring(0,d.indexOf("&qSize=")+10),c.src=d+"&ut="+(new Date).getTime())})},resetTabs:function(){$("#contentLinkTabsRound").empty();$("#contentLinkTabs").css("display","none");$("#contentSpecificToolbar").empty()},setTabs:function(a){$("#contentLinkTabsRound").empty();$("#contentLinkTabsRound").append(a);$("#contentLinkTabs").css("display","table-row")},
acceptWindow:function(){var a=mygis.Admin.UI.dialogConfig;null!=a.checkfn&&a.checkfn()&&($(a.windowTitle).dialog("close"),a.callbackfn.call(a.object,"ok"),mygis.Admin.UI.resetDialog())},closeWindow:function(){var a=mygis.Admin.UI.dialogConfig;null!=a.callbackfn&&($(a.windowTitle).dialog("close"),a.callbackfn.call(null,null),mygis.Admin.UI.resetDialog());$(a.windowTitle).dialog("close")},resetDialog:function(){var a=mygis.Admin.UI.dialogConfig;a.checkfn=null;a.callbackfn=null;a.objectCount=-1;a.object=
null;a.windowTitle=null},dialogConfig:{checkfn:null,callbackfn:null,objectCount:-1,object:null,windowTitle:null}},Utilities:{getAppID:function(){for(var a=$("#myAppGrid").jqxGrid("source").records,b=!1,c=0,d=-1;!b&&c<a.length;)a[c].appPrefix==currentAppName&&(b=!0,d=a[c].appID),c++;return d},getRGBA:function(a,b){var c=mygis.Utilities.hexToRGB(a),d=parseInt(b);return"rgba("+c[0]+","+c[1]+","+c[2]+","+d/100+")"}}};var layout,mypageSplitter,midzone,rightzone,layoutControl,maplistControl,wizard,stepWizard,currentWizard,layerOpacityText,markerStyleList,markerSizeText,pointBorderText,pointOpacityText,lineColorText,lineOpacityText,lineWeightText,polygonStrokeOpacityText,polygonFillOpacityText,polygonStrokeWeightText,rsideSplitter,wrapSplitter,lsideExpanded,reg_firstname,reg_lastname,reg_displayname,reg_username,reg_password,reg_email,login_username,login_password,slideMenuToggling=!1,slideMenuVisible=!1,impendingSlideClose,
tabsInitialized=!1,infoWindowInitialized=!1,gridInitialized=!1,mapsBound=!1,currentMapID,currentMapMaxExtent,currentAppName,mapSource,layerSource,layerRemovedSource=[],layerStyles={},layerToReset,layerCurrentEditing,layerTreeSource,layergridSource,layerImages,layersLoaded,layersToLoad,querySource,QSSource,layerTimeWindow,infoDetachStruct,resultGridButtons,showInfoOnEdit=!0,finishApplicationLoad=!1,customStyleApplied=!1,unsavedChanges=!1,featureEditMode=0,customFiltered=!1,memory={LayerControl:{selectableBeforeEdit:[]}};
function setRegName(a){reg_firstname=a}function setRegLastName(a){reg_lastname=a}function setRegDisplayName(a){reg_displayname=a}function setRegUserName(a){reg_username=a}function setRegPassword(a){reg_password=a}function setRegEmail(a){reg_email=a;document.getElementById("extraMsg").innerHTML=msg_reg_step1}function setLoginUsername(a){login_username=a}function setLoginPassword(a){login_password=a}function setMarkerStyleList(a){markerStyleList=a;setMarkerStyleTree()}
function setpointBorderText(a){pointBorderText=a}function setpointOpacityText(a){pointOpacityText=a}function setlayerOpacityText(a){layerOpacityText=a}function setMarkerSizeText(a){markerSizeText=a}function setLineOpacityText(a){lineOpacityText=a}function setLineWeightText(a){lineWeightText=a}function setPolyStrokeOpacityText(a){polygonStrokeOpacityText=a}function setPolyFillOpacityText(a){polygonFillOpacityText=a}function setPolyStrokeWeightText(a){polygonStrokeWeightText=a}
function router(a,b){switch(a){case "cmdLogin2":show_Login();break;case "cmdRegister2":show_Registration();break;case "cmdAdministration":show_Administration();break;case "mapAction_Maps":showMapDialog();break;case "mapAction_buildQuery":showQueryDialog();break;case "mapAction_QuerySettings":toggleQuerySettings();break;case "mapAction_Export":showMapExport();break;case "mapAction_Save":mygis.Drawing.Exporting.saveDigitizing();break;case "zoomOutBtn":mygis.Map.ZoomOut();break;case "zoomBoxBtn":mygis.UI.activateControl("zoomBox");
break;case "dragPanBtn":mygis.UI.activateControl("drag");break;case "toggleInfoBtn":mygis.UI.toggleInfoBtn_V2(b);break;case "toggleOverviewBtn":mygis.UI.toggleOverview();break;case "infoPoint":mygis.UI.toggleSelectBtn("point");break;case "infoRect":mygis.UI.toggleSelectBtn("rectangle");break;case "markerButton":mygis.UI.setTool("marker",b);break;case "polylineButton":mygis.UI.setTool("polyline",b);break;case "polygonButton":mygis.UI.setTool("polygon",b);break;case "rectangleButton":mygis.UI.setTool("rectangle",
b);break;case "showInfoOnEdit":mygis.UI.toggleEditableInfo();break;case "tlvm":mygis.UI.preToggleLayerVisible(null,b);break;case "tlvp":mygis.UI.toggleLayerVisibleProperty(b);break;case "tle":mygis.UI.toggleLayerEditable();break;case "tls":mygis.UI.toggleLayerSelectable();break;case "tlz":mygis.UI.zoomToLayer(0);break;case "tlr":mygis.UI.mg_removeLayer(0);break;case "tlmu":mygis.UI.moveLayerUp(0);break;case "tlmd":mygis.UI.moveLayerDown(0);break;case "tlcf":mygis.UI.toggleLayerConstraint("From");
break;case "tlct":mygis.UI.toggleLayerConstraint("To");break;case "tlgv":mygis.UI.toggleLayerGroup(b);break;case "popScaleFrom":mygis.UI.getMgScale(b);break;case "popScaleTo":mygis.UI.getMgScale(b);break;case "pointMode":mygis.UI.togglePointMode(b);break;case "scaleTo":mygis.UI.scaleTo($("#olScale_wrapper").find(":selected").val());break;case "lcg":mygis.UI.layerGrouping(b);break;case "resultSelectOn":mygis.UI.dbResultsSelect(b);break;case "mapResults":mygis.UI.dbResultsOnMap(b);break;case "critClick":mygis.UI.dbCriteriaClick(b);
break;case "critMap":mygis.UI.updateCriteriaMap(b);break;case "critPop":mygis.UI.dbFieldPopulate(b);break;case "critDescrip":mygis.UI.dbCriteriaUpdateDescription();break;case "critSelect":mygis.UI.dbSelectChanged(b);break;case "critGetDisc":mygis.UI.dbGetFromDistinct(b);break;case "critPopDisc":mygis.UI.dbPopulateDistinct(b);break;case "critReset":mygis.UI.dbCriteriaReset();break;case "showQR":showQueryResetConfirm();break;case "lmap":showConfirmationDialog(strings.MapControl.loadMapConfirm,function(){router("dragPanBtn");
loadMap(!1,b)},function(){return!1});break;case "codingTLD":toggleLayerDetails(b,this);break;case "codingTLE":mygis.UI.toggleLayerEditable(b);break;case "codingTLS":mygis.UI.toggleLayerSelectable(b);break;case "codingSaveLayer":mygis.UI.startSaving(b);break;case "styleUpdate":mygis.UI.previewLayerStyle();break;case "styleApply":mygis.UI.applyLocalStyle();break;case "styleSave":mygis.UI.saveLayerStyle();break;case "styleCancel":mygis.UI.cancelApplyLocalStyle();break;case "editModeBtn":mygis.UI.switchEditMode(b);
break;case "selectCtrl":mygis.UI.activateSelectCtrl(b);break;case "expandSelect":var c=b.isMapSelect?mygis.Query.breakupMapData(b.results,b.layername,b.fid):mygis.Query.breakupQueryData(b.results);mygis.Query.popupInfo(c,b.layername);break;case "infopopup_previewImg":mygis.Query.infoImgPreview(b);break;case "infopopup_previewFile":mygis.Query.infoFilePreview(b);case "tlSM":mygis.UI.toggleDrawerButton(b);break;case "exportMap":c=b.id.split("_")[1];mygis.Drawing.Exporting.exportMapAs(c);break;case "mapDL":mygis.UI.showExportMap();
break;case "tHotSearch":mygis.UI.toggleHotSearchItem(b);break;case "tFieldEditU":mygis.UI.updateObjectField();break;case "tFieldEditC":mygis.UI.clearObjectField();break;case "tFieldEditE":mygis.UI.cancelObjectEditing();break;case "mm_imgclick":mygis.UI.MediaManager.fullImgPreview(b);break;case "cmdMediaManager":showMediaManager();break;case "attachNew_I":mygis.UI.attachFileToRecord(b);break;case "attachNew_F":mygis.UI.attachFileToRecord(b);break;case "cycleBG":mygis.Map.cycleBackground(b);break;case "switchBG_1":mygis.Map.switchBackground($(b).find("option:selected")[0].value,
1);break;case "mm_toggleSelection":mygis.UI.MediaManager.toggleSelection(b);break;case "cmdAdminPanel":mygis.Admin.UI.switchToAdmin();break;case "cmdUserPanel":mygis.User.UI.switchToUserPage();break;case "cmdSwitchLayout":displayNotify(msg_errFeatureNotImplemented);break;case "backToApp":mygis.User.UI.switchToApp();break;case "adminAppLogo":mygis.Admin.AppManager.logoBtnClick(b);break;case "adminAppLogoRemove":mygis.Admin.AppManager.logoRemoveBtnClick(b);break;case "amenu_Apps_Manager":switch(b){case "new":mygis.Admin.AppManager.Apps.showAddNewApp();
break;case "edit":mygis.Admin.UI.menuClick(null,"amenu_Apps_Config")}break;case "amenu_Maps_Manager":switch(b){case "new":mygis.Admin.MapManager.Maps.showAddNewMap()}break;case "amenu_Apps_Config":switch(b){case "save":mygis.Admin.AppManager.saveChanges();break;case "cancel":mygis.Admin.AppManager.revertChanges()}break;case "amenu_Maps_Config":switch(b){case "save":mygis.Admin.MapManager.saveChanges();break;case "cancel":mygis.Admin.MapManager.revertChanges()}break;case "amenu_Users_Manager":switch(b){case "delete":mygis.Admin.UserManager.Users.userDelete()}break;
case "amenu_Help_Manual":mygis.Admin.UI.showManual();break;case "adminAppClick":mygis.Admin.AppManager.Apps.singleCheckClicked(b);break;case "adminAllClick":mygis.Admin.AppManager.Apps.allCheckClicked(b);break;case "appNameClick":mygis.Admin.AppManager.Apps.appClicked(b);break;case "adminMapClick":mygis.Admin.AppManager.Maps.mapCheckClicked(b);break;case "adminMapAllClick":mygis.Admin.AppManager.Maps.mapAllCheck(b);break;case "adminURlAllClick":mygis.Admin.AppManager.URLs.urlAllCheck(b);break;case "adminStyleAllClick":mygis.Admin.AppManager.Styles.allCheckClicked(b);
break;case "adminMacroAllClick":mygis.Admin.MapManager.Macros.allCheckClicked(b);break;case "appAddAlias":mygis.Admin.AppManager.URLs.showAddAlias();break;case "appRemoveAlias":mygis.Admin.AppManager.URLs.urlDelete();break;case "appAddMap":mygis.Admin.AppManager.Maps.addAppMap();break;case "appDefaultMap":mygis.Admin.AppManager.Maps.mapMakeDefault();break;case "appUnpublishMap":mygis.Admin.AppManager.Maps.mapUnpublish();break;case "appDeleteMap":mygis.Admin.AppManager.Maps.mapDelete();break;case "amenu_Apps_Config_Tab":c=
{};c.item=b;mygis.Admin.AppManager.expandDetails(c);break;case "accountInfo_Config_Tab":c={};c.item=b;mygis.User.ProfileInfo.switchToTab(c);break;case "amenu_Maps_Config_Tab":c={};c.item=b;mygis.Admin.MapManager.expandDetails(c);break;case "adminOK":mygis.Admin.UI.acceptWindow();break;case "adminCancel":mygis.Admin.UI.closeWindow();break;case "mapManager_filterMe":mygis.Admin.MapManager.filterPotentialMaps();break;case "mapManager_toggleAll":mygis.Admin.MapManager.allMapToggle(b);break;case "adminStylePreview":c=
$(mygis.Utilities.format("#stylePreviewTimer_{0}",b)).val();mygis.Admin.AppManager.Styles.stylePreview(b,c);break;case "app_addNewStyle":mygis.Admin.AppManager.Styles.showEditStyle(!0);break;case "app_editStyle":mygis.Admin.AppManager.Styles.showEditStyle(!1);break;case "app_directEditStyle":mygis.Admin.AppManager.Styles.directStyleEdit(b);break;case "app_copyStyle":mygis.Admin.AppManager.Styles.saveAsCopy();break;case "app_makeActiveStyle":mygis.Admin.AppManager.Styles.makeDefault();break;case "app_publishStyle":mygis.Admin.AppManager.Styles.publishStyles();
break;case "app_unpublishStyle":mygis.Admin.AppManager.Styles.unpublishStyles();break;case "app_deleteStyle":mygis.Admin.AppManager.Styles.deleteStyles();break;case "styleMenu_ConfigTab":mygis.Admin.AppManager.Styles.switchToTab(b);break;case "macroMenu_ConfigTab":mygis.Admin.MapManager.Macros.switchToTab(b);break;case "digitizeMenu_ConfigTab":mygis.Drawing.Editing.switchToTab(b);break;case "mapnameClicked":mygis.Admin.MapManager.Maps.mapClicked(b);break;case "admin_Maps_allClick":mygis.Admin.MapManager.Maps.allCheckClicked(b);
break;case "map_addNewQS":mygis.Admin.MapManager.QuickSearches.showEditQS(!0);break;case "map_editQS":mygis.Admin.MapManager.QuickSearches.showEditQS(!1);break;case "map_directEditQS":mygis.Admin.MapManager.QuickSearches.directQSEdit(b);break;case "map_deleteQS":mygis.Admin.MapManager.QuickSearches.deleteQS();break;case "map_getExtent":mygis.Admin.MapManager.Maps.getCurrentExtent();break;case "map_getCenter":mygis.Admin.MapManager.Maps.getCurrentCenter();break;case "map_getZoom":mygis.Admin.MapManager.Maps.getCurrentZoom();
break;case "map_customThumb":mygis.Admin.MapManager.Maps.replaceMapThumbDialog();break;case "map_generateThumb":mygis.Admin.MapManager.Maps.replaceMapThumbAuto();break;case "mapQSAllClick":mygis.Admin.MapManager.QuickSearches.qsAllCheckClicked(b);break;case "qsTitleClick":mygis.Admin.MapManager.QuickSearches.directQSEdit(b);break;case "mapLayerAllClick":mygis.Admin.MapManager.Layers.layerAllCheckClicked(b);break;case "mapAddLayer":mygis.Admin.MapManager.Layers.addMapLayer();break;case "mapDeleteLayer":mygis.Admin.MapManager.Layers.deleteLayer();
break;case "mapLayermoveUp":mygis.Admin.MapManager.Layers.moveUp();break;case "mapLayermoveDown":mygis.Admin.MapManager.Layers.moveDown();break;case "map_addNewMacro":mygis.Admin.MapManager.Macros.showEditMacro(!0);break;case "map_editMacro":mygis.Admin.MapManager.Macros.showEditMacro(!1);break;case "map_deleteMacro":mygis.Admin.MapManager.Macros.deleteMacros();break;case "editPopup_addImage":mygis.Drawing.Editing.handlerAttachImage();break;case "editPopup_detachImage":mygis.Drawing.Editing.imageDetach();
break;case "editPopup_imageSelectAll":mygis.Drawing.Editing.imageGridCheckAll(b);break;case "editPopup_addFile":mygis.Drawing.Editing.handlerAttachFile();break;case "editPopup_detachFile":mygis.Drawing.Editing.fileDetach();break;case "editPopup_fileSelectAll":mygis.Drawing.Editing.fileGridCheckAll(b);break;case "editDigi_btnImageDownload":mygis.Drawing.Editing.imageDownload(b);break;case "editDigi_btnFileDownload":mygis.Drawing.Editing.fileDownload(b);break;case "editDigi_btnImageZoom":mygis.Drawing.Editing.imageZoom(b);
break;case "appManual":mygis.UI.Help.shortcutStart();break;case "appManual2":mygis.UI.Help.showManual(!0);break;case "shortcutMaps":mygis.UI.Help.shortcutMaps();break;case "shortcutSearches":mygis.UI.Help.shortcutSearch();break;case "buildPopup":mygis.Admin.MapManager.Macros.showPopupWizard();break;case "popupWiz_copyToMacro":mygis.Admin.MapManager.Macros.copyPopupOutput();break;case "popupWiz_testIt":mygis.Admin.MapManager.Macros.testPopupOutput();break;case "wizard_ChangeBG":mygis.UI.Help.tutorial("changeBG",
b);break;case "infoPopup_download":mygis.UI.MediaManager.downloadFile(b);break;case "infoPopup_replace":mygis.UI.replaceFileInRecord(b[0],b[1],b[2]);break;case "infoPopup_detach":mygis.UI.MediaManager.detachFile(b[0],b[1],b[2]);break;case "searchDelete":mygis.UI.removeSavedQuery();break;case "styleManager_ConfigTab":mygis.Drawing.Styling.styleManager_switchTab(b);break;case "up_menuAccount_Info":switch(b){case "save":mygis.User.ProfileInfo.updateProfile();break;case "cancel":mygis.User.ProfileInfo.getProfileDetails()}break;
case "qstatsBtn":mygis.Query.queryStatsWindow();break;case "withinBtn":mygis.Query.queryWithinWindow();break;case "qstatsExecute":mygis.Query.statsCalculate();break;case "layerSelectionToggle":mygis.Map.switchSelectionToggleBtn(b);break;case "withinSearchGo":mygis.Query.queryWithinExecute();break;case "qstatsBack":mygis.Query.statsBackToSelection();break;case "qstatsPrint":mygis.Query.queryStatsPrint();break;case "mapResultsToggle":$("#mapFeaturesCont").is(":visible")?($("#mapFeaturesCont").hide(),
$("#mapResultsToggleBtn").attr("class","")):($("#mapFeaturesCont").show(),$("#mapResultsToggleBtn").attr("class","pressed"),router("mapFeatureSearchOpen"),mygis.Map.moveEnd());break;case "mapFeatureSearchToggle":$("#mapFeatureSearchBar").is(":visible")?mygis.Map.hideSearchPanel():mygis.Map.showSearchPanel();break;case "mapFeatureSearchClose":mygis.Map.hideSearchPanel();break;case "mapFeatureSearchOpen":mygis.Map.showSearchPanel();break;case "mapFeatureSearchNext":mygis.Map.gotoNextFeatureResult();
break;case "mapFeatureSearchPrevious":mygis.Map.gotoPreviousFeatureResult();break;case "togglePreviousSearch":"active"==$("#pageHelpSearchMap").attr("class")?(mygis.UI.Help.shortcutStart(),$("#btnSearchList").html(strings.MapTools.showSearchesBtn)):(mygis.UI.Help.shortcutSearch(),$("#btnSearchList").html(strings.MapTools.hideSearchesBtn));break;case "toggleGoogle":$(".googleSearchContainer").is(":visible")?($(".googleSearchContainer").hide("slide",{direction:"right"},1E3),mygis.Map.clearFeedback()):
$(".googleSearchContainer").show("slide",{direction:"right"},1E3);break;case "applyLayerChanges":mygis.UI.applyLayerChanges();break;case "cancelLayerChanges":mygis.UI.cancelLayerChanges()}}function locateObjectlist(a,b){var c;c=b.get_item().get_index();mygis.Map.selectObject(c)}function unlocateObjectlist(a,b){var c;c=b.get_item().get_index();mygis.Map.deselectObject(c)}
function show_Registration(){var a=function(){$("#registrationDialog").dialog({width:525,modal:!0,resizable:!1,open:mygis.Utilities.unbindGlobalHandlers,close:mygis.Utilities.rebindGlobalHandlers,title:strings.Registration.infoTitle})};0==$("#registrationDialog").children().length?loadFragment("registrationDialog",a):a()}function show_Login(){$("#loginDialogCont").dialog({width:440,height:217,modal:!0,resizable:!1,title:strings.Login.welcomeTo+$(".domainStaticTextBackground").attr("title")})}
function show_Forgot(){$("#forgotCont").load("/default.aspx?returnurl=&ctl=SendPassword&popUp=true",function(){$("#forgotCont").dialog({width:440,height:300,modal:!0,resizable:!1,title:"Forgot password?"})})}
function nextStep_Registration(){var a=parseInt(document.getElementById("currentStep").value);if(Page_ClientValidate("step"+a))if(2>a)switch(document.getElementById("reg_back").style.display="",document.getElementById("reg_step"+a).style.display="none",a+=1,document.getElementById("reg_step"+a).style.display="",document.getElementById("currentStep").value=a,a){case 1:document.getElementById("extraMsg").innerHTML=msg_reg_step1;break;case 2:document.getElementById("extraMsg").innerHTML=msg_reg_step2}else registerUser()}
function prevStep_Registration(){var a=parseInt(document.getElementById("currentStep").value);document.getElementById("reg_results").style.display="none";document.getElementById("reg_forward").style.display="";if(1<a)switch(document.getElementById("reg_step"+a).style.display="none",a-=1,document.getElementById("reg_step"+a).style.display="",document.getElementById("currentStep").value=a,1==a&&(document.getElementById("reg_back").style.display="none"),a){case 1:document.getElementById("extraMsg").innerHTML=
msg_reg_step1;break;case 2:document.getElementById("extraMsg").innerHTML=msg_reg_step2}}function login(a){Page_ClientValidate("login_dialog")&&loginUser(a)}function show_Administration(){}function playVideo(){swfobject.embedSWF("http://youtube.com/v/tPPcahQb7aQ?version=3&playerapiid=ytapiplayer","ytapiplayer","500","384","8",null,null,{allowScriptAccess:"always",allowFullScreen:"true"},{id:"myytplayer",color2:"#FFFFFF"})}
function displayShortNotify(a){$("#Notification").jnotifyAddMessage({text:a,permanent:!1,disappearTime:1500,oneAtTime:!0})}function displayNotify(a,b,c){$("#Notification").jnotifyAddMessage({text:a,permanent:b,disappearTime:5E3,callbackClose:c,oneAtTime:!0})}function displayError(a,b){$("#Notification").jnotifyAddMessage({text:a,type:"error",permanent:b,disappearTime:1E4})}function displaySuccess(a,b){$("#Notification").jnotifyAddMessage({text:a,type:"success",permanent:b,disappearTime:5E3})}
function menuHandler(a){var a=a.substring(a.lastIndexOf("_")+1),b="lm_"+a.replace("img","");switch(a){case "imgTables":case "imgShared":case "imgProfile":case "imgSupport":displayNotify(msg_errFeatureNotImplemented);break;case "imgMap":document.getElementById("middlePane").style.left="15px";document.getElementById("leftPane").style.display="none";break;default:document.getElementById("middlePane").style.left="800px",document.getElementById("leftPane").style.display="block",initLeftMenu(b)}mygis.Map.elementPosition("mapContainer")}
function leftmenuHandler(a){var b,c,d,e,f,g;f=a.substring(0,a.indexOf("_"));c=document.getElementById(a);b=c.parentNode.parentNode;document.getElementById("infoTitle").innerHTML=c.innerHTML;for(g=0;g<$(b).find("li").length;g++)d=$($(b).find("li")[g]).find("a").get(0),d!=c?$(d).removeClass("selected"):($(d).addClass("selected"),e=g);g=a.substring(a.indexOf("_")+1);switch(f){case "menuStart":mygis.UI.stopDigitize();f=document.getElementById("startDialog");f=$(f).find(">div");e=0==e&&"Welcome"==g?e+
1:e;for(g=0;g<f.length;g++)g!=e?$(f[g]).hide():($(f[g]).clone().show().dialog({modal:!0,resizable:!1,width:800,title:c.innerHTML,close:function(){$(this).remove()}}),document.getElementById("startDialog").style.display="",document.getElementById("registrationDialog").style.display="none",document.getElementById("loginDialog").style.display="none")}}
function initLeftMenu(a){var b=document.getElementById("wizardPane");document.getElementById("wizardOutputPane");for(var b=$(b).find("div"),c,d=0;d<b.length;d++)c=b[d],$(c).attr("id")!=a?$(c).hide():$(c).show();switch(a){case "lm_Welcome":document.getElementById("startDialog").style.display="";document.getElementById("saveAskDialog").style.display="none";document.getElementById("supportDialog").style.display="none";break;case "lm_Save":document.getElementById("startDialog").style.display="none";document.getElementById("saveAskDialog").style.display=
"";document.getElementById("supportDialog").style.display="none";break;case "lm_Support":document.getElementById("startDialog").style.display="none",document.getElementById("saveAskDialog").style.display="none",document.getElementById("supportDialog").style.display=""}}function ffclose(){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserWrite")}catch(a){}window.open("","_self");window.close()}
function setMapDescription(a){var b=document.createElement("span");b.innerHTML=" - "+a;document.getElementById("mapDescription").appendChild(b)}
function registerUser(){var a=document.createElement("FORM");a.id="gisRegistrationForm";a.name=a.id;a.method="POST";a.action="";a.target="self";var b=createDummyPostbackControl("reg_firstname"),c=createDummyPostbackControl("reg_lastname"),d=createDummyPostbackControl("reg_displayname"),e=createDummyPostbackControl("reg_username"),f=createDummyPostbackControl("reg_password"),g=createDummyPostbackControl("reg_email"),h=createDummyPostbackControl("postbackAction");a.appendChild(b);a.appendChild(c);a.appendChild(d);
a.appendChild(e);a.appendChild(f);a.appendChild(g);h.value="registerUser";a.appendChild(h);$.ajax({data:$(a).serialize(),success:function(a){switch(a){default:document.getElementById("reg_results_msg").innerHTML=a,"Success"==a?(document.getElementById("reg_results_img").className="successful",document.getElementById("extraMsg").innerHTML=msg_reg_successful):(document.getElementById("reg_results_img").className="error",document.getElementById("extraMsg").innerHTML=msg_reg_error),a=parseInt(document.getElementById("currentStep").value),
document.getElementById("reg_step"+a).style.display="none",document.getElementById("reg_results").style.display="",document.getElementById("reg_forward").style.display="none"}},type:"POST",url:config.mgreq+"?qtype=register"})}
function loginUser(){var a=document.createElement("FORM");a.id="gisLoginForm";a.name=a.id;a.method="POST";a.action=config.mgreq;a.target="_self";a.style.display="none";var b=createDummyPostbackControl("login_username"),c=createDummyPostbackControl("login_password"),d=createDummyPostbackControl("login_remember"),e=createDummyPostbackControl("postbackAction");a.appendChild(b);a.appendChild(c);a.appendChild(d);e.value="loginUser";a.appendChild(e);$("#loginDialog").css("cursor","wait");$.ajax({data:$(a).serialize(),
success:function(a){$("#loginDialog").css("cursor","default");switch(a){case "Invalid username/password":alert(a);break;default:mygis.UI.gatherUnsaved(),location.reload()}},type:"POST",url:a.action+"?qtype=login"})}function checkKeys(a,b){var c=b.get_keyCode();a==login_password&&13==c&&(login(),b.set_cancel(!0))}
function createDummyPostbackControl(a){var b=document.createElement("input"),c;b.id=a;b.name=a;b.type="hidden";switch(a){case "reg_firstname":c=reg_firstname.get_textBoxValue();break;case "reg_lastname":c=reg_lastname.get_textBoxValue();break;case "reg_email":c=reg_email.get_textBoxValue();break;case "reg_displayname":c=reg_displayname.get_textBoxValue();break;case "reg_username":c=reg_username.get_textBoxValue();break;case "reg_password":c=reg_password.get_textBoxValue();break;case "login_username":c=
login_username.get_textBoxValue();break;case "login_password":c=login_password.get_textBoxValue();break;case "login_remember":c=document.getElementById("RememberMe").checked;break;case "mapID":c=$("#mapsList").jqxListBox("getSelectedItem").value}b.value=c;return b}
function showSave(){mygis.UI.stopDigitize();$("#saveAskDialog").is(":visible")?$("#saveAskDialog").dialog("close"):(document.getElementById("saveMarkers").innerHTML=countMarkers,document.getElementById("savePolygons").innerHTML=countPolygons,document.getElementById("savePolylines").innerHTML=countPolylines,$("#saveAskDialog").dialog({modal:!0,resizable:!1,title:tip_btnSave}))}
function showCosmetic(a){mygis.UI.stopDigitize();!$("#cosmeticPanel").is(":visible")&&a?(showSingleRightPane("cosmeticPanel"),$("#rsideSplitter").jqxSplitter("expandAt",1),$("#rsideSplitter").jqxSplitter("panels")[1].collapsed=!1,$("#rsideSplitter").jqxSplitter("enable")):($("#cosmeticPanel").hide(),$("#rsideSplitter").jqxSplitter("collapseAt",1),$("#rsideSplitter").jqxSplitter("panels")[1].collapsed=!0,$("#rsideSplitter").jqxSplitter("disable"))}
function showMapDialog(a){a&&(a=a.data.mapIndex,void 0!=a&&($("#mapsList").jqxListBox("selectIndex",a),expandMapProperties()))}function showQueryDialog(){0==$("#databaseAnalysis").children().length?loadFragment("databaseAnalysis",showQueryExecute):showQueryExecute(!0)}function QuerySettingsVisibility(a){a?($("#searchSettings").show(),$("#btnSearchSettings").attr("class","active")):($("#searchSettings").hide(),$("#btnSearchSettings").attr("class",""))}
function toggleQuerySettings(){var a=$("#searchSettings").is(":visible");QuerySettingsVisibility(!a)}function showNewLayerDialog(){0==$("#newLayerDialog").children().length?loadFragment("newLayerDialog",showNewLayer):showNewLayer()}function showMediaManager(a,b){0==$("#userFiles").children().length?loadFragment("userFiles",function(){showUserFiles(!1,a,b)}):showUserFiles(!0,a,b)}
function showMapManager(a){var b=function(a){return function(){mygis.Admin.MapManager.showMapManagerMaps(!1,a)}}(a);0==$("#mapManager").children().length?loadFragment("mapManager",b):mygis.Admin.MapManager.showMapManagerMaps(!0,a)}function showLayerManager(a){var b=function(a){return function(){mygis.Admin.MapManager.Layers.showAddLayer(!1,a)}}(a);0==$("#layerManager").children().length?loadFragment("layerManager",b):mygis.Admin.MapManager.Layers.showAddLayer(!0,a)}
function showNewLayer(){$("#newLayerDialog").dialog({modal:!0,resizable:!1,width:900,height:510,title:strings.LayerControl.newLayerWindowTitle});$("#ui-dialog-title-newLayerDialog").parent().css({background:"url('"+config.folderPath+"Images/layerlist/Color_layers_original.png') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"})}
function showQueryExecute(a){"ToBeParks"==currentAppName&&($('#criteriaPanels .dbFieldOperator option[value="NEQ"]').remove(),$('#criteriaPanels .dbFieldOperator option[value="GEQ"]').remove(),$('#criteriaPanels .dbFieldOperator option[value="LEQ"]').remove());var b=(new Date).toString(Date.CultureInfo.formatPatterns.fullDateTime),b=(new Date).toString("hh:mm:ss");a||buildDBSearchSource(layerSource);document.getElementById("critFriendlyName").value=strings.QBuilder.friendlyNameDef+b;$("#databaseAnalysis").dialog({modal:!0,
resizable:!1,width:900,height:510,title:strings.QBuilder.windowTitle});a=$("#ui-dialog-title-databaseAnalysis").parent();a.css({background:"url('"+config.folderPath+"Images/queryBuilder/database_search.png') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"});0==a.find(".movingHideBtn").length&&(b=document.createElement("a"),b.onclick=function(){$("#databaseAnalysis").dialog("close")},b.className="movingHideBtn",b.innerHTML=strings.QBuilder.windowClose,a.append(b));mygis.UI.dbCriteriaReset()}
function showQueryResetConfirm(){showConfirmationDialog(strings.ConfirmBox.msg_qb_resetcrit,mygis.UI.dbCriteriaReset)}function hideQueryResetConfirm(){$("#critReset").css({display:"none"});document.getElementById("criteriaGo").ex_AddClassName("defaultAction")}
function showMapExport(){var a=mygis.Utilities.getVisibleLayerString(currentAppName,!1);document.getElementById("saveAsLink").href=document.getElementById("permaElem").href;document.getElementById("saveAsLink").innerHTML=document.getElementById("saveAsLink").href;document.getElementById("saveAsLegendImg").src="http://mgmapserver.avmap.gr:8081/geoserver/wms?layer="+a+"&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png";$("#saveAs").show().dialog({resizable:!1,title:strings.Export.saveAsWindowTitle})}
function showUserFiles(a,b,c){a||(mygis.UI.MediaManager.bindManagerHandlers(),$("#userFiles").dialog({autoOpen:!1,modal:!0,resizable:!1,width:780,height:510,title:strings.MediaManager.windowTitle,closeOnEscape:!1}),$("#ui-dialog-title-userFiles").parent().css({background:"url('"+config.folderPath+"Images/pictures_folder.png') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"}));$("#userFiles").dialog("open");var d=$("#userFilesList");a&&(d.jqxGrid("clearselection"),d.jqxGrid("clearfilters"),
d.jqxGrid("clear"));var e=function(a,b,c){var d="";switch(b){case "fileID":switch(this.owner.getrowdata(a).fileTYPE.toLowerCase()){case ".png":case ".jpg":case ".jpeg":case ".gif":d=mygis.Utilities.format('<img onclick="{0}" style="margin: 4px;" src="{1}GetImage.ashx?qType=userFile&qContents={2}&qSize=28" />',"return false;",config.folderPath,c);break;case ".doc":case ".docx":d=mygis.Utilities.format('<div class="MMFile {0}" />',"doc");break;case ".xls":case ".xlsx":d=mygis.Utilities.format('<div class="MMFile {0}" />',
"xls");break;case ".ppt":case ".pptx":d=mygis.Utilities.format('<div class="MMFile {0}" />',"ppt");break;case ".pdf":d=mygis.Utilities.format('<div class="MMFile {0}" />',"pdf");break;default:d=mygis.Utilities.format('<div class="MMFile {0}" />',"unknown")}break;case "fileTYPE":switch(c.toLowerCase()){case ".png":case ".jpg":case ".jpeg":case ".gif":a=strings.MediaManager.filetype_Image;break;case ".txt":case ".doc":case ".docx":case ".rtf":case ".pdf":a=strings.MediaManager.filetype_Document;break;
default:a=strings.MediaManager.filetype_Other}d=mygis.Utilities.format("<span class='primaryFileType' style='margin: 9px 4px; float: left;'>{0}<span class='secondaryFileType'>{1}</span></span>",a,c);break;case "fileSIZE":d=mygis.Utilities.format("<span style='margin:9px 4px; float: right;'>{0}</span>",c.toFixed(2));break;case "fileINSERT":d=mygis.Utilities.format("<span style='margin:9px 10px 9px 4px; float: right;'>{0}</span>",c);break;default:d=mygis.Utilities.format("<span style='margin:9px 4px; float: left;'>{0}</span>",
c)}return d};a?mygis.UI.MediaManager.refreshFileList():(mygis.UI.MediaManager.setupGaugeFeedback(),a=c?createFileListApp():createFileList(),d.jqxGrid({source:a,width:760,height:224,autoheight:!1,theme:"pk_mg",enabletooltips:!0,columns:[{text:"",datafield:"fileID",width:36,cellsrenderer:e},{text:"really really really long name",datafield:"fileNAME",cellsrenderer:e},{text:"",datafield:"fileTYPE",width:100,cellsrenderer:e},{text:"",datafield:"fileSIZE",width:95,cellsrenderer:e},{text:"",datafield:"fileINUSE",
width:55,columntype:"checkbox",type:"boolean"},{text:"",datafield:"fileINSERT",width:115,cellsrenderer:e}],enableanimations:!1,showheader:!1,selectionmode:"singlerow",rowsheight:35}),d.bind("rowselect",mygis.UI.MediaManager.fileSelected),$.ajax({url:config.mgreq+"?qtype=GetUserSpace",type:"GET",success:function(a){mygis.UI.MediaManager.setupGaugeValue(parseFloat(a))}}));null==internalConfig.mmCallback.fn?$("#userFilesDialogButtons").hide():$("#userFilesDialogButtons").show();b?mygis.UI.MediaManager.filterImages():
mygis.UI.MediaManager.clearFilterImages()}function fileUploaded(a,b){b.get_fileInfo();b.get_row()}function fileUploading(){$("#userFiles_uploadNew").addClass("disabled")}function fileUploadFinished(){$("#userFiles_uploadNew").removeClass("disabled");mygis.UI.MediaManager.refreshFileList()}
function loadMap(a,b){mygis.Utilities.blockUI();b||(b="mapsList");try{mygis.UI.queryResultsReset()}catch(c){}try{$("#infoLeftList").jqxListBox("clear")}catch(d){}$("#mapsPanel").is(":visible")&&($("#mapsPanel").slideUp("fast"),$("#mapsPanelOverlay").hide().unbind("click"));if($("#"+b).jqxListBox("getSelectedItem")){syncMapSelection(b);var e=$("#"+b).jqxListBox("getSelectedItem").originalItem,f=e.id;currentMapID=f;currentMapMaxExtent=e.maxExtent;currentAppName=e.appName;createLayerList(f);mygis.UI.feedback(strings.Coding.loadingStep4);
mygis.UI.Macros.init();setTimeout(function(){loadMapSequence(e,true);$("#filterContents").empty();mygis.UI.feedback(strings.Coding.loadingStep5);mygis.UI.Help.shortcutStart();setTimeout(function(){createQSList(f);mygis.UI.initHotSearches();if(a)ui_setup_2();else{try{$("#databaseAnalysis").dialog("destroy");$("#databaseAnalysis").empty();mygis.Map.switchBackground(e.mapDefaultBG,0)}catch(b){}$(document).trigger("finishedLoading")}},4)},4)}else mygis.UI.feedback(strings.Coding.loadingStep4,!0),mygis.UI.feedback(strings.Coding.loadingStep5,
!0),a&&ui_setup_2()}
function loadMapSequence(a,b){a||(a=$("#mapsList").jqxListBox("getSelectedItem").originalItem);var c,d=[];layersToLoad=layerSource.records.length;layersLoaded=0;mygis.Map.clearMap(b);c=a.filePath;var e=a.maxExtent,f=a.appName,g=a.mapCenter.split(","),h=a.mapZoom;$("#mapDescription").html(a.mapName);(f=mygis.Utilities.getVisibleLayerString(f))?(c=mygis.Map.getMapServerLayer(f,c,e),c.events.register("loadend",c,finishLoad),d.push(c),digimap.addLayers(d),digimap.setLayerIndex(cosmeticLayer,99),digimap.setLayerIndex(selectionLayer,
100),digimap.setLayerIndex(feedbackLayer,101),b&&(mygis.Map.buildSLDArray(),1<g.length?digimap.setCenter((new OpenLayers.LonLat([g[0],g[1]])).transform(new OpenLayers.Projection(mygis.Utilities.projections.wgs84),digimap.getProjectionObject()),h):digimap.zoomToExtent(c.getMaxExtent()),internalMemory.lastZoom=digimap.getExtent())):mygis.Utilities.unblockUI()}function finishLoad(){this.events.unregister("loadend",this,finishLoad);finishApplicationLoad&&mygis.Utilities.unblockUI()}
function initializeTabs(){tabsInitialized||($("#bottomTabContainer").jqxTabs({width:"100%",height:"auto",theme:"classic",scrollable:!1,selectionTracker:!1,selectedIndex:0}),$("#bottomTabContainer").jqxTabs("disableAt",internalConfig.editTabIndex),$("#bottomTabContainer").bind("selecting",function(a){if(a.args.item==$("#bottomTabContainer").jqxTabs("length")-1){var b=$("#appTabs").parent()[0];b.ex_HasClassName("collapsed")?(b.ex_RemoveClassName("collapsed"),document.getElementById("tabsCloseButton").ex_RemoveClassName("collapsed"),
b=$("#bottomTabContainer").jqxTabs("selectedItem"),b=$("#bottomTabsRow li")[b],b.ex_AddClassName("jqx-tabs-title-selected-top"),b.ex_AddClassName("jqx-tabs-title-selected-top-classic"),b.ex_AddClassName("jqx-fill-state-pressed"),b.ex_AddClassName("jqx-fill-state-pressed-classic")):(b.ex_AddClassName("collapsed"),document.getElementById("tabsCloseButton").ex_AddClassName("collapsed"),b=$("#bottomTabContainer").jqxTabs("selectedItem"),b=$("#bottomTabsRow li")[b],b.ex_RemoveClassName("jqx-tabs-title-selected-top"),
b.ex_RemoveClassName("jqx-tabs-title-selected-top-classic"),b.ex_RemoveClassName("jqx-fill-state-pressed"),b.ex_RemoveClassName("jqx-fill-state-pressed-classic"));a.cancel=!0}else a.args.item!=internalConfig.editTabIndex&&(mygis.UI.toggleActiveList(a.args.item),b=$("#appTabs").parent()[0],b.ex_HasClassName("collapsed")&&(b.ex_RemoveClassName("collapsed"),document.getElementById("tabsCloseButton").ex_RemoveClassName("collapsed"),b=$("#bottomTabContainer").jqxTabs("selectedItem"),b=$("#bottomTabsRow li")[b],
b.ex_AddClassName("jqx-tabs-title-selected-top"),b.ex_AddClassName("jqx-tabs-title-selected-top-classic"),b.ex_AddClassName("jqx-fill-state-pressed"),b.ex_AddClassName("jqx-fill-state-pressed-classic")))}),tabsInitialized=!0)}function initializeInfoWindow(){querySource=[];mygis.UI.updateQueryList();$("#infoLeftList").show();infoWindowInitialized=!0}
function queryResultsMouseOver(a){$(a.target);var a=$("#infoLeftList"),b=a.jqxListBox("getItems"),c=!1,d=0;if(mygis.UI.isActiveSelectMode("mode_ResultsOnHover")){for(;d<b.length&&!c;)$(b[d].element).is(":hover")&&(c=!0),d++;c&&(a=a.jqxListBox("source")[d-1].linkedResults.features)&&mygis.Map.markFeatures(a)}}function queryResultsMouseOut(){$("#infoLeftList").jqxListBox("getSelectedItem")&&mygis.UI.isActiveSelectMode("mode_ResultsOnHover")&&mygis.Map.markFeatures()}
function queryResultsClick(a){var b=$("#infoLeftList").jqxListBox("getSelectedItem").element;a.target==b&&queryResultsSelect()}function queryResultsSelect(){mygis.UI.toggleSearchAvailableActions()}
function populateQueryLayerList(a,b){showInfoDialog("query",b);var c=$("#infoRightCol"),d=$("<ul />");d.attr("id","infoRightTabsQ");c.removeData().empty();c.die();c.append(d);var e;1<c.children().length&&c.children().slice(1).remove();$.each(a,function(a,g){var h=$("<div />"),k=$("<li />"),l=$("<div />");l.attr("class","resultGridButtons");l.html(resultGridButtons.html());var m=!1;d.append(k);h.attr("id","queryTab_"+a);h.append(l);e=g.TableName;k.html(e);0==a&&(m=!0);h.data("clickMe",m);h.data("result",
g);h.data("queryname",b);h.data("windowTitle",e);c.append(h)});c.jqxTabs({width:"100%",height:"100%",theme:"classic",scrollable:!0,scrollPosition:"right",selectionTracker:!0});c.live("selected",infoTabClicked);infoTabClicked(null,0)}function infoTabClicked(a,b,c,d){a=$("#queryTab_"+(a?a.args.item:b));d?populateMapFeatureList(a.data("result"),a,a.data("windowTitle")):c||populateQueryFeatureList(a.data("result"),a,a.data("queryname"),a.data("clickMe"),a.data("tableNAME"))}
function infoTabClickedM(a,b){infoTabClicked(a,b,!1,!0)}function showInfoDialog(a,b){var c;switch(a){case "query":c="queryBuilder/database_search.png";break;case "info":c="info2.png"}b&&mygis.Utilities.format("{0}",b);expandResultDetails();$("#ui-dialog-title-infoAnalysis").parent().css({background:"url('"+config.folderPath+"Images/"+c+"') #F6A828 no-repeat 12px 2px","background-size":"auto 25px"})}
function populateMapFeatureList(a,b,c){var d=[],e=[];$.each(a[0].data,function(a){var b={};b.text=a;b.dataField=a;b.width=100;e.push(b)});$.each(a,function(a,b){var c={},c=b.data;d.push(c)});a=new $.jqx.dataAdapter({localdata:d,datatype:"local"},{async:!1});a.dataBind();a.mydatacolumns=e;infoWindows[c]=a;actualInfoGridPop(c,b)}
function saveAndClose(){var a=document.createElement("FORM");a.id="digiForm";a.name="digiForm";a.method="POST";a.action="";a.target="self";var b=document.createElement("input");b.id="_output";b.name="_output";b.value=getKML();a.appendChild(b);b=document.createElement("input");b.id="_extra";b.name="_extra";b.value=getExtra();a.appendChild(b);b=document.createElement("input");b.id="guid";b.name="guid";b.value=getGUID();a.appendChild(b);b=document.createElement("input");b.id="postbackurl";b.name="postbackurl";
b.value=postbackurl;a.appendChild(b);postbackurl?$.ajax({data:$(a).serialize(),success:function(){self.close()},type:"POST"}):($("#Body").append(a),a.submit());return!1}
function toggleRadControl(a,b){mygis.UI.stopDigitize();var c;document.getElementById(b);switch(a){case "layers":case "tables":c=rsideSplitter;break;case "info":c=wrapSplitter}var d=c.getEndPane().get_collapsed();"layers"==a&&d?showSingleRightPane("cosmeticPanel"):$("#cosmeticPanel").hide();expandRightPane(!c.getEndPane().get_collapsed(),c);ToggleSplitBar(d,c)}
function forwardRightPane(){for(var a=$("#bottomTopPane").find(">div"),b=-1,c=!1,d=0;d<a.length&&!c;)$(a[d]).is(":visible")?(b=d,c=!0):d++;-1<b&&b+1<=a.length-1&&($(a[b]).hide(),$(a[b+1]).show(),1==b&&$("#rotateBackBtn").show(),b+1==a.length-1&&$("#rotateForwardBtn").hide())}
function backRightPane(){for(var a=$("#bottomTopPane").find(">div"),b=-1,c=!1,d=0;d<a.length&&!c;)$(a[d]).is(":visible")?(b=d,c=!0):d++;-1<b&&0<=b-1&&($(a[b]).hide(),$(a[b-1]).show(),0==b-1&&$("#rotateBackBtn").hide(),b==a.length-1&&$("#rotateForwardBtn").show())}
function createMapList(){var a=config.folderPath+"mgreq.ashx?qtype=GetMapList",b;null!=internalConfig.changeDefaultMap&&(a+="&oDef="+internalConfig.changeDefaultMap);b=(b=mygis.Storage.getItem("mapRecords_"+a))&&!Sys.Services.AuthenticationService.get_isLoggedIn()?{datatype:"local",localdata:eval(b)}:{datatype:"json",datafields:[{name:"mapName"},{name:"mapDescription"},{name:"mapLayerCount"},{name:"id"},{name:"defaultLoad"},{name:"filePath"},{name:"maxExtent"},{name:"appName"},{name:"mapCenter"},
{name:"mapZoom"},{name:"mapCreateDate"},{name:"mapUpdateDate"},{name:"mapDevelopedBy"},{name:"mapOwner"},{name:"mapDefaultBG"},{name:"appDisabledBGs"}],id:"id",url:a};mapSource=new $.jqx.dataAdapter(b,{async:!1});mapSource.dataBind();Sys.Services.AuthenticationService.get_isLoggedIn()||mygis.Storage.storeItem("mapRecords_"+a,JSON.stringify(mapSource.records));var c,d=!1;$.each(mapSource.records,function(a,b){"true"==b.defaultLoad&&(c=a);if(b.appDisabledBGs&&!d){d=!0;for(var g=b.appDisabledBGs.split(","),
a=0;a<g.length;a++)delete backgrounds[g[a]]}});$("#mapsList").jqxListBox({source:mapSource,displayMember:"mapName",valueMember:"id",width:232,itemHeight:52,height:"100%",theme:"pk_mg",renderer:function(a,b,c){return retobject=mygis.Utilities.format("<div class='mapListRowContainer' style='height: {1}px;'><a class='loadMapBtn' href='#' title='{3}'><img style='margin-right: 5px;' src='{0}'/><span>{2}</span></a></div>",config.folderPath+"GetImage.ashx?qType=mapThumb&qSize=50&qContents="+c,52,b,strings.MapControl.loadMapTooltip)},
equalItemsWidth:!0});$("#mapsList2").jqxListBox({source:mapSource,displayMember:"mapName",valueMember:"id",width:243,itemHeight:38,height:150,theme:"pk_mg",renderer:function(a,b,c){return retobject=mygis.Utilities.format("<div class='mapListRowContainer' style='height: {1}px;'><a class='loadMapBtn' href='#' title='{3}'><img style='margin-right: 5px;' src='{0}'/><span>{2}</span></a></div>",config.folderPath+"GetImage.ashx?qType=mapThumb&qSize=35&qContents="+c,38,b,strings.MapControl.loadMapTooltip)},
equalItemsWidth:!0});$("#mapsList").jqxListBox("selectIndex",c);$("#mapsList2").jqxListBox("selectIndex",c);$(".loadMapBtn").live("click",function(a){a=$(a.currentTarget).closest("div.jqx-listbox").attr("id");router("lmap",a);return!1})}
function createMapListThumbsUL(){var a=$("#mapSlider"),b=mapSource.getrecords();a.html("");var c=$("<ul />"),d=$("<li />"),e=$("<img />"),f=$("<a />");e.attr("src",config.folderPath+"Images/map_Add.png");e.attr("title","New Map");f.attr("title","New Map");d.attr("title","New Map");f.bind("click",showMapDialog);f.append(e);d.append(f);$.each(b,function(a,b){var d=$("<li />"),e=$("<img />"),f=$("<a />");e.attr("src",config.folderPath+"GetImage.ashx?qType=mapThumb&qContents="+b.id);e.attr("title",b.mapName);
f.attr("title",b.mapName);d.attr("title",b.mapName);f.bind("click",{mapIndex:a},showMapDialog);f.append(e);d.append(f);c.append(d)});b=$("<div />");b.append(c);b.attr("class","es-carousel");a.append(b);a.elastislide({imageW:50,border:0})}
function createLayerList(a){var b=$("#layersList");try{b.die(),b.unbind("cellendedit"),b.unbind("select"),b.unbind("checkchange")}catch(c){}var d=config.folderPath+"mgreq.ashx?qtype=GetLayerList&qContents="+a,e=mygis.Storage.getItem("layerRecords_"+a),d=e&&!Sys.Services.AuthenticationService.get_isLoggedIn()?{datatype:"local",localdata:eval(e)}:{datatype:"json",datafields:[{name:"mapID"},{name:"layerID"},{name:"layerNAME"},{name:"layerDESCRIPTION"},{name:"layerTABLE"},{name:"layerORDER"},{name:"layerEXTENTS"},
{name:"hidden"},{name:"Editable"},{name:"Selectable"},{name:"layerMinScale"},{name:"layerMaxScale"},{name:"manualVisibility"},{name:"layerGeomType"},{name:"folderName"},{name:"layer_ObjectCount"}],id:"layers_asdf",url:d};layerSource=new $.jqx.dataAdapter(d,{async:!1});layerSource.dataBind();mygis.Map.getFieldDescriptions();Sys.Services.AuthenticationService.get_isLoggedIn()||mygis.Storage.storeItem("layerRecords_"+a,JSON.stringify(layerSource.records));layergridSource={localdata:mygis.UI.buildGridSource(layerSource,
"layers",!0),datatype:"array"};$("#layersPanel");a={groupsheaderstring:strings.Grid.groupsheaderstring,sortascendingstring:strings.Grid.sortascendingstring,sortdescendingstring:strings.Grid.sortdescendingstring,sortremovestring:strings.Grid.sortremovestring,groupbystring:strings.Grid.groupbystring,groupremovestring:strings.Grid.groupremovestring};d=[];Sys.Services.AuthenticationService.get_isLoggedIn();d=[{text:"",datafield:"Visible",width:20,cellsrenderer:mygis.UI.layerInnerCellRenderer()},{text:"",
datafield:"Image",width:26,cellsrenderer:mygis.UI.layerGraphicCellRenderer(),editable:!1},{text:strings.LayerControl.columnName,datafield:"Name",cellsrenderer:mygis.UI.layerInnerCellRenderer(),editable:!1}];b.jqxGrid({source:layergridSource,width:241,rowheight:29,autoheight:!0,theme:"pk_mg",columns:d,groups:["folderName"],groupsexpandedbydefault:!0,enableanimations:!0,rowdetails:!1,sortable:!0,groupable:!0,showheader:!1,showgroupsheader:!1,editable:!1,pageable:!1,selectionmode:"none",groupsrenderer:function(a,
b,c,d){a=d.subItems.length;d=d.subItems;countVisible=0;$.each(d,function(a,b){b.Visible&&countVisible++});d="groupVisible jqx-checkbox-default jqx-checkbox-default-pk_mg jqx-rc-all jqx-rc-all-pk_mg";d=countVisible==a?d+" jqx-checkbox-check-checked":0<countVisible?d+" jqx-fill-state-normal jqx-fill-state-normal-pk_mg pressed":d+" jqx-fill-state-normal jqx-fill-state-normal-pk_mg";return"<a href='#' class='"+d+"' onclick=\"router('tlgv','"+b+"');return false;\"></a><div class='groupHeaderRow' title='"+
b+"'>"+b+"</div>"},scrollbarsize:5,rendered:layerGridRendered});mygis.UI.initLayerSelectionList(!0);mygis.UI.initLayerWithinSelectionList(!0);b.jqxGrid("localizestrings",a);b.bind("rowselect",mygis.UI.toggleLayerAvailableActions);b.bind("rowunselect",mygis.UI.toggleLayerAvailableActions);b.bind("mouseover",gridRowsMouseOver);b.bind("mouseout",gridRowsMouseOut);b.find(".layerLegendGraphic").live({mouseenter:layerStyleFullZoom,mouseleave:layerStyleFullZoomOff});Sys.Services.AuthenticationService.get_isLoggedIn()&&
mygis.User.Hooks.loadUserLayerRights()}function createQSList(a){QSSource=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"quickID"},{name:"layername"},{name:"fieldname"},{name:"searchType"},{name:"searchOperator"},{name:"searchLayout"},{name:"searchMode"},{name:"windowTitle"},{name:"windowIcon"},{name:"customFn"},{name:"fieldFill"}],id:"asdfg",url:config.folderPath+"mgreq.ashx?qtype=GetMapQuickSearches&qContents="+a},{async:!1});QSSource.dataBind()}
function createFileList(){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"fileID"},{name:"fileTYPE"},{name:"fileNAME"},{name:"fileINUSE",type:"boolean"},{name:"fileINSERT"},{name:"fileSIZE",type:"number"}],id:"filesource",url:config.mgreq+"?qtype=GetUserFiles"},{async:!1})}
function createFileListApp(){return new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"fileID"},{name:"fileTYPE"},{name:"fileNAME"},{name:"fileINUSE",type:"boolean"},{name:"fileINSERT"},{name:"fileSIZE",type:"number"}],id:"filesource",url:config.mgreq+"?qtype=GetUserFilesApplication&qContents="},{async:!1})}
function layerStyleFullZoom(a){var b=$(a.target),a=b.css("background-image");if("none"!=a){a=0==a.indexOf('url("')?a.substring(5,a.length-2):a.substring(4,a.length-1);a=a.replace("&WIDTH=20&HEIGHT=20","");$("#magnifierStyle").remove();var c=$("<div />");c.attr("id","magnifierStyle");var d=$("<img />"),e,f,b=b.offset();e=b.left+20;f=b.top;d.attr("src",a);c.append(d);var g=$(document).height(),a=c.height();f+a>g&&(f=g-a);c.css({left:e+"px",top:f+"px"});$("Body").append(c);setTimeout(function(){var a=
c.height();f+a>g&&(f=g-a-30);c.css({left:e+"px",top:f+"px"})},300)}}function layerStyleFullZoomOff(){$("#magnifierStyle").remove()}function gridRowsMouseOver(a){$(a.target);for(var a=$("#contenttablelayersList >div"),b=!1,c=0;c<a.length&&!b;){var d=$(a[c]);d.is(":hover")&&(b=!0);c++}b&&(d=d.find(".layer_options")[0])&&d.ex_AddClassName("pressed");return!0}
function gridRowsMouseOut(){for(var a=$("#contenttablelayersList >div").find(".layer_options"),b=0;b<a.length;b++)a[b].ex_RemoveClassName("pressed")}function toggleLayerDetails(){}
function createLayerProperties(){var a=$("#rsideSplitter").height()-10;$("#layerPropertiesTabs").die();$("#layerstylePanel").die();$("#layerPropertiesTabs").jqxNavigationBar({width:324,height:a,sizeMode:"fitAvailableHeight",theme:"pk_mg",expandMode:"toggle",expandedIndex:0});$("#layerstylePanel").jqxNavigationBar({width:300,height:a-235,sizeMode:"fitAvailableHeight",theme:"classic",expandMode:"toggle"})}
function createMapProperties(){var a=$("#rsideSplitter").height()-10;$("#mapsProperties").die();$("#mapsList").die();$("#mapsProperties").jqxNavigationBar({width:"324",height:a,sizeMode:"fitAvailableHeight",theme:"pk_mg",expandMode:"toggle",expandedIndex:0});$("#mapsProperties").bind("collapsedItem",collapseMapProperties)}
function propertiesVisibility(a,b){for(var c=$("#layerPropertiesWrapper").find(">div"),d=0;d<c.length;d++)c[d].id==a&&b?$(c[d]).css("display","block"):$(c[d]).css("display","none");c=$("#rpanelTabButtons a");for(d=0;d<c.length;d++)c[d].ex_RemoveClassName("active");b?(document.getElementById("panel3Out").ex_RemoveClassName("collapsed"),document.getElementById("rpanelCollapseBtn").ex_AddClassName("active"),document.getElementById("panel2").ex_AddClassName("rightExpanded")):(document.getElementById("panel3Out").ex_AddClassName("collapsed"),
document.getElementById("rpanelCollapseBtn").ex_RemoveClassName("active"),document.getElementById("panel2").ex_RemoveClassName("rightExpanded"))}
function expandLayerDetails(a){propertiesVisibility("layerPropertiesPanelCont",!0);a=a?a.args.rowindex:$("#layersList").jqxGrid("getselectedrowindex");a=layerSource.records[a];$("#layerPropertiesDescription").html(a.layerDESCRIPTION);var b=$("#layerPropertiesCommonActions"),c=$("#visibleFrom"),d=$("#visibleTo"),e=b.find(".toggleLayerVisible")[0],f=b.find(".toggleLayerEditable")[0],b=b.find(".toggleLayerSelectable")[0],g=c.find(".visibleFromBtn")[0],c=c.find(".layerVisibleInput")[0],h=d.find(".visibleToBtn")[0],
d=d.find(".layerVisibleInput")[0];a.hidden?e.ex_RemoveClassName("pressed"):e.ex_AddClassName("pressed");a.Editable?f.ex_AddClassName("pressed"):f.ex_RemoveClassName("pressed");a.Selectable?b.ex_AddClassName("pressed"):b.ex_RemoveClassName("pressed");-1<a.layerMinScale?(c.value=mygis.Utilities.addCommas(a.layerMinScale),a.manualVisibility?g.ex_RemoveClassName("pressed"):g.ex_AddClassName("pressed")):g.ex_RemoveClassName("pressed");-1<a.layerMaxScale?(d.value=mygis.Utilities.addCommas(a.layerMaxScale),
a.manualVisibility?h.ex_RemoveClassName("pressed"):h.ex_AddClassName("pressed")):h.ex_RemoveClassName("pressed");createLayerProperties();mygis.UI.initializeStyler(a.layerTABLE,a)}function collapseLayerDetails(){propertiesVisibility("layerPropertiesPanelCont",!1);$("#layersList").jqxGrid("clearselection")}function expandResultDetails(){propertiesVisibility("infoAnalysis",!0);$("#resultsTabButton").is(":visible")||$("#resultsTabButton").show()}
function collapseResultDetails(){propertiesVisibility("infoAnalysis",!1)}function expandMapProperties(){createMapProperties();finishApplicationLoad&&(propertiesVisibility("mapsPropertiesCont",!0),$("#mapsProperties").jqxNavigationBar("expandAt",0),$("#mapsList").bind("select",expandMapProperties))}function collapseMapProperties(){propertiesVisibility("mapsPropertiesCont",!1)}function expandFilters(){propertiesVisibility("filterAnalysis",!0)}
function collapseFilters(){propertiesVisibility("filterAnalysis",!1)}function toggleStylerButton(a){switch(a){case "Point":$("#pointStyleButton");$("#lineStyleButton");$("#polygonStyleButton");break;case "Line":$("#lineStyleButton");$("#pointStyleButton");$("#polygonStyleButton");break;case "Polygon":$("#polygonStyleButton"),$("#lineStyleButton"),$("#pointStyleButton")}}function MakeTimeout(a,b,c,d){setTimeout(function(){a.call(d,b)},c)}
function buildDBSearchSource(a){for(var b=$("#databaseAnalysis").find(".criteriaFirstRow").find(".dbTableName")[0],a=a.records,c=[],d=0;d<a.length;d++){var e=a[d],f={};f.name=e.layerNAME;f.value=e.layerTABLE;c.push(f)}mygis.Utilities.populateSelect(b,c)}
function buildFontSource(a,b){var c=[],d,e,f=parseInt(224/b);0!=224%b&&(f+=1);switch(a){case "Wingdings":for(var g=1;g<=f;g++){d={};for(var h=1;h<=b;h++)e=32+16*parseInt(((g-1)*b+h)/16)+((g-1)*b+h)%16,d["_"+h.toString()]="0x"+e.toString(16);c.push(d)}}return c}
function buildLibrarySource(a,b){var c=[],d,e;switch(a){case "currentMap":var f=mygis.Map.getUniqueGraphics(),g=f.length,h=b<g?b:g;e=parseInt(g/b);0!=g%b&&(e+=1);for(var k=1;k<=e;k++){d={};for(var l=1;l<=h;l++){var m=f[(k-1)*g+l-1];d["_"+l.toString()]=mygis.Utilities.format("{0}#{1}",m.layer,m.graphicUrl)}c.push(d)}}return c}
function updateMapProperties(){var a=$("#mapsList").jqxListBox("getSelectedItem");a&&(a=a.originalItem,$("#layerMapTitle").html(a.mapName),$("#mapShortDescription").html(a.mapDescription),a.mapDescription?$("#mapShortDescription").show():$("#mapShortDescription").hide(),document.getElementById("mapLargeThumb").src=config.folderPath+"GetImage.ashx?qType=mapThumb&qSize=300&qContents="+a.id,$("#mapLayerCount").html(a.mapLayerCount),$("#mapCreatedDate").html(a.mapCreateDate),$("#mapUpdateDate").html(a.mapUpdateDate),
$("#mapOwner").html(a.mapOwner),$("#mapDeveloper").html(a.mapDevelopedBy));return!1}function updateLayerProperties(){$("#layersList").jqxTree("selectedItem")}
function createMapListTips(){var a=$("#mapsList").find("#listBoxContent>div>div");if(0==a.length)setTimeout(createMapListTips,500);else{a.addClass("listFullWidth");for(var a=$("#mapsList").jqxListBox("getItems"),b=0;b<a.length;b++)try{var c=a[b].element;if("false"!=a[b].originalItem.defaultLoad&&0==$(c).parent().find(".mapsListButtons").length){var d=$("<div />");d.addClass("mapsListButtons");var e=$("<a />");e.addClass("starButton");e.attr("title",strings.MapControl.currentMap);d.append(e);d.insertBefore(c)}}catch(f){console.log(f)}mapsBound||
($("#mapsList").bind("change",function(a){updateMapProperties(a)}),mapsBound=!0);c=$("#mapsList").jqxListBox("getSelectedIndex");$("#mapsList").jqxListBox("clearSelection");$("#mapsList").jqxListBox("selectIndex",c)}}
function setUpQTips(){singleQTip("cosmetic");singleQTip("mapSaveBtn");singleQTip("mode_TopSelect");singleQTip("mode_InfoSelect");singleQTip("mode_InfoStore");singleQTip("mode_AddSelect");singleQTip("mode_SubtractSelect");singleQTip("editModeCopy");singleQTip("editModePaste");singleQTip("editModeDelete");singleQTip("editModeDrag");singleQTip("editModeRotate");singleQTip("editModeResize");singleQTip("editModeReshape");singleQTip("mode_EditableInfo");singleQTip("mode_Grouping");singleQTip("mode_Snap");
singleQTip("dragPanBtn");singleQTip("zoomBoxBtn");singleQTip("zoomOutBtn");singleQTip("toggleInfoBtn");singleQTip("selectObject");singleQTip("infoTool");singleQTip("selectRect");singleQTip("selectCircle");singleQTip("selectClear");singleQTip("markerButton");singleQTip("polylineButton");singleQTip("polygonButton");singleQTip("rectangleButton");singleQTip("mapActionsBtn")}
function singleQTip(a,b){var c,d,e="top left",f="bottom right",g=!1,h="click",k=!1,l="mouseleave unfocus",m=!1,n=3E3;switch(a){case "editField":c=b.message;d=b.element;h="mouseover click";m=k=!1;e="left center";f="right center";n=6E3;l="click unfocus";break;case "polygon":case "marker":case "polyline":case "rectangle":c=b[1];d="<div />";e="top center";g=b[0];h=$("#mapContainer").offset();g=[h.left+g.x,h.top+g.y+10];k=!0;h="mouseover";l="mouseleave unfocus";m=!0;break;case "cosmetic":c=strings.LayerControl.tipEdit;
d=$("#cosmeticPanel").find("div.RadListBox");h="mouseover";e="bottom center";f="top center";break;case "mapActionsBtn":case "mapAction_Maps":case "mapAction_Layers":case "mapAction_Tables":case "mapSaveBtn":d=$("#"+a);h="mouseover";e="bottom center";f="top center";switch(a){case "mapActionsBtn":c=tip_btnErgaleia;break;case "mapAction_Maps":c=tip_btnMaps;break;case "mapAction_Layers":c=tip_btnLayers;break;case "mapAction_Tables":c=tip_btnTables;break;case "mapSaveBtn":c=tip_btnSave}break;case "mapList":d=
$(b[0]);h="mouseover";e="bottom center";f="top center";c=b[1];break;case "projection":d=$("#map_projection_node");h="mouseover";e="bottom center";f="top center";c=b[0];break;case "tip_MacroName":d=$("#tip_MacroName");h="mouseover";e="left center";f="right center";c=b[0];break;case "tip_MacroSelector":d=$("#tip_MacroSelector");h="mouseover";e="left center";f="right center";c=b[0];break;case "tip_MacroButton":d=$("#tip_MacroButton");h="mouseover";e="left center";f="right center";c=b[0];break;case "tip_MacroRegistered":d=
$("#tip_MacroRegistered");h="mouseover";e="left center";f="right center";c=b[0];break;case "tip_MacroApp":d=$("#tip_MacroApp");h="mouseover";e="left center";f="right center";c=b[0];break;case "mode_TopSelect":case "mode_InfoSelect":case "mode_InfoStore":case "mode_AddSelect":case "mode_SubtractSelect":case "editModeCopy":case "editModePaste":case "editModeDelete":case "editModeDrag":case "editModeRotate":case "editModeResize":case "editModeReshape":case "mode_EditableInfo":case "mode_Grouping":case "mode_Snap":d=
"#"+a;h="mouseover";e="left center";f="right center";c=strings.MapTools[a];break;case "dragPanBtn":case "zoomBoxBtn":case "zoomOutBtn":case "toggleInfoBtn":case "selectObject":case "infoTool":case "selectRect":case "selectCircle":case "selectClear":case "markerButton":case "polylineButton":case "polygonButton":case "rectangleButton":case "mapActionsBtn":d="#"+a;h="mouseover";e="bottom center";f="top center";c=strings.MapTools[a];break;case "switchBG":d=b[0];h="mouseover";e="right center";f="left center";
c=strings.LayerControl.tip_ChangeBG_cb;k=!0;h="mouseover";m=!0;n=6E3;break;case "mapResultsToggler":d="#panel2 .ui-layout-toggler",c=strings.HelpSystem.mapResults,e="bottom center",f="top center",l="click",h="mouseover",k=!0}$(d).qtip({content:{text:c},position:{my:e,at:f,viewport:$(window),target:g},show:{event:h,ready:k,solo:!0,delay:1E3},hide:{event:l,inactive:n},events:{hide:function(a,b){m&&b.destroy()}},style:{classes:"ui-tooltip-shadow",tip:{border:1},border:1}})}
function setMarkerStyleTree(){$("#markerFolders").jstree({html_data:{ajax:{url:config.folderPath+"Scripts/markerStyleTree.html",data:function(a){return{id:a.attr?a.attr("id"):0}}}},themes:{theme:"pk",dots:!1,icons:!1},ui:{initially_select:["nodeDefault"],select_limit:1},plugins:["themes","html_data","ui"]}).bind("select_node.jstree",function(a,b){var c=b.inst,d=b.rslt.obj,e;c.is_leaf(d)?(e=c._get_parent(d),c.get_text(d),-1!==e&&c.get_text(e)):c.toggle_node(d)})}
function showConfirmationDialog(a,b,c){$("#confirmationAction").html(a);$("#confirmationBox").dialog({buttons:{Confirm:{text:strings.ConfirmBox.buttonConfirm,"class":"confirmButton",click:function(){closeConfirm();b&&b()}},Cancel:{text:strings.ConfirmBox.buttonCancel,"class":"cancelButton",click:function(){closeConfirm();c&&c()}}},modal:!0,draggable:!1,resizable:!1}).siblings("div.ui-dialog-titlebar").remove()}
function showEditFieldDialog(a,b,c,d){$("#editRecordNo").html("#"+d);$("#editLayerName").html(a);$("#fieldColumnName").html(b);$("#fieldEditor").attr("value",c);$("#editFieldBox").dialog({modal:!0,draggable:!0,resizable:!1,open:mygis.Utilities.unbindGlobalHandlers,close:mygis.Utilities.rebindGlobalHandlers}).siblings("div.ui-dialog-titlebar").remove()}function editRouter(){var a=$(this).data("attachedData");showEditFieldDialog(a.layername,a.fieldname,a.existingValue,a.recordIndex)}
function closeConfirm(){$("#confirmationBox").dialog("close")}function fixLayerList(){}function layerGridRendered(){}
jQuery.fn.animateStrikethrough=function(a,b){return this.each(function(){0==jQuery(this).find(".strike").length&&(jQuery(this).wrapInner("<span class='letters-left'></span>"),jQuery(this).prepend("<span class='strike'></span>"));var c=jQuery(this);jQuery(c).find(".strike");var d=jQuery(c).find(".letters-left");strikethrough=setInterval(function(){jQuery(c).strikeThroughFirstLetter();if(jQuery(d).text().length==0){jQuery(c).addClass("strike");clearInterval(strikethrough);typeof b=="function"&&b()}},
a)})};jQuery.fn.strikeThroughFirstLetter=function(){return this.each(function(){jQuery(this).find(".strike").transposeFirstLetter(jQuery(this).find(".letters-left"));jQuery(this).find(".letters-left").removeFirstLetter()})};jQuery.fn.transposeFirstLetter=function(a){return this.each(function(){var b=jQuery(this).text()+jQuery(a).text().charAt(0);jQuery(this).text(b)})};jQuery.fn.removeFirstLetter=function(){return this.each(function(){var a=jQuery(this).text().replace(/^./,"");jQuery(this).text(a)})};
var notSupportedBrowsers=[{os:"Any",browser:"MSIE",version:9},{os:"Any",browser:"Firefox",version:3}],displayPoweredBy=!1,noticeLang="pk",noticeLangCustom=null,supportedBrowsers=[],BrowserDetection={init:function(){if(null==notSupportedBrowsers||1>notSupportedBrowsers.length)notSupportedBrowsers=this.defaultNotSupportedBrowsers;this.detectBrowser();this.detectOS();if(!(""==this.browser||"Unknown"==this.browser||""==this.os||"Unknown"==this.os||""==this.browserVersion||0==this.browserVersion)){for(var a=
!1,b=0;b<notSupportedBrowsers.length;b++)if("Any"==notSupportedBrowsers[b].os||notSupportedBrowsers[b].os==this.os)if("Any"==notSupportedBrowsers[b].browser||notSupportedBrowsers[b].browser==this.browser)if("Any"==notSupportedBrowsers[b].version||this.browserVersion<=parseFloat(notSupportedBrowsers[b].version)){a=!0;break}a&&this.displayNotice()}},getEl:function(a){return window.document.getElementById(a)},getElSize:function(a){a=this.getEl(a);return null==a?null:{width:parseInt(a.offsetWidth),height:parseInt(a.offsetHeight)}},
getWindowSize:function(){return"undefined"!=typeof window.innerWidth?{width:parseInt(window.innerWidth),height:parseInt(window.innerHeight)}:0!=window.document.documentElement.clientWidth?{width:parseInt(window.document.documentElement.clientWidth),height:parseInt(window.document.documentElement.clientHeight)}:{width:parseInt(window.document.body.clientWidth),height:parseInt(window.document.body.clientHeight)}},positionNotice:function(){var a=this.getElSize("browser-detection"),b=this.getWindowSize(),
c=this.getEl("browser-detection");null==c||(null==a||null==b||!b.width||!b.height)||(c.style.left=(b.width-a.width)/2+"px",c.style.top=b.height-a.height-20+("MSIE"==this.browser&&7>this.browserVersion?0!=window.document.documentElement.scrollTop?window.document.documentElement.scrollTop:window.document.body.scrollTop:0)+"px",this.noticeHeight=a.height)},displayNotice:function(){this.writeNoticeCode();this.positionNotice();var a=this;"MSIE"==this.browser&&10>this.browserVersion&&(window.onscroll=function(){a.positionNotice()});
this.getEl("browser-detection-close").onclick=function(){a.remindMe(false)};this.getEl("browser-detection-remind-later").onclick=function(){a.remindMe(false)};this.getEl("browser-detection-never-remind").onclick=function(){a.remindMe(true)}},remindMe:function(a){this.writeCookie("bdnotice",1,!0==a?365:7);this.getEl("browser-detection").style.display="none";this.getEl("black_overlay").style.display="none"},writeCookie:function(a,b,c){var d="";0<parseInt(c)&&(d=new Date,d.setTime(d.getTime()+864E5*
parseInt(c)),d="; expires="+d.toGMTString());document.cookie=a+"="+b+d+"; path=/"},readCookie:function(a){if(!document.cookie)return"";for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(;" "==b[c].charAt(0);)b[c]=b[c].substring(1,b[c].length);if(0==b[c].indexOf(a))return b[c].substring(a.length,b[c].length)}return""},writeNoticeCode:function(){var a="",b="",c="",d=null,e='<div id="black_overlay"></div><div id="browser-detection"><a href="javascript:;" id="browser-detection-close">Close</a>';
"custom"==noticeLang&&null!=noticeLangCustom?(a=noticeLangCustom.title,b=noticeLangCustom.notice,c=noticeLangCustom.selectBrowser):(d=null,eval("noticeTextObj = this.noticeText."+noticeLang+";"),d||(d=this.noticeText.professional),a=d.title,b=d.notice,c=d.selectBrowser);b=b.replace("\n",'</p><p class="bd-notice">');b=b.replace("{browser_name}",this.browser+" "+this.browserVersion);d=0<supportedBrowsers.length?supportedBrowsers:this.supportedBrowsers;e=e+('<p class="bd-title">'+a+'</p><p class="bd-notice">'+
b+'</p><p class="bd-notice"><b>'+c+"</b></p>")+'<ul class="bd-browsers-list">';for(a=0;a<d.length;a++)e+='<li class="'+d[a].cssClass+'"><a href="'+d[a].downloadUrl+'" target="_blank">'+d[a].name+"</a></li>";e+="</ul>";displayPoweredBy&&(e+='<div class="bd-poweredby">Powered by <a href="http://www.devslide.com/labs/browser-detection" target="_blank">DevSlide Labs</a></div>');window.document.body.innerHTML=e+"</div>"},detectBrowser:function(){this.browser="";this.browserVersion=0;/Opera[\/\s](\d+\.\d+)/.test(navigator.userAgent)?
this.browser="Opera":/MSIE (\d+\.\d+);/.test(navigator.userAgent)?this.browser="MSIE":/Navigator[\/\s](\d+\.\d+)/.test(navigator.userAgent)?this.browser="Netscape":/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)?this.browser="Chrome":/Safari[\/\s](\d+\.\d+)/.test(navigator.userAgent)?(this.browser="Safari",/Version[\/\s](\d+\.\d+)/.test(navigator.userAgent),this.browserVersion=new Number(RegExp.$1)):/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&(this.browser="Firefox");""==this.browser?
this.browser="Unknown":0==this.browserVersion&&(this.browserVersion=parseFloat(new Number(RegExp.$1)))},detectOS:function(){for(var a=0;a<this.operatingSystems.length;a++)if(-1!=this.operatingSystems[a].searchString.indexOf(this.operatingSystems[a].subStr)){this.os=this.operatingSystems[a].name;return}this.os="Unknown"},noticeHeight:0,browser:"",os:"",browserVersion:"",supportedBrowsers:[{cssClass:"firefox",name:"Mozilla Firefox",downloadUrl:"http://www.getfirefox.com/"},{cssClass:"chrome",name:"Google Chrome",
downloadUrl:"http://www.google.com/chrome/"},{cssClass:"msie",name:"Internet Explorer",downloadUrl:"http://www.google.com/chromeframe/eula.html?quickenable=true/"},{cssClass:"opera",name:"Opera",downloadUrl:"http://www.opera.com/"}],operatingSystems:[{searchString:navigator.platform,name:"Windows",subStr:"Win"},{searchString:navigator.platform,name:"Mac",subStr:"Mac"},{searchString:navigator.platform,name:"Linux",subStr:"Linux"},{searchString:navigator.userAgent,name:"iPhone",subStr:"iPhone/iPod"}],
defaultNotSupportedBrowsers:[{os:"Any",browser:"MSIE",version:8}],noticeText:{professional:{title:"Not suppported Browser Detected",notice:"Our website has detected that you are using an outdated or not supported browser. Using your current browser will prevent you from accessing features on our website. An upgrade is not required, but is strongly recommend to improve your browsing experience on our website.",selectBrowser:"Use the links below to download a new browser or upgrade your existing browser.",
remindMeLater:"Remind me later",neverRemindAgain:"No, don't remind me again"},pk:{title:"Not suppported browser detected",notice:"Our website has detected that you are using an outdated or not supported browser. Using your current browser will prevent you from accessing features on our website. An upgrade is required.",remindMeLater:"Remind me later",neverRemindAgain:"No, don't remind me again"},informal:{title:"Whoaaa!",notice:"It appears you're using an outdated browser which prevents access to some of the features on our website. While it's not required, you really should <b>upgrade or install a new browser</b>!",
selectBrowser:"Visit the official sites for popular browsers below:",remindMeLater:"Not now, but maybe later",neverRemindAgain:"No, don't remind me again"},technical:{title:"Old Browser Alert! <span class='bd-highlight'>DEFCON 5</span>",notice:"Come on! If you are hitting our site, then you must at least be partially tech savvy. So, why the older browser? We're not asking you to brush off your old Fibonacci Heap and share it with the class. Just upgrade!\nI know, I know. You don't like to be told what to do. But, we're only asking you to upgrade so you can access all the latest, greatest features on our site. It's quick and easy. But, if you still want to skip it, that's cool. We will still welcome you &mdash; and your creepy old browser. :P",
selectBrowser:"Visit the official sites for popular browsers below:",remindMeLater:"Remind me later",neverRemindAgain:"No, don't remind me. I like my Commodore 64!"},goofy:{title:"Are You Serious?",notice:"Are you really using <b>{browser_name}</b> as your browser?\nYou're surfing the web on a dinosaur (a dangerous one too &mdash; like a Tyrannosaurus or Pterodactyl or something scary like that). <b>Get with it and upgrade now!</b> If you do, we promise you will enjoy our site a whole lot more. :)",
selectBrowser:"Visit the official sites for popular browsers below:",remindMeLater:"Maybe Later",neverRemindAgain:"No, don't remind me again"},mean:{title:"Umm, Your Browser Sucks!",notice:"Get a new one here.",selectBrowser:"Official sites for popular browsers:",remindMeLater:"Remind me later, a'hole",neverRemindAgain:"F' off! My browser rocks!"}}};window.onload=function(){BrowserDetection.init()};
$(document).ready(function(){layout=$("#applicationContainer").layout({north__closable:!1,spacing_open:0,spacing_closed:0,west__onresize:function(){fixLayerList()},center__onresize:function(a,b){digimap.updateSize();$.layout.callbacks.resizePaneAccordions(a,b)}});panel1=$("#panel1").layout({north__size:100,north__resizable:!1,north__closable:!1});singleQTip("mapResultsToggler");window.errors={};window.checkImage=function(a,b,c){var d=new Image,e=!1,f=!1;d.onload=function(){e||(e=!0,b&&b.call&&b.call(d,
d))};d.onerror=function(){f||(window.errors[a]=f=!0,c&&c.call&&c.call(d,d))};d.src=a;window.errors[a]&&d.onerror.call(d,d);d.complete&&d.onload.call(d)};$("#dialog-extend-fixed-title").bind("click",mygis.UI.toggleInfoGroup);ui_setup()});function replace_initialLogo(){var a=$("#logoPane").parent().find(".domainLogoWrapper2 img")[0],b=$("#initialLoad").find(".mygis_logo img")[0];a.src&&(b.src=a.src)}
function ui_setup(){mygis.Utilities.blockUI(!0);$("#mapChangeBtn").click(function(){router("shortcutMaps")});mygis.UI.resetLoadFeedback();mygis.UI.feedback(strings.Coding.loadingStep1);setTimeout(function(){mygis.UI.initializeStyleSheets();$("#olScaleLine_wrapper").find(".olControlScaleLineTop").css({visibility:"visible !important"});$(".backBtn").button();$(".forwardBtn").button();$("#polylineStrokeColor").bind("colorpicked",function(){mygis.UI.updateLinePreview()});$("#polygonStrokeColor").bind("colorpicked",
function(){mygis.UI.updatePolyPreview()});$("#polygonFillColor").bind("colorpicked",function(){mygis.UI.updatePolyPreview()});$("#layerOpacitySlider").slider({max:1,min:0,value:0,step:0.25,slide:mygis.UI.changeLayerOpacity});$("#markerSizeSlider").slider({max:128,min:8,step:1,value:32,slide:mygis.UI.changeMarkerSize});$("#pointColumns").jqxNumberInput({width:"50px",height:"25px",decimal:5,min:1,max:7,decimalDigits:0,spinButtons:!0,inputMode:"simple",theme:"energyblue"});$("#pointColumns").bind("valuechanged",
function(){var a=document.getElementById("pointFontFamily");mygis.UI.populatePointIcons("font",a.options[a.options.selectedIndex].value)});$("#pointBorderSlider").slider({max:32,min:1,value:1,step:1,slide:mygis.UI.changePointBorder});$("#pointOpacitySlider").slider({max:1,min:0,value:0,step:0.25,slide:mygis.UI.changePointOpacity});$("#lineStrokeOpacitySlider").slider({max:1,min:0,step:0.25,value:1,slide:mygis.UI.changeLineOpacity});$("#lineStrokeWeightSlider").slider({max:32,min:1,value:3,step:1,
slide:mygis.UI.changeLineWeight});$("#polygonStrokeOpacitySlider").slider({max:1,min:0,step:0.25,value:1,slide:mygis.UI.changePolyStrokeOpacity});$("#polygonFillOpacitySlider").slider({max:1,min:0,step:0.25,value:0.5,slide:mygis.UI.changePolyFillOpacity});$("#polygonStrokeWeightSlider").slider({max:32,min:1,value:3,step:1,slide:mygis.UI.changePolyWeight});$(".saveActionLine").find(".forwardBtn").button().bind("click",saveAndClose);$("#login_btn").hover(function(){$("#login_btn").stop().animate({backgroundPosition:"138px 0px"},
900);$("#login_btn").css({backgroundColor:"white"})});$("#login_btn").mouseout(function(){$("#login_btn").stop().animate({backgroundPosition:"0 0"},900);$("#login_btn").css({backgroundColor:"#F2F2F2"})});$("#Notification").jnotifyInizialize({oneAtTime:!0,appendType:"append"}).css({position:"fixed",top:"1px",left:"50%","margin-left":"-250px",width:"500px","z-index":"100000","padding-top":"5px"}).appendTo($("#Body"));$("#mapActionsBtn").bind("click",function(){toolbarToggling||(toolbarToggling=!0,$("#fWindowWrapper").is(":visible")?
($("#fWindowWrapper").hide("slide",{direction:"up"},1E3,function(){toolbarToggling=!1}),document.getElementById("mapActionsBtn").setAttribute("class",""),document.getElementById("mapActionsBtn").setAttribute("className",""),$("#rsideSplitter").jqxSplitter("collapseAt",0)):($("#fWindowWrapper").show("slide",{direction:"up"},1E3,function(){toolbarToggling=!1}),document.getElementById("mapActionsBtn").setAttribute("class","pressed"),document.getElementById("mapActionsBtn").setAttribute("className","pressed"),
$("#rsideSplitter").jqxSplitter("expandAt",0)))});$("#allListsTabButton").bind("click",function(){document.getElementById("panel1").ex_HasClassName("collapsed")?(document.getElementById("panel1").ex_RemoveClassName("collapsed"),document.getElementById("allListsTabButton").ex_AddClassName("active"),document.getElementById("panel2").ex_AddClassName("leftExpanded")):(document.getElementById("panel1").ex_AddClassName("collapsed"),document.getElementById("allListsTabButton").ex_RemoveClassName("active"),
document.getElementById("panel2").ex_RemoveClassName("leftExpanded"))});$("#rpanelCollapseBtn").bind("click",function(){document.getElementById("panel3Out").ex_HasClassName("collapsed")?(document.getElementById("panel3Out").ex_RemoveClassName("collapsed"),document.getElementById("rpanelCollapseBtn").ex_AddClassName("active"),document.getElementById("panel2").ex_AddClassName("rightExpanded")):(document.getElementById("panel3Out").ex_AddClassName("collapsed"),document.getElementById("rpanelCollapseBtn").ex_RemoveClassName("active"),
document.getElementById("panel2").ex_RemoveClassName("rightExpanded"))});$("#resultsTabButton").bind("click",function(){propertiesVisibility("infoAnalysis",!document.getElementById("resultsTabButton").ex_HasClassName("active"))});$("#mapActionsBtn").click();setUpQTips();var a=$(".leftpanes");$("#menuTriggerBtn").bind("click",function(){slideMenuVisible||(a.css({"margin-left":"0px"}),slideMenuVisible=!0)});a.bind("mouseenter",function(){clearTimeout(impendingSlideClose)});a.bind("mouseleave",function(){slideMenuVisible&&
(a.css({"margin-left":"-195px"}),slideMenuVisible=!1)});var b=$("#infoAnalysis_SearchInput");b.data("oldVal","");b.bind("propertychange keyup input paste",mygis.UI.filterSearchResults);b.bind("focus",function(){mygis.UI.toggleSearchFilterFocus(!0)});b.bind("blur",function(){mygis.UI.toggleSearchFilterFocus(!1)});mygis.UI.feedback(strings.Coding.loadingStep2);createMapList();mygis.UI.feedback(strings.Coding.loadingStep3,0==$("#mapsList").jqxListBox("source").records);loadMap(!0)},100)}
function ui_setup_2(){mygis.UI.togglePointMode();mygis.UI.feedback("");setTimeout(function(){resultGridButtons=$("<div />");setTimeout(function(){initializeTabs();$("#bottomTabContainer").jqxTabs("ensureVisible",0)},1500);setTimeout(createMapListTips,1E3);finishApplicationLoad=!0;var a=$("#mapsList").jqxListBox("getSelectedItem").originalItem;mygis.Map.switchBackground(a.mapDefaultBG,0);setTimeout(function(){mygis.Utilities.unblockUI();$(document).trigger("initMapFinished");$(".blockUI.blockOverlay").animate({opacity:0},
1400);$("#page_effect").animate({opacity:1},1400);digimap.updateSize();$("#pageActionsWrapper").animate({opacity:1},1400);Sys.Services.AuthenticationService.get_isLoggedIn()&&mygis.User.Hooks.initialLoad();setTimeout(function(){panel1.sizePane("north",$("#customOverview").height()+$("#bottomTabContainer").height()-4)},2E3);mygis.Map.moveEnd();$(document).trigger("finishedLoading")},1400)},1400)}
function loadFragment(a,b,c,d){var e;e=c?$(c):$("#"+a);0==e.children().length?$.ajax({url:"/mgfrag2.aspx?qtype="+a+"&language="+Sys.CultureInfo.CurrentCulture.name,type:"GET",dataType:"html",success:function(c){c=$(c).find("#"+a).html();d&&$(c).find("*").removeAttr("id");e.html(c);b&&b()}}):b()}
function testLocal(a){for(var a=a.target.files,b=0,c;c=a[b];b++)c.type.match("image.*")&&(document.getElementById("testLocalImg").src=window.URL.createObjectURL(c),c=document.getElementById("testLocalImg").src.split(":"),c=new OpenLayers.Layer.Image("City Lights",c[0]+":http://localhost/"+c[1],new OpenLayers.Bounds(digimap.getExtent()),new OpenLayers.Size(580,288)),digimap.addLayer(c))}
(function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,f){a(window).scrollTo(b,c,f)};c.defaults={axis:"xy",duration:1.3<=parseFloat(a.fn.jquery)?0:1};c.window=function(){return a(window)._scrollable()};a.fn._scrollable=function(){return this.map(function(){if(this.nodeName&&-1==a.inArray(this.nodeName.toLowerCase(),["iframe","#document","html","body"]))return this;var b=(this.contentWindow||this).document||this.ownerDocument||this;return a.browser.safari||
"BackCompat"==b.compatMode?b.body:b.documentElement})};a.fn.scrollTo=function(d,e,f){"object"==typeof e&&(f=e,e=0);"function"==typeof f&&(f={onAfter:f});"max"==d&&(d=9E9);f=a.extend({},c.defaults,f);e=e||f.speed||f.duration;f.queue=f.queue&&1<f.axis.length;f.queue&&(e/=2);f.offset=b(f.offset);f.over=b(f.over);return this._scrollable().each(function(){function g(a){k.animate(n,e,f.easing,a&&function(){a.call(this,d,f)})}var h=this,k=a(h),l=d,m,n={},o=k.is("html,body");switch(typeof l){case "number":case "string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(l)){l=
b(l);break}l=a(l,this);case "object":if(l.is||l.style)m=(l=a(l)).offset()}a.each(f.axis.split(""),function(a,b){var d=b=="x"?"Left":"Top",e=d.toLowerCase(),p="scroll"+d,u=h[p],v=c.max(h,b);if(m){n[p]=m[e]+(o?0:u-k.offset()[e]);if(f.margin){n[p]=n[p]-(parseInt(l.css("margin"+d))||0);n[p]=n[p]-(parseInt(l.css("border"+d+"Width"))||0)}n[p]=n[p]+(f.offset[e]||0);f.over[e]&&(n[p]=n[p]+l[b=="x"?"width":"height"]()*f.over[e])}else{d=l[e];n[p]=d.slice&&d.slice(-1)=="%"?parseFloat(d)/100*v:d}/^\d+$/.test(n[p])&&
(n[p]=n[p]<=0?0:Math.min(n[p],v));if(!a&&f.queue){u!=n[p]&&g(f.onAfterFirst);delete n[p]}});g(f.onAfter)}).end()};c.max=function(b,c){var f="x"==c?"Width":"Height",g="scroll"+f;if(!a(b).is("html,body"))return b[g]-a(b)[f.toLowerCase()]();var f="client"+f,h=b.ownerDocument.documentElement,k=b.ownerDocument.body;return Math.max(h[g],k[g])-Math.min(h[f],k[f])}})(jQuery);Telerik.Web.UI.RadAsyncUpload.prototype._updateFormProperties=function(a){a&&(a.enctype=a.encoding="multipart/form-data")};
function contextMenu(a){var b=this,c=null;this.div=a;this.items=[];this.create=function(a){var b=$('<div class="item '+a.cl+'">'+a.label+"</div>");b.click(function(){"function"===typeof a.fnc&&a.fnc.apply($(this),[])}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});return b};this.clearTs=function(){c&&(clearTimeout(c),c=null)};this.initTs=function(a){c=setTimeout(function(){b.close()},a)}}
contextMenu.prototype.add=function(a,b,c){this.items.push({label:a,fnc:c,cl:b})};contextMenu.prototype.open=function(a){this.close();var b,c=this,d=$('<div id="right-menu"></div>');for(b=0;b<this.items.length;b++)d.append(this.create(this.items[b]));d.hover(function(){c.clearTs()},function(){c.initTs(3E3)});d.css({top:a.layerY,left:a.layerX,position:"absolute"});rightmenuOpen=!0;$(digiContainer).append(d);this.initTs(5E3);return!1};
contextMenu.prototype.close=function(){this.clearTs();rightmenuOpen=!1;$("#right-menu").remove()};
var loadGoogleMaps=function(a){var b=a.now(),c;return function(d,e,f){if(c)return c;var g=a.Deferred(),h=function(){g.resolve(window.google&&google.maps?google.maps:!1)},k="loadGoogleMaps_"+b++,e=a.extend({sensor:!1},e?{key:e}:{},f?{language:f}:{},{libraries:"places"});window.google&&google.maps?h():window.google&&google.load?google.load("maps",d||3,{other_params:a.param(e),callback:h}):(e=a.extend(e,{v:d||3,callback:k}),window[k]=function(){h();setTimeout(function(){try{delete window[k]}catch(a){}},
20)},a.ajax({dataType:"script",data:e,url:"http://maps.google.com/maps/api/js"}));return c=g.promise()}}(jQuery);function syncMapSelection(a){$("#"+("mapsList"==a?"mapsList2":"mapsList")).jqxListBox("selectIndex",$("#"+a).jqxListBox("getSelectedIndex"))};
