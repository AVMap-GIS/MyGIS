<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scripts\mg_admin.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><a href="..&#x2F;index.html"><img src="..&#x2F;assets/css/logo.png" title=""></a></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for MyGIS version 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/mygis.Admin.html">mygis.Admin</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.AppManager.html">mygis.Admin.AppManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.AppManager.Apps.html">mygis.Admin.AppManager.Apps</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.AppManager.Maps.html">mygis.Admin.AppManager.Maps</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.AppManager.Styles.html">mygis.Admin.AppManager.Styles</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.AppManager.URLs.html">mygis.Admin.AppManager.URLs</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.LayerManager.html">mygis.Admin.LayerManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.LogManager.html">mygis.Admin.LogManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.html">mygis.Admin.MapManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.Layers.html">mygis.Admin.MapManager.Layers</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.Macros.html">mygis.Admin.MapManager.Macros</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.Maps.html">mygis.Admin.MapManager.Maps</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.Permissions.html">mygis.Admin.MapManager.Permissions</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.MapManager.QuickSearches.html">mygis.Admin.MapManager.QuickSearches</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.UI.html">mygis.Admin.UI</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.UserManager.html">mygis.Admin.UserManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Admin.Utilities.html">mygis.Admin.Utilities</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Drawing.html">mygis.Drawing</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Drawing.Editing.html">mygis.Drawing.Editing</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Drawing.Exporting.html">mygis.Drawing.Exporting</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Drawing.Importing.html">mygis.Drawing.Importing</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Drawing.Styling.html">mygis.Drawing.Styling</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Map.html">mygis.Map</a></li>
            
                <li><a href="..&#x2F;classes/mygis.OLOverrides.html">mygis.OLOverrides</a></li>
            
                <li><a href="..&#x2F;classes/mygis.OLOverrides.mygis_Control.html">mygis.OLOverrides.mygis_Control</a></li>
            
                <li><a href="..&#x2F;classes/mygis.OLOverrides.mygis_Control.mygis_GetFeature.html">mygis.OLOverrides.mygis_Control.mygis_GetFeature</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Printing.html">mygis.Printing</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Query.html">mygis.Query</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Storage.html">mygis.Storage</a></li>
            
                <li><a href="..&#x2F;classes/mygis.UI.html">mygis.UI</a></li>
            
                <li><a href="..&#x2F;classes/mygis.UI.Help.html">mygis.UI.Help</a></li>
            
                <li><a href="..&#x2F;classes/mygis.UI.Hooks.html">mygis.UI.Hooks</a></li>
            
                <li><a href="..&#x2F;classes/mygis.UI.Macros.html">mygis.UI.Macros</a></li>
            
                <li><a href="..&#x2F;classes/mygis.UI.MediaManager.html">mygis.UI.MediaManager</a></li>
            
                <li><a href="..&#x2F;classes/mygis.User.html">mygis.User</a></li>
            
                <li><a href="..&#x2F;classes/mygis.User.Hooks.html">mygis.User.Hooks</a></li>
            
                <li><a href="..&#x2F;classes/mygis.User.ProfileInfo.html">mygis.User.ProfileInfo</a></li>
            
                <li><a href="..&#x2F;classes/mygis.User.UI.html">mygis.User.UI</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Utilities.html">mygis.Utilities</a></li>
            
                <li><a href="..&#x2F;classes/mygis.Utilities.projections.html">mygis.Utilities.projections</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: Scripts\mg_admin.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿
&#x2F;**
	Methods and classes for the administration back-end of MyGIS
	@class mygis.Admin
	@static
**&#x2F;
mygis.Admin={
	&#x2F;**
		Functions and classes for application management
		
		@class mygis.Admin.AppManager
		@static
	**&#x2F;
	AppManager: {
	
		&#x2F;**
			This holds the update configuration for the app settings.
			@property updateConfig
			@type {Object}
		**&#x2F;
		updateConfig: {
		  appID: -1,
			maps: [],
			urls: [],
			styles: [],
			logo: {
				changed: false,
				newValue: null,
				oldValue: null
			},
			logo1: {
				changed: false,
				newValue: null,
				oldValue: null
			},
			logo2: {
				changed: false,
				newValue: null,
				oldValue: null
			},
			appName: {
				changed: false,
				newValue: null,
				oldValue: null
			},
			appAlias: {
				changed: false,
				newValue: null,
				oldValue: null
			},
			appText: {
				changed: false,
				newValue: null,
				oldValue: null
			}
		},
		
		&#x2F;**
		 * Functions for the apps in the app manager
		 *
		 * @class mygis.Admin.AppManager.Apps
		 * @static
		 *&#x2F;
		Apps: {
				
				&#x2F;**
				 * Shows a dialog window for inserting new app
				 * @method showAddNewApp
				 *&#x2F;
				showAddNewApp: function(){
						var myconfig = mygis.Admin.UI.dialogConfig;
						myconfig.checkfn = mygis.Admin.AppManager.Apps.addNewAppCheck;
						myconfig.callbackfn = mygis.Admin.AppManager.Apps.createNewApp;
						myconfig.objectCount = 1;
						myconfig.windowTitle = &quot;#addAppNamePop&quot;;
						$(myconfig.windowTitle).dialog({
								autoOpen: true,
								modal: true,
								resizable: false,
								width: 480,
								height: 130, 
								title: strings.AppManager.addApp_WindowTitle,
								closeOnEscape: false
						});
						var titleBar = $(&quot;#ui-dialog-title-addAppNamePop&quot;).parent();
						titleBar.css({
							&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;Administration&#x2F;menu&#x2F;icon-16-component.png&#x27;) #F6A828 no-repeat 12px 8px&quot;,
							&quot;background-size&quot;:&quot;auto 18px&quot;
							});
						
				},
				
				&#x2F;**
				 * Used for client-validation when inserting new app name
				 * @method addNewAppCheck
				 *&#x2F;
				addNewAppCheck: function(){
						var retvalue = false;
						var checkValue = $(&quot;#addAppNameInp&quot;).val();
						if (!checkValue){
								alert(strings.AppManager.addApp_err_NotFilled);
						}else{
								var wrongSymbols = [&#x27;&#x60;&#x27;,&#x27;~&#x27;,&#x27;!&#x27;,&#x27;@&#x27;,&#x27;#&#x27;,&#x27;$&#x27;,&#x27;%&#x27;,&#x27;^&#x27;,&#x27;&amp;&#x27;,&#x27;*&#x27;,&#x27;-&#x27;,&#x27;+&#x27;,&#x27;=&#x27;,&#x27;[&#x27;,&#x27;]&#x27;,&#x27;{&#x27;,&#x27;}&#x27;,&#x27;\\&#x27;,&#x27;|&#x27;,&#x27;:&#x27;,&#x27;;&#x27;,&#x27;&quot;&#x27;,&#x27;\&#x27;&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;&#x27;,&#x27;,&#x27;,&#x27;.&#x27;,&#x27;&#x2F;&#x27;,&#x27;?&#x27;];
								var atLeastOne =false;
								for (var i=0;i&lt;wrongSymbols.length;i++){
										if (checkValue.indexOf(wrongSymbols[i])&gt;-1){
												atLeastOne=true;
										}
								}
								if (atLeastOne){
										alert(strings.AppManager.addApp_err_InvalidName);
								}else{
										mygis.Admin.UI.dialogConfig.object = checkValue;
										retvalue=true;
								}
						}
						return retvalue;
				},
				
				&#x2F;**
				* Handles the creation of a new application
				* @method createNewApp
				*&#x2F;
			 createNewApp: function(result){
						if (result==&quot;ok&quot;){
								var myValue = this;
								mygis.Admin.AppManager.resetConfigObject();
								var myconfig = mygis.Admin.AppManager.updateConfig;
								myconfig.appName.changed=true;
								myconfig.appName.newValue=myValue;
								var toSend=JSON.stringify(myconfig);
								var customUrl = config.mgreq+&quot;?qtype=CreateNewApp&amp;qContents=&quot;+toSend;
								var postObject = new Object();
								postObject[&quot;qContents&quot;]=toSend;
								mygis.Utilities.blockUI();
								$.ajax({
										type:&quot;POST&quot;,
										data: postObject,
										url: customUrl,
										success: function(data){
											try{
												var realResults = eval(data);
												if (realResults.iotype==&quot;success&quot;){
														mygis.Admin.AppManager.Apps.refreshAppGrid();
														displaySuccess(strings.AppManager.addApp_msg_Success);
													
												}else{
													displayError(realResults.iomsg);
												}
												
											}catch(err){
												console.log(err.message);
											}
											mygis.Utilities.unblockUI();
										}
								});
					 }
			 },
				
				&#x2F;**
				* Handles clicking on an app name in the app grid.
				* Selects the row and goes to &quot;edit mode&quot;
				* @method appClicked
				* @param {Integer} The row index clicked
				*&#x2F;
			 appClicked: function(index){
					 var grid = $(&quot;#myAppGrid&quot;);
					 grid.jqxGrid(&#x27;clearselection&#x27;);
					 grid.jqxGrid(&#x27;selectrow&#x27;,index);
					 mygis.Admin.UI.menuClick(null,&quot;amenu_Apps_Config&quot;);
			 },
		 
			 &#x2F;**
				* Handles the clicking of the checkbox in each row at the App Manager
				* @method singleCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
			 singleCheckClicked: function(elem){
					 var grid = $(&quot;#myAppGrid&quot;);
					 if (elem.args.value) {
							 grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
					 }
					 else {
							 grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
					 }
			 },
			 
			 
				&#x2F;**
				 * Handles the check button in the App Manager
				 * @method allCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				allCheckClicked: function(elem){
						var grid = $(&quot;#myAppGrid&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].appSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].appSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
			
				&#x2F;**
					Activates&#x2F;deactivates some buttons when an application is selected
					@method appSelected
					@param {Object} event
				**&#x2F;
				appSelected: function(event){
						var grid = $(&quot;#myAppGrid&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_AddClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_AddClassName(&quot;disabled&quot;);
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllApps&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllApps&quot;).checked=false;
						}
						
					
				},
				
				&#x2F;**
					Activates&#x2F;deactivates some buttons when an application is unselected.
					@method appUnselected
					@param {Object} event
				**&#x2F;
				appUnselected: function(event){
						var grid = $(&quot;#myAppGrid&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else if (selection.length==1){
								document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								if (!document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}else{
								if (!document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_style&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Apps_Manager_delete&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllApps&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllApps&quot;).checked=false;
						}
				},
		
				
				&#x2F;**
					Used to create the app grid in the App Manager
					@method createAppGrid
				**&#x2F;
				createAppGrid: function(){
						mygis.Utilities.blockUI();
						var appContainer = $(&quot;#myAppGrid&quot;);
						var cellrenderer = function(row,datafield,value){
								var retobject;
								var appID = this.owner.getrowdata(row).appID;
								var action = &quot;router(&#x27;mm_imgclick&#x27;,this);&quot;;
								switch (datafield){
										case &quot;appSelected&quot;:
												var action = &#x27;router(&quot;adminAppClick&quot;,this);&#x27;;
												var inpclass = mygis.Utilities.format(&quot;row_{0}&quot;,row);
												var checked = this.owner.getselectedrowindexes().indexOf(row)&gt;-1 ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
												var titleObj = strings.AppManager.grid_selectBox;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 30px;&#x27;&gt;&lt;input class=&#x27;{1}&#x27; type=&#x27;checkbox&#x27; title=&#x27;{3}&#x27; onclick=&#x27;{0}&#x27;{2}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																													 action,inpclass,checked,titleObj);
												break;
										case &quot;hasLogo1&quot;:
												if (value){
													retobject = mygis.Utilities.format(&#x27;&lt;div class=&quot;imageVerticalContainer&quot;&gt;&lt;img onclick=&quot;{0}&quot; src=&quot;{1}GetImage.ashx?qType=GetAppLogo1&amp;qContents={2}&amp;qSize=112&quot; &#x2F;&gt;&lt;&#x2F;div&gt;&#x27;,
																action,
																config.folderPath,
																appID);
												}else{
													retobject = &quot;&lt;span style=&#x27;margin:9px 4px; float: left;&#x27;&gt;&lt;&#x2F;span&gt;&quot;;
												}
												break;
										case &quot;hasLogo2&quot;:
												if (value){
													retobject = mygis.Utilities.format(&#x27;&lt;div class=&quot;imageVerticalContainer&quot;&gt;&lt;img onclick=&quot;{0}&quot; src=&quot;{1}GetImage.ashx?qType=GetAppLogo2&amp;qContents={2}&amp;qSize=112&quot; &#x2F;&gt;&lt;&#x2F;div&gt;&#x27;,
																action,
																config.folderPath,
																appID);
												}else{
													retobject = &quot;&lt;span style=&#x27;margin:9px 4px; float: left;&#x27;&gt;&lt;&#x2F;span&gt;&quot;;
												}
												break;
										case &quot;appURLS&quot;:
												var urls;
												if (value!=&quot;&quot;){
														urls = value.split(&quot;,&quot;);
												}else{
														urls = [];
												}
												
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 120px;&#x27;&gt;&lt;span &gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,urls.length);
												break;
										case &quot;appMAPS&quot;:
												var maps;
												if (value!=&quot;&quot;){
														maps = value.split(&quot;,&quot;);
												}else{
														maps = [];
												}
												
												var titleObj=&quot;&quot;;
												$.each(maps,function(i,v){
														var mapName = v.split(&quot;$&quot;)[0];
														if (i&gt;0){
																titleObj+=&quot;,&quot;;
														}
														titleObj+=mapName;
												})
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 120px;&#x27;&gt;&lt;span title=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,maps.length,titleObj);
												break;
										case &quot;appName&quot;:
												var action = mygis.Utilities.format(&#x27;router(&quot;appNameClick&quot;,{0});&#x27;,row);
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,action);
												break;
										case &quot;appOwner&quot;:
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 100px;&#x27;&gt;&lt;span &gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,value);
												break;
										case &quot;appPrefix&quot;:
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 100px;&#x27;&gt;&lt;span &gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,value);
												 
												break;
										default:
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;span &gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,value);
												break;
								}
								return retobject;
						}
						var columnrenderer = function(value){
								var retobject;
								switch (value){
								case strings.AppManager.grid_AppOwner:
								case strings.AppManager.grid_AppPrefix:
								case strings.AppManager.grid_AppWelcome:
								case strings.AppManager.grid_AppURLS:
								case strings.AppManager.grid_AppMAPS:
										retobject = mygis.Utilities.format(&quot;&lt;a href=&#x27;#&#x27; style=&#x27;text-align: center;&#x27;&gt;{0}&lt;&#x2F;a&gt;&quot;,value);				
										break;
								default:
										var action = &#x27;router(&quot;adminAllClick&quot;,this);&#x27;;
										var grid = $(&quot;#myAppGrid&quot;);
										var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
										var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
										retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;text-align: center; margin-top: 5px;position: absolute;left: 9px;z-index: 1;&#x27;&gt;&lt;input id=&#x27;adminSelectAllApps&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,action,checked);				
										break;
								}
								
								return retobject;
						}
						var appSource = mygis.Admin.AppManager.Apps.createAppGridSource();
						appContainer.jqxGrid({
								source: appSource,
								width: &#x27;100%&#x27;,
								&#x2F;&#x2F;height: &#x27;100%&#x27;,
								autoheight: true,
								theme: &#x27;pk_mg_jm&#x27;,
								altrows: true,
								enabletooltips: true,
								columns: [
									{text: &#x27;&#x27;, datafield: &#x27;appSelected&#x27;, width: 30, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
									{text: strings.AppManager.grid_AppName, datafield: &#x27;appName&#x27;, width: 150, cellsrenderer: cellrenderer, editable:false},
									{text: strings.AppManager.grid_AppOwner, datafield: &#x27;appOwner&#x27;, width: 100, cellsrenderer: cellrenderer, renderer: columnrenderer, editable:false},
									{text: strings.AppManager.grid_AppPrefix, datafield: &#x27;appPrefix&#x27;, width: 100,cellsrenderer: cellrenderer, renderer: columnrenderer, editable:false},
									{text: strings.AppManager.grid_AppWelcome, datafield: &#x27;appWelcomeText&#x27;, cellsrenderer: cellrenderer, renderer: columnrenderer, editable:false},
									{text: strings.AppManager.grid_AppURLS, datafield: &#x27;appURLS&#x27;, width: 120, cellsrenderer: cellrenderer,renderer: columnrenderer},
									{text: strings.AppManager.grid_AppMAPS, datafield: &#x27;appMAPS&#x27;, width: 120, cellsrenderer: cellrenderer,renderer: columnrenderer}
									&#x2F;*,
									{text: strings.AppManager.grid_AppURLS, datafield: &#x27;appURLS&#x27;, width: 140, cellsrenderer: cellrenderer},
									{text: strings.AppManager.grid_AppLogo1, datafield: &#x27;hasLogo1&#x27;, width: 140,cellsrenderer: cellrenderer},
									{text: strings.AppManager.grid_AppLogo2, datafield: &#x27;hasLogo2&#x27;, width: 140,cellsrenderer: cellrenderer}*&#x2F;
								],
								enableanimations: false,
								showheader: true,
								columnsmenu: true,
								editable: true,
								selectionmode: &#x27;none&#x27; &#x2F;*,
								rowsheight: 120*&#x2F;
						});
						appContainer.bind(&#x27;rowselect&#x27;,mygis.Admin.AppManager.Apps.appSelected);
						appContainer.bind(&#x27;rowunselect&#x27;,mygis.Admin.AppManager.Apps.appUnselected);
						appContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.AppManager.Apps.singleCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
					Used to create the source of the grid for the App Manager
					@method createAppGridSource
				**&#x2F;
				createAppGridSource: function(){
					var myurl = config.mgreq+&quot;?qtype=GetMyApps&quot;;
					var appSource;
					var source = {
						datatype: &quot;json&quot;,
						datafields: [
							{name: &quot;appSelected&quot;,type: &quot;boolean&quot;},
							{name: &quot;appID&quot;},
							{name: &quot;appOwner&quot;},
							{name: &quot;appName&quot;},
							{name: &quot;appPrefix&quot;},
							{name: &quot;appWelcomeText&quot;},
							{name: &quot;appURLS&quot;},
							{name: &quot;appMAPS&quot;},
							{name: &quot;hasLogo1&quot;,type: &quot;boolean&quot;},
							{name: &quot;hasLogo2&quot;,type: &quot;boolean&quot;}
						],
						id: &#x27;myapps&#x27;,
						url: myurl
					};
					appSource = new $.jqx.dataAdapter(source,{async:false});
					&#x2F;&#x2F;appSource.dataBind();
					return appSource;
				},
	
				&#x2F;**
						Refreshes the list of apps from the server
						@method refreshAppGrid
				**&#x2F;
				refreshAppGrid: function(){
					var appContainer = $(&quot;#myAppGrid&quot;);
					appContainer.jqxGrid(&#x27;updatebounddata&#x27;);
				},
				
				&#x2F;**
				* Handles the input change in app settings
				* @method inputChanged
				* @param {Object} event The triggering event object
				*&#x2F;
			 inputChanged: function(event){
					 var elem = event.currentTarget;
					 var myconfig = mygis.Admin.AppManager.updateConfig;
					 var confObj;
					 switch (elem.id){
							 case &quot;editAppName&quot;:
											 confObj=myconfig.appName;
											 break;
							 case &quot;editAppAlias&quot;:
											 confObj=myconfig.appAlias;
											 break;
							 case &quot;editAppWelcomeText&quot;:
											 confObj=myconfig.appText;
											 break;
					 
					 }
					 
					 confObj.changed=true;
					 confObj.newValue = elem.value;
					 mygis.Admin.AppManager.notifyUnsaved();
			 },
			 
			 &#x2F;**
				* Stores the initial value of an input element in app settings
				* @method inputStore
				* @param {Object} event The triggering event object
				*&#x2F;
			 inputStore: function(event){
					 var elem = event.currentTarget;
					 var myconfig = mygis.Admin.AppManager.updateConfig;
					 var confObj;
					 switch (elem.id){
							 case &quot;editAppName&quot;:
											 confObj=myconfig.appName;
											 break;
							 case &quot;editAppAlias&quot;:
											 confObj=myconfig.appAlias;
											 break;
							 case &quot;editAppWelcomeText&quot;:
											 confObj=myconfig.appText;
											 break;
					 
					 }
					 if (!confObj.changed){
							 confObj.oldValue=elem.value;
					 }
			 }
		},
		
		&#x2F;**
		 * Functions for the maps in the app manager
		 *
		 * @class mygis.Admin.AppManager.Maps
		 * @static
		 *&#x2F;
		Maps: {
				
				
				
				&#x2F;**
				 * Handles the checking of the map list
				 * @method mapCheckClicked
				 * @param {Element} elem The firing element
				 *&#x2F;
				mapCheckClicked: function(elem){
						var grid = $(&quot;#adminMapList&quot;);
						if (elem.args.value) {
								grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
								grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
				
				&#x2F;**
				 * Handles the &quot;check all&quot; btn in the map list
				 * @method mapAllCheck
				 * @param {Element} elem The firing element
				 *&#x2F;
				mapAllCheck: function(elem){
						var grid = $(&quot;#adminMapList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].mapSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].mapSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Activates&#x2F;deactivates some buttons when a map is selected
				 * @method mapSelected
				 * @param {Object} event
				 *&#x2F;
				mapSelected: function(event){
						var grid = $(&quot;#adminMapList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								for (var i=1;i&lt;3;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	&#x2F;&#x2F;i=1: Edit, i=2: Default
										if (!elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_AddClassName(&quot;disabled&quot;);
										}
								}
								for (var i=3;i&lt;5;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	&#x2F;&#x2F;i=3: Unpublish, i=4: Remove
										if (elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_RemoveClassName(&quot;disabled&quot;);
										}
								}
								
						}else if (selection.length==1){
								for (var i=1;i&lt;5;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	
										if (elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_RemoveClassName(&quot;disabled&quot;);
										}
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllMaps&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllMaps&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Activates&#x2F;deactivates some buttons when a map is unselected
				 * @method mapUnselected
				 * @param {Object} event
				 *&#x2F;
				mapUnselected: function(event){
						var grid = $(&quot;#adminMapList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								for (var i=1;i&lt;3;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	&#x2F;&#x2F;i=1: Edit, i=2: Default
										if (!elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_AddClassName(&quot;disabled&quot;);
										}
								}
								for (var i=3;i&lt;5;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	&#x2F;&#x2F;i=3: Unpublish, i=4: Remove
										if (elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_RemoveClassName(&quot;disabled&quot;);
										}
								}
								
						}else if (selection.length==1){
								for (var i=1;i&lt;5;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	
										if (elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_RemoveClassName(&quot;disabled&quot;);
										}
								}
						}else{
								for (var i=1;i&lt;5;i++){
										var elem = $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[i];	
										if (!elem.ex_HasClassName(&quot;disabled&quot;)){
												elem.ex_AddClassName(&quot;disabled&quot;);
										}
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllMaps&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllMaps&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Resets the currently selected maps and the assosiated controls
				 * @method mapResetSelection
				 *&#x2F;
				mapResetSelection: function(){
						var grid = $(&quot;#adminMapList&quot;);
						grid.jqxGrid(&#x27;clearselection&#x27;);
						mygis.Admin.AppManager.Maps.mapSelected();	&#x2F;&#x2F;to reset the controls
				},
				
				&#x2F;**
				 * Creates the grid for the application&#x27;s maps
				 * @method createAppMapGrid
				 * @param {Integer} appID The application to query
				 *&#x2F;
				createAppMapGrid: function(appID){
						mygis.Utilities.blockUI();
						var mapSource = mygis.Admin.AppManager.Maps.createAppMapGridSource(appID);
						var mapContainer = $(&quot;#adminMapList&quot;);
						var columnrenderer = function(value){
								var action = &#x27;router(&quot;adminMapAllClick&quot;,this);&#x27;;
								var grid = $(&quot;#adminMapList&quot;);
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								var customStyle=&quot;text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;&quot;;
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;input id=&#x27;adminSelectAllMaps&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																									 action,checked,customStyle);
								return retobject;
						};
						var cellrenderer = function(row,datafield,value){
								var retobject;
								switch(datafield){
										case &quot;mapSelected&quot;:
												var action = &#x27;router(&quot;adminMapClick&quot;,this);&#x27;;
												var inpclass = mygis.Utilities.format(&quot;row_{0}&quot;,row);
												var checked = this.owner.getselectedrowindexes().indexOf(row)&gt;-1 ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
												var titleObj = strings.AppManager.grid_selectBox;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 30px;&#x27;&gt;&lt;input class=&#x27;{1}&#x27; type=&#x27;checkbox&#x27; title=&#x27;{3}&#x27; onclick=&#x27;{0}&#x27;{2}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																													 action,inpclass,checked,titleObj);
												break;
										case &quot;mapName&quot;:
												var descr = this.owner.getrowdata(row).mapDescription;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;a href=&#x27;#&#x27; title=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,descr);
												break;
										case &quot;defaultLoad&quot;:
												var checked = value?&quot; checked&quot;:&quot;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 80px;line-height:25px;&#x27;&gt;&lt;div class=&#x27;btnStarCheck{0}&#x27;&gt;&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&quot;,checked);
												break;
										default:
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;span &gt;{0}&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&quot;,value);
												break;
								}
								
								return retobject;
						};
						mapContainer.bind(&quot;bindingcomplete&quot;,function(event){
								mygis.Admin.AppManager.setConfigMaps($(&quot;#adminMapList&quot;).jqxGrid(&#x27;source&#x27;).records);
								setTimeout(function(){$(&quot;#adminMapList&quot;).find(&#x27;a[title]&#x27;).qtip();},1000);
						});
						if (mapSource.records.length&gt;0){
								mapContainer.jqxGrid({
										source: mapSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text:&#x27;asdf&#x27;,datafield:&#x27;mapSelected&#x27;, width:45,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapControl.col_mapName, datafield: &#x27;mapName&#x27;, width: 200, cellsrenderer: cellrenderer,editable:false},
												{text: strings.MapControl.col_mapLCount, datafield: &#x27;mapLayerCount&#x27;,editable:false,cellsrenderer: cellrenderer,width: 80},
												{text: strings.MapControl.col_mapDefault, datafield: &#x27;defaultLoad&#x27;, editable:false, cellsrenderer: cellrenderer,width: 80},
												{text: strings.MapControl.col_mapCreate, datafield: &#x27;mapCreateDate&#x27;,editable:false},
												{text: strings.MapControl.col_mapUpdate, datafield: &#x27;mapUpdateDate&#x27;,editable:false},
												{text: strings.MapControl.col_mapDeveloped, datafield: &#x27;mapDevelopedBy&#x27;,editable:false},
												{text: strings.MapControl.col_mapOwner, datafield: &#x27;mapOwner&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								mapContainer.jqxGrid({
										source: mapSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text:&#x27;asdf&#x27;,datafield:&#x27;mapSelected&#x27;, width:45,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapControl.col_mapName, datafield: &#x27;mapName&#x27;, width: 200, cellsrenderer: cellrenderer,editable:false},
												{text: strings.MapControl.col_mapLCount, datafield: &#x27;mapLayerCount&#x27;,editable:false,cellsrenderer: cellrenderer,width: 80},
												{text: strings.MapControl.col_mapDefault, datafield: &#x27;defaultLoad&#x27;, editable:false, cellsrenderer: cellrenderer,width: 80},
												{text: strings.MapControl.col_mapCreate, datafield: &#x27;mapCreateDate&#x27;,editable:false},
												{text: strings.MapControl.col_mapUpdate, datafield: &#x27;mapUpdateDate&#x27;,editable:false},
												{text: strings.MapControl.col_mapDeveloped, datafield: &#x27;mapDevelopedBy&#x27;,editable:false},
												{text: strings.MapControl.col_mapOwner, datafield: &#x27;mapOwner&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});		
						}
						mapContainer.bind(&quot;rowselect&quot;,mygis.Admin.AppManager.Maps.mapSelected);
						mapContainer.bind(&quot;rowunselect&quot;,mygis.Admin.AppManager.Maps.mapUnselected);
						mapContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.AppManager.Maps.mapCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Creates the source for the application&#x27;s maps
				 * @method createAppMapGridSource
				 * @param {Integer} appID The application to query
				 *&#x2F;
				createAppMapGridSource: function(appID){
						var retvalue;
						var url = config.mgreq+&quot;?qtype=GetAppMaps&amp;qContents=&quot;+appID;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
										{ name: &quot;mapSelected&quot;,type: &quot;boolean&quot;},
										{ name: &quot;mapName&quot; },
										{ name: &quot;mapDescription&quot; },
										{ name: &quot;mapLayerCount&quot; },
										{ name: &quot;id&quot; },
										{ name: &quot;defaultLoad&quot;,type: &quot;boolean&quot; },
										{ name: &quot;maxExtent&quot;},
										{ name: &quot;appName&quot;},
										{ name: &quot;mapCenter&quot;},
										{ name: &quot;mapZoom&quot;},
										{ name: &quot;mapCreateDate&quot;},
										{ name: &quot;mapUpdateDate&quot;},
										{ name: &quot;mapDevelopedBy&quot;},
										{ name: &quot;mapOwner&quot;}
								],
								id: &#x27;adminMapList&#x27;,
								url: url
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						&#x2F;&#x2F;retvalue.dataBind();
						&#x2F;&#x2F;mygis.Admin.AppManager.setConfigMaps(retvalue.records);
						return retvalue;
				},
		
				&#x2F;**
				 *
				 * @method addAppMap
				 *&#x2F;
				addAppMap: function(){
						var myconfig = mygis.Admin.UI.dialogConfig;
						myconfig.checkfn = mygis.Admin.AppManager.Maps.addAppMapCheck;
						myconfig.callbackfn = mygis.Admin.AppManager.Maps.addAppMapResult;
						myconfig.objectCount = 1;
						myconfig.windowTitle = &quot;#mapManager&quot;;
						
						var mapContainer = $(&quot;#adminMapList&quot;);
						var records = mapContainer.jqxGrid(&#x27;source&#x27;).records;
						var filterList = &quot;&quot;;
						for (var i=0;i&lt;records.length;i++){
								if (i&gt;0){
										filterList +=&quot;%23&quot;;
								}
								filterList += records[i].id;
						}
						showMapManager(filterList);
				},
				
				&#x2F;**
				 *
				 * @method addAppMapCheck
				 *&#x2F;
				addAppMapCheck: function(){
						var retvalue=false;
						var grid = $(&quot;#mapManagerList&quot;);
						var myconfig = mygis.Admin.UI.dialogConfig;
						var selections = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var selectedCount = selections.length;
						var expectedCount = myconfig.objectCount;
						if (selectedCount&lt;expectedCount &amp;&amp; expectedCount&gt;-1){
							alert(mygis.Utilities.format(strings.MapManager.err_notEnoughSelected,expectedCount));
						}else{
							var retobject;
							retobject = [];
							for (var i =0;i&lt;selections.length;i++){
								retobject.push(grid.jqxGrid(&#x27;getrowdata&#x27;,selections[i]));	
							}
							myconfig.object=  retobject;
							retvalue=true;
						}
						return retvalue;
				},
				
				&#x2F;**
				 *
				 * @method addAppMapResult
				 *&#x2F;
				addAppMapResult: function(result){
						if (result==&quot;ok&quot;){
								var mapsToAdd =[];
								var gridSource=$(&quot;#adminMapList&quot;).jqxGrid(&#x27;source&#x27;).records;
								var myconfig = mygis.Admin.AppManager.updateConfig;
								var sampleAppName = gridSource[0]?gridSource[0].appName:&quot;&quot; ;
								for (var i=0;i&lt;this.length;i++){
										mapsToAdd.push(this[i].id);
										var r = this[i];
										var item = {
												mapSelected: false,
												mapName: r.mapName,
												mapDescription: r.mapDescription,
												mapLayerCount: r.mapLayerCount,
												id: r.id,
												defaultLoad : false,
												maxExtent: r.maxExtent,
												appName: sampleAppName,
												mapCenter: r.mapCenter,
												mapZoom: r.mapZoom,
												mapCreateDate: r.mapCreateDate,
												mapUpdateDate: r.mapUpdateDate,
												mapDevelopedBy: r.mapDevelopedBy,
												mapOwner: r.mapOwner
										};
										&#x2F;&#x2F;gridSource.push(item);
										$(&quot;#adminMapList&quot;).jqxGrid(&#x27;addrow&#x27;, null, item);
										var confItem = {
												changed: true,
												oldValue: null,
												newValue: JSON.stringify(item)
										};
										myconfig.maps.push(confItem);
								}
								mygis.Admin.AppManager.notifyUnsaved();
								$(&quot;#adminMapList&quot;).jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Makes the currently selected map the default one
				 * @method mapMakeDefault
				 *&#x2F;
				mapMakeDefault: function(){
						var grid = $(&quot;#adminMapList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var selectedIndex = selection[0];	&#x2F;&#x2F;shouldn&#x27;t be more than 1 anyway
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var changedFlag = false;
						var myconfig = mygis.Admin.AppManager.updateConfig;
						var previousIndex;
						for (var i=0;i&lt;records.length;i++){
								if (records[i].defaultLoad &amp;&amp; i!=selectedIndex){
										records[i].defaultLoad = false;
										changedFlag = true;
										previousIndex = i;
								}else if(i==selectedIndex){
										records[i].defaultLoad = true;
										changedFlag = true;
								}
						}
						if (changedFlag){
								grid.jqxGrid(&#x27;refreshdata&#x27;);
								mygis.Admin.AppManager.setConfigMaps(records);
								if (previousIndex){
										myconfig.maps[previousIndex].changed=true;
								}
								myconfig.maps[selectedIndex].changed=true;
								mygis.Admin.AppManager.notifyUnsaved();
						}
						mygis.Admin.AppManager.Maps.mapResetSelection();
						
				},
				
				&#x2F;**
				 * Deletes the association of the selected maps with the app
				 * @method mapUnpublish
				 *&#x2F;
				mapUnpublish: function(){
						var grid = $(&quot;#adminMapList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var newRecords=[];
						var myconfig = mygis.Admin.AppManager.updateConfig;
						if (selection.length&gt;0){
								&#x2F;*
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												newRecords.push(records[i]);
										}
								}
								grid.jqxGrid(&#x27;source&#x27;).records = newRecords;
								*&#x2F;
								for (var i=0;i&lt;selection.length;i++){
										grid.jqxGrid(&#x27;deleterow&#x27;,selection[i]);
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
								
								mygis.Admin.AppManager.setConfigMaps(records);
								for (var i=0;i&lt;myconfig.maps.length;i++){
										myconfig.maps[i].changed=true;	&#x2F;&#x2F;consider all changed
								}
								mygis.Admin.AppManager.notifyUnsaved();
						}
						mygis.Admin.AppManager.Maps.mapResetSelection();
				},
				
				&#x2F;**
				 * Deletes the association of the selected maps with their layers (thus deleting the map)
				 * @method mapDelete
				 *&#x2F;
				mapDelete: function(){
						displayNotify(msg_errFeatureNotImplemented);
				}
		
		},
		
		&#x2F;**
		 * Functions for the urls in the app manager
		 *
		 * @class mygis.Admin.AppManager.URLs
		 * @static
		 *&#x2F;
		URLs: {
				&#x2F;**
				* Shows the &quot;add new app alias&quot; window
				* @method showAddAlias
				* 
				*&#x2F;
			 showAddAlias: function(){
					 
					 var myconfig = mygis.Admin.UI.dialogConfig;
					 myconfig.callbackfn=mygis.Admin.AppManager.URLs.addAliasResult;
					 myconfig.objectCount=1;
					 myconfig.windowTitle = &quot;#addAppAliasPop&quot;;
					 myconfig.checkfn=mygis.Admin.AppManager.URLs.checkAliasValidity;
					 $(&quot;#addAppAliasPop&quot;).dialog({
							 autoOpen: true,
							 modal: true,
							 resizable: false,
							 width: 480,
							 height: 200, 
							 title: strings.AppManager.addAlias_WindowTitle,
							 closeOnEscape: false
					 });
					 var titleBar = $(&quot;#ui-dialog-title-addAppAliasPop&quot;).parent();
					 titleBar.css({
						 &quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;Administration&#x2F;url_add.png&#x27;) #F6A828 no-repeat 12px 8px&quot;,
						 &quot;background-size&quot;:&quot;auto 18px&quot;
						 });
			 },
			 
			 &#x2F;**
				* @method addAliasResult
				* @param {String} result
				*&#x2F;
			 addAliasResult: function(result){
					 var resultObj = this.toString();
					 if (!result || result!=&quot;ok&quot;){
							 if (result){
								 displayError(result);
							 }
					 }else{
							 mygis.Admin.AppManager.URLs.addAppAlias(resultObj);
					 }
			 },
			 
			 &#x2F;**
				* Validation method for add new alias
				* @method checkAliasValidity
				*&#x2F;
			 checkAliasValidity: function(){
					 var myconfig = mygis.Admin.UI.dialogConfig;
					 var inp = $(&quot;#chooseHost&quot;).val();
					 inp = inp.toLowerCase();
					 var expression = &#x2F;^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$&#x2F;gi;
					 var regex = expression; &#x2F;&#x2F;new RegExp(expression);
					 var protocol=$(&quot;#chooseProtocol&quot;).val();
					 var port = $(&quot;#choosePort&quot;).val();
					 $(&quot;#addAppAlias_err_WrongHostname&quot;).css(&quot;visibility&quot;,&quot;hidden&quot;);
					 if (!inp.match(regex) || !mygis.Admin.AppManager.URLs.checkPortValidity()){
							 $(&quot;#addAppAlias_err_WrongHostname&quot;).html(strings.AppManager.addAlias_err_InvalidUrl);
							 $(&quot;#addAppAlias_err_WrongHostname&quot;).css(&quot;visibility&quot;,&quot;visible&quot;);
					 }else{
							 mygis.Utilities.blockUI();
							 var customUrl = config.mgreq+&quot;?qtype=CheckAlias&amp;qContents=&quot;+
															 mygis.Utilities.format(&quot;{0}:&#x2F;&#x2F;{1}:{2}&#x2F;&quot;,protocol,inp,port);
							 $.ajax({
									 type: &quot;GET&quot;,
									 url: customUrl,
									 async: false,
									 success: function(data){
											 mygis.Utilities.unblockUI();
											 try{
													 var realResults = eval(data);
													 if (realResults.iotype==&quot;success&quot;){
															 var protocol=$(&quot;#chooseProtocol&quot;).val();
															 var port = $(&quot;#choosePort&quot;).val();
															 var host = $(&quot;#chooseHost&quot;).val().toLowerCase();
															 myconfig.object = mygis.Utilities.format(&quot;{0}:&#x2F;&#x2F;{1}:{2}&#x2F;&quot;,protocol,host,port);
															 console.log(&quot;Success!&quot;);
													 }else{
															 &#x2F;&#x2F;Proper: switch according to server answer:
															 console.log(realResults.iomsg);
															 $(&quot;#addAppAlias_err_WrongHostname&quot;).html(strings.AppManager.addAlias_err_PlatformRejected);
															 $(&quot;#addAppAlias_err_WrongHostname&quot;).css(&quot;visibility&quot;,&quot;visible&quot;);
													 }
											 }catch(err){
													 console.log(err.message);
											 }
									 }
							 });
					 }
					 return (myconfig.object!=null);
			 },
			 
			 &#x2F;**
				* Checks if the port number in &quot;add alias&quot; window is valid
				* @method checkPortValidity
				* @returns {Boolean} True if it&#x27;s valid
				*&#x2F;
			 checkPortValidity: function(){
					 var retvalue = false;
					 var port = $(&quot;#choosePort&quot;).val();
					 if (port!=&quot;0&quot;){
							 var portRegex = &#x2F;^(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{1,3}|[0-9])$&#x2F;gi;
							 if (port.match(portRegex)){
									 retvalue=true;
							 }
							 if (!retvalue){
									 $(&quot;#addAppAlias_err_WrongPort&quot;).html(strings.AppManager.addAlias_err_PortNumber);
									 $(&quot;#addAppAlias_err_WrongPort&quot;).css(&quot;visibility&quot;,&quot;visible&quot;);
							 }else{
									 $(&quot;#addAppAlias_err_WrongPort&quot;).css(&quot;visibility&quot;,&quot;hidden&quot;);
							 }
					 }
					 return retvalue;
			 },
			 
			 &#x2F;**
				* @method addAppAlias
				* @param {String} url
				*&#x2F;
			 addAppAlias: function(url){
					 var toSend = mygis.Utilities.format(&quot;{0}#{1}&quot;,mygis.Admin.AppManager.updateConfig.appID,url);
					 var postObject = new Object();
					 postObject[&quot;qContents&quot;]=toSend;
					 var customUrl = config.mgreq+&quot;?qtype=AddAppAlias&quot;;
					 $.ajax({
							 type:&quot;POST&quot;,
							 data: postObject,
							 url: customUrl,
							 success: function(data){
									 try{
											 var realResults = eval(data);
											 if (realResults.iotype==&quot;success&quot;){
													 displaySuccess(strings.AppManager.addAlias_operationSuccess);
													 $(&quot;#adminURLList&quot;).jqxGrid(&#x27;updatebounddata&#x27;);
											 }else{
													 displayError(realResults.iomsg);
											 }
									 }catch(err){
											 console.log(err.message);
									 }
							 }
					 });
			 },
		 
			 &#x2F;**
				* Removes the selected app aliases
				* @method urlDelete
				*&#x2F;
			 urlDelete: function(){
					 var grid = $(&quot;#adminURLList&quot;);
					 var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
					 var recordCount = grid.jqxGrid(&#x27;source&#x27;).records.length;
					 if (selection.length==recordCount || recordCount==1){
							 displayError(strings.AppManager.deleteAlias_err_NotAll)
					 }else{
							 var message = mygis.Utilities.format(strings.AppManager.deleteAlias_err_YouSure,selection.length);
							 showConfirmationDialog(message,function(){
									 var grid = $(&quot;#adminURLList&quot;);
									 var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
									 var urls= [];
									 for (var i=0;i&lt;selection.length;i++){
											 urls.push(grid.jqxGrid(&#x27;getrowdata&#x27;,selection[i]).appURL);
									 }
									 var customUrl = config.mgreq+&quot;?qtype=RemoveAppAlias&quot;;
									 var postObject = new Object();
									 postObject[&quot;qContents&quot;]=urls.join(&quot;#&quot;);
									 mygis.Utilities.blockUI();
									 $.ajax({
											 type: &quot;POST&quot;,
											 data:postObject,
											 url: customUrl,
											 success: function(data){
													 mygis.Utilities.unblockUI();
													 try{
															 var realResults = eval(data);
															 if (realResults.iotype==&quot;success&quot;){
																	 displaySuccess(strings.AppManager.urls_updated);
																	 var grid = $(&quot;#adminURLList&quot;);
																	 grid.jqxGrid(&#x27;updatebounddata&#x27;);
															 }else{
																	 displayError(realResults.iomsg);
															 }
													 }catch(err){
															 console.log(err.message);
													 }
											 }
									 });
							 });
					 }
			 },
		 
			 
			 &#x2F;**
				* Handles the clicking of the checkbox in each row at the URL Manager
				* @method urlCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
			 urlCheckClicked: function(elem){
					 var grid = $(&quot;#adminURLList&quot;);
					 if (elem.args.value) {
							 grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
					 }
					 else {
							 grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
					 }
			 },
			 
			 &#x2F;**
				* Handles the &quot;check all&quot; button in the app settings-&gt;URLs
				* @method urlAllCheck
				* @param {Element} elem The firing checkbox
				*&#x2F;
			 urlAllCheck: function(elem){
					 var grid = $(&quot;#adminURLList&quot;);
					 var records = grid.jqxGrid(&#x27;source&#x27;).records;
					 var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
					 if (elem.checked){
							 for (var i=0;i&lt;records.length;i++){
									 if (selection.indexOf(i)==-1){
											 records[i].urlSelected=true;
											 grid.jqxGrid(&#x27;selectrow&#x27;,i)
									 }
							 }
							 grid.jqxGrid(&#x27;refreshdata&#x27;);
					 }else{
							 for (var i=0;i&lt;records.length;i++){
									 records[i].urlSelected=false;
									 grid.jqxGrid(&#x27;unselectrow&#x27;,i)
							 }
							 grid.jqxGrid(&#x27;refreshdata&#x27;);
					 }
			 },
			 
			 &#x2F;**
				* Activates&#x2F;deactivates some buttons when a url is selected in the app settings-&gt;URLs
				* @method urlSelected
				* @param {Object} event
				*&#x2F;
			 urlSelected: function(event){
					 var grid = $(&quot;#adminURLList&quot;);
					 var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
					 $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[1].ex_RemoveClassName(&quot;disabled&quot;);
					 if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
							 document.getElementById(&quot;adminSelectAllUrls&quot;).checked=true;
					 }else{
							 document.getElementById(&quot;adminSelectAllUrls&quot;).checked=false;
					 }
			 },
			 
			 &#x2F;**
				* Activates&#x2F;deactivates some buttons when a url is selected in the app settings-&gt;URLs
				* @method urlUnselected
				* @param {Object} event
				*&#x2F;
			 urlUnselected: function(event){
					 var grid = $(&quot;#adminURLList&quot;);
					 var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
					 if (selection.length&gt;0){
							 $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[1].ex_RemoveClassName(&quot;disabled&quot;);
					 }else{
							 if (!$(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[1].ex_HasClassName(&quot;disabled&quot;)){
									 $(&quot;#contentSpecificToolbar .sectionButtons a&quot;)[1].ex_AddClassName(&quot;disabled&quot;);
							 }
					 }
					 if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
							 document.getElementById(&quot;adminSelectAllUrls&quot;).checked=true;
					 }else{
							 document.getElementById(&quot;adminSelectAllUrls&quot;).checked=false;
					 }
				},
		
				
				&#x2F;**
				 * Creates the grid for the application&#x27;s aliases
				 * @method createAppURLGrid
				 * @param {Integer} appID The application to query
				 *&#x2F;
				createAppURLGrid: function(appID){
						mygis.Utilities.blockUI();
						var urlSource = mygis.Admin.AppManager.URLs.createAppURLGridSource(appID);
						var urlContainer = $(&quot;#adminURLList&quot;);
						var columnrenderer = function(value){
								var retobject;
								switch (value){
										case strings.AppManager.urlgrid_URL:
												retobject = mygis.Utilities.format(&quot;&lt;a href=&#x27;#&#x27; style=&#x27;text-align: center;&#x27;&gt;{0}&lt;&#x2F;a&gt;&quot;,value);	
												break;
										default:
												var action = &#x27;router(&quot;adminURlAllClick&quot;,this);&#x27;;
												var grid = $(&quot;#adminURLList&quot;);
												var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
												var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
												var customStyle=&quot;text-align: center; margin-top: 5px;position: absolute;left: 9px;z-index: 1;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;input id=&#x27;adminSelectAllUrls&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																													 action,checked,customStyle);
												break;
								}
								return retobject;
						}
						var cellrenderer = function(row,datafield,value){
								switch (datafield){
										case &quot;urlSelected&quot;:
												var action = &#x27;router(&quot;adminAppClick&quot;,this);&#x27;;
												var inpclass = mygis.Utilities.format(&quot;row_{0}&quot;,row);
												var checked = this.owner.getselectedrowindexes().indexOf(row)&gt;-1 ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
												var titleObj = strings.AppManager.grid_selectBox;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 30px;&#x27;&gt;&lt;input class=&#x27;{1}&#x27; type=&#x27;checkbox&#x27; title=&#x27;{3}&#x27; onclick=&#x27;{0}&#x27;{2}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																													 action,inpclass,checked,titleObj);
												break;
								}
						}
						urlContainer.bind(&quot;bindingcomplete&quot;,function(event){
								mygis.Admin.AppManager.setConfigUrls($(&quot;#adminURLList&quot;).jqxGrid(&#x27;source&#x27;).records);
						});
						if (urlSource.records.length&gt;0){
								urlContainer.jqxGrid({
										source: urlSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;,datafield: &#x27;urlSelected&#x27;,width: 30, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
												{text: strings.AppManager.urlgrid_URL,datafield: &#x27;appURL&#x27;}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								urlContainer.jqxGrid({
										source: urlSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;,datafield: &#x27;urlSelected&#x27;,width: 30, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
												{text: strings.AppManager.urlgrid_URL,datafield: &#x27;appURL&#x27;}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}
						
						urlContainer.bind(&#x27;rowselect&#x27;,mygis.Admin.AppManager.URLs.urlSelected);
						urlContainer.bind(&#x27;rowunselect&#x27;,mygis.Admin.AppManager.URLs.urlUnselected);
						urlContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.AppManager.URLs.urlCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Creates the source for the application&#x27;s aliases
				 * @method createAppURLGridSource
				 * @param {Integer} appID
				 *&#x2F;
				createAppURLGridSource: function(appID){
						var retvalue;
						var url = config.mgreq+&quot;?qtype=GetAppURLs&amp;qContents=&quot;+appID;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
									{name: &quot;urlSelected&quot;,type: &quot;boolean&quot;},	
									{ name: &quot;appURL&quot; }
								],
								id: &#x27;aliasList&#x27;,
								url: url
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						&#x2F;&#x2F;retvalue.dataBind();
						&#x2F;&#x2F;mygis.Admin.AppManager.setConfigUrls(retvalue.records);
						return retvalue;
				}
		
		
		},
		
		&#x2F;**
		 * Functions for the styles in the app manager
		 *
		 * @class mygis.Admin.AppManager.Styles
		 * @static
		 *&#x2F;
		Styles: {
				
				&#x2F;**
				 * The text editor object
				 * @property editor
				 * @type {Object}
				 *&#x2F;
				editor: null,
				
				&#x2F;**
				 * Previews that style for a few seconds
				 * @method stylePreview
				 * @param {Integer} styleID
				 * @param {Integer} duration	The duration in seconds to keep the preview
				 *&#x2F;
				stylePreview: function(styleID,duration){
						mygis.Utilities.previewCustomization(styleID);
						$(&quot;#page_administration&quot;).animate({opacity: 0},1000);
						$(&quot;#page_effect&quot;).css({
									&quot;display&quot;:&quot;block&quot;,
									&quot;opacity&quot;:0
						});
						$(&quot;#page_effect&quot;).animate({opacity:1},1000,null,function(){
								setTimeout(mygis.Admin.AppManager.Styles.cancelPreview,1000*duration);
						});
				},
				
				&#x2F;**
				 * Cancels the style preview
				 * @method cancelPreview
				 *&#x2F;
				cancelPreview: function(){
						$(&quot;#page_effect&quot;).css({
									&quot;display&quot;:&quot;none&quot;,
									&quot;opacity&quot;:1
						});
						$(&quot;#page_administration&quot;).animate({opacity: 1},1000);
						mygis.Utilities.enableCustomization();	
				},
				
				&#x2F;**
				* Handles the clicking of the checkbox in each row at the Style Manager
				* @method singleCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
				singleCheckClicked: function(elem){
						var grid = $(&quot;#adminStyleList&quot;);
						if (elem.args.value) {
								grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
								grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
			 
			 
				&#x2F;**
				 * Handles the check button in the Style Manager
				 * @method allCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				allCheckClicked: function(elem){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].styleSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].styleSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
			
				&#x2F;**
					Activates&#x2F;deactivates some buttons when a style is selected
					@method styleSelected
					@param {Object} event
				**&#x2F;
				styleSelected: function(event){
						var grid = $(&quot;#adminStyleList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;appStyle_Edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_Copy&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Copy&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_CopyTo&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_CopyTo&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								
								if (document.getElementById(&quot;appStyle_MakePublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakePublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Remove&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Remove&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
								
						}else{
								if (document.getElementById(&quot;appStyle_Edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Copy&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Copy&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_CopyTo&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_CopyTo&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
								if (document.getElementById(&quot;appStyle_MakePublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakePublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Remove&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Remove&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllStyles&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllStyles&quot;).checked=false;
						}
						
					
				},
				
				&#x2F;**
					Activates&#x2F;deactivates some buttons when a style is unselected.
					@method styleUnselected
					@param {Object} event
				**&#x2F;
				styleUnselected: function(event){
						var grid = $(&quot;#adminStyleList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;appStyle_Edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_Copy&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Copy&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_CopyTo&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_CopyTo&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								
								if (document.getElementById(&quot;appStyle_MakePublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakePublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Remove&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Remove&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
								
						}else if (selection.length==1){
								if (document.getElementById(&quot;appStyle_Edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Copy&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Copy&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_CopyTo&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_CopyTo&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
								if (document.getElementById(&quot;appStyle_MakePublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakePublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;appStyle_Remove&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Remove&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								
						}else{
								if (!document.getElementById(&quot;appStyle_Edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_Copy&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Copy&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_CopyTo&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_CopyTo&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeDefault&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								
								if (!document.getElementById(&quot;appStyle_MakePublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakePublish&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_MakeUnpublish&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;appStyle_Remove&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;appStyle_Remove&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllStyles&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllStyles&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Creates the grid for the application&#x27;s styles
				 * @method createAppStylesGrid
				 * @param {Integer} appID The application to query
				 *&#x2F;
				createAppStylesGrid: function(appID){
						mygis.Utilities.blockUI();
						var styleSource = mygis.Admin.AppManager.Styles.createAppStylesGridSource(appID);
						var styleContainer = $(&quot;#adminStyleList&quot;);
						var columnrenderer = function(value){
								var action = &#x27;&#x27;;
								var grid = $(&quot;#adminStyleList&quot;);
								switch (value){
										case strings.AppManager.grid_Style_IsActive:
										case strings.AppManager.grid_Style_Published:
												retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;text-align: center; width: 100%;height: 100%;&#x27;&gt;&lt;a href=&#x27;#&#x27;&gt;{0}&lt;&#x2F;a&gt;&quot;,value);
												break;
										default:
												var action = &#x27;router(&quot;adminStyleAllClick&quot;,this);&#x27;;
												var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
												var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
												var customStyle=&quot;text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;&quot;;
												action = 
												retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;input id=&#x27;adminSelectAllStyles&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																													 action,checked,customStyle);
												break;
								}
								
								return retobject;
						};
						var cellrenderer = function(row,datafield,value){
								var retobject;
								switch(datafield){
										case &quot;layoutName&quot;:
												var action = mygis.Utilities.format(&#x27;router(&quot;app_directEditStyle&quot;,{0});&#x27;,row);
												var mystyle = &quot;text-align: left; width: 200px;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{0}&#x27; style=&#x27;margin-left: 5px;margin-top: 6px;display:block;font-size:11px;&#x27;&gt;{1}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,action,value,mystyle);
												break;
										case &quot;isActive&quot;:
												var checked = value?&quot; checked&quot;:&quot;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 80px;line-height:25px;&#x27;&gt;&lt;div class=&#x27;btnStarCheck{0}&#x27;&gt;&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&quot;,checked);
												break;
										case &quot;isPublished&quot;:
												var checked = value?&quot; checked&quot;:&quot;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 80px;line-height:25px;&#x27;&gt;&lt;a href=&#x27;#&#x27; class=&#x27;btnTickCheck{0}&#x27;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,checked);
												break;
										case &quot;id&quot;:
												
												var action = mygis.Utilities.format(&#x27;router(&quot;adminStylePreview&quot;,{0});&#x27;,value);
												var mystyle = &quot;text-align: center; width: 200px;&quot;;
												var selector = mygis.Utilities.format(&quot;&lt;select id=&#x27;stylePreviewTimer_{6}&#x27;&gt;&lt;option value=&#x27;{1}&#x27; selected=&#x27;selected&#x27;&gt;{1}{0}&lt;&#x2F;option&gt;&lt;option value=&#x27;{2}&#x27;&gt;{2}{0}&lt;&#x2F;option&gt;&lt;option value=&#x27;{3}&#x27;&gt;{3}{0}&lt;&#x2F;option&gt;&lt;option value=&#x27;{4}&#x27;&gt;{4}{0}&lt;&#x2F;option&gt;&lt;option value=&#x27;{5}&#x27;&gt;{5}{0}&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&quot;,
																															strings.Coding.seconds,2,5,10,30,60,value);
												if (!value){
														retobject = &quot;&quot;;		
												}else{
														retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{0}&#x27; style=&#x27;margin-top: 6px;width: 100px;display:inline-block;font-size:11px;&#x27;&gt;{1}&lt;&#x2F;a&gt;{3}&lt;&#x2F;div&gt;&quot;,action,&quot;Î ÏÎ¿ÎµÏÎ¹ÏÎºÏÏÎ·ÏÎ·&quot;,mystyle,selector);
												}
												break;
								}
								
								return retobject;
						};
						styleContainer.bind(&quot;bindingcomplete&quot;,function(event){
								mygis.Admin.AppManager.Styles.setConfigStyles($(&quot;#adminStyleList&quot;).jqxGrid(&#x27;source&#x27;).records);		
						});
						
						if (styleSource.records.length&gt;0){
								styleContainer.jqxGrid({
										source: styleSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;&#x27;, datafield: &#x27;styleSelected&#x27;, width: 45, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
												{text: strings.AppManager.grid_Style_Name, datafield: &#x27;layoutName&#x27;, cellsrenderer: cellrenderer,editable:false},
												{text: strings.AppManager.grid_Style_IsActive, datafield: &#x27;isActive&#x27;, renderer: columnrenderer, width: 80,editable:false, cellsrenderer: cellrenderer},
												{text: strings.AppManager.grid_Style_Published, datafield: &#x27;isPublished&#x27;, renderer: columnrenderer, width: 80,editable:false, cellsrenderer: cellrenderer},
												{text: &#x27;&#x27;, datafield: &#x27;id&#x27;, editable:false, cellsrenderer: cellrenderer,width: 200}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								styleContainer.jqxGrid({
										source: styleSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;&#x27;, datafield: &#x27;styleSelected&#x27;, width: 45, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
												{text: strings.AppManager.grid_Style_Name, datafield: &#x27;layoutName&#x27;, cellsrenderer: cellrenderer,editable:false},
												{text: strings.AppManager.grid_Style_IsActive, datafield: &#x27;isActive&#x27;, renderer: columnrenderer, width: 80,editable:false, cellsrenderer: cellrenderer},
												{text: strings.AppManager.grid_Style_Published, datafield: &#x27;isPublished&#x27;, renderer: columnrenderer, width: 80,editable:false, cellsrenderer: cellrenderer},
												{text: &#x27;&#x27;, datafield: &#x27;id&#x27;, editable:false, cellsrenderer: cellrenderer,width: 200}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});		
						}
						styleContainer.bind(&quot;rowselect&quot;,mygis.Admin.AppManager.Styles.styleSelected);
						styleContainer.bind(&quot;rowunselect&quot;,mygis.Admin.AppManager.Styles.styleUnselected);
						styleContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.AppManager.Styles.singleCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Creates the source for the application&#x27;s styles
				 * @method createAppStylesGridSource
				 * @param {Integer} appID The application to query
				 *&#x2F;
				createAppStylesGridSource: function(appID){
						var retvalue;
						var url = config.mgreq+&quot;?qtype=GetAppStyles&amp;qContents=&quot;+appID;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
										{ name: &quot;styleSelected&quot;,type: &quot;boolean&quot;},
										{ name: &quot;id&quot;},
										{ name: &quot;layoutName&quot;},
										{ name: &quot;isActive&quot;,type: &quot;boolean&quot;},
										{ name: &quot;isPublished&quot;,type: &quot;boolean&quot;},
										{ name: &quot;headerOn&quot;,type: &quot;boolean&quot;},
										{ name: &quot;headerHeight&quot;},
										{ name: &quot;headerBG&quot;},
										{ name: &quot;headerTextColor&quot;},
										{ name: &quot;textBG&quot;},
										{ name: &quot;textRadius&quot;},
										{ name: &quot;theme1_FillSelectBG&quot;},
										{ name: &quot;theme1_FillSelectBorderColor&quot;},
										{ name: &quot;theme1_FillBG&quot;},
										{ name: &quot;theme1_FillBorderColor&quot;},
										{ name: &quot;menuColor&quot;},
										{ name: &quot;menuActiveColor&quot;},
										{ name: &quot;rightPanel_TopBG&quot;},
										{ name: &quot;rightPanel_TabsBG&quot;},
										{ name: &quot;rightPanel_TopColor&quot;},
										{ name: &quot;rightPanel_TabColor&quot;},
										{ name: &quot;rightPanel_TabActiveColor&quot;},
										{ name: &quot;mapHeaderBG&quot;},
										{ name: &quot;mapDescriptionSize&quot;},
										{ name: &quot;mapDescriptionColor&quot;},
										{ name: &quot;mapFooterBG&quot;},
										{ name: &quot;mapFooterFontColor&quot;},
										{ name: &quot;customCSS_enabled&quot;,type: &quot;boolean&quot;},
										{ name: &quot;customCSS&quot;}
								],
								id: &#x27;madminStyleList&#x27;,
								url: url
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						&#x2F;&#x2F;retvalue.dataBind();
						&#x2F;&#x2F;mygis.Admin.AppManager.Styles.setConfigStyles(retvalue.records);
						return retvalue;
				},
				
				&#x2F;**
				* Updates the config object with the source styles
				* @method setConfigMaps
				*&#x2F;
				setConfigStyles: function(source){
						var finalList = [];
						for (var i=0;i&lt;source.length;i++){
								var item = {
										changed: false,
										newValue: null,
										oldValue : null
								};
								item.oldValue = JSON.stringify(source[i]);
								finalList.push(item);
						}
						mygis.Admin.AppManager.updateConfig.styles=finalList;
				},
				
				&#x2F;**
				 * Pops up a dialog to edit an application style
				 * @method showEditStyle
				 * @param {Boolean} isNew True if this is a completely new style
				 *&#x2F;
				showEditStyle: function(isNew){
						var windowTitle;
						var myconfig = mygis.Admin.UI.dialogConfig;
						
						if (isNew){
								$(&quot;#editStyleActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;newStyle&#x27;);
								windowTitle = strings.AppManager.window_NewStyle;
						}else{
								$(&quot;#editStyleActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;editStyle&#x27;);
								windowTitle = strings.AppManager.window_EditStyle;
						}
						$(&quot;#editActionsTitleElem&quot;).html(windowTitle);
						myconfig.checkfn = mygis.Admin.AppManager.Styles.editStyleCheck;
						myconfig.callbackfn = mygis.Admin.AppManager.Styles.editStyleResult;
						myconfig.objectCount = -1;
						myconfig.windowTitle = &quot;#editStylePop&quot;;
						
						if (!isNew){
								var grid = $(&quot;#adminStyleList&quot;);
								var records = grid.jqxGrid(&#x27;source&#x27;).records;
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var item = records[selection[0]];
								mygis.Admin.AppManager.Styles.setupEditStyleButtons(item);
								myconfig.objectCount = item.id;
								myconfig.callbackfn = mygis.Admin.AppManager.Styles.editStyleUpdateResult;
						}else{
								var item = {
										customCSS: &quot;&quot;,
										customCSS_enabled: false,
										headerBG: &quot;#FAA419&quot;,
										headerHeight: &quot;60px&quot;,
										headerOn: true,
										headerTextColor: &quot;white&quot;,
										layoutName: strings.AppManager.addStyle_NewStyleName +&quot; &quot;+new Date().toString(Date.CultureInfo.formatPatterns.fullDateTime),
										mapDescriptionColor: &quot;#FFFFFF&quot;,
										mapDescriptionSize: &quot;20px&quot;,
										mapFooterBG: &quot;rgba(0, 0, 0, 0.45)&quot;,
										mapFooterFontColor: &quot;#FFFFFF&quot;,
										mapHeaderBG: &quot;rgba(0, 0, 0, 0.5)&quot;,
										menuActiveColor: &quot;#333333&quot;,
										menuColor: &quot;#333333&quot;,
										rightPanel_TabActiveColor: &quot;#FFFFFF&quot;,
										rightPanel_TabColor: &quot;#FFFFFF&quot;,
										rightPanel_TabsBG: &quot;#777777&quot;,
										rightPanel_TopBG: &quot;#555555&quot;,
										rightPanel_TopColor: &quot;#FFFFFF&quot;,
										textBG: &quot;rgba(141, 141, 141, 0.4)&quot;,
										textRadius: &quot;15px&quot;,
										theme1_FillBG: &quot;#FAA419&quot;,
										theme1_FillBorderColor: &quot;#FAA419&quot;,
										theme1_FillSelectBG: &quot;#FAA419&quot;,
										theme1_FillSelectBorderColor: &quot;#FAA419&quot;
								};
								mygis.Admin.AppManager.Styles.setupEditStyleButtons(item);
						}
						
						$(&quot;#editStylePop&quot;).dialog({
								autoOpen: true,
								modal: true,
								resizable: false,
								width: 900,
								height: 510, 
								title: strings.AppManager.window_StyleManager,
								closeOnEscape: false
						});
						
				},
				
				&#x2F;**
				 * Sets up the UI (jqx widgets, color pickers, handlers etc
				 * @method setupEditStyleButtons
				 * @param {Object} defaultItem The item that sets up the default parameters
				 *&#x2F;
				setupEditStyleButtons: function(defaultItem){
						$(&quot;#saveStyleAs&quot;).val(defaultItem.layoutName);
						
						&#x2F;&#x2F;SET COLORS:
						$(&quot;#appSetting_HeaderBG&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.headerBG));
						$(&quot;#appSetting_HeaderTextBG&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.textBG));
						$(&quot;#appSetting_HeaderTextColor&quot;).val(defaultItem.headerTextColor);
						$(&quot;#appSetting_menuBackground&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.theme1_FillBG));
						$(&quot;#appSetting_menuBackgroundBorder&quot;).val(defaultItem.theme1_FillBorderColor);
						$(&quot;#appSetting_menuColor&quot;).val(defaultItem.menuColor);
						$(&quot;#appSetting_menuBackgroundActive&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.theme1_FillSelectBG));
						$(&quot;#appSetting_menuBackgroundBorderActive&quot;).val(defaultItem.theme1_FillSelectBorderColor);
						$(&quot;#appSetting_menuÎctiveColor&quot;).val(defaultItem.menuActiveColor);
						$(&quot;#appSetting_TopBackground&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.rightPanel_TopBG));
						$(&quot;#appSetting_TopColor&quot;).val(defaultItem.rightPanel_TopColor);
						$(&quot;#appSetting_MidBackground&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.rightPanel_TabsBG));
						$(&quot;#appSetting_MidColor&quot;).val(defaultItem.rightPanel_TabColor);
						$(&quot;#appSetting_MidActiveColor&quot;).val(defaultItem.rightPanel_TabActiveColor);
						&#x2F;&#x2F;these colors need parsing:
						$(&quot;#appSetting_mapHeaderBG&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.mapHeaderBG));
						$(&quot;#appSetting_mapFooterBG&quot;).val(mygis.Utilities.rgbaToHex(defaultItem.mapFooterBG));
						&#x2F;&#x2F;back to colors:
						$(&quot;#appSetting_mapDescriptionColor&quot;).val(defaultItem.mapDescriptionColor);
						$(&quot;#appSetting_mapFooterFontColor&quot;).val(defaultItem.mapFooterFontColor);
						
						&#x2F;&#x2F;now run:
						$(&quot;#editStyleContent input[type=hidden]&quot;).prop(&quot;type&quot;,&quot;color&quot;);
						$(&quot;#editStyleContent span.mColorPicker&quot;).remove();
						$(&quot;#editStyleContent input[type=color]&quot;).mColorPicker();
						$(&quot;#appSetting_HeaderHeight&quot;).jqxNumberInput({
								width: &#x27;40px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 1,
								decimal: parseInt(defaultItem.headerHeight),
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_HeaderTextRadius&quot;).jqxNumberInput({
								width: &#x27;40px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								decimal: parseInt(defaultItem.textRadius),
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_mapHeaderOpacity&quot;).jqxNumberInput({
								width: &#x27;40px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.mapHeaderBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_mapFooterOpacity&quot;).jqxNumberInput({
								width: &#x27;40px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.mapFooterBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						
						&#x2F;&#x2F; -----opacity sliders-----
						$(&quot;#appSetting_MidBGOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.rightPanel_TabsBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_TopBGOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.rightPanel_TopBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_menuBGActiveOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.theme1_FillSelectBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_menuBGOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.theme1_FillBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_HeaderTextOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.textBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						$(&quot;#appSetting_HeaderOpacity&quot;).jqxNumberInput({
								width: &#x27;45px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 0,
								max: 100,
								decimal: parseFloat(mygis.Utilities.getOpacityRGBA(defaultItem.headerBG))*100,
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						
						
						&#x2F;&#x2F; ----------------------
						$(&quot;#appSetting_mapDescriptionSize&quot;).jqxNumberInput({
								width: &#x27;40px&#x27;,
								height: &#x27;17px&#x27;,
								inputMode: &#x27;simple&#x27;,
								min: 8,
								max: 40,
								decimal: parseInt(defaultItem.mapDescriptionSize),
								decimalDigits: 0,
								spinButtons: true,
								theme: &#x27;classic&#x27;
						});
						mygis.Admin.AppManager.Styles.createEditor();
						mygis.Admin.AppManager.Styles.bindHandlers();
				},
				
				&#x2F;**
				 * Binds various handlers in the interface
				 * @method bindHandlers
				 *&#x2F;
				bindHandlers: function(){
						$(&quot;#appSetting_enableHeader&quot;).bind(&quot;change&quot;,function(){mygis.Admin.AppManager.Styles.toggleSubMenu(this);});
						$(&quot;#appSetting_expertModeToggle&quot;).bind(&quot;change&quot;,function(){mygis.Admin.AppManager.Styles.toggleSubMenu(this);});
				},
				
				&#x2F;**
				 * Checking the validity of the input in the edit style dialog
				 * @method editStyleCheck
				 *&#x2F;
				editStyleCheck: function(){
						var retvalue = false;
						var grid = $(&quot;#adminStyleList&quot;);
						var myconfig = mygis.Admin.UI.dialogConfig;
						var retobject;
						retobject = [];
						&#x2F;*
						 *$(&#x27;#appSetting_HeaderTextRadius&#x27;).jqxNumberInput(&#x27;decimal&#x27;) + &#x27;px&#x27;
						 *
						 *&#x2F;
						var item = {
								styleSelected: false,
								id: null,
								layoutName: $(&quot;#saveStyleAs&quot;).val(),
								isActive: false,
								isPublished: false,
								headerOn: $(&quot;#appSetting_enableHeader&quot;).is(&#x27;:checked&#x27;),
								headerHeight: $(&#x27;#appSetting_HeaderHeight&#x27;).jqxNumberInput(&#x27;decimal&#x27;) + &#x27;px&#x27;,
								headerBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_HeaderBG&quot;).val(),
																										$(&#x27;#appSetting_HeaderOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								headerTextColor: $(&quot;#appSetting_HeaderTextColor&quot;).val(),
								textBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_HeaderTextBG&quot;).val(),
																										$(&#x27;#appSetting_HeaderTextOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								textRadius: $(&#x27;#appSetting_HeaderTextRadius&#x27;).jqxNumberInput(&#x27;decimal&#x27;) + &#x27;px&#x27;,
								theme1_FillSelectBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_menuBackgroundActive&quot;).val(),
																										$(&#x27;#appSetting_menuBGActiveOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								theme1_FillSelectBorderColor: $(&quot;#appSetting_menuBackgroundBorderActive&quot;).val(),
								theme1_FillBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_menuBackground&quot;).val(),
																										$(&#x27;#appSetting_menuBGOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								theme1_FillBorderColor: $(&quot;#appSetting_menuBackgroundBorder&quot;).val(),
								menuColor: $(&quot;#appSetting_menuColor&quot;).val(),
								menuActiveColor: $(&quot;#appSetting_menuÎctiveColor&quot;).val(),
								rightPanel_TopBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_TopBackground&quot;).val(),
																										$(&#x27;#appSetting_TopBGOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								rightPanel_TabsBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_MidBackground&quot;).val(),
																										$(&#x27;#appSetting_MidBGOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								rightPanel_TopColor: $(&quot;#appSetting_TopColor&quot;).val(),
								rightPanel_TabColor: $(&quot;#appSetting_MidColor&quot;).val(),
								rightPanel_TabActiveColor: $(&quot;#appSetting_MidActiveColor&quot;).val(),
								mapHeaderBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_mapHeaderBG&quot;).val(),
																										$(&#x27;#appSetting_mapHeaderOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								mapDescriptionSize: $(&#x27;#appSetting_mapDescriptionSize&#x27;).jqxNumberInput(&#x27;decimal&#x27;) + &#x27;px&#x27;,
								mapDescriptionColor: $(&quot;#appSetting_mapDescriptionColor&quot;).val(),
								mapFooterBG:
										mygis.Admin.Utilities.getRGBA(
																										$(&quot;#appSetting_mapFooterBG&quot;).val(),
																										$(&#x27;#appSetting_mapFooterOpacity&#x27;).jqxNumberInput(&#x27;decimal&#x27;)
																										),
								mapFooterFontColor: $(&quot;#appSetting_mapFooterFontColor&quot;).val(),
								customCSS_enabled: $(&quot;#appSetting_expertModeToggle&quot;).is(&#x27;:checked&#x27;),
								customCSS: &quot;&quot;
						};
						retobject.push(item);
						myconfig.object=retobject;
						retvalue = true;
						return retvalue;
				},
				
				&#x2F;**
				 * Adds a copy of the selected style to the grid
				 * @method saveAsCopy
				 *&#x2F;
				saveAsCopy: function(){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var r = records[selection[0]];
						var myconfig = mygis.Admin.AppManager.updateConfig;
						var item = {
								styleSelected: false,
								id: -1,
								layoutName: (r.layoutName + strings.AppManager.addStyle_CopySuffix + new Date().toString(Date.CultureInfo.formatPatterns.fullDateTime)).substring(0,99),
								isActive: r.isActive,
								isPublished: r.isPublished,
								headerOn: r.headerOn,
								headerHeight: r.headerHeight,
								headerBG: r.headerBG,
								headerTextColor: r.headerTextColor,
								textBG: r.textBG,
								textRadius: r.textRadius,
								theme1_FillSelectBG: r.theme1_FillSelectBG,
								theme1_FillSelectBorderColor: r.theme1_FillSelectBorderColor,
								theme1_FillBG: r.theme1_FillBG,
								theme1_FillBorderColor: r.theme1_FillBorderColor,
								menuColor: r.menuColor,
								menuActiveColor: r.menuActiveColor,
								rightPanel_TopBG: r.rightPanel_TopBG,
								rightPanel_TabsBG: r.rightPanel_TabsBG,
								rightPanel_TopColor: r.rightPanel_TopColor,
								rightPanel_TabColor: r.rightPanel_TabColor,
								rightPanel_TabActiveColor: r.rightPanel_TabActiveColor,
								mapHeaderBG: r.mapHeaderBG,
								mapDescriptionSize: r.mapDescriptionSize,
								mapDescriptionColor: r.mapDescriptionColor,
								mapFooterBG: r.mapFooterBG,
								mapFooterFontColor: r.mapFooterFontColor,
								customCSS_enabled: r.customCSS_enabled,
								customCSS: r.customCSS
						};
						grid.jqxGrid(&#x27;addrow&#x27;,null,item);
						var confItem = {
								changed: true,
								oldvalue: null,
								newValue: JSON.stringify(item)
						};
						myconfig.styles.push(confItem);
						mygis.Admin.AppManager.notifyUnsaved();
						grid.jqxGrid(&#x27;refreshdata&#x27;);
				},
				
				&#x2F;**
				 * Handling the result of the edit style dialog if it&#x27;s a new item
				 * @method editStyleResult
				 * @param {String} result Whether it was successful (&quot;ok&quot;) or not
				 *&#x2F;
				editStyleResult: function(result){
						if (result==&quot;ok&quot;){
								var grid = $(&quot;#adminStyleList&quot;);
								var gridSource = grid.jqxGrid(&#x27;source&#x27;).records;
								var myconfig = mygis.Admin.AppManager.updateConfig;
								var dialogConfig = mygis.Admin.UI.dialogConfig;
								for (var i=0;i&lt;this.length;i++){
										var r = this[i];
										var item = {
												styleSelected: false,
												id: -1,
												layoutName: r.layoutName,
												isActive: r.isActive,
												isPublished: r.isPublished,
												headerOn: r.headerOn,
												headerHeight: r.headerHeight,
												headerBG: r.headerBG,
												headerTextColor: r.headerTextColor,
												textBG: r.textBG,
												textRadius: r.textRadius,
												theme1_FillSelectBG: r.theme1_FillSelectBG,
												theme1_FillSelectBorderColor: r.theme1_FillSelectBorderColor,
												theme1_FillBG: r.theme1_FillBG,
												theme1_FillBorderColor: r.theme1_FillBorderColor,
												menuColor: r.menuColor,
												menuActiveColor: r.menuActiveColor,
												rightPanel_TopBG: r.rightPanel_TopBG,
												rightPanel_TabsBG: r.rightPanel_TabsBG,
												rightPanel_TopColor: r.rightPanel_TopColor,
												rightPanel_TabColor: r.rightPanel_TabColor,
												rightPanel_TabActiveColor: r.rightPanel_TabActiveColor,
												mapHeaderBG: r.mapHeaderBG,
												mapDescriptionSize: r.mapDescriptionSize,
												mapDescriptionColor: r.mapDescriptionColor,
												mapFooterBG: r.mapFooterBG,
												mapFooterFontColor: r.mapFooterFontColor,
												customCSS_enabled: r.customCSS_enabled,
												customCSS: r.customCSS
										};
										grid.jqxGrid(&#x27;addrow&#x27;,null,item);
										var confItem = {
												changed: true,
												oldvalue: null,
												newValue: JSON.stringify(item)
										};
										myconfig.styles.push(confItem)
								}
								mygis.Admin.AppManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Handling the result of the edit style dialog if it&#x27;s an existing item
				 * @method editStyleUpdateResult
				 * @param {String} result Whether it was successful (&quot;ok&quot;) or not
				 *&#x2F;
				editStyleUpdateResult: function(result){
						if (result==&quot;ok&quot;){
								var grid = $(&quot;#adminStyleList&quot;);
								var gridSource = grid.jqxGrid(&#x27;source&#x27;).records;
								var myconfig = mygis.Admin.AppManager.updateConfig;
								var dialogConfig = mygis.Admin.UI.dialogConfig;
								
								var r = this[0];
								var found =false;
								var counter = 0;
								var itemIndex = -1;
								while (!found &amp;&amp; counter&lt;gridSource.length){
										if (gridSource[counter].id==dialogConfig.objectCount){
												found=true;
												itemIndex =counter;
										}
										counter++;
								}
								if (found){
										var item= {
												layoutName: r.layoutName,
												isActive: r.isActive,
												isPublished: r.isPublished,
												headerOn: r.headerOn,
												headerHeight: r.headerHeight,
												headerBG: r.headerBG,
												headerTextColor: r.headerTextColor,
												textBG: r.textBG,
												textRadius: r.textRadius,
												theme1_FillSelectBG: r.theme1_FillSelectBG,
												theme1_FillSelectBorderColor: r.theme1_FillSelectBorderColor,
												theme1_FillBG: r.theme1_FillBG,
												theme1_FillBorderColor: r.theme1_FillBorderColor,
												menuColor: r.menuColor,
												menuActiveColor: r.menuActiveColor,
												rightPanel_TopBG: r.rightPanel_TopBG,
												rightPanel_TabsBG: r.rightPanel_TabsBG,
												rightPanel_TopColor: r.rightPanel_TopColor,
												rightPanel_TabColor: r.rightPanel_TabColor,
												rightPanel_TabActiveColor: r.rightPanel_TabActiveColor,
												mapHeaderBG: r.mapHeaderBG,
												mapDescriptionSize: r.mapDescriptionSize,
												mapDescriptionColor: r.mapDescriptionColor,
												mapFooterBG: r.mapFooterBG,
												mapFooterFontColor: r.mapFooterFontColor,
												customCSS_enabled: r.customCSS_enabled,
												customCSS: r.customCSS
										};
										$.extend(gridSource[itemIndex],item);
										myconfig.styles[itemIndex].changed=true;
										if (myconfig.styles[itemIndex].newValue){
												myconfig.styles[itemIndex].newValue = JSON.stringify(gridSource[itemIndex]);
										}else{
												myconfig.styles[itemIndex].oldValue = JSON.stringify(gridSource[itemIndex]);	
										}
										
								}else{
										console.log(&quot;An error occured in editStyleUpdateResult&quot;);
								}								
								mygis.Admin.AppManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Selects a row(deselecting others if necessary) and then calls the editing function
				 * @method directStyleEdit
				 * @param {Integer} rowIndex
				 *&#x2F;
				directStyleEdit: function(rowindex){
						var grid = $(&quot;#adminStyleList&quot;);
						grid.jqxGrid(&#x27;clearselection&#x27;);
						grid.jqxGrid(&#x27;selectrow&#x27;,rowindex);
						mygis.Admin.AppManager.Styles.styleSelected();
						mygis.Admin.AppManager.Styles.showEditStyle(false);
				},
				
				&#x2F;**
				 * Switches the active tab to the given index
				 * @method switchToTab
				 *&#x2F;
				switchToTab: function(index){
						var tabHeaders = $(&quot;#editStyleLinkTabsRound&quot;).find(&quot;.sectionHeader&quot;);
						for (var i=0;i&lt;tabHeaders.length;i++){
								if (i!=index){
										tabHeaders[i].ex_RemoveClassName(&quot;active&quot;);
								}else{
										tabHeaders[i].ex_AddClassName(&quot;active&quot;);
								}
						}
						var tabs = $(&quot;#editHeaderTab&quot;).find(&quot;.appSettingFrame&quot;);
						for (var i=0;i&lt;tabs.length;i++){
								if (i!=index){
										$(tabs[i]).hide();
								}else{
										$(tabs[i]).show();
										
								}
						}
				},
				
				&#x2F;**
				 * Hides elements if global &quot;on&#x2F;off&quot; button is unchecked
				 * @method toggleSubMenu
				 * @param {String} id The firing element. Accepts &quot;#appSetting_enableHeader&quot;, &quot;#appSetting_expertModeToggle&quot;
				 *&#x2F;
				toggleSubMenu: function(element){
						var on = element.checked;
						switch (element.id){
								case &quot;appSetting_enableHeader&quot;:
										if (on){
												$(&quot;#appSetting_HeaderSettings&quot;).show();
										}else{
												$(&quot;#appSetting_HeaderSettings&quot;).hide();
										}
										break;
								case &quot;appSetting_expertModeToggle&quot;:
										if (on){
												$(&quot;#appSetting_ExpertSettings&quot;).show();
										}else{
												$(&quot;#appSetting_ExpertSettings&quot;).hide();
										}
										break;
						}
				},
				
				&#x2F;**
				 * Creates an advanced text-editor for manual css mode
				 * @method createEditor
				 *&#x2F;
				createEditor: function(){
						
						if (!mygis.Admin.AppManager.Styles.editor){
								mygis.Admin.AppManager.Styles.editor = CodeMirror.fromTextArea(document.getElementById(&quot;expertModeCss&quot;),{
										mode: &quot;css&quot;,
										lineNumbers: true,
										matchBrackets: true,
										theme: &quot;default&quot;,
										tabindex: 0
								});  
						}
						
				},
				
				&#x2F;**
				 * Sets the selected grid row as the default(active) and notifies for save
				 * @method makeDefault
				 *&#x2F;
				makeDefault: function(){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var changed= false;
						var oldIndex = -1;
						if (selection.length&gt;1){
								displayError(&quot;Only one style can be set as active&quot;);	&#x2F;&#x2F;This should never fire under normal conditions
						}else{
								for (var i=0;i&lt;records.length;i++){
										var item = records[i];
										if (item.isActive &amp;&amp; i!=selection[0]){
												item.isActive=false;
												changed=true;
												oldIndex = i;
										}else if (i==selection[0]){
												item.isActive=!item.isActive;
												changed=true;
										}
								}
								if (changed){
										if (oldIndex&gt;-1){
												var oldItem = mygis.Admin.AppManager.updateConfig.styles[oldIndex];
												oldItem.changed=true;
												if (oldItem.newValue){
														oldItem.newValue = JSON.stringify(records[oldIndex]);
												}else{
														oldItem.oldValue = JSON.stringify(records[oldIndex]);
												}
										}
										
										var newItem = mygis.Admin.AppManager.updateConfig.styles[selection[0]];
										
										newItem.changed=true;
										
										if (newItem.newValue){
												newItem.newValue = JSON.stringify(records[selection[0]]);
										}else{
												newItem.oldValue = JSON.stringify(records[selection[0]]);
										}
										mygis.Admin.AppManager.notifyUnsaved();
										grid.jqxGrid(&#x27;refreshdata&#x27;);
								}
						}
				},
				
				&#x2F;**
				 * Sets the selected grid rows as &#x27;published&#x27; and notifies for save
				 * @method publishStyles
				 *&#x2F;
				publishStyles: function(){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var atLeastOne = false;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								if (!item.isPublished){
										atLeastOne = true;
										item.isPublished = true;
										var confItem = mygis.Admin.AppManager.updateConfig.styles[selection[i]];
										confItem.changed=true;
										if (confItem.newValue){
												confItem.newValue = JSON.stringify(item);
										}else{
												confItem.oldValue = JSON.stringify(item);
										}
								}
						}
						if (atLeastOne){
								mygis.Admin.AppManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Sets the selected grid rows as &#x27;published&#x27; and notifies for save
				 * @method unpublishStyles
				 *&#x2F;
				unpublishStyles: function(){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var atLeastOne = false;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								if (item.isPublished){
										atLeastOne = true;
										item.isPublished = false;
										var confItem = mygis.Admin.AppManager.updateConfig.styles[selection[i]];
										confItem.changed=true;
										if (confItem.newValue){
												confItem.newValue = JSON.stringify(item);
										}else{
												confItem.oldValue = JSON.stringify(item);
										}
								}
						}
						if (atLeastOne){
								mygis.Admin.AppManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Deletes the selected grid rows and notifies for save
				 * @method deleteStyles
				 *&#x2F;
				deleteStyles: function(){
						var grid = $(&quot;#adminStyleList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var atLeastOne = false;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								var confItem = mygis.Admin.AppManager.updateConfig.styles[selection[i]];
								if (confItem.newValue){	&#x2F;&#x2F;it&#x27;s simply a newly created item, so remove it from the array
										records.splice(selection[i],1);
										mygis.Admin.AppManager.updateConfig.styles.splice(selection[i],1);
								}else{
										var grabCopy = $.extend({},item);
										grabCopy.id=-1;
										confItem.newValue = JSON.stringify(grabCopy);
										confItem.changed=true;
										atLeastOne=true;
										records.splice(selection[i],1);
								}
						}
						if (atLeastOne){
								mygis.Admin.AppManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				}
		
		},
		
		&#x2F;**
		 * Triggers when a section in the &quot;edit app settings&quot; is expanded
		 * @method expandDetails
		 * @param {Object} event The triggering event
		 * @for mygis.Admin.AppManager
		 *&#x2F;
		expandDetails: function(event){
				var index = event.item;
				var myconfig = mygis.Admin.AppManager.updateConfig;
				mygis.Utilities.blockUI();
				
				var tabHeaders = $(&quot;#contentLinkTabsRound&quot;).find(&quot;.sectionHeader&quot;);
				for (var i=0;i&lt;tabHeaders.length;i++){
						if (i!=index){
								tabHeaders[i].ex_RemoveClassName(&quot;active&quot;);
						}else{
								tabHeaders[i].ex_AddClassName(&quot;active&quot;);
						}
				}
				var tabs = $(&quot;#editAppForm&quot;).find(&quot;.sectionContent&quot;);
				for (var i=0;i&lt;tabs.length;i++){
						if (i!=index){
								$(tabs[i]).hide();
						}else{
								$(tabs[i]).show();
								var buttons = $(tabs[i]).find(&quot;.sectionButtons&quot;);
								$(&quot;#contentSpecificToolbar&quot;).empty();
								$(&quot;#contentSpecificToolbar&quot;).append(buttons.clone());
						}
				}
				
				mygis.Admin.AppManager.createGrid(index);
				mygis.Utilities.unblockUI();
		},
		
		&#x2F;**
		 * Routing function for the app settings tabs
		 * @method createGrid
		 * @param {Integer} index The corresponding tabIndex to create a grid for.
		 *&#x2F;
		createGrid: function(index){
				var myconfig = mygis.Admin.AppManager.updateConfig;
				switch (index){
						case 1:
								if (myconfig.maps.length==0){
										mygis.Admin.AppManager.Maps.createAppMapGrid(myconfig.appID);
								}else{
										$(&quot;#adminMapList&quot;).jqxGrid(&#x27;render&#x27;); &#x2F;&#x2F;force update
								}
								break;
						case 2:
								if (myconfig.urls.length==0){
										mygis.Admin.AppManager.URLs.createAppURLGrid(myconfig.appID);
								}else{
										$(&quot;#adminURLList&quot;).jqxGrid(&#x27;render&#x27;); &#x2F;&#x2F;force update
								}
								break;
						case 3:
								if (myconfig.users.length==0){
										mygis.Admin.AppManager.createAppUserGrid(myconfig.appID);
								}else{
										$(&quot;#adminAppUserList&quot;).jqxGrid(&#x27;render&#x27;); &#x2F;&#x2F;force update
								}
								break;
						case 4:
								if (myconfig.styles.length==0){
										mygis.Admin.AppManager.Styles.createAppStylesGrid(myconfig.appID);
								}else{
										$(&quot;#adminStyleList&quot;).jqxGrid(&#x27;render&#x27;);	&#x2F;&#x2F;force update
								}
								break;
				}
		},
		
		&#x2F;**
			Fills in the &quot;editForm&quot; fields with the application details
			@method getAppDetails
			@param {String} appID The application id. If ommited, it will get the current application details.
		**&#x2F;
		getAppDetails: function(appID){
			var records = $(&quot;#myAppGrid&quot;).jqxGrid(&#x27;source&#x27;).records;
			var found=false;
			var i=0;
			var details;
			while (!found &amp;&amp; i&lt;records.length){
				if (appID){
					if (records[i].appID==appID){
						found=true;
						details = records[i];
					}
				}else{
					if (records[i].appPrefix==currentAppName){
						found=true;
						details = records[i];
					}
				}
				i++;
			}
			if (found){
				mygis.Admin.AppManager.storeAppDetails(details);
				
				
				document.getElementById(&quot;editAppName&quot;).value = details.appName;
				document.getElementById(&quot;editAppAlias&quot;).value = details.appPrefix;
				document.getElementById(&quot;editAppWelcomeText&quot;).value = details.appWelcomeText;
				document.getElementById(&quot;editAppLogo&quot;).src = mygis.Utilities.format(&quot;{0}GetImage.ashx?qType=GetAppLogo&amp;qContents={1}&amp;qSize=142&quot;,config.folderPath,details.appID);
				if (details.hasLogo1){
					document.getElementById(&quot;editAppLogo1&quot;).src = mygis.Utilities.format(&quot;{0}GetImage.ashx?qType=GetAppLogo1&amp;qContents={1}&amp;qSize=142&quot;,config.folderPath,details.appID);
				}else{
						
						document.getElementById(&quot;editAppLogo1&quot;).src =&quot;&quot;;
				}
				if (details.hasLogo2){
					document.getElementById(&quot;editAppLogo2&quot;).src	= mygis.Utilities.format(&quot;{0}GetImage.ashx?qType=GetAppLogo2&amp;qContents={1}&amp;qSize=142&quot;,config.folderPath,details.appID);
				}else{
						document.getElementById(&quot;editAppLogo2&quot;).src =&quot;&quot;;
				}
			}else{
				displayError(strings.AppManager.err_notAuthorized);
			}
		},
		
		&#x2F;**
		 * Stores the current editing application&#x27;s details in the config object
		 * @method storeAppDetails
		 * @param {Object} detailRow The grid record
		 *&#x2F;
		storeAppDetails: function(detailRow){
				var myconfig = mygis.Admin.AppManager.updateConfig;
				var mymaps = detailRow.appMAPS.split(&quot;#&quot;);
				var myurls = detailRow.appURLS.split(&quot;,&quot;);
				myconfig.appID = detailRow.appID;
				myconfig.maps = [];
				myconfig.urls = [];
				myconfig.users = [];
				&#x2F;*
				$.each(mymaps,function(i,v){
						var item = {
								changed: false,
								oldValue: v,
								newValue: null
						};
						myconfig.maps.push(item);
				});
				$.each(myurls,function(i,v){
						var item = {
								changed: false,
								oldValue: v,
								newValue: null
						};
						myconfig.urls.push(item);
				});
				*&#x2F;
		},
		
		&#x2F;**
		 * Creates the grid for the application&#x27;s users
		 * @method createAppUserGrid
		 * @param {Integer} appID The application to search
		 *&#x2F;
		createAppUserGrid: function(appID){
				mygis.Utilities.blockUI();
				var userSource = mygis.Admin.AppManager.createAppUserGridSource(appID);
				var userContainer = $(&quot;#adminAppUserList&quot;);
				if (userSource.records.length&gt;0){
						userContainer.jqxGrid({
								source: userSource,
								width: &#x27;100%&#x27;,
								autoheight: true,
								theme: &#x27;pk_mg_jm&#x27;,
								altrows: true,
								enabletooltips: true,
								columns: [
										{text: strings.AppManager.usergrid_UserFirstName,datafield: &#x27;firstName&#x27;},
										{text: strings.AppManager.usergrid_UserLastName,datafield: &#x27;lastName&#x27;},
										{text: strings.AppManager.usergrid_UserEmail,datafield: &#x27;email&#x27;},
										{text: strings.AppManager.usergrid_Username,datafield: &#x27;username&#x27;},
										{text: strings.AppManager.usergrid_UserID,datafield: &#x27;userID&#x27;}
								],
								enableanimations: false,
								showheader: true,
								columnsmenu: true,
								editable: true,
								selectionmode: &#x27;none&#x27;
						});
				}else{
						userContainer.jqxGrid({
								source: userSource,
								width: &#x27;100%&#x27;,
								autoheight: true,
								theme: &#x27;pk_mg_jm&#x27;,
								altrows: true,
								enabletooltips: true,
								columns: [
										{text: strings.AppManager.usergrid_UserFirstName,datafield: &#x27;firstName&#x27;},
										{text: strings.AppManager.usergrid_UserLastName,datafield: &#x27;lastName&#x27;},
										{text: strings.AppManager.usergrid_UserEmail,datafield: &#x27;email&#x27;},
										{text: strings.AppManager.usergrid_Username,datafield: &#x27;username&#x27;},
										{text: strings.AppManager.usergrid_UserID,datafield: &#x27;userID&#x27;}
								],
								enableanimations: false,
								showheader: true,
								columnsmenu: true,
								editable: true,
								selectionmode: &#x27;none&#x27;
						});
				}
				
				mygis.Utilities.unblockUI();
		},
		
		&#x2F;**
		 * Creates the source for the application&#x27;s users
		 * @method createAppUserGridSource
		 * @param {Integer} appID
		 *&#x2F;
		createAppUserGridSource: function(appID){
				var retvalue;
				var url = config.mgreq+&quot;?qtype=GetAppUserList&amp;qContents=&quot;+appID;
				var source = {
						datatype: &quot;json&quot;,
						datafields: [
							{ name: &quot;userID&quot; },
							{ name: &quot;username&quot; },
							{ name: &quot;firstName&quot; },
							{ name: &quot;lastName&quot; },
							{ name: &quot;email&quot; }
						],
						id: &#x27;userlist&#x27;,
						url: url
			};
				retvalue = new $.jqx.dataAdapter(source,{async:false});
				&#x2F;&#x2F;retvalue.dataBind();
				return retvalue;
		},
		
		
		&#x2F;**
		 * Updates the config object with the source maps
		 * @method setConfigMaps
		 *&#x2F;
		setConfigMaps: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.AppManager.updateConfig.maps=finalList;
		},
		
		&#x2F;**
		 * Updates the config object with the source Urls
		 * @method setConfigMaps
		 *&#x2F;
		setConfigUrls: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.AppManager.updateConfig.urls=finalList;
		},
		
		&#x2F;**
			Handles the clicking of a &#x27;replace logo&#x27; button.
			@method logoBtnClick
			@param {Element} elem The button clicked
		**&#x2F;
		logoBtnClick: function(elem){
			var clicked = elem.id;
			var logo_id=-1;
			switch (clicked){
				case &quot;replaceAppLogo&quot;:
					logo_id=0;
					break;
				case &quot;replaceAppLogo1&quot;:
					logo_id=1;
					break;
				case &quot;replaceAppLogo2&quot;:
					logo_id=2;
					break;
			}
			if (logo_id&gt;-1){
				internalConfig.mmCallback.fn=mygis.Admin.AppManager.newlogoSelected;
				internalConfig.mmCallback.objectCount=1;
				internalConfig.mmCallback.object={
					logo_id: logo_id
				};
				showMediaManager();
			}
		},
		
		&#x2F;**
		 * Handles the clicking of a &#x27;remove logo&#x27; button.
		 * @method logoRemoveBtnClick
		 * @param {Element} elem The calling element
		 *&#x2F;
		logoRemoveBtnClick: function(elem){
				var clicked = elem.id;
				var logo_id=-1;
				var myconfig = mygis.Admin.AppManager.updateConfig;
				switch (clicked){
						case &quot;removeAppLogo1&quot;:
								myconfig.logo1.changed=true;
								myconfig.logo1.newValue=-1;
								document.getElementById(&quot;editAppLogo1&quot;).src = &quot;&quot;;
								break;
						case &quot;removeAppLogo2&quot;:
								myconfig.logo2.changed=true;
								myconfig.logo2.newValue=-1;
								document.getElementById(&quot;editAppLogo2&quot;).src = &quot;&quot;;
								break;
				}
				mygis.Admin.AppManager.notifyUnsaved();
		
		},
		
		&#x2F;**
			This method is called after an image is selected in the Media Manager to replace the application&#x27;s logos
			@method newlogoSelected
			@param {Object} result The result of the Media Manager window
		**&#x2F;
		newlogoSelected: function(result){
			var resultObj=this;
			
			resultObj = resultObj[0];
			if (!result || result!=&quot;ok&quot;){
				if (result){
					displayError(result);
				}
			}else{
				var myconfig = internalConfig.mmCallback.object;
				var updateConfig = mygis.Admin.AppManager.updateConfig;
				var confObj;
				var confObjLoc=&quot;&quot;;
				switch (myconfig.logo_id){
					case 0:
						confObj=updateConfig.logo;
						confObjLoc=&quot;editAppLogo&quot;;
						break;
					case 1:
						confObj=updateConfig.logo1;
						confObjLoc=&quot;editAppLogo1&quot;;
						break;
					case 2:
						confObj=updateConfig.logo2;
						confObjLoc=&quot;editAppLogo2&quot;;
						break;
				}
				if (!confObj.changed){
					confObj.oldValue = document.getElementById(confObjLoc).src;	&#x2F;&#x2F;store the old value
				}
				confObj.changed = true;
				confObj.newValue = resultObj.fileID;
				var newsource = mygis.Utilities.format(&quot;{0}GetImage.ashx?qType=userFile&amp;qContents={1}&quot;,
																				 config.folderPath,resultObj.fileID);
				document.getElementById(confObjLoc).src = newsource+&quot;&amp;qSize=142&quot;;	&#x2F;&#x2F;thumbnail
				mygis.Admin.AppManager.notifyUnsaved();
				if (myconfig.logo_id==1){
						
				
				}
				mygis.Admin.AppManager.previewAppLogo(myconfig.logo_id,newsource);
				displayNotify(strings.AppManager.logo_selected);
				
				
				&#x2F;&#x2F;mygis.Admin.AppManager.replaceLogo(myconfig.logo_id,resultObj.fileID);
				
			}
		},
		
		&#x2F;**
			Replaces the application logo with a new one.
		
			@method replaceLogo
			@param {Integer} id The logo to replace (0 - the default, 1 or 2)
			@param {Integer} fileID The fileID to replace it with
		**&#x2F;
		replaceLogo: function(id,fileID){
			mygis.Utilities.blockUI();
			var params = mygis.Utilities.format(&quot;{0}%23{1}&quot;,id,fileID);
			var customUrl = config.mgreq+&quot;?qtype=ReplaceLogo&amp;qContents=&quot;+params;
			$.ajax({
				type:&quot;GET&quot;,
				url: customUrl,
				success: function(data){
					try{
						&#x2F;&#x2F;update the preview, update the logo!
						var realResults = eval(data);
						if (realResults.iotype==&quot;success&quot;){
							mygis.Admin.UI.refreshPageLogos();
							mygis.Admin.AppManager.resetConfigObject();
							displaySuccess(strings.AppManager.logo_updated);
						}else{
							displayError(realResults.iomsg);
						}
						
					}catch(err){
						console.log(err.message);
					}
					mygis.Utilities.unblockUI();
				}
			});
		},
		
		&#x2F;**
		 * @method previewAppLogo
		 *&#x2F;
		previewAppLogo: function(logo_id,newvalue){
				var images = $(&quot;.domainLogoWrapper2&quot;).find(&quot;img&quot;);
				images[logo_id].src=newvalue;
				if (newvalue){
						images[logo_id].style.display=&quot;&quot;;
				}else if (logo_id&gt;0){
						images[logo_id].style.display=&quot;none&quot;;
				}
		},
		
		&#x2F;**
			Notifies that there are unsaved changes
			@method notifyUnsaved
		**&#x2F;
		notifyUnsaved: function(){
			document.getElementById(&quot;amenu_Apps_Config_save&quot;).ex_RemoveClassName(&quot;disabled&quot;);
			$(&quot;#amenu_Apps_Config_save&quot;).qtip({
				content: {
						text: strings.AppManager.msg_NotifyUnsaved
				},
				position: {
						my: &quot;center right&quot;,
						at: &quot;center left&quot;
				},
				show: {
						event: &quot;mouseover&quot;,
						ready: true,
						solo: true
				},
				hide: {
						event: &quot;unfocus&quot;,
						inactive: false
				},
				events: {
						hide: function(event, api) {
								api.destroy();
						}
				},
				style: {
						classes: &#x27;ui-tooltip-shadow&#x27;, &#x2F;&#x2F; Optional shadow...
						tip: {
							border: 1
						},
						border: 1
				}});
		},
		
		&#x2F;**
			Propagates all changes to the server
			@method saveChanges
		**&#x2F;
		saveChanges: function(){
				var toSend=JSON.stringify(mygis.Admin.AppManager.updateConfig);
				var customUrl = config.mgreq+&quot;?qtype=UpdateAppSettings&quot;;	&#x2F;&#x2F;&amp;qContents=&quot;+toSend;
				var postObject = new Object();
				postObject[&quot;qContents&quot;]=toSend;
				mygis.Utilities.blockUI();
				$.ajax({
						type:&quot;POST&quot;,
						data: postObject,
						url: customUrl,
						success: function(data){
							try{
								&#x2F;&#x2F;update the preview, update the logo!
								var realResults = eval(data);
								if (realResults.iotype==&quot;success&quot;){
									mygis.Admin.UI.refreshPageLogos();
									mygis.Admin.AppManager.resetConfigObject();
									displaySuccess(strings.AppManager.settings_updated);
									setTimeout(function(){
										var activeTab = $(&quot;#contentLinkTabsRound&quot;).find(&quot;.sectionHeader.active&quot;);
										mygis.Admin.AppManager.createGrid(activeTab.index());
									},250);
									
								}else{
									displayError(realResults.iomsg);
								}
								
							}catch(err){
								console.log(err.message);
							}
							mygis.Utilities.unblockUI();
						}
			});
				
		},
		
		&#x2F;**
		 * Reverts all changes at the client
		 * @method revertChanges
		 *&#x2F;
		revertChanges: function(){
				var myconfig = mygis.Admin.AppManager.updateConfig;
				if (myconfig.logo.changed){
								document.getElementById(&quot;editAppLogo&quot;).src=myconfig.logo.oldValue;
				}
				if (myconfig.logo1.changed){
								document.getElementById(&quot;editAppLogo1&quot;).src=myconfig.logo1.oldValue;	
				}
				if (myconfig.logo2.changed){
								document.getElementById(&quot;editAppLogo2&quot;).src=myconfig.logo2.oldValue;
				}
				if (myconfig.appName.changed){
								document.getElementById(&quot;editAppName&quot;).value=myconfig.appName.oldValue;
				}
				if (myconfig.appAlias.changed){
								document.getElementById(&quot;editAppAlias&quot;).value=myconfig.appAlias.oldValue;
				}
				if (myconfig.appText.changed){
								document.getElementById(&quot;editAppWelcomeText&quot;).value=myconfig.appText.oldValue;
				}
				mygis.Admin.AppManager.resetConfigObject();
		},

		&#x2F;**
		 * Resets the configuration object used in tracking app settings&#x27; changes.
		 * @method resetConfigObject
		 **&#x2F;
		resetConfigObject: function(){
				try{
						if (!document.getElementById(&quot;amenu_Apps_Config_save&quot;).ex_HasClassName(&quot;disabled&quot;)){
								document.getElementById(&quot;amenu_Apps_Config_save&quot;).ex_AddClassName(&quot;disabled&quot;);
						}
				}catch(err){}
				var resetobj = {
								maps: [],
								urls: [],
								users: [],
								styles: [],
								logo: {
									changed: false,
									newValue: null,
									oldValue: null
								},
								logo1: {
									changed: false,
									newValue: null,
									oldValue: null
								},
								logo2: {
									changed: false,
									newValue: null,
									oldValue: null
								},
								appName: {
									changed: false,
									newValue: null,
									oldValue: null
								},
								appAlias: {
									changed: false,
									newValue: null,
									oldValue: null
								},
								appText: {
									changed: false,
									newValue: null,
									oldValue: null
								}
			  };
				mygis.Admin.AppManager.updateConfig = mygis.Utilities.mergeOptions(mygis.Admin.AppManager.updateConfig,resetobj);
		}
		
		
	},
	
	
	&#x2F;**
		Functions and classes for map management
		
		@class mygis.Admin.MapManager
		@static
	**&#x2F;
	MapManager: {
		
		&#x2F;**
			This holds the update configuration for the map settings.
			@property updateConfig
			@type {Object}
		**&#x2F;
		updateConfig: {
				mapID: -1,
				layers: [],
				tags: [],
				quickSearches: [],
				permissions: [],
				macros: [],
				mapName: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDescription: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapExtent: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapCenter: {
						changed: false,
						oldValue : &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapZoom: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDeveloped: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapOwner: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapThumb: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDefaultBG: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				}
		},
		
		&#x2F;**
		 * Functions for the maps in the map manager
		 * @class mygis.Admin.MapManager.Maps
		 * @static
		 *&#x2F;
		Maps: {
				
				&#x2F;**
				 * Shows a dialog window for inserting new map
				 * @method showAddNewMap
				 *&#x2F;
				showAddNewMap: function(){
						var myconfig = mygis.Admin.UI.dialogConfig;
						myconfig.checkfn = mygis.Admin.MapManager.Maps.addNewMapCheck;
						myconfig.callbackfn = mygis.Admin.MapManager.Maps.createNewMap;
						myconfig.objectCount = 1;
						myconfig.windowTitle = &quot;#addMapNamePop&quot;;
						$(myconfig.windowTitle).dialog({
								autoOpen: true,
								modal: true,
								resizable: false,
								width: 480,
								height: 130, 
								title: strings.MapManager.addMap_windowTitle,
								closeOnEscape: false
						});
						var titleBar = $(&quot;#ui-dialog-title-addMapNamePop&quot;).parent();
						titleBar.css({
							&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;Administration&#x2F;menu&#x2F;icon-16-banner-tracks.png&#x27;) #F6A828 no-repeat 12px 8px&quot;,
							&quot;background-size&quot;:&quot;auto 18px&quot;
							});
						
				},
				
				&#x2F;**
				 * Used for client-validation when inserting new map name
				 * @method addNewMapCheck
				 *&#x2F;
				addNewMapCheck: function(){
						var retvalue = false;
						var checkValue = $(&quot;#addMapNameInp&quot;).val();
						if (!checkValue){
								alert(strings.MapManager.addMap_err_NotFilled);
						}else{
								var wrongSymbols = [&#x27;&#x60;&#x27;,&#x27;~&#x27;,&#x27;!&#x27;,&#x27;@&#x27;,&#x27;#&#x27;,&#x27;$&#x27;,&#x27;%&#x27;,&#x27;^&#x27;,&#x27;&amp;&#x27;,&#x27;*&#x27;,&#x27;-&#x27;,&#x27;+&#x27;,&#x27;=&#x27;,&#x27;[&#x27;,&#x27;]&#x27;,&#x27;{&#x27;,&#x27;}&#x27;,&#x27;\\&#x27;,&#x27;|&#x27;,&#x27;:&#x27;,&#x27;;&#x27;,&#x27;&quot;&#x27;,&#x27;\&#x27;&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;&#x27;,&#x27;,&#x27;,&#x27;.&#x27;,&#x27;&#x2F;&#x27;,&#x27;?&#x27;];
								var atLeastOne =false;
								for (var i=0;i&lt;wrongSymbols.length;i++){
										if (checkValue.indexOf(wrongSymbols[i])&gt;-1){
												atLeastOne=true;
										}
								}
								if (atLeastOne){
										alert(strings.MapManager.addMap_err_InvalidName);
								}else{
										mygis.Admin.UI.dialogConfig.object = checkValue;
										retvalue=true;
								}
						}
						return retvalue;
				},
				
				&#x2F;**
				 * Creates a new map
				 * @method createNewMap
				 *&#x2F;
				createNewMap: function(result){
						if (result==&quot;ok&quot;){
								var myValue = this;
								mygis.Admin.MapManager.resetConfigObject();
								var myconfig = mygis.Admin.MapManager.updateConfig;
								myconfig.mapName.changed=true;
								myconfig.mapName.newValue=myValue;
								var toSend=JSON.stringify(myconfig);
								var customUrl = config.mgreq+&quot;?qtype=CreateNewMap&quot;;
								var postObject = new Object();
								postObject[&quot;qContents&quot;]=toSend;
								mygis.Utilities.blockUI();
								$.ajax({
										type:&quot;POST&quot;,
										data: postObject,
										url: customUrl,
										success: function(data){
											try{
												var realResults = eval(data);
												if (realResults.iotype==&quot;success&quot;){
														mygis.Admin.MapManager.Maps.refreshMapGrid();
														displaySuccess(strings.MapManager.addMap_msg_Success);
													
												}else{
													displayError(realResults.iomsg);
												}
												
											}catch(err){
												console.log(err.message);
											}
											mygis.Utilities.unblockUI();
										}
								});
						}
				},
				
				&#x2F;**
					Used to create the map grid in the map Manager
					@method createMapGrid
				**&#x2F;
				createMapGrid: function(){
						mygis.Utilities.blockUI();
						var container = $(&quot;#myMapsGrid&quot;);
						var columnrenderer = function(value){
								var retobject;
								var action = &#x27;router(&quot;admin_Maps_allClick&quot;,this);&#x27;;
								var grid = $(&quot;#myMapsGrid&quot;);
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var style = &quot;text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;&quot;;
								var inpID = &quot;admin_Maps_selectAllMaps&quot;;
								var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{0}&#x27;&gt;&lt;input id=&#x27;{1}&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{2}&#x27;{3}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																									 style,inpID,action,checked);				
								return retobject;
						}
						var cellrenderer = function(row,datafield,value){
								var retobject;
								switch(datafield){
										case &quot;mapName&quot;:
												var action = mygis.Utilities.format(&#x27;router(&quot;mapnameClicked&quot;,{0});&#x27;,row);
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,action);
												break;
								}
								return retobject;
						}
						var locObject = {
								groupsheaderstring: strings.Grid.groupsheaderstring,
								sortascendingstring: strings.Grid.sortascendingstring,
								sortdescendingstring: strings.Grid.sortdescendingstring,
								sortremovestring: strings.Grid.sortremovestring,
								groupbystring: strings.Grid.groupbystring,
								groupremovestring: strings.Grid.groupremovestring
						};
						var mapSource = mygis.Admin.MapManager.createPotentialMapSource();
						container.jqxGrid({
								source: mapSource,
								width: &#x27;100%&#x27;,
								height: &#x27;100%&#x27;,
								autoheight: false,
								theme: &#x27;pk_mg_jm&#x27;,
								altrows: true,
								enabletooltips: true,
								columns: [
										{text:&#x27;asdf&#x27;,datafield:&#x27;mapSelected&#x27;, width:45,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
										{text: strings.MapControl.col_mapName, datafield: &#x27;mapName&#x27;, width: 200, cellsrenderer: cellrenderer,editable:false},
										{text: strings.MapControl.col_mapOwner, datafield: &#x27;mapOwner&#x27;,editable:false},
										{text: strings.MapControl.col_mapLCount, datafield: &#x27;mapLayerCount&#x27;,editable:false,cellsrenderer: cellrenderer,width: 80},
										{text: strings.MapControl.col_mapCreate, datafield: &#x27;mapCreateDate&#x27;,editable:false},
										{text: strings.MapControl.col_mapUpdate, datafield: &#x27;mapUpdateDate&#x27;,editable:false},
										{text: strings.MapControl.col_mapDeveloped, datafield: &#x27;mapDevelopedBy&#x27;,editable:false}
										
								],
								enableanimations: false,
								showheader: true,
								columnsmenu: false,
								sortable: true,
								editable: true,
								groupable: true,
								showgroupsheader: true,
								selectionmode: &#x27;none&#x27;
								
						});
						container.jqxGrid(&#x27;localizestrings&#x27;, locObject);
						container.bind(&#x27;rowselect&#x27;,mygis.Admin.MapManager.Maps.mapSelected);
						container.bind(&#x27;rowunselect&#x27;,mygis.Admin.MapManager.Maps.mapUnselected);
						container.bind(&#x27;cellendedit&#x27;,mygis.Admin.MapManager.Maps.singleCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Refreshes the list of maps from the server
				 * @method refreshMapGrid	
				 **&#x2F;
				refreshMapGrid: function(){
						var container = $(&quot;#myMapsGrid&quot;);
						container.jqxGrid(&#x27;updatebounddata&#x27;);
				},
				
				&#x2F;**
				 * Activates&#x2F;deactivates some buttons when a map is selected
				 * @method mapSelected
				 **&#x2F;
				mapSelected: function(){
						var grid = $(&quot;#myMapsGrid&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);								
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;admin_Maps_selectAllMaps&quot;).checked=true;
						}else{
								document.getElementById(&quot;admin_Maps_selectAllMaps&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Activates&#x2F;deactivates some buttons when a map is unselected
				 * @method mapUnselected
				 **&#x2F;
				mapUnselected: function(){
						var grid = $(&quot;#myMapsGrid&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								
								document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else if (selection.length==1){
								document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								if (!document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Maps_Manager_edit&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;amenu_Maps_Manager_delete&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;admin_Maps_selectAllMaps&quot;).checked=true;
						}else{
								document.getElementById(&quot;admin_Maps_selectAllMaps&quot;).checked=false;
						}
				},
				
				&#x2F;**
				* Handles the clicking of the checkbox in each row at the Map Manager
				* @method singleCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
				singleCheckClicked: function(elem){
						var grid = $(&quot;#myMapsGrid&quot;);
						if (elem.args.value) {
							 grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
							 grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
				
				&#x2F;**
				 * Handles the check button in the Map Manager
				 * @method allCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				allCheckClicked : function(elem){
						var grid = $(&quot;#myMapsGrid&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].mapSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].mapSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				* Handles clicking on an app name in the map grid.
				* Selects the row and goes to &quot;edit mode&quot;
				* @method appClicked
				* @param {Integer} The row index clicked
				*&#x2F;
				mapClicked: function(index){
						var grid = $(&quot;#myMapsGrid&quot;);
						grid.jqxGrid(&#x27;clearselection&#x27;);
						grid.jqxGrid(&#x27;selectrow&#x27;,index);
						mygis.Admin.UI.menuClick(null,&quot;amenu_Maps_Config&quot;);		
				},
				
				&#x2F;**
				 * Gets the map&#x27;s current extent and replaces the corresponding map property
				 * @method getCurrentExtent
				 *&#x2F;
				getCurrentExtent: function(){
						var value = digimap.getExtent().toBBOX();
						$(&quot;#editMapExtent&quot;).val(value);
				},
				
				&#x2F;**
				 * Gets the map&#x27;s current center and replaces the corresponding map property
				 * @method getCurrentCenter
				 *&#x2F;
				getCurrentCenter: function(){
						var value = digimap.getCenter().toShortString();
						$(&quot;#editMapCenter&quot;).val(value);
				},
				
				&#x2F;**
				 * Gets the map&#x27;s current zoom level and replaces the corresponding map property
				 * @method getCurrentZoom
				 *&#x2F;
				getCurrentZoom: function(){
						var value = digimap.getZoom();
						$(&quot;#editMapZoom&quot;).val(value);
				},
				
				&#x2F;**
				 * Shows the file manager to replace a map thumb.
				 * @method replaceMapThumbDialog
				 *&#x2F;
				replaceMapThumbDialog: function(){
						internalConfig.mmCallback.fn=mygis.Admin.MapManager.Maps.newMapThumbSelected;
						internalConfig.mmCallback.objectCount=1;
						internalConfig.mmCallback.object={
								
						};
						showMediaManager();
				},
				
				&#x2F;**
				 * This method is called after an image is selected in the Media Manager to replace the map&#x27;s thumb
				 * @method newMapThumbSelected
				 * @param {Object} result The result of the Media Manager window
				 *&#x2F;
				newMapThumbSelected: function(result){
						var resultObj=this;
						resultObj = resultObj[0];
						if (!result || result!=&quot;ok&quot;){
							if (result){
								displayError(result);
							}
						}else{
								var myconfig = internalConfig.mmCallback.object;
								var updateConfig = mygis.Admin.MapManager.updateConfig;
								
								updateConfig.mapThumb.changed=true;
								updateConfig.mapThumb.newValue = resultObj.fileID;
								var newsource = mygis.Utilities.format(&quot;{0}GetImage.ashx?qType=userFile&amp;qContents={1}&quot;,
																				 config.folderPath,resultObj.fileID);
								document.getElementById(&quot;editMapThumb&quot;).src = newsource+&quot;&amp;qSize=120&quot;;
								mygis.Admin.MapManager.notifyUnsaved();
						}
				},
				
				&#x2F;**
				 * Generates a new map thumbnail from its layers
				 * @method replaceMapThumbAuto
				 *&#x2F;
				replaceMapThumbAuto: function(manualBox){
						var myconfig = mygis.Admin.MapManager.updateConfig;
						var format=&quot;image&#x2F;png&quot;;
						var bbox;
						if (manualBox){
								bbox=manualBox;
						}else{
								bbox = myconfig.mapExtent.newValue?myconfig.mapExtent.newValue:myconfig.mapExtent.oldValue;
						}
						internalConfig.mapThumbPreviousBox = bbox;
						var srs = digimap.projection.toString();
						var size = 120;	&#x2F;&#x2F;tha doume
						var layersNormal=[];
						
						for (var i=0;i&lt;myconfig.layers.length;i++){
								var layer = myconfig.layers[i];
								var props = JSON.parse(layer.oldValue);
								layersNormal.push(props.layerTABLE);
								
						}
						var url = mygis.Utilities.format(&quot;{0}wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers={1}&amp;styles=&amp;bbox={2}&amp;width={3}&amp;height={3}&amp;srs={4}&amp;format={5}&amp;TILED=TRUE&amp;TRANSPARENT=TRUE&quot;,
																						 config.mapserver,layersNormal.join(&#x27;,&#x27;),bbox,size,srs,format
																						 );
						$(&quot;#editMapThumb&quot;).bind(&#x27;load&#x27;,function(){
								$(&quot;#editMapThumb&quot;).unbind(&#x27;load&#x27;);
								var img = document.getElementById(&quot;editMapThumb&quot;);
								var canvas = document.createElement(&#x27;canvas&#x27;);
								canvas.width=img.width;
								canvas.height = img.height;
								var ctx = canvas.getContext(&quot;2d&quot;);
								ctx.drawImage(img,0,0);
								var myconfig = mygis.Admin.MapManager.updateConfig;
								myconfig.mapThumb.changed=true;
								myconfig.mapThumb.newValue=canvas.toDataURL();
								myconfig.mapThumb.oldValue=&quot;fromData&quot;;
								mygis.Admin.MapManager.Maps.mapThumbSelector();
								mygis.Utilities.unblockUI();
								mygis.Admin.MapManager.notifyUnsaved();
						});
						&#x2F;&#x2F;mygis.Utilities.blockUI();
						document.getElementById(&quot;editMapThumb&quot;).src = url;
				},
				
				mapThumbSelector: function(){
						$(&quot;#editMapThumb&quot;).Jcrop({
								onSelect: mygis.Admin.MapManager.Maps.mapThumbSelectorChanged,
								aspectRatio: 1
						},function(){
								internalConfig.mapThumbCropper=this;		
						});
				},
				
				mapThumbSelectorChanged: function(event){
						var minX = event.x;
						var maxX = event.x2;
						var minY = event.y;
						var maxY = event.y2;
						internalConfig.mapThumbCropper.destroy();
						$(&quot;#editMapThumb&quot;).css({
								&quot;display&quot;:&quot;inline-block&quot;,	&#x2F;&#x2F;no, i didn&#x27;t have it as block, thank you
								&quot;visibility&quot;:&quot;visible&quot;	&#x2F;&#x2F;no, i didn&#x27;t set it to hidden, thank you
						});
						
						var previousBox = internalConfig.mapThumbPreviousBox;
						previousBox = previousBox.split(&quot;,&quot;);
						var newCoords = [];
						var pixelUnitX = parseFloat(previousBox[2])-parseFloat(previousBox[0]);
						var pixelUnitY = parseFloat(previousBox[3])-parseFloat(previousBox[1]);
						pixelUnitX = pixelUnitX &#x2F; 120;
						pixelUnitY = pixelUnitY &#x2F; 120;
						var minXnew = parseFloat(previousBox[0])+(pixelUnitX*minX);
						var maxXnew = parseFloat(previousBox[0])+(pixelUnitX*maxX);
						var minYnew = parseFloat(previousBox[1])+(pixelUnitY*(120-maxY));
						var maxYnew = parseFloat(previousBox[1])+(pixelUnitY*(120-minY));
						newCoords.push(minXnew);
						newCoords.push(minYnew);
						newCoords.push(maxXnew);
						newCoords.push(maxYnew);
						mygis.Admin.MapManager.Maps.replaceMapThumbAuto(newCoords.join(&quot;,&quot;));
				},
				
				
				&#x2F;**
				* Handles the input change in map settings
				* @method inputChanged
				* @param {Object} event The triggering event object
				*&#x2F;
				inputChanged: function(event){
						var elem = event.currentTarget;
						var myconfig = mygis.Admin.MapManager.updateConfig;
						var confObj;
						switch (elem.id){
								case &quot;editMapName&quot;:
										confObj=myconfig.mapName;
										break;
								case &quot;editMapDescription&quot;:
										confObj=myconfig.mapDescription;
										break;
								case &quot;editMapExtent&quot;:
										confObj=myconfig.mapExtent;
										break;
								case &quot;editMapCenter&quot;:
										confObj=myconfig.mapCenter;
										break;
								case &quot;editMapZoom&quot;:
										confObj=myconfig.mapZoom;
										break;
								case &quot;editMapDeveloper&quot;:
										confObj=myconfig.mapDeveloped;
										break;
								case &quot;editMapOwner&quot;:
										confObj=myconfig.mapOwner;
										break;
								case &quot;editMapDefaultBG&quot;:
										confObj=myconfig.mapDefaultBG;
										break;
						}
						
						confObj.changed=true;
						if (elem.id==&quot;editMapDefaultBG&quot;){
								confObj.newValue = $(elem).find(&quot;option:selected&quot;)[0].value;
						}else{
								confObj.newValue = elem.value;
						}
						mygis.Admin.MapManager.notifyUnsaved();
				}
				
		},
		
		&#x2F;**
		 * Functions for the layers in the map manager
		 * @class mygis.Admin.MapManager.Layers
		 * @static
		 *&#x2F;
		Layers: {
				
				&#x2F;**
				 * Moves a layer up in the grid
				 * @method moveUp
				 *&#x2F;
				moveUp: function(){
						var grid = $(&quot;#mapLayerList&quot;);
						var records = grid.jqxGrid(&quot;source&quot;).records;
						var selection = grid.jqxGrid(&quot;getselectedrowindexes&quot;);
						var index = selection[0];
						var newIndex = index-1&lt;0?records.length-1:index-1;
						records = mygis.Utilities.arrayMove(records,index,index-1);
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						grid.jqxGrid(&quot;unselectrow&quot;,index);
						grid.jqxGrid(&quot;selectrow&quot;,newIndex);
						mygis.Admin.MapManager.setConfigLayers(records,true);
						mygis.Admin.MapManager.notifyUnsaved();
				},
				
				&#x2F;**
				 * Moves a layer down in the grid
				 * @method moveDown
				 *&#x2F;
				moveDown: function(){
						var grid = $(&quot;#mapLayerList&quot;);
						var records = grid.jqxGrid(&quot;source&quot;).records;
						var selection = grid.jqxGrid(&quot;getselectedrowindexes&quot;);
						var index = selection[0];
						var newIndex = index+1&gt;=records.length-1?0:index+1;
						records = mygis.Utilities.arrayMove(records,index,index+1);
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						grid.jqxGrid(&quot;unselectrow&quot;,index);
						grid.jqxGrid(&quot;selectrow&quot;,newIndex);
						mygis.Admin.MapManager.setConfigLayers(records,true);
						mygis.Admin.MapManager.notifyUnsaved();
				},
				
				&#x2F;**
				 * Deletes a layer from the grid
				 * @method deleteLayer
				 *&#x2F;
				deleteLayer: function(){
						var grid = $(&quot;#mapLayerList&quot;);
						var records = grid.jqxGrid(&quot;source&quot;).records;
						var selection = grid.jqxGrid(&quot;getselectedrowindexes&quot;);
						var atLeastOne = false;
						var grabLayers = [];
						&#x2F;&#x2F;var grabRecords = [];
						var configLayers = mygis.Admin.MapManager.updateConfig.layers;
						for (var i=0;i&lt;configLayers.length;i++){
								if (!(configLayers[i].newValue&amp;&amp;selection.indexOf(i)&gt;-1)){	&#x2F;&#x2F;if NOT (has newValue and is one of the selected indexes) include it.
										grabLayers.push(configLayers[i]);
										&#x2F;&#x2F;grabRecords.push(records[i]);
								}else{
										&#x2F;&#x2F;we took care of it, remove it from the selection
										grid.jqxGrid(&#x27;deleterow&#x27;,selection[selection.indexOf(i)]);
										selection.splice(selection.indexOf(i),1);
								}
						}
						mygis.Admin.MapManager.updateConfig.layers=grabLayers;
						&#x2F;&#x2F;grid.jqxGrid(&quot;source&quot;).records = grabRecords;
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						var records = grid.jqxGrid(&quot;source&quot;).records;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								var confItem = mygis.Admin.MapManager.updateConfig.layers[selection[i]];
								
								var grabCopy = $.extend({},item);
								grabCopy.layerID=-1;
								confItem.newValue = JSON.stringify(grabCopy);
								confItem.changed=true;
								atLeastOne=true;
								grid.jqxGrid(&#x27;deleterow&#x27;,selection[i]);&#x2F;&#x2F;records.splice(selection[i],1);
								
						}
						if (atLeastOne){
								mygis.Admin.MapManager.notifyUnsaved();
								grid.jqxGrid(&#x27;clearselection&#x27;);
								grid.jqxGrid(&#x27;refreshdata&#x27;);
								mygis.Admin.MapManager.Layers.layerUnselected();
						}
						
						mygis.Admin.MapManager.Layers.layerUnselected();
				},
				
				&#x2F;**
				 * Adds a layer to the current editing map
				 * @method addMapLayer
				 *&#x2F;
				addMapLayer: function(){
						var windowTitle;
						var myconfig = mygis.Admin.UI.dialogConfig;
						myconfig.checkfn = mygis.Admin.MapManager.Layers.addLayerCheck;
						myconfig.callbackfn = mygis.Admin.MapManager.Layers.addLayerResult;
						myconfig.objectCount=1;
						myconfig.windowTitle = &quot;#layerManager&quot;;
						var records = $(&quot;#mapLayerList&quot;).jqxGrid(&#x27;source&#x27;).records;
						var filterList = &quot;&quot;;
						
						for (var i=0;i&lt;records.length;i++){
								if (i&gt;0){
										filterList +=&quot;%23&quot;;
								}
								filterList += records[i].id;
						}
						showLayerManager(filterList);
				},
				
				&#x2F;**
				 * Used to display the layer manager window
				 * @method showAddLayer
				 *&#x2F;
				showAddLayer: function(secondRun){
						
						if (!secondRun){
								$(&quot;#layerManager&quot;).dialog({
										autoOpen: false,
										modal: true,
										resizable: false,
										width: 900,
										height: 510, 
										title: strings.MapManager.window_LayerManager,
										closeOnEscape: false
								});
						}
						mygis.Admin.MapManager.Layers.createPotentialLayerGrid();
						$(&quot;#layerManager&quot;).dialog(&#x27;open&#x27;);
						if (mygis.Admin.UI.dialogConfig.callbackfn==null){
								$(&quot;#layerManagerDialogButtons&quot;).hide();
						}else{
								$(&quot;#layerManagerDialogButtons&quot;).show();
						}
						var titleBar = $(&quot;#ui-dialog-title-layerManager&quot;).parent();
						titleBar.css({
							&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;administration&#x2F;menu&#x2F;icon-16-banner.png&#x27;) #F6A828 no-repeat 12px 2px&quot;,
							&quot;background-size&quot;:&quot;auto 25px&quot;
						});
				},
				
				&#x2F;**
				 * Used to check the &quot;OK&quot; button in the layer manager dialog
				 * @method addLayerCheck
				 *&#x2F;
				addLayerCheck: function(){
						var retvalue=false;
						var grid = $(&quot;#layerManagerList&quot;);
						var myconfig = mygis.Admin.UI.dialogConfig;
						var selections = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var selectedCount = selections.length;
						var expectedCount = myconfig.objectCount;
						if (selectedCount&gt;=expectedCount &amp;&amp; expectedCount&gt;-1){
								var retobject;
								retobject = [];
								for (var i=0;i&lt;selections.length;i++){
										retobject.push(grid.jqxGrid(&#x27;getrowdata&#x27;,selections[i]));	
								}
								myconfig.object=  retobject;
							retvalue=true;
						}else{
								alert(mygis.Utilities.format(strings.LayerControl.err_notEnoughSelected,expectedCount));
						}
						return retvalue;
				},
				
				&#x2F;**
				 * Callback function after the layer manager window returns
				 * @method addLayerResult
				 *&#x2F;
				addLayerResult: function(result){
						if (result==&quot;ok&quot;){
								var layersToAdd = [];
								var grid = $(&quot;#mapLayerList&quot;);
								var gridSource = grid.jqxGrid(&#x27;source&#x27;).records;
								var myconfig = mygis.Admin.MapManager.updateConfig;
								for (var i=0;i&lt;this.length;i++){
										var r = this[i];
										var item = {
												layerSelected: false,
												layerID: r.layerID,
												layerNAME: r.layerNAME,
												layerDESCRIPTION: r.layerDESCRIPTION,
												layerTABLE: r.layerTABLE,
												hidden: r.hidden,
												Editable: r.Editable,
												Selectable: r.Selectable,
												Locked: r.Locked,
												layerMinScale: r.layerMinScale,
												layerMaxScale: r.layerMaxScale,
												layerGeomType: r.layerGeomType,
												layerEXTENTS: &quot;&quot;,
												manualVisibility: false,
												layerORDER: &quot;&quot;,
												folderName: r.folderName
										};
										grid.jqxGrid(&#x27;addrow&#x27;,null,item);
										var confItem = {
												changed: true,
												oldValue: null,
												newValue: JSON.stringify(item)
										};
										myconfig.layers.push(confItem);
								}
								mygis.Admin.MapManager.notifyUnsaved();
								grid.jqxGrid(&quot;refreshdata&quot;);
						}
				},
				
				&#x2F;**
				 *	Creates the layer manager grid
				 *	@method createPotentialLayerGrid
				 *&#x2F;
				createPotentialLayerGrid: function(){
						var layerSource = mygis.Admin.MapManager.Layers.createPotentialLayerGridSource();
						var layerContainer = $(&quot;#layerManagerList&quot;);
						var columnrenderer = function(value){
								var retobject;
								var action = &quot;&quot;;	&#x2F;&#x2F;&#x27;router(&quot;adminAllClick&quot;,this);&#x27;;
								&#x2F;&#x2F;var grid = $(&quot;#myAppGrid&quot;);
								&#x2F;&#x2F;var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var checked = &quot;&quot;; &#x2F;&#x2F;var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;&#x27;&gt;&lt;input id=&#x27;adminSelectAllApps&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,action,checked);
								return retobject;
								
						};
						var cellrenderer = function(row,datafield,value){
								var retobject;
								var rowdata = this.owner.getrowdata(row);
								switch (datafield){
										case &quot;layerNAME&quot;:
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,action);
												break;
										case &quot;layerTABLE&quot;:
												var style = &quot;width: 96%; margin: 6px 5px; float: left;&quot;;
												var actualApp = value.split(&quot;_&quot;)[0];
												retobject = mygis.Utilities.format(&quot;&lt;span style=&#x27;{0}&#x27;&gt;{1}&lt;&#x2F;span&gt;&quot;,style,actualApp);
												break;
										case &quot;layerGeomType&quot;:
												var action = &quot;return false;&quot;;
												var title = &quot;&quot;;
												switch (value){
														case &quot;Point&quot;:
																var c1 = strings.LayerControl.layergrid_colPoints;
																var d1 = rowdata.layerPoints;
																title=mygis.Utilities.format(&quot;{0}: {1}&quot;,c1,d1);
																break;
														case &quot;Line&quot;:
																var c1 = strings.LayerControl.layergrid_colLines;
																var d1 = rowdata.layerLines;
																title=mygis.Utilities.format(&quot;{0}: {1}&quot;,c1,d1);
																break;
														case &quot;Polygon&quot;:
																var c1 = strings.LayerControl.layergrid_colPolygons;
																var d1 = rowdata.layerPolygons;
																title=mygis.Utilities.format(&quot;{0}: {1}&quot;,c1,d1);
																break;
														case &quot;Mixed&quot;:
																var c1 = strings.LayerControl.layergrid_colPoints;
																var c2 = strings.LayerControl.layergrid_colLines;
																var c3 = strings.LayerControl.layergrid_colPolygons;
																var d1 = rowdata.layerPoints;
																var d2 = rowdata.layerLines;
																var d3 = rowdata.layerPolygons;
																title=mygis.Utilities.format(&quot;{0}: {1}, {2}: {3}, {4}: {5}&quot;,c1,d1,c2,d2,c3,d3);
																break;
												}
												retobject = mygis.Utilities.format(&quot;&lt;span title=&#x27;{2}&#x27; style=&#x27;width: 96%; margin:6px 5px; float: left;&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{1}&#x27; title=&#x27;{2}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;&quot;,value,action,title);
												break;
								}
								return retobject;
						};
						var locObject = {
								groupsheaderstring: strings.Grid.groupsheaderstring,
								sortascendingstring: strings.Grid.sortascendingstring,
								sortdescendingstring: strings.Grid.sortdescendingstring,
								sortremovestring: strings.Grid.sortremovestring,
								groupbystring: strings.Grid.groupbystring,
								groupremovestring: strings.Grid.groupremovestring
						};
						layerContainer.jqxGrid({
								source: layerSource,
								width: 880,
								height: 414,
								autoheight: false,
								theme: &#x27;pk-mg-jm&#x27;,
								altrows: true,
								enabletooltips: true,
								columns: [
										{text: &#x27;asdf&#x27;, datafield: &#x27;layerSelected&#x27;,width: 45, renderer: columnrenderer,columntype: &#x27;checkbox&#x27;},
										{text: strings.LayerControl.layergrid_colName,datafield: &#x27;layerNAME&#x27;, editable: false},
										{text: strings.LayerControl.layergrid_colTableApp, datafield: &#x27;layerAppOrigin&#x27;, editable: false, width: 140},
										{text: strings.LayerControl.layergrid_colTable,datafield: &#x27;layerTABLE&#x27;, editable: false,width: 200},
										{text: strings.LayerControl.layergrid_colGeom,datafield: &#x27;layerGeomType&#x27;, editable: false,width: 200, cellsrenderer: cellrenderer}
								],
								enableanimations: false,
								showheader: true,
								columnsmenu: false,
								editable: true,
								groupable: true,
								showgroupsheader: true,
								selectionmode: &#x27;none&#x27;
						});
						layerContainer.jqxGrid(&#x27;localizestrings&#x27;, locObject);
						layerContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.MapManager.Layers.potentialLayer_checkClicked);
				},
				
				&#x2F;**
				 *	Creates the grid source for the layer manager
				 *	@method createPotentialLayerGridSource
				 *&#x2F;
				createPotentialLayerGridSource: function(){
						var retvalue;
						var url = config.mgreq+&quot;?qtype=GetPotentialLayers&quot;;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
										{name: &quot;layerSelected&quot;,type: &quot;boolean&quot;},
										{name: &quot;layerID&quot;},
										{name: &quot;layerNAME&quot;},
										{name: &quot;layerDESCRIPTION&quot;},
										{name: &quot;layerTABLE&quot;},
										{name: &quot;layerAppOrigin&quot;},
										{name: &quot;hidden&quot;},
										{name: &quot;Editable&quot;},
										{name: &quot;Selectable&quot;},
										{name: &quot;Locked&quot;},
										{name: &quot;layerMinScale&quot;},
										{name: &quot;layerMaxScale&quot;},
										{name: &quot;layerGeomType&quot;},
										{name: &quot;layerPoints&quot;},
										{name: &quot;layerLines&quot;},
										{name: &quot;layerPolygons&quot;}
								],
								id: &#x27;adminPotentialLayerList&#x27;,
								url: url
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						retvalue.dataBind();
						return retvalue;
				},
				
				&#x2F;**
				 *	Used when a layer checkbox is clicked in the layer manager
				 *	@method potentialLayer_checkClicked
				 *&#x2F;
				potentialLayer_checkClicked: function(elem){
						var grid = $(&quot;#layerManagerList&quot;);
						if (elem.args.value) {
								grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
								grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
				
				&#x2F;**
				 *	Used when the &#x27;check all&#x27; button is clicked in the layer manager
				 *	@method potentialLayer_checkClicked
				 *&#x2F;
				potentialLayer_allCheckClicked: function(elem){
						var grid = $(&quot;#layerManagerList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].layerSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].layerSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
			
				
				&#x2F;**
				 * Used to create the layer grid in the layers tab of the map Manager
				 * @method createLayerGrid
				 * @param {Integer} mapID The map to query
				**&#x2F;
				createLayerGrid: function(mapID){
						mygis.Utilities.blockUI();
						var layerSource = mygis.Admin.MapManager.Layers.createLayerGridSource(mapID);
						var container = $(&quot;#mapLayerList&quot;);
						var columnrenderer = function(value){
								var action = &#x27;router(&quot;mapLayerAllClick&quot;,this);&#x27;;
								var grid = $(&quot;#mapLayerList&quot;);
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;text-align: center; margin-top: 5px;position: absolute;left: 8px;z-index: 1;&#x27;&gt;&lt;input id=&#x27;map_selectAllLayers&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,action,checked);
								return retobject;
						};
						
						if (layerSource.records.length&gt;0){
								container.jqxGrid({
										source: layerSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;, datafield:&#x27;layerSelected&#x27;,width: 22,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.LayerControl.layergrid_colName, datafield:&#x27;layerNAME&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colDescription, datafield:&#x27;layerDESCRIPTION&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colTable, datafield:&#x27;layerTABLE&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colFolder, datafield:&#x27;folderName&#x27;,editable: true},
												{text: strings.LayerControl.layergrid_colGeom, datafield:&#x27;layerGeomType&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								container.jqxGrid({
										source: layerSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;, datafield:&#x27;layerSelected&#x27;,width: 22,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.LayerControl.layergrid_colName, datafield:&#x27;layerNAME&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colDescription, datafield:&#x27;layerDESCRIPTION&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colTable, datafield:&#x27;layerTABLE&#x27;,editable:false},
												{text: strings.LayerControl.layergrid_colFolder, datafield:&#x27;folderName&#x27;,editable: true},
												{text: strings.LayerControl.layergrid_colGeom, datafield:&#x27;layerGeomType&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});		
						}
						container.bind(&quot;rowselect&quot;,mygis.Admin.MapManager.Layers.layerSelected);
						container.bind(&quot;rowunselect&quot;,mygis.Admin.MapManager.Layers.layerUnselected);
						container.bind(&quot;cellendedit&quot;,mygis.Admin.MapManager.Layers.layerCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Creates the source for the map&#x27;s layers
				 * @method createLayerGridSource
				 * @param {Integer} mapID the map to query
				 *&#x2F;
				createLayerGridSource: function(mapID){
						var retvalue;
						var url = config.mgreq+&quot;?qtype=GetLayerList&amp;qContents=&quot;+mapID;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
										{name : &quot;layerSelected&quot;, type: &quot;boolean&quot;},
										{ name: &quot;layerID&quot; },
										{ name: &quot;layerNAME&quot; },
										{ name: &quot;layerDESCRIPTION&quot; },
										{ name: &quot;layerTABLE&quot; },
										{ name: &quot;layerORDER&quot; },
										{ name: &quot;layerEXTENTS&quot;}, 
										{ name: &quot;hidden&quot;},
										{ name: &quot;Editable&quot;},
										{ name: &quot;Selectable&quot;},
										{ name: &quot;Locked&quot;},
										{ name: &quot;layerMinScale&quot; },
										{ name: &quot;layerMaxScale&quot; },
										{ name: &quot;manualVisibility&quot; },
										{ name: &quot;layerGeomType&quot; }, 
										{ name: &quot;folderName&quot; }
								],
								id: &#x27;adminLayerList&#x27;,
								url: url
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						retvalue.dataBind();
						mygis.Admin.MapManager.setConfigLayers(retvalue.records);
						return retvalue;
				},
				
				&#x2F;**
				 * Handles the selection or rows in the layer grid
				 * @method layerSelected
				 *&#x2F;
				layerSelected: function(){
						var grid = $(&quot;#mapLayerList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_layerUpBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerUpBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_layerDownBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerDownBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								document.getElementById(&quot;map_layerUpBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_layerDownBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;map_selectAllLayers&quot;).checked=true;
						}else{
								document.getElementById(&quot;map_selectAllLayers&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Handles the unselection or rows in the layer grid
				 * @method layerUnselected
				 *&#x2F;
				layerUnselected: function(){
						var grid = $(&quot;#mapLayerList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_layerUpBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerUpBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_layerDownBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerDownBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else if(selection.length==1){
								document.getElementById(&quot;map_layerUpBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_layerDownBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								if (!document.getElementById(&quot;map_layerUpBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerUpBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_layerDownBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerDownBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_layerDeleteBtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;map_selectAllLayers&quot;).checked=true;
						}else{
								document.getElementById(&quot;map_selectAllLayers&quot;).checked=false;
						}
				},
				
				&#x2F;**
				* Handles the clicking of the checkbox in each row at the layer grid
				* @method layerCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
				layerCheckClicked: function(elem){
						var grid = $(&quot;#mapLayerList&quot;);
						switch (elem.args.datafield){
							case &quot;folderName&quot;:
								var grid = $(&quot;#mapLayerList&quot;);
								var oldData = grid.jqxGrid(&#x27;getrowdata&#x27;, elem.args.rowindex);
								oldData.folderName=elem.args.value;
								grid.jqxGrid(&#x27;updaterow&#x27;,grid.jqxGrid(&#x27;getrowid&#x27;, elem.args.rowindex),oldData);
								var records = grid.jqxGrid(&quot;source&quot;).records;
								mygis.Admin.MapManager.setConfigLayers(records,true);
								mygis.Admin.MapManager.notifyUnsaved();
								break;
							case &quot;layerSelected&quot;:
								if (elem.args.value) {
										grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
								}
								else {
										grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
								}
								break;
						}
						
				},
				
				&#x2F;**
				 * Handles the check all button in the layer grid
				 * @method layerAllCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				layerAllCheckClicked: function(elem){
						var grid = $(&quot;#mapLayerList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].layerSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].layerSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				}
				
		},
		
		&#x2F;**
		 * Functions for the permissions in the map manager
		 * @class mygis.Admin.MapManager.Permissions
		 * @static
		 *&#x2F;
		Permissions: {
				
		},
		
		&#x2F;**
		 * Functions for the macros in the map manager
		 * @class mygis.Admin.MapManager.Macros
		 * @static
		 *&#x2F;
		Macros: {
				&#x2F;**
				 * Pops up a dialog to edit a map Macro
				 * @method showEditMacro
				 * @param {Boolean} isNew True if this is a completely new macro
				 *&#x2F;
				showEditMacro: function(isNew){
						var windowTitle;
						var myconfig = mygis.Admin.UI.dialogConfig;
						if (isNew){
								$(&quot;#editMacroActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;newMacro&#x27;);
								windowTitle = strings.MapManager.window_NewMacro;	
						}else{
								$(&quot;#editMacroActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;editMacro&#x27;);
								windowTitle = strings.MapManager.window_EditMacro;	
						}
						$(&quot;#editMacroTitleElem&quot;).html(windowTitle);
						myconfig.checkfn = mygis.Admin.MapManager.Macros.editMacroCheck; 
						myconfig.callbackfn = mygis.Admin.MapManager.Macros.editMacroResult; 
						myconfig.objectCount = -1;
						myconfig.windowTitle = &quot;#editMacroPop&quot;;
						var item;
						if (!isNew){
								var grid = $(&quot;#mapMacroList&quot;);
								var records = grid.jqxGrid(&#x27;source&#x27;).records;
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								item = records[selection[0]];
								
								myconfig.objectCount = item.id;
								
						}
						$(&quot;#editMacroPop&quot;).dialog({
								autoOpen: true,
								modal: true,
								resizable: false,
								width: 900,
								height: 510, 
								title: strings.MapManager.window_MacroManager,
								closeOnEscape: false
						});
						var titleBar = $(&quot;#ui-dialog-title-editMacroPop&quot;).parent();
						titleBar.css({
							&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;Administration&#x2F;header&#x2F;icon-48-cpanel.png&#x27;) #F6A828 no-repeat 14px 5px&quot;,
							&quot;background-size&quot;:&quot;auto 18px&quot;
							});
						mygis.Admin.MapManager.Macros.setupMacroWindow(item);
				},
				
				&#x2F;**
				 * Sets up the UI (tips, default values etc)
				 * @method setupMacroWindow
				 * @param {Object} item
				 *&#x2F;
				setupMacroWindow: function(item){
						singleQTip(&quot;tip_MacroName&quot;,[strings.MapManager.macroTip_name]);
						singleQTip(&quot;tip_MacroSelector&quot;,[strings.MapManager.macroTip_jselector]);
						singleQTip(&quot;tip_MacroButton&quot;,[strings.MapManager.macroTip_button]);
						singleQTip(&quot;tip_MacroRegistered&quot;,[strings.MapManager.macroTip_registered]);
						singleQTip(&quot;tip_MacroApp&quot;,[strings.MapManager.macroTip_app]);
						if (item){
								$(&quot;#appSetting_MacroName&quot;).val(item.name);
								$(&quot;#appSetting_parentSelector&quot;).val(item.parentSelector);
								$(&quot;#appSetting_IsButton&quot;).attr(&quot;checked&quot;,item.isButton);
								$(&quot;#appSetting_IsForRegistered&quot;).attr(&quot;checked&quot;,item.isForRegistered);
								$(&quot;#macroCommandsEditor&quot;).val(item.commands.replace(&#x2F;\%&#x2F;g,&#x27;,&#x27;).replace(&#x2F;\#&#x2F;g,&#x27;\r\n&#x27;));
								$(&quot;#macroContainerStyle&quot;).val(item.cont_css.replace(&#x2F;\;&#x2F;g,&#x27;;\r\n&#x27;));
								$(&quot;#macroBtnStyle&quot;).val(item.btn_css.replace(&#x2F;\;&#x2F;g,&#x27;;\r\n&#x27;));
						}else{
								$(&quot;#appSetting_MacroName&quot;).val(&quot;&quot;);
								$(&quot;#appSetting_parentSelector&quot;).val(&quot;&quot;);
								$(&quot;#appSetting_IsButton&quot;).attr(&quot;checked&quot;,true);
								$(&quot;#appSetting_IsForRegistered&quot;).attr(&quot;checked&quot;,false);
								$(&quot;#macroCommandsEditor&quot;).val(&quot;&quot;);
								$(&quot;#macroContainerStyle&quot;).val(&quot;&quot;);
								$(&quot;#macroBtnStyle&quot;).val(&quot;&quot;);
						}
						var apps=[];
						var counter = 0;
						var finalCounter = -1;
						$.each($(&quot;#myAppGrid&quot;).jqxGrid(&#x27;source&#x27;).records,function(i,v){
								var newitem={
										name: v.appName,
										value: v.appID
								};
								
								if (item){
										if (item.appID==v.appID){
												finalCounter = counter;
										}
								}
								counter++;
								apps.push(newitem);
						});
						mygis.Utilities.populateSelect(document.getElementById(&quot;appsetting_chooseMacroApp&quot;),apps,true);
						if (item &amp;&amp; finalCounter&gt;-1){
								$(&quot;#appsetting_chooseMacroApp option&quot;).eq(finalCounter).attr(&quot;selected&quot;,&quot;selected&quot;);
						}
				},
				
				&#x2F;**
				 *	Checking the validity of the input in the edit macro dialog
				 *	@method editMacroCheck
				 *&#x2F;
				editMacroCheck: function(){
						var retvalue = false;
						var grid = $(&quot;#mapMacroList&quot;);
						var myconfig = mygis.Admin.UI.dialogConfig;
						var retobject;
						retobject = [];
						
						var item = {
								macroSelected: false,
								macroID: -1,
								mapID: mygis.Admin.MapManager.updateConfig.mapID,
								appID: $(&quot;#appsetting_chooseMacroApp&quot;).val(),	
								name: $(&quot;#appSetting_MacroName&quot;).val(),
								commands: $(&quot;#macroCommandsEditor&quot;).val().replace(&#x2F;\r\n&#x2F;g,&#x27;#&#x27;).replace(&#x2F;\,&#x2F;g,&#x27;%&#x27;),
								parentSelector: $(&quot;#appSetting_parentSelector&quot;).val(),
								cont_css: $(&quot;#macroContainerStyle&quot;).val().replace(&#x2F;\r\n&#x2F;g,&#x27;&#x27;),
								btn_css: $(&quot;#macroBtnStyle&quot;).val().replace(&#x2F;\r\n&#x2F;g,&#x27;&#x27;),
								options: null,
								isButton: $(&quot;#appSetting_IsButton&quot;).is(&#x27;:checked&#x27;),
								isForRegistered: $(&quot;#appSetting_IsForRegistered&quot;).is(&#x27;:checked&#x27;)
						};
						retobject.push(item);
						myconfig.object=retobject;
						retvalue = true;
						return retvalue;
				},
				
				&#x2F;**
				 * Handling the result of the edit macro dialog if it&#x27;s a new item
				 * @method editMacroResult
				 * @param {String} result Whether it was successful (&quot;ok&quot;) or not
				 *&#x2F;
				editMacroResult: function(result){
						if (result==&quot;ok&quot;){
								var grid = $(&quot;#mapMacroList&quot;);
								var gridSource = grid.jqxGrid(&#x27;source&#x27;).records;
								var myconfig = mygis.Admin.MapManager.updateConfig;
								for (var i=0;i&lt;this.length;i++){
										var item = this[i];
										grid.jqxGrid(&#x27;addrow&#x27;,null,item);
										var confItem = {
												changed: true,
												oldvalue: null,
												newValue: JSON.stringify(item)
										};
										myconfig.macros.push(confItem)
								}
								mygis.Admin.MapManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Deletes the selected grid rows and notifies for save
				 * @method deleteMacros
				 *&#x2F;
				deleteMacros: function(){
						var grid = $(&quot;#mapMacroList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var atLeastOne = false;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								var confItem = mygis.Admin.MapManager.updateConfig.macros[selection[i]];
								if (confItem.newValue){	&#x2F;&#x2F;it&#x27;s simply a newly created item, so remove it from the array
										records.splice(selection[i],1);
										mygis.Admin.MapManager.updateConfig.macros.splice(selection[i],1);
								}else{
										var grabCopy = $.extend({},item);
										grabCopy.id=-1;
										confItem.newValue = JSON.stringify(grabCopy);
										confItem.changed=true;
										atLeastOne=true;
										records.splice(selection[i],1);
								}
						}
						if (atLeastOne){
								mygis.Admin.MapManager.notifyUnsaved();
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Switches the active tab to the given index
				 * @method switchToTab
				 *&#x2F;
				switchToTab: function(index){
						var tabHeaders = $(&quot;#editMacroLinkTabsRound&quot;).find(&quot;.sectionHeader&quot;);
						for (var i=0;i&lt;tabHeaders.length;i++){
								if (i!=index){
										tabHeaders[i].ex_RemoveClassName(&quot;active&quot;);
								}else{
										tabHeaders[i].ex_AddClassName(&quot;active&quot;);
								}
						}
						var tabs = $(&quot;#editMacroTab&quot;).find(&quot;.appSettingFrame&quot;);
						for (var i=0;i&lt;tabs.length;i++){
								if (i!=index){
										$(tabs[i]).hide();
								}else{
										$(tabs[i]).show();
										
								}
						}
				},
				
				&#x2F;**
				 *	Used to create the macro grid in the macro tab of the map manager
				 *	@method createMacroGrid
				 *	@param {Integer} mapID the map to query
				 *&#x2F;
				createMacroGrid: function(mapID){
						mygis.Utilities.blockUI();
						var macroSource = mygis.Admin.MapManager.Macros.createMacroGridSource(mapID);
						var container = $(&quot;#mapMacroList&quot;);
						container.bind(&quot;bindingcomplete&quot;,function(event){
								mygis.Admin.MapManager.setConfigMacros($(&quot;#mapMacroList&quot;).jqxGrid(&#x27;source&#x27;).records);
						});
						var columnrenderer = function(value){
								var retobject;
								var grid=$(&quot;#mapMacroList&quot;);
								var action = &#x27;router(&quot;adminMacroAllClick&quot;,this);&#x27;;
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								var customStyle=&quot;text-align: center; margin-top: 5px;position: absolute;left: 18px;z-index: 1;&quot;;
								
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;{2}&#x27;&gt;&lt;input id=&#x27;adminSelectAllMacros&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,
																									 action,checked,customStyle);
								return retobject;
						}
						var cellrenderer = function(row,datafield,value){
								var retobject;
								switch (datafield){
										
										case &quot;isButton&quot;:
										case &quot;isForRegistered&quot;:
												var checked = value?&quot; checked&quot;:&quot;&quot;;
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 25px;line-height:25px;&#x27;&gt;&lt;a href=&#x27;#&#x27; class=&#x27;btnTickCheck{0}&#x27;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,checked);
												break;
								}
								return retobject;
						}
						if (macroSource.records.length&gt;0){
								container.jqxGrid({
										source: macroSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns:[
												{text:&#x27;sel&#x27;,datafield: &#x27;macroSelected&#x27;, width: 45, columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapManager.macroGrid_colID, datafield: &#x27;macroID&#x27;,editable: false},
												{text: strings.MapManager.macroGrid_colName, datafield: &#x27;name&#x27;, editable: false},
												{text: strings.MapManager.macroGrid_colApp, datafield: &#x27;appID&#x27;, editable: false},
												{text: strings.MapManager.macroGrid_colBtn, datafield: &#x27;isButton&#x27;, editable: false,cellsrenderer: cellrenderer},
												{text: strings.MapManager.macroGrid_colRegister, datafield: &#x27;isForRegistered&#x27;, editable: false,cellsrenderer: cellrenderer}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								container.jqxGrid({
										source: macroSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text:&#x27;sel&#x27;,datafield: &#x27;macroSelected&#x27;, width: 45, columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapManager.macroGrid_colID, datafield: &#x27;macroID&#x27;,editable: false},
												{text: strings.MapManager.macroGrid_colName, datafield: &#x27;name&#x27;, editable: false},
												{text: strings.MapManager.macroGrid_colApp, datafield: &#x27;appID&#x27;, editable: false},
												{text: strings.MapManager.macroGrid_colBtn, datafield: &#x27;isButton&#x27;, editable: false,cellsrenderer: cellrenderer},
												{text: strings.MapManager.macroGrid_colRegister, datafield: &#x27;isForRegistered&#x27;, editable: false,cellsrenderer: cellrenderer}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}
						container.bind(&quot;rowselect&quot;,mygis.Admin.MapManager.Macros.macroSelected);
						container.bind(&quot;rowunselect&quot;,mygis.Admin.MapManager.Macros.macroUnselected);
						container.bind(&quot;cellendedit&quot;,mygis.Admin.MapManager.Macros.singleCheckClick);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Used to create the macro grid&#x27;s source
				 * @method createMacroGridSource
				 * @param {Integer} mapID the map to query
				 *&#x2F;
				createMacroGridSource: function(mapID){
						var retvalue;
						var myurl = config.folderPath+&quot;mgreq.ashx?qtype=GetMapMacros&amp;qContents=&quot;+mapID;
						var source =
						{
								datatype: &quot;json&quot;,
								datafields: [
										{ name: &quot;macroSelected&quot;},
										{ name: &quot;macroID&quot; },
										{ name: &quot;mapID&quot;}, 
										{ name: &quot;appID&quot; },
										{ name: &quot;name&quot; },
										{ name: &quot;commands&quot; },
										{ name: &quot;parentSelector&quot;},
										{ name: &quot;cont_css&quot;},
										{ name: &quot;btn_css&quot;},
										{ name: &quot;options&quot; },
										{ name: &quot;isButton&quot;, type: &quot;boolean&quot;},
										{ name: &quot;isForRegistered&quot;, type: &quot;boolean&quot;}
								],
								id: &#x27;macroEditSource&#x27;,
								url: myurl
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						return retvalue;
				},
				
				&#x2F;**
				 * Refreshes the quick search grid
				 * @method refreshMacroGrid
				 *&#x2F;
				refreshMacroGrid: function(){
						$(&quot;#mapMacroList&quot;).jqxGrid(&#x27;updatebounddata&#x27;);
				},
				
				&#x2F;**
				 *	Activates&#x2F;deactivates some buttons when a macro is selected
				 *	@method macroSelected
				 **&#x2F;
				macroSelected: function(){
						var grid = $(&quot;#mapMacroList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_editMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editMacrobtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
						}else{
								if (document.getElementById(&quot;map_editMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllMacros&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllMacros&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 *	Activates&#x2F;deactivates some buttons when a macro is unselected
				 *	@method macroUnselected
				 **&#x2F;
				macroUnselected: function(){
						var grid = $(&quot;#mapMacroList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_editMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editMacrobtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
						}else if (selection.length==1){
								if (document.getElementById(&quot;map_editMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
								if (document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								}
						}else{
								if (!document.getElementById(&quot;map_editMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editMacrobtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteMacrobtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;adminSelectAllMacros&quot;).checked=true;
						}else{
								document.getElementById(&quot;adminSelectAllMacros&quot;).checked=false;
						}
				},
				
				&#x2F;**
				* Handles the clicking of the checkbox in each row at the macro grid
				* @method singleCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
				singleCheckClick: function(elem){
						var grid = $(&quot;#mapMacroList&quot;);
						if (elem.args.value) {
								grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
								grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
				
				&#x2F;**
				 * Handles the check all button in the macro grid
				 * @method allCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				allCheckClicked: function(elem){
						var grid = $(&quot;#mapMacroList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].macroSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].macroSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				},
				
				&#x2F;**
				 * Displays a wizard that helps build the command for mygis.UI.Help.createPopup
				 * @method showPopupWizard
				 *&#x2F;
				showPopupWizard: function(){
						$(&quot;#popupWiz&quot;).dialog({
								autoOpen: true,
								modal: false,
								resizable: false,
								width: 600,
								height: 510,
								title: strings.MapManager.macroPopup_window,
								closeOnEscape: false,
								draggable: true,
								position: &quot;center&quot;
						});
						$(&quot;#popupWiz_id&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_header&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_width&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_height&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_position&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_dispHeader&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_dispClose&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_isMovable&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
						$(&quot;#popupWiz_textArea&quot;).bind(&#x27;propertychange keyup input paste&#x27;,mygis.Admin.MapManager.Macros.updatePopupWizardOutput);
				},
				
				&#x2F;*
				 * Gathers the data entered in the popup Wizard dialog and updates the output
				 * @method updatePopupWizardOutput
				 *&#x2F;
				updatePopupWizardOutput: function(){
						var id = $(&quot;#popupWiz_id&quot;).val();
						var title = $(&quot;#popupWiz_header&quot;).val();
						var width = $(&quot;#popupWiz_width&quot;).val();
						var height = $(&quot;#popupWiz_height&quot;).val();
						var position = $(&quot;#popupWiz_position&quot;).val();
						var showTitle = $(&quot;#popupWiz_dispHeader&quot;).is(&quot;:checked&quot;);
						var showClose = $(&quot;#popupWiz_dispClose&quot;).is(&quot;:checked&quot;);
						var isMovable = $(&quot;#popupWiz_isMovable&quot;).is(&quot;:checked&quot;);
						var myhtml = $(&quot;#popupWiz_textArea&quot;).val();
						var output = mygis.Utilities.format(&quot;mygis.UI.Help.createPopup(&#x27;{0}&#x27;,&#x27;{1}&#x27;,&#x27;{2}&#x27;,{3},{4},{5},&#x27;{6}&#x27;,[{7},{8}]);&quot;,
																								id,myhtml,title,showTitle,showClose,isMovable,position,width,height
																								);
						$(&quot;#popupWiz_output&quot;).val(output);
				},
				
				copyPopupOutput: function(){
						var id = $(&quot;#popupWiz_id&quot;).val();
						var title = $(&quot;#popupWiz_header&quot;).val();
						var width = $(&quot;#popupWiz_width&quot;).val();
						var height = $(&quot;#popupWiz_height&quot;).val();
						var position = $(&quot;#popupWiz_position&quot;).val();
						var showTitle = $(&quot;#popupWiz_dispHeader&quot;).is(&quot;:checked&quot;);
						var showClose = $(&quot;#popupWiz_dispClose&quot;).is(&quot;:checked&quot;);
						var isMovable = $(&quot;#popupWiz_isMovable&quot;).is(&quot;:checked&quot;);
						var myhtml = $(&quot;#popupWiz_textArea&quot;).val();
						
						var params = mygis.Utilities.format(&quot;&#x27;{0}&#x27;,&#x27;{1}&#x27;,&#x27;{2}&#x27;,{3},{4},{5},&#x27;{6}&#x27;,[{7},{8}]&quot;,
																								id,myhtml,title,showTitle,showClose,isMovable,position,width,height
																								);
						$(&quot;#macroCommandsEditor&quot;).val($(&quot;#macroCommandsEditor&quot;).val()+&quot;\r\n&quot;+&quot;mygis.UI.Help.createPopup,&quot;+params);
						$(&quot;#popupWiz&quot;).dialog(&#x27;close&#x27;);
				},
				
				testPopupOutput: function(){
						var output = $(&quot;#popupWiz_output&quot;).val();
						try{
								var fn = new Function(output);
								fn();
						}catch(err){alert(&quot;Error in syntax. Have you filled in all the fields?&quot;);}
				}
		},
		
		&#x2F;**
		 * Functions for the quick searches in the map manager
		 * @class mygis.Admin.MapManager.QuickSearches
		 * @static
		 *&#x2F;
		QuickSearches: {
				&#x2F;**
				 * Pops up a dialog to edit a map Quick Search
				 * @method showEditQS
				 * @param {Boolean} isNew True if this is a completely new QS
				 *&#x2F;
				showEditQS: function(isNew){
						var windowTitle;
						var myconfig = mygis.Admin.UI.dialogConfig;
						if (isNew){
								$(&quot;#editQSActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;newQS&#x27;);
								windowTitle = strings.MapManager.window_NewQS;
						}else{
								$(&quot;#editQSActionsTitle&quot;).attr(&#x27;class&#x27;,&#x27;editQS&#x27;);
								windowTitle = strings.MapManager.window_EditQS;
						}
						$(&quot;#editQSTitleELem&quot;).html(windowTitle);
						myconfig.checkfn = mygis.Admin.MapManager.QuickSearches.editQSCheck;
						myconfig.callbackfn = mygis.Admin.MapManager.QuickSearches.editQSResult;
						myconfig.objectCount = -1;
						myconfig.windowTitle = &quot;#editQSPop&quot;;
						if (!isNew){
								var grid = $(&quot;#mapHotSearchList&quot;);
								var records = grid.jqxGrid(&#x27;source&#x27;).records;
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var item = records[selection[0]];
								mygis.Admin.MapManager.QuickSearches.setupEditQSButtons(item);
								myconfig.objectCount = item.id;
								&#x2F;&#x2F;myconfig.callbackfn = mygis.Admin.MapManager.QuickSearches.editQSUpdateResult;
						}else{
								var item = {
										mapID: mygis.Admin.MapManager.updateConfig.mapID,
										quickID: -1
								};
								mygis.Admin.MapManager.QuickSearches.setupEditQSButtons(item);
						}
						$(&quot;#editQSPop&quot;).dialog({
								autoOpen: true,
								modal: true,
								resizable: false,
								width: 900,
								height: 510, 
								title: strings.MapManager.window_QSManager,
								closeOnEscape: false
						});
						var titleBar = $(&quot;#ui-dialog-title-editQSPop&quot;).parent();
						titleBar.css({
							&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;Administration&#x2F;header&#x2F;icon-48-cpanel.png&#x27;) #F6A828 no-repeat 14px 5px&quot;,
							&quot;background-size&quot;:&quot;auto 18px&quot;
							});
				},
				
				&#x2F;**
				 * Sets up the UI (jqx widgets, handlers etc)
				 * @method setupEditQSButtons
				 * @param {Object} defaultItem The item that sets up the default parameters
				 *&#x2F;
				setupEditQSButtons: function(defaultItem){
						$(&quot;#qs_quickID&quot;).val(defaultItem.quickID);
						mygis.Admin.MapManager.QuickSearches.qsLoadLayers(defaultItem.mapID,defaultItem);
						if (defaultItem.quickID!=-1){
								switch (defaultItem.searchType){
										case &quot;distinct&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_layerSearchType&#x27;]&quot;)[0].checked=&quot;checked&quot;;
												break;
										case &quot;input&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_layerSearchType&#x27;]&quot;)[1].checked=&quot;checked&quot;;
												break;
										case &quot;customSQL&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_layerSearchType&#x27;]&quot;)[2].checked=&quot;checked&quot;;
												break;
								}
								switch (defaultItem.searchLayout){
										case &quot;checkbox&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_searchLayout&#x27;]&quot;)[0].checked=&quot;checked&quot;;
												break;
										case &quot;dropdown&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_searchLayout&#x27;]&quot;)[1].checked=&quot;checked&quot;;
												break;
								}
								switch(defaultItem.searchMode){
										case &quot;auto&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_searchMode&#x27;]&quot;)[0].checked=&quot;checked&quot;;
												break;
										case &quot;buttons&quot;:
												$(&quot;#editQSTab input[name=&#x27;qs_searchMode&#x27;]&quot;)[1].checked=&quot;checked&quot;;
												break;
								}
								$(&quot;#qs_windowTitle&quot;).val(defaultItem.windowTitle);
						}
				},
				
				&#x2F;**
				 * Loads the layer list in the create&#x2F;edit QS dialog window
				 * @method qsLoadLayers
				 *&#x2F;
				qsLoadLayers: function(mapID,configItem){
						var myurl = config.folderPath +&quot;mgreq.ashx?qtype=GetLayerList&amp;qContents=&quot;+mapID;
						var source = {
								datatype: &quot;json&quot;,
								datafields: [
									{ name: &quot;layerID&quot; },
									{ name: &quot;layerNAME&quot; },
									{ name: &quot;layerTABLE&quot; }
								],
								id: &#x27;qsLayers&#x27;,
								url: myurl
						};
						var mysource = new $.jqx.dataAdapter(source,{
								loadComplete: function(){
										var data = mysource.records;
										var selectSource = [];
										var defaultSelected=-1;
										
										for (var i = 0; i &lt; data.length; i++) {
												var item = data[i];
												var label = item.layerNAME;
												var row = {};
												row[&quot;name&quot;]=label;
												&#x2F;&#x2F;row[&quot;value&quot;]=label;
												row[&quot;value&quot;]=item.layerTABLE;
												selectSource.push(row);
												if (configItem){
														if (configItem.layername==item.layerTABLE){
																defaultSelected=i;
														}
												}
										}
										mygis.Utilities.populateSelect($(&quot;#qs_layernameInp&quot;)[0],selectSource);
										if (defaultSelected&gt;-1){
												document.getElementById(&quot;qs_layernameInp&quot;).selectedIndex=defaultSelected+1;
												mygis.Admin.MapManager.QuickSearches.qsLoadFields(configItem);
										}
								}
						});
						mysource.dataBind();
						$(&quot;#qs_layernameInp&quot;).bind(&quot;change&quot;,mygis.Admin.MapManager.QuickSearches.qsLoadFields);
				},
				
				&#x2F;**
				 * Loads the field list in the create&#x2F;edit QS dialog window
				 * @method qsLoadFields
				 *&#x2F;
				qsLoadFields: function(configItem){
						var element = document.getElementById(&quot;qs_layernameInp&quot;);
						if (element.selectedIndex&gt;0){
								var layername = element.options[element.selectedIndex].value;
								var customUrl = config.mgreq+&quot;?qtype=GetLayerFields&amp;qContents=&quot;+escape(layername.replace(&#x2F; &#x2F;g,&quot;_&quot;));
								$.ajax({
										type:&quot;GET&quot;,
										url: customUrl,
										success: function(data){
												var newElem=document.getElementById(&quot;qs_layerfieldInp&quot;);
												var datacolumns = mygis.Query.resultLayerDetails(data);	
												mygis.Utilities.populateSelect(newElem,datacolumns);
												if (configItem){
														$(&quot;#qs_layerfieldInp option:contains(&#x27;&quot;+configItem.fieldname+&quot;&#x27;)&quot;).attr(&quot;selected&quot;,&quot;selected&quot;)
												}
										}
								});
						}
						
				},
								
				&#x2F;**
				 * Checking the validity of the input in the edit QS dialog
				 * @method editQSCheck
				 *&#x2F;
				editQSCheck: function(){
						var retvalue=false;
						var flag1 = $(&quot;#qs_layernameInp&quot;)[0].selectedIndex&gt;0;
						var flag2 = $(&quot;#qs_layerfieldInp&quot;)[0].selectedIndex&gt;0;
						var flag3 = $(&quot;#qs_windowTitle&quot;).val()!=&quot;&quot;;
						if (flag1&amp;&amp;flag2&amp;&amp;flag3){
								retvalue=true;
								mygis.Admin.UI.dialogConfig.object = {
										layername: $(&quot;#qs_layernameInp&quot;).val(),
										fieldname: $(&quot;#qs_layerfieldInp&quot;).val().split(&quot;%&quot;)[0],
										searchType: $(&quot;#editQSTab input[name=&#x27;qs_layerSearchType&#x27;]:checked&quot;).val(),
										searchOperator: $(&quot;#qs_searchOp&quot;).val(),
										searchLayout: $(&quot;#editQSTab input[name=&#x27;qs_searchLayout&#x27;]:checked&quot;).val(),
										searchMode: $(&quot;#editQSTab input[name=&#x27;qs_searchMode&#x27;]:checked&quot;).val(),
										windowTitle: $(&quot;#qs_windowTitle&quot;).val(),
										mapID: mygis.Admin.MapManager.updateConfig.mapID,
										quickID: $(&quot;#qs_quickID&quot;).val()
								};
						}else{
								if (!flag1){
										alert(strings.MapManager.qsNew_err_NoLayer);	
								}else if (!flag2){
										alert(strings.MapManager.qsNew_err_NoField);
								}else if (!flag3){
										alert(strings.MapManager.qsNew_err_NoTitle);
								}
						}
						return retvalue;
				},
				
				&#x2F;**
				 * Handling the result of the edit QS dialog if it&#x27;s a new item
				 * @method editQSResult
				 * @param {String} result Whether it was successful (&quot;ok&quot;) or not
				 *&#x2F;
				editQSResult: function(result){
						var configObj = this;
						var toSend=JSON.stringify(configObj);
						var customUrl = config.mgreq+&quot;?qtype=CreateNewQS&quot;;
						var postObject = new Object();
						postObject[&quot;qContents&quot;]=toSend;
						mygis.Utilities.blockUI();
						$.ajax({
								type:&quot;POST&quot;,
								data: postObject,
								url: customUrl,
								success: function(data){
										try{
												var realResults = eval(data);
												if (realResults.iotype==&quot;success&quot;){
														mygis.Admin.MapManager.QuickSearches.refreshQSGrid();
														displaySuccess(strings.MapManager.qsNew_msg_Success);
													
												}else{
													displayError(realResults.iomsg);
												}		
										}catch(err){
												console.log(err.message);
										}
										mygis.Utilities.unblockUI();
								}
						});
				},
				
				&#x2F;**
				 * Selects a row(deselecting others if necessary) and then calls the editing function
				 * @method directQSEdit
				 * @param {Integer} rowIndex
				 *&#x2F;
				directQSEdit: function(rowindex){
						var grid = $(&quot;#mapHotSearchList&quot;);
						grid.jqxGrid(&#x27;clearselection&#x27;);
						grid.jqxGrid(&#x27;selectrow&#x27;,rowindex);
						mygis.Admin.MapManager.QuickSearches.qsSelected();
						mygis.Admin.MapManager.QuickSearches.showEditQS(false);
				},
				
				&#x2F;**
				 * Deletes the selected grid rows and notifies for save
				 * @method deleteQS
				 *&#x2F;
				deleteQS: function(){
						var grid = $(&quot;#mapHotSearchList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						var atLeastOne = false;
						for (var i=0;i&lt;selection.length;i++){
								var item = records[selection[i]];
								var confItem = mygis.Admin.MapManager.updateConfig.quickSearches[selection[i]];
								var grabCopy = $.extend({},item);
								grabCopy.quickID=-1;
								confItem.newValue = JSON.stringify(grabCopy);
								confItem.changed=true;
								atLeastOne=true;
								records.splice(selection[i],1);
						}
						if (atLeastOne){
								mygis.Admin.MapManager.notifyUnsaved();
								grid.jqxGrid(&#x27;clearselection&#x27;);
								grid.jqxGrid(&#x27;refreshdata&#x27;);
								mygis.Admin.MapManager.QuickSearches.qsUnselected();
						}
				},
				
				&#x2F;**
				 * Used to create the quick search grid in the QS tab of the map manager
				 * @method createQSGrid
				 * @param {Integer} mapID the map to query
				 *&#x2F;
				createQSGrid: function(mapID){
						mygis.Utilities.blockUI();
						var qsSource = mygis.Admin.MapManager.QuickSearches.createQSGridSource(mapID);
						var container = $(&quot;#mapHotSearchList&quot;);
						container.bind(&quot;bindingcomplete&quot;,function(event){
								mygis.Admin.MapManager.setConfigQS($(&quot;#mapHotSearchList&quot;).jqxGrid(&#x27;source&#x27;).records);
						});
						var columnrenderer = function(value){
								var action = &#x27;router(&quot;mapQSAllClick&quot;,this);&#x27;;
								var grid = $(&quot;#mapHotSearchList&quot;);
								var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
								var checked = selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length ? &#x27; checked=&quot;checked&quot;&#x27; : &#x27;&#x27;;
								retobject = mygis.Utilities.format(&quot;&lt;div style=&#x27;text-align: center; margin-top: 5px;position: absolute;left: 8px;z-index: 1;&#x27;&gt;&lt;input id=&#x27;map_selectAllQS&#x27; type=&#x27;checkbox&#x27; onclick=&#x27;{0}&#x27;{1}&#x2F;&gt;&lt;&#x2F;div&gt;&quot;,action,checked);
								return retobject;
						};
						var cellrenderer = function(row,datafield,value){
								var retobject;
								switch (datafield){
										case &quot;windowTitle&quot;:
												var action = mygis.Utilities.format(&#x27;router(&quot;qsTitleClick&quot;,{0});&#x27;,row);
												retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27;&gt;&lt;a href=&#x27;#&#x27; onclick=&#x27;{1}&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,action);
												break;
								}
								return retobject;
						};
						if (qsSource.records.length&gt;0){
								container.jqxGrid({
										source: qsSource,
										width: &#x27;100%&#x27;,
										autoheight: true,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;, datafield:&#x27;qsSelected&#x27;,width: 22,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapManager.qsGrid_colWindowName, datafield:&#x27;windowTitle&#x27;,editable:false,cellsrenderer: cellrenderer},
												{text: strings.MapManager.qsGrid_colLayerName, datafield:&#x27;layername&#x27;,editable:false},
												{text: strings.MapManager.qsGrid_colFieldName, datafield:&#x27;fieldname&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}else{
								container.jqxGrid({
										source: qsSource,
										width: &#x27;100%&#x27;,
										autoheight: false,
										height: 200,
										theme: &#x27;pk_mg_jm&#x27;,
										altrows: true,
										enabletooltips: true,
										columns: [
												{text: &#x27;asdf&#x27;, datafield:&#x27;qsSelected&#x27;,width: 22,columntype: &#x27;checkbox&#x27;,renderer: columnrenderer},
												{text: strings.MapManager.qsGrid_colWindowName, datafield:&#x27;windowTitle&#x27;,editable:false,cellsrenderer: cellrenderer},
												{text: strings.MapManager.qsGrid_colLayerName, datafield:&#x27;layername&#x27;,editable:false},
												{text: strings.MapManager.qsGrid_colFieldName, datafield:&#x27;fieldname&#x27;,editable:false}
										],
										enableanimations: false,
										showheader: true,
										columnsmenu: false,
										editable: true,
										selectionmode: &#x27;none&#x27;
								});
						}
						container.bind(&quot;rowselect&quot;,mygis.Admin.MapManager.QuickSearches.qsSelected);
						container.bind(&quot;rowunselect&quot;,mygis.Admin.MapManager.QuickSearches.qsUnselected);
						container.bind(&quot;cellendedit&quot;,mygis.Admin.MapManager.QuickSearches.qsCheckClicked);
						mygis.Utilities.unblockUI();
				},
				
				&#x2F;**
				 * Used to create the quick search grid&#x27;s source
				 * @method createQSGridSource
				 * @param {Integer} mapID the map to query
				 *&#x2F;
				createQSGridSource: function(mapID){
						var retvalue;
						var myurl = config.folderPath+&quot;mgreq.ashx?qtype=GetMapQuickSearches&amp;qContents=&quot;+mapID;
						var source =
						{
							datatype: &quot;json&quot;,
							datafields: [
								{ name: &quot;qsSelected&quot;, type:&quot;boolean&quot;},
								{ name: &quot;mapID&quot;},
								{ name: &quot;quickID&quot; },
								{ name: &quot;layername&quot;}, 
								{ name: &quot;fieldname&quot; },
								{ name: &quot;searchType&quot; },
								{ name: &quot;searchOperator&quot; },
								{ name: &quot;searchLayout&quot; },
								{ name: &quot;searchMode&quot; },
								{ name: &quot;windowTitle&quot;}, 
								{ name: &quot;windowIcon&quot;}
							],
							id: &#x27;asdfg&#x27;,
							url: myurl
						};
						retvalue = new $.jqx.dataAdapter(source,{async:false});
						return retvalue;
				},
				
				&#x2F;**
				 * Refreshes the quick search grid
				 * @method refreshQSGrid
				 *&#x2F;
				refreshQSGrid: function(){
						$(&quot;#mapHotSearchList&quot;).jqxGrid(&#x27;updatebounddata&#x27;);
				},
				
				&#x2F;**
				 * Handles the selection or rows in the qs grid
				 * @method qsSelected
				 *&#x2F;
				qsSelected: function(){
						var grid = $(&quot;#mapHotSearchList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_editQSbtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editQSbtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;map_deleteQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								document.getElementById(&quot;map_editQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_deleteQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;map_selectAllQS&quot;).checked=true;
						}else{
								document.getElementById(&quot;map_selectAllQS&quot;).checked=false;
						}
				},
				
				&#x2F;**
				 * Handles the selection or rows in the qs grid
				 * @method qsUnselected
				 *&#x2F;
				qsUnselected: function(){
						var grid = $(&quot;#mapHotSearchList&quot;);
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (selection.length&gt;1){
								if (!document.getElementById(&quot;map_editQSbtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editQSbtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								document.getElementById(&quot;map_deleteQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else if (selection.length==1){
								document.getElementById(&quot;map_editQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
								document.getElementById(&quot;map_deleteQSbtn&quot;).ex_RemoveClassName(&quot;disabled&quot;);
						}else{
								if (!document.getElementById(&quot;map_editQSbtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_editQSbtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
								if (!document.getElementById(&quot;map_deleteQSbtn&quot;).ex_HasClassName(&quot;disabled&quot;)){
										document.getElementById(&quot;map_deleteQSbtn&quot;).ex_AddClassName(&quot;disabled&quot;);
								}
						}
						if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
								document.getElementById(&quot;map_selectAllQS&quot;).checked=true;
						}else{
								document.getElementById(&quot;map_selectAllQS&quot;).checked=false;
						}
				},
				
				&#x2F;**
				* Handles the clicking of the checkbox in each row at the QS grid
				* @method qsCheckClicked
				* @param {Element} elem The checkbox clicked
				*&#x2F;
				qsCheckClicked: function(elem){
						var grid = $(&quot;#mapHotSearchList&quot;);
						if (elem.args.value) {
								grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
						}
						else {
								grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
						}
				},
				
				&#x2F;**
				 * Handles the check all button in the QS grid
				 * @method qsAllCheckClicked
				 * @param {Element} elem The firing checkbox
				 *&#x2F;
				qsAllCheckClicked: function(elem){
						var grid = $(&quot;#mapHotSearchList&quot;);
						var records = grid.jqxGrid(&#x27;source&#x27;).records;
						var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
						if (elem.checked){
								for (var i=0;i&lt;records.length;i++){
										if (selection.indexOf(i)==-1){
												records[i].qsSelected=true;
												grid.jqxGrid(&#x27;selectrow&#x27;,i)
										}
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}else{
								for (var i=0;i&lt;records.length;i++){
										records[i].qsSelected=false;
										grid.jqxGrid(&#x27;unselectrow&#x27;,i)
								}
								grid.jqxGrid(&#x27;refreshdata&#x27;);
						}
				}
		},
		
		&#x2F;**
			Fills in the &quot;editForm&quot; fields with the map details
			@method getMapDetails
			@param {String} mapID The map id. If ommited, it will get the current map details.
			@for mygis.Admin.MapManager
		**&#x2F;
		getMapDetails: function(mapID){
				if (!$(&quot;#myMapsGrid&quot;).jqxGrid(&#x27;source&#x27;)){
						mygis.Admin.MapManager.Maps.createMapGrid();
				}
				var records = $(&quot;#myMapsGrid&quot;).jqxGrid(&#x27;source&#x27;).records;
				var found=false;
				var i=0;
				var details;
				while (!found &amp;&amp; i&lt;records.length){
					if (mapID){
						if (records[i].id==mapID){
							found=true;
							details = records[i];
						}
					}else{
						if (records[i].id==currentMapID){
							found=true;
							details = records[i];
						}
					}
					i++;
				}
				if (found){
						mygis.Admin.MapManager.storeMapDetails(details);
						document.getElementById(&quot;editMapName&quot;).value = details.mapName;
						document.getElementById(&quot;editMapDescription&quot;).value = details.mapDescription;
						document.getElementById(&quot;editMapExtent&quot;).value = details.maxExtent;
						document.getElementById(&quot;editMapCenter&quot;).value = details.mapCenter;
						document.getElementById(&quot;editMapZoom&quot;).value = details.mapZoom;
						document.getElementById(&quot;editMapDeveloper&quot;).value = details.mapDevelopedBy;
						document.getElementById(&quot;editMapOwner&quot;).value = details.mapOwner;
						document.getElementById(&quot;editMapThumb&quot;).src = config.folderPath+&#x27;GetImage.ashx?qType=mapThumb&amp;qsize=120&amp;qContents=&#x27;+details.id;
						mygis.Utilities.populateBGselect($(&quot;#editMapDefaultBG&quot;),details.mapDefaultBG);
						mygis.Admin.MapManager.Layers.createLayerGrid(details.id);	&#x2F;&#x2F;this is needed for map thumb generation from layers
						
				}
		},
		
		&#x2F;**
		 * Stores the current editing map&#x27;s details in the config object
		 * @method storeMapDetails
		 * @param {Object} detailRow The grid record
		 *&#x2F;
		storeMapDetails: function(detailRow){
				mygis.Admin.MapManager.resetConfigObject();
				var myconfig = mygis.Admin.MapManager.updateConfig;
				myconfig.mapID=detailRow.id;
				myconfig.mapName.oldValue = detailRow.mapName;
				myconfig.mapDescription.oldValue = detailRow.mapDescription;
				myconfig.mapExtent.oldValue = detailRow.maxExtent;
				myconfig.mapCenter.oldValue = detailRow.mapCenter;
				myconfig.mapZoom.oldValue =  detailRow.mapZoom;
				myconfig.mapDeveloped.oldValue = detailRow.mapDevelopedBy;
				myconfig.mapOwner.oldValue = detailRow.mapOwner;
				myconfig.mapDefaultBG.oldValue = detailRow.mapDefaultBG;
		},
		
		&#x2F;**
		 * Updates the config object with the source layers
		 * @method setConfigLayers
		 * @param {Object} source The grid source
		 * @param {Boolean} changed If all items should be considered changed
		 *&#x2F;
		setConfigLayers: function(source,changed){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: changed?changed:false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.MapManager.updateConfig.layers=finalList;
		},
		
		&#x2F;**
		 * Updates the config object with the source tags
		 * @method setConfigTags
		 *&#x2F;
		setConfigTags: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.MapManager.updateConfig.tags = finalList;
		},
		
		&#x2F;**
		 * Updates the config object with the source Quick Searches
		 * @method setConfigQS
		 *&#x2F;
		setConfigQS: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.MapManager.updateConfig.quickSearches = finalList;
		},
		
		&#x2F;**
		 * Updates the config object with the source Macros
		 * @method setConfigMacros
		 *&#x2F;
		setConfigMacros: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.MapManager.updateConfig.macros = finalList;
		},
		
		&#x2F;**
		 * Updates the config object with the source permissions
		 * @method setConfigPermissions
		 *&#x2F;
		setConfigPermissions: function(source){
				var finalList = [];
				for (var i=0;i&lt;source.length;i++){
						var item = {
								changed: false,
								newValue: null,
								oldValue : null
						};
						item.oldValue = JSON.stringify(source[i]);
						finalList.push(item);
				}
				mygis.Admin.MapManager.updateConfig.permissions = finalList;
		},
		
		resetConfigObject: function(){
				try{
						if (!document.getElementById(&quot;amenu_Maps_Config_save&quot;).ex_HasClassName(&quot;disabled&quot;)){
								document.getElementById(&quot;amenu_Maps_Config_save&quot;).ex_AddClassName(&quot;disabled&quot;);
						}
				}catch(err){}
				var resetobj = {
						layers: [],
						permissions: [],
						macros: [],
						mapName: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDescription: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapExtent: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapCenter: {
						changed: false,
						oldValue : &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapZoom: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDeveloped: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapOwner: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapThumb: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				},
				mapDefaultBG: {
						changed: false,
						oldValue: &quot;&quot;,
						newValue: &quot;&quot;
				}
				};
				mygis.Admin.MapManager.updateConfig = mygis.Utilities.mergeOptions(mygis.Admin.MapManager.updateConfig,resetobj);
		},
		
		&#x2F;**
		 * Triggers when a section in the &quot;edit map settings&quot; is expanded
		 * @method expandDetails
		 * @param {Object} event The triggering event
		 *&#x2F;
		expandDetails: function(event){
				var index = event.item;
				mygis.Utilities.blockUI();
				
				var tabHeaders = $(&quot;#contentLinkTabsRound&quot;).find(&quot;.sectionHeader&quot;);
				for (var i=0;i&lt;tabHeaders.length;i++){
						if (i!=index){
								tabHeaders[i].ex_RemoveClassName(&quot;active&quot;);
						}else{
								tabHeaders[i].ex_AddClassName(&quot;active&quot;);
						}
				}
				var tabs = $(&quot;#editMapForm&quot;).find(&quot;.sectionContent&quot;);
				for (var i=0;i&lt;tabs.length;i++){
						if (i!=index){
								$(tabs[i]).hide();
						}else{
								$(tabs[i]).show();
								var buttons = $(tabs[i]).find(&quot;.sectionButtons&quot;);
								$(&quot;#contentSpecificToolbar&quot;).empty();
								$(&quot;#contentSpecificToolbar&quot;).append(buttons.clone());
						}
				}
				
				mygis.Admin.MapManager.createGrid(index);
				mygis.Utilities.unblockUI();
		},
		
		&#x2F;**
		 * Routing function for the map settings tabs
		 * @method createGrid
		 * @param {Integer} index The corresponding tabIndex to create a grid for.
		 *&#x2F;
		createGrid: function(index){
				var myconfig = mygis.Admin.MapManager.updateConfig;
				switch (index){
						case 1:
								if (myconfig.layers.length==0){
										mygis.Admin.MapManager.Layers.createLayerGrid(myconfig.mapID);
								}else{
										$(&quot;#mapLayerList&quot;).jqxGrid(&#x27;render&#x27;); &#x2F;&#x2F;force update
								}
								break;
						case 3:
								if (myconfig.quickSearches.length==0){
										mygis.Admin.MapManager.QuickSearches.createQSGrid(myconfig.mapID);
								}else{
										$(&quot;#mapHotSearchList&quot;).jqxGrid(&#x27;render&#x27;);	&#x2F;&#x2F;force update
								}
								break;
						case 4:
								if (myconfig.macros.length==0){
										mygis.Admin.MapManager.Macros.createMacroGrid(myconfig.mapID);
								}else{
										$(&quot;#mapMacroList&quot;).jqxGrid(&#x27;render&#x27;);	&#x2F;&#x2F;force update
								}
								break;
				}
		},
		
		&#x2F;**
		 * Notifies that there are unsaved changes
		 * @method notifyUnsaved
		 *&#x2F;
		notifyUnsaved: function(){
				document.getElementById(&quot;amenu_Maps_Config_save&quot;).ex_RemoveClassName(&quot;disabled&quot;);
				$(&quot;#amenu_Maps_Config_save&quot;).qtip({
					content: {
							text: strings.AppManager.msg_NotifyUnsaved
					},
					position: {
							my: &quot;center right&quot;,
							at: &quot;center left&quot;
					},
					show: {
							event: &quot;mouseover&quot;,
							ready: true,
							solo: true
					},
					hide: {
							event: &quot;unfocus&quot;,
							inactive: false
					},
					events: {
							hide: function(event, api) {
									api.destroy();
							}
					},
					style: {
							classes: &#x27;ui-tooltip-shadow&#x27;, &#x2F;&#x2F; Optional shadow...
							tip: {
								border: 1
							},
							border: 1
					}});
		},
		
		&#x2F;**
		 * Propagates all changes to the server
		 * @method saveChanges
		 *&#x2F;
		saveChanges: function(){
				var toSend = JSON.stringify(mygis.Admin.MapManager.updateConfig);
				var customUrl = config.mgreq+&quot;?qtype=UpdateMapSettings&quot;;
				var postObject = new Object();
				postObject[&quot;qContents&quot;]=toSend;
				mygis.Utilities.blockUI();
				$.ajax({
						type: &quot;POST&quot;,
						data: postObject,
						url: customUrl,
						success: function(data){
								var realResults = eval(data);
								if (realResults.iotype==&quot;success&quot;){
										mygis.Utilities.unblockUI();
										mygis.Admin.MapManager.resetConfigObject();
										displaySuccess(strings.MapManager.settings_updated);
										setTimeout(function(){
												var activeTab = $(&quot;#contentLinkTabsRound&quot;).find(&quot;.sectionHeader.active&quot;);
												mygis.Admin.MapManager.createGrid(activeTab.index());
										},250);
								}else{
										displayError(realResults.iomsg);
								}
						}
				});
		},
		
		&#x2F;**
			This function is used to late-bind all handlers for the Map Manager window
			@method bindManagerHandlers
		**&#x2F;
		bindManagerHandlers: function(){
				for (var i=0;i&lt;5;i++){
						var handler=&quot;&quot;;
						switch(i){
								case 0:
										handler=&quot;mapManager_sortName&quot;;
										break;
								case 1:
										handler=&quot;mapManager_sortLayerCount&quot;;
										break;
								case 2:
										handler=&quot;mapManager_sortCreateDate&quot;;
										break;
								case 3:
										handler=&quot;mapManager_sortUpdateDate&quot;;
										break;
								case 4:
										handler=&quot;mapManager_sortOwnershipType&quot;;
										break;
								
						}
						$(&quot;#&quot;+handler).bind(&#x27;click&#x27;,function(){
								mygis.Admin.MapManager.sortBy(handler);
								return false;
						});
				}
				var search=$(&quot;#mapManager_SearchInput&quot;);
				search.data(&quot;oldVal&quot;,&quot;&quot;);
				&#x2F;&#x2F;search.bind(&#x27;paste&#x27;,mygis.Admin.MapManager.filterPotentialMaps);
				search.bind(&#x27;focus&#x27;,function(){mygis.Admin.MapManager.toggleFilterFocus(true);});
				search.bind(&#x27;blur&#x27;,function(){mygis.Admin.MapManager.toggleFilterFocus(false);});
				var delay = (function(){
						var timer = 0;
						return function(callback, ms){
							clearTimeout (timer);
							timer = setTimeout(callback, ms);
						};
						})();
				search.bind(&quot;propertychange input keyup&quot;,function(){delay(mygis.Admin.MapManager.filterPotentialMaps,300);});
				search.bind(&quot;propertychange input keyup&quot;,mygis.Admin.MapManager.toggleFilterDecoration);
		},
		
		&#x2F;**
		 * Creates the grid for the available maps to load
		 * @method createPotentialMapGrid
		 * @param {String} filterList A #-separated list of map ids to filter OUT
		 *&#x2F;
		createPotentialMapGrid: function(filterList){
				var mapSource = mygis.Admin.MapManager.createPotentialMapSource(filterList);
				var mapContainer = $(&quot;#mapManagerList&quot;);
				var cellrenderer = function(row,datafield,value){
						var retobject;
						switch(datafield){
								case &quot;mapName&quot;:
										var descr = this.owner.getrowdata(row).mapDescription;
										retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 100px;line-height:25px;&#x27;&gt;&lt;a href=&#x27;#&#x27; title=&#x27;{1}&#x27; style=&#x27;font-size: 11px;&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,value,descr);
						
										break;
								case &quot;mapOwnershipDesc&quot;:
										var data = this.owner.getrowdata(row);
										var description = &quot;&quot;;
										if (data.mapAmOwner &amp;&amp; data.mapAmCreator){
												description = strings.MapManager.mapOwnershipType1;
										}else if (data.mapAmOwner){
												description = strings.MapManager.mapOwnershipType2;
										}else if (data.mapAmCreator){
												description = strings.MapManager.mapOwnershipType3;
										}else if (data.mapAmSubscriber){
												description = strings.MapManager.mapOwnershipType4;
										}else if (data.mapIsPublic){
												description = strings.MapManager.mapOwnershipType5;
										}
										retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 160px;line-height:25px;text-align:center;&#x27;&gt;&lt;a href=&#x27;#&#x27; title=&#x27;{1}&#x27; style=&#x27;font-size: 11px;&#x27;&gt;{0}&lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&quot;,
																											 description,description);	&#x2F;&#x2F;TODO: the second title should be an Ajax tooltip with more info
										break;
								case &quot;mapIsPublic&quot;:
								case &quot;mapAmOwner&quot;:
								case &quot;mapAmCreator&quot;:
								case &quot;mapAmSubscriber&quot;:
										var checked = value?&quot; checked&quot;:&quot;&quot;;
										retobject = mygis.Utilities.format(&quot;&lt;div class=&#x27;imageVerticalContainer&#x27; style=&#x27;width: 80px;line-height:25px;&#x27;&gt;&lt;div class=&#x27;btnToggleCheck{0}&#x27;&gt;&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&quot;,checked);
										break;
						}
						
						return retobject;
				};
				mapContainer.jqxGrid({
						source: mapSource,
						width: 760,
						height: 294,
						autoheight: false,
						theme: &#x27;pk_mg_jm&#x27;,
						altrows: true,
						enabletooltips: true,
						columns: [
								{text: &#x27;asdf&#x27;, datafield: &#x27;mapSelected&#x27;, width: 20, columntype: &#x27;checkbox&#x27;},
								{text: strings.MapControl.col_mapName, datafield: &#x27;mapName&#x27;, cellsrenderer: cellrenderer, editable:false},
								{text: strings.MapControl.col_mapLCount, datafield: &#x27;mapLayerCount&#x27;,editable:false,width:50,cellsalign:&#x27;right&#x27;},
								{text: strings.MapControl.col_mapCreate, datafield: &#x27;mapCreateDate&#x27;,editable:false,width:130},
								{text: strings.MapControl.col_mapUpdate, datafield: &#x27;mapUpdateDate&#x27;,editable:false,width:130},
								{text: strings.MapControl.col_mapOwnership, datafield: &quot;mapOwnershipDesc&quot;, editable:false, width:160,cellsrenderer: cellrenderer} &#x2F;*,
								{text: strings.MapControl.col_mapIsPublic, datafield: &quot;mapIsPublic&quot;, editable:false, width:80,cellsrenderer: cellrenderer},
								{text: strings.MapControl.col_mapAmOwner, datafield: &quot;mapAmOwner&quot;, editable:false, width:80,cellsrenderer: cellrenderer},
								{text: strings.MapControl.col_mapAmCreator, datafield: &quot;mapAmCreator&quot;,editable:false, width:80,cellsrenderer: cellrenderer},
								{text: strings.MapControl.col_mapAmSubsciber, datafield: &quot;mapAmSubscriber&quot;,editable:false, width:80,cellsrenderer: cellrenderer}*&#x2F;
						],
						enableanimations: false,
						showheader: false,
						columnsmenu: false,
						editable: true,
						selectionmode: &#x27;none&#x27;
				});

				mapContainer.bind(&#x27;rowselect&#x27;,mygis.Admin.MapManager.mapSelected);
				mapContainer.bind(&#x27;rowunselect&#x27;,mygis.Admin.MapManager.mapUnselected);
				mapContainer.bind(&#x27;cellendedit&#x27;,mygis.Admin.MapManager.singleMapCheck);
		},
		
		&#x2F;**
		 * Creates the source for the available maps to load
		 * @method createPotentialMapSource
		 * @param {String} filterList A #-separated list of map ids to filter OUT
		 *&#x2F;
		createPotentialMapSource: function(filterList){
				var retvalue;
				var url = config.mgreq+&quot;?qtype=AppAvailableMaps&quot;;
				if (filterList){
						url+= &quot;&amp;qContents=&quot;+filterList;
				}
				var source = {
						datatype: &quot;json&quot;,
						datafields: [
								{name: &quot;mapSelected&quot;,type: &quot;boolean&quot;},
								{name: &quot;mapOwnershipDesc&quot;},
								{ name: &quot;id&quot; },
								{ name: &quot;mapName&quot; },
								{ name: &quot;mapDescription&quot; },
								{ name: &quot;mapLayerCount&quot; },
								{ name: &quot;maxExtent&quot; },
								{ name: &quot;mapCenter&quot;},
								{ name: &quot;mapZoom&quot;},
								{ name: &quot;mapCreateDate&quot;},
								{ name: &quot;mapUpdateDate&quot;},
								{ name: &quot;mapDevelopedBy&quot;},
								{ name: &quot;mapOwner&quot;},
								{ name: &quot;mapDefaultBG&quot;},
								{ name: &quot;mapIsPublic&quot;,type: &quot;boolean&quot;},
								{ name: &quot;mapAmOwner&quot;,type: &quot;boolean&quot;},
								{ name: &quot;mapAmCreator&quot;,type: &quot;boolean&quot;},
								{ name: &quot;mapAmSubscriber&quot;,type: &quot;boolean&quot;}
						],
						id: &#x27;adminPotentialMapList&#x27;,
						url: url
				};
				retvalue = new $.jqx.dataAdapter(source,{async:false});
				&#x2F;&#x2F;retvalue.dataBind();
				return retvalue;
		},
		
		&#x2F;**
		 * Filters the list of potential maps according to the &lt;select&gt; filters
		 * @method filterPotentialMaps
		 *&#x2F;
		filterPotentialMaps: function(){
				var grid=$(&#x27;#mapManagerList&#x27;);
				grid.jqxGrid(&#x27;clearfilters&#x27;);
				var textFilter = $(&quot;#mapManager_SearchInput&quot;).val();
				var selFilter = parseInt($(&quot;#mapManager_filterOwnership&quot;).val());
				var boolFilter1 = $(&quot;#mapManager_filterPublic&quot;).val()==&quot;1&quot;?true:false;
				var boolFilter2 = $(&quot;#mapManager_filterOwner&quot;).val()==&quot;1&quot;?true:false;
				var boolFilter3 = $(&quot;#mapManager_filterCreator&quot;).val()==&quot;1&quot;?true:false;
				var boolFilter4 = $(&quot;#mapManager_filterSubscriber&quot;).val()==&quot;1&quot;?true:false;
				
				if (textFilter || selFilter&gt;-1 || boolFilter1 || boolFilter2 || boolFilter3 || boolFilter4){
						
						for (var i=0;i&lt;6;i++){
								var examined;
								var examinedType;
								var examinedCondition;
								var examinedDatafield;
								switch (i){
										case 0:
												examined=textFilter;
												examinedDatafield=&quot;mapName&quot;;
												examinedType = &quot;stringfilter&quot;;
												examinedCondition = &quot;CONTAINS&quot;;
												break;
										case 1:
												examined=boolFilter1;
												examinedDatafield=&quot;mapIsPublic&quot;;
												examinedType = &quot;booleanfilter&quot;;
												examinedCondition = &quot;EQUAL&quot;;
												break;
										case 2:
												examined=boolFilter2;
												examinedDatafield=&quot;mapAmOwner&quot;;
												examinedType = &quot;booleanfilter&quot;;
												examinedCondition = &quot;EQUAL&quot;;
												break;
										case 3:
												examined=boolFilter3;
												examinedDatafield=&quot;mapAmCreator&quot;;
												examinedType = &quot;booleanfilter&quot;;
												examinedCondition = &quot;EQUAL&quot;;
												break;
										case 4:
												examined=boolFilter4;
												examinedDatafield=&quot;mapAmSubscriber&quot;;
												examinedType = &quot;booleanfilter&quot;;
												examinedCondition = &quot;EQUAL&quot;;
												break;
										case 5:
												examined = selFilter;
												examinedType = &quot;numericfilter&quot;;
												examinedCondition = &quot;EQUAL&quot;;
												examinedDatafield = &quot;mapOwnershipDesc&quot;;
												break;
										
								}
								if (examined){
										var filtergroup = new $.jqx.filter();
										if (i!=5){
												var filter = filtergroup.createfilter(examinedType,examined,examinedCondition);
												filtergroup.addfilter(0,filter);
												grid.jqxGrid(&#x27;addfilter&#x27;, examinedDatafield, filtergroup);
										}else{
												
												switch (selFilter){
														case 0:	&#x2F;&#x2F;My creation
																var filterA = filtergroup.createfilter(examinedType,1,examinedCondition);
																var filterB = filtergroup.createfilter(examinedType,3,examinedCondition);
																filtergroup.addfilter(1,filterA);
																filtergroup.addfilter(1,filterB);
																grid.jqxGrid(&#x27;addfilter&#x27;, examinedDatafield, filtergroup);
																break;
														case 1:	&#x2F;&#x2F;Buy 
																var filterA = filtergroup.createfilter(examinedType,2,examinedCondition);
																var filterB = filtergroup.createfilter(examinedType,5,examinedCondition);
																filtergroup.addfilter(1,filterA);
																filtergroup.addfilter(1,filterB);
																grid.jqxGrid(&#x27;addfilter&#x27;, examinedDatafield, filtergroup);
																break;
														case 2:	&#x2F;&#x2F;Subscribe
																var filterA = filtergroup.createfilter(examinedType,4,examinedCondition);
																&#x2F;&#x2F;var filterB = filtergroup.createfilter(examinedType,3,examinedCondition);
																filtergroup.addfilter(0,filterA);
																&#x2F;&#x2F;filtergroup.addfilter(1,filterB);
																grid.jqxGrid(&#x27;addfilter&#x27;, examinedDatafield, filtergroup);
																break;
												}
										}
										
								}
						}
						mygis.Admin.MapManager.clearSelection();
						grid.jqxGrid(&#x27;applyfilters&#x27;);
				}			
		},
		
		&#x2F;**
		 * Sorts the files displayed according to the control ID.
		 * Element classes:
		 *  -No class: no sorting
		 *  -&#x27;desc&#x27;	sorted desc
		 *  -&#x27;asc&#x27; sorted asc
		 * The function cycles through the states as each button is pressed.
		 * @method sortBy
		 * @param {String} controlID The ID of the activating element.
		 *&#x2F;
		sortBy: function(controlID){
				var columnName = &quot;&quot;;
				var status=&quot;&quot;;
				var elementClasses = $(&quot;#&quot;+controlID).attr(&quot;class&quot;).split(&quot; &quot;);
				var sortClass=&quot;&quot;;
				var newSortClass = &quot;&quot;;
				if (elementClasses.length&gt;1){
					sortClass = elementClasses[1];
				}
				switch (controlID){
					case &quot;mapManager_sortName&quot;:
						columnName=&quot;mapName&quot;;
						break;
					case &quot;mapManager_sortLayerCount&quot;:
						columnName=&quot;mapLayerCount&quot;;
						break;
					case &quot;mapManager_sortCreateDate&quot;:
						columnName = &quot;mapCreateDate&quot;;
						break;
					case &quot;mapManager_sortUpdateDate&quot;:
						columnName = &quot;mapUpdateDate&quot;;
						break;
					case &quot;mapManager_sortOwnershipType&quot;:
						columnName = &quot;mapOwnershipDesc&quot;
						break;
				}
				switch (sortClass){
					case &quot;desc&quot;:
						newSortClass=&quot;asc&quot;;
						break;
					case &quot;asc&quot;:
						newSortClass=&quot;&quot;;
						break;
					default:
						newSortClass=&quot;desc&quot;;
						break;
						
				}
				if (columnName){
					$(&quot;#userFilesList&quot;).jqxGrid(&#x27;sortby&#x27;,columnName,newSortClass);
					if (newSortClass){
						if (sortClass){
							document.getElementById(controlID).ex_RemoveClassName(sortClass);
						}
						if (!document.getElementById(controlID).ex_HasClassName(newSortClass)){
								document.getElementById(controlID).ex_AddClassName(newSortClass);
						}
					}else{
						document.getElementById(controlID).ex_RemoveClassName(sortClass);
					}
				}
		},
		
		&#x2F;**
		 * Initializes the MapManager dialog
		 * @method showMapManagerMaps
		 * @param {Boolean} secondRun
		 * @param {String} filterList #-separated list of map ids to filter out
		 *&#x2F;
		showMapManagerMaps: function(secondRun,filterList){
			if (!secondRun){
				mygis.Admin.MapManager.bindManagerHandlers();
				$(&quot;#mapManager&quot;).dialog({
					autoOpen: false,
					modal: true,
					resizable: false,
					width: 780,
					height: 510, 
					title: strings.MapManager.loadWindowTitle,
					closeOnEscape: false
				});
				var titleBar = $(&quot;#ui-dialog-title-mapManager&quot;).parent();
				titleBar.css({
					&quot;background&quot;:&quot;url(&#x27;&quot;+config.folderPath+&quot;Images&#x2F;pictures_folder.png&#x27;) #F6A828 no-repeat 12px 2px&quot;,
					&quot;background-size&quot;:&quot;auto 25px&quot;
				});
			}
			$(&quot;#mapManager&quot;).dialog(&#x27;open&#x27;);
			
			
			var fileContainer = $(&quot;#mapManagerList&quot;);
			if (secondRun){
				fileContainer.jqxGrid(&#x27;clearselection&#x27;);
				fileContainer.jqxGrid(&#x27;clear&#x27;);
			}
			
			if (!secondRun){
				mygis.Admin.MapManager.createPotentialMapGrid(filterList);
				fileContainer.bind(&#x27;rowselect&#x27;,mygis.Admin.MapManager.mapSelected);
				fileContainer.bind(&#x27;rowunselect&#x27;,mygis.Admin.MapManager.mapUnselected);
				
			}else{
				mygis.Admin.MapManager.refreshMapList();
				
			}
			if (mygis.Admin.UI.dialogConfig.callbackfn==null){
				$(&quot;#mapManagerDialogButtons&quot;).hide();
			}else{
				$(&quot;#mapManagerDialogButtons&quot;).show();
			}
		},
		
		&#x2F;**
		 * Refreshes the map list from server
		 * @method refreshMapList
		 *&#x2F;
		refreshMapList: function(){
				var fileContainer = $(&quot;#mapManagerList&quot;);
				fileContainer.jqxGrid(&#x27;clearselection&#x27;);
				fileContainer.jqxGrid(&#x27;updatebounddata&#x27;);
		},
		
		&#x2F;**
			This function is called whenever a map is selected in the grid.
			@method mapSelected
			@param {Object} event The event parameters
		**&#x2F;
		mapSelected: function(event){
				var elem = $(&quot;#mapManager_toggleSelection&quot;);
				var grid = $(&quot;#mapManagerList&quot;);
				var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
				if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
						elem.html(strings.MapManager.mapUncheckAllTitle);
				}else{
						elem.html(strings.MapManager.mapCheckAllTitle);
				}
		},
		
		&#x2F;**
			This function is called whenever a map is unselected in the grid.
			It checks the selected rows count, to manipulate some controls
			@method mapUnselected
			@param {Object} event The event parameters
		**&#x2F;
		mapUnselected: function(event){
				var elem = $(&quot;#mapManager_toggleSelection&quot;);
				var grid = $(&quot;#mapManagerList&quot;);
				var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
				if (selection.length==grid.jqxGrid(&#x27;source&#x27;).records.length){
						elem.html(strings.MapManager.mapUncheckAllTitle);
				}else{
						elem.html(strings.MapManager.mapCheckAllTitle);
				}
		},
		
		&#x2F;**
		 * Handles the clicking of the checkbox in each row at the Map Manager
		 * @method singleMapCheck
		 * @param {Element} elem The checkbox clicked
		 *&#x2F;
		singleMapCheck :function(elem){
				var grid = $(&quot;#mapManagerList&quot;);
				if (elem.args.value) {
						grid.jqxGrid(&#x27;selectrow&#x27;, elem.args.rowindex);
				}
				else {
						grid.jqxGrid(&#x27;unselectrow&#x27;, elem.args.rowindex);
				}
		},
		
		&#x2F;**
		 * Handles the toggle all button in the Map Manager
		 * @method allMapToggle
		 * @param {Element} elem The firing element
		 *&#x2F;
		allMapToggle: function(elem){
				var grid = $(&quot;#mapManagerList&quot;);
				var records = grid.jqxGrid(&#x27;source&#x27;).records;
				var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
				if (selection.length==records.length){
						grid.jqxGrid(&#x27;clearselection&#x27;);
						for (var i=0;i&lt;records.length;i++){
								records[i].mapSelected=false;
						}
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						$(elem).html(strings.MapManager.mapCheckAllTitle);
				}else{
						grid.jqxGrid(&#x27;clearselection&#x27;);
						for (var i=0;i&lt;records.length;i++){
								records[i].mapSelected=true;
								grid.jqxGrid(&#x27;selectrow&#x27;,i);
						}
						grid.jqxGrid(&#x27;refreshdata&#x27;);
						$(elem).html(strings.MapManager.mapUncheckAllTitle);
				}
				
		},
		
		&#x2F;**
		 * Clears the selected rows
		 * @method clearSelection
		 *&#x2F;
		clearSelection: function(){
				var grid = $(&quot;#mapManagerList&quot;);
				var selection = grid.jqxGrid(&#x27;getselectedrowindexes&#x27;);
				for (var i=0;i&lt;selection.length;i++){
						grid.jqxGrid(&#x27;getrowdata&#x27;,selection[i]).mapSelected=false;
				}
				grid.jqxGrid(&#x27;clearselection&#x27;);
				grid.jqxGrid(&#x27;refreshdata&#x27;);
		},
		
		&#x2F;**
		 *
		 * @method toggleFilterFocus
		 * @param {Boolean} on 
		 *&#x2F;
		 toggleFilterFocus: function(on){
				var parentElem = document.getElementById(&quot;mapManager_Search&quot;);
				if (on){
					if (!parentElem.ex_HasClassName(&quot;focused&quot;)){
						parentElem.ex_AddClassName(&quot;focused&quot;);
					}
				}else{
					if (parentElem.ex_HasClassName(&quot;focused&quot;)){
						parentElem.ex_RemoveClassName(&quot;focused&quot;);
					}
				}
		 },
		 
		 &#x2F;**
		  * Checks if filter input box is empty or not and sets the according css class
		  * @method toggleFilterDecoration
		  *&#x2F;
		 toggleFilterDecoration: function(){
				var textFilter = $(&quot;#mapManager_SearchInput&quot;).val();
				var elem = $(&quot;#mapManager_Search&quot;)[0];
				if (textFilter){
						if (!elem.ex_HasClassName(&quot;populated&quot;)){
								elem.ex_AddClassName(&quot;populated&quot;);
						}
				}else{
						if (!elem.ex_HasClassName(&quot;populated&quot;)){
								elem.ex_RemoveClassName(&quot;populated&quot;);
						}
						
				}
		 }
	},
	
	&#x2F;**
		Functions and classes for layer management
		
		@class mygis.Admin.LayerManager
		@static
	**&#x2F;
	LayerManager: {
	
	},
	
	&#x2F;**
		Functions and classes for user&#x2F;groups management
		
		@class mygis.Admin.UserManager
		@static
	**&#x2F;
	UserManager: {
	
	},
	
	&#x2F;**
		Functions and classes for log management
		
		@class mygis.Admin.LogManager
		@static
	**&#x2F;
	LogManager: {
	
	},

	&#x2F;**
		UI-related functions
		@class mygis.Admin.UI
		@static
	**&#x2F;
	UI:{
		
		&#x2F;**
			This holds internal variables per session
			@property internalConfig
			@type {Object}
		**&#x2F;
		internalConfig: {
				lastMenuActive: -1
		},
		
		showManual: function(){
			var show=false;
			var src=&quot;&quot;;
			switch(currentAppName){
				case &quot;psyhat&quot;:
					show=true;
					src=&quot;&#x2F;psyhatManualAdmin.pdf&quot;;
					break;
			}
			if (show){
				if ($(&quot;#mygis_manual&quot;).children().length&gt;0){
					$(&quot;#mygis_manual&quot;).dialog(&#x27;show&#x27;);
				}else{
					var superCont = $(&quot;&lt;div &#x2F;&gt;&quot;);

					var cont = $(&quot;&lt;iframe &#x2F;&gt;&quot;);
					cont.attr(&quot;id&quot;,&quot;mygis_manual&quot;);
					cont.attr(&quot;src&quot;,src);
					cont.css({
						&quot;width&quot;:&quot;99%&quot;,
						&quot;height&quot;: &quot;100%&quot;
					});
					superCont.append(cont);
					superCont.dialog({
						modal: true,
						autoOpen: false,
						width: 920,
						height: 500,
						title: strings.HelpSystem.manual,
						resizable: true
					});

					superCont.dialog(&#x27;open&#x27;);
				}
			}else{
				displayNotify(msg_errFeatureNotImplemented);
			}
		},
		
		&#x2F;**
			Activates(displays) the content tab with the given id and hides the rest.
			
			@method activateTab
			@param {String} tabID 
		**&#x2F;
		activateTab: function(tabID){
			var tabs = $(&quot;#contentTabs&quot;).find(&quot;.contentTab&quot;);
			$.each(tabs,function(i,v){
				var myid = $(v).attr(&quot;id&quot;);
				if (myid==tabID){
					$(v).attr(&quot;class&quot;,&quot;contentTab active&quot;);
				}else{
					$(v).attr(&quot;class&quot;,&quot;contentTab&quot;);
				}
			});
		},
		
		&#x2F;**
			Handles the clicking of a menu item
			
			@method menuClick
			@param {Object} sender The menu object
			@param {String} manualID Used if called manually.
		**&#x2F;
		menuClick: function(sender,manualID){
			var eventArgs = manualID?document.getElementById(manualID):sender.args;
			var callerID = eventArgs.id;
			var menuLevel=-1;
			if (manualID){sender = $(&quot;#menuTabs&quot;);}
			if (callerID){
				var idparts =callerID.split(&quot;_&quot;);
				menuLevel = idparts.length-1;
				var parent;
				var title;
				if (menuLevel&gt;1){
					if (manualID){
						parent = $(sender).find(mygis.Utilities.format(&quot;#{0}_{1}&quot;,idparts[0],idparts[1]));
					}else{
						sender.currentTarget=this;
						parent = $(sender.currentTarget).find(mygis.Utilities.format(&quot;#{0}_{1}&quot;,idparts[0],idparts[1]));
					}
					
					title = parent.find(&quot;a&quot;).html();
				}
				if (title &amp;&amp; callerID!=&quot;amenu_Files_Manager&quot;){	&#x2F;&#x2F;Media Manager: special case (popup)
					var mytitle = $(eventArgs).find(&quot;a span&quot;).html();
					$(&quot;#contentActionsTitleElem&quot;).html(mygis.Utilities.format(&quot;{0}: {1}&quot;,title,mytitle));
				}
			}
			if (menuLevel&gt;1){
				var idparts =callerID.split(&quot;_&quot;);
				switch (idparts[1]){
						case &quot;Apps&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=0;
								break;
						case &quot;Maps&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=1;
								break;
						case &quot;Layers&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=2;
								break;
						case &quot;Users&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=3;
								break;
						case &quot;Data&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=4;
								break;
						case &quot;Files&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=5;
								break;
						case &quot;Logs&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=6;
								break;
						case &quot;Help&quot;:
								mygis.Admin.UI.internalConfig.lastMenuActive=7;
								break;
						
				}
				mygis.Admin.UI.resetTabs();
				switch (callerID){
						case &quot;amenu_Apps_Manager&quot;:
							mygis.Admin.UI.activateTab(&quot;appManagerTab&quot;);
							mygis.Admin.UI.createGenericActions(callerID);
							$(&quot;#contentActionsTitle&quot;).attr(&quot;class&quot;,&quot;appManager&quot;);
							mygis.Admin.AppManager.Apps.createAppGrid();
							
							break;
						case &quot;amenu_Apps_Config&quot;:
							mygis.Admin.UI.activateTab(&quot;editAppTab&quot;);
							mygis.Admin.UI.createGenericActions(callerID);
							$(&quot;#contentActionsTitle&quot;).attr(&quot;class&quot;,&quot;appConfig&quot;);
							if(manualID){
									var grid = $(&quot;#myAppGrid&quot;);
									var selectedIndex = grid.jqxGrid(&quot;getselectedrowindex&quot;);
									var details = grid.jqxGrid(&quot;getrowdata&quot;, selectedIndex);
									var appID = details.appID;
									$(&quot;#contentActionsTitleElem&quot;).html(mygis.Utilities.format(&quot;{0}: {1} &#x27;{2}&#x27;&quot;,title,strings.AppManager.appSetings_Label,details.appName));
									mygis.Admin.AppManager.getAppDetails(appID);
							}else{
									mygis.Admin.AppManager.getAppDetails();		
							}
							router(&quot;amenu_Apps_Config_Tab&quot;,0);
							break;
						case &quot;amenu_Files_Manager&quot;:
							showMediaManager();
							break;
						case &quot;amenu_Maps_Manager&quot;:
							mygis.Admin.UI.activateTab(&quot;mapManagerTab&quot;);
							mygis.Admin.UI.createGenericActions(callerID);
							$(&quot;#contentActionsTitle&quot;).attr(&quot;class&quot;,&quot;mapManager&quot;);
							mygis.Admin.MapManager.Maps.createMapGrid();
							break;
					
						case &quot;amenu_Maps_Config&quot;:
							mygis.Admin.UI.activateTab(&quot;editMapTab&quot;);
							mygis.Admin.UI.createGenericActions(callerID);
							if(manualID){
									var grid = $(&quot;#myMapsGrid&quot;);
									var selectedIndex = grid.jqxGrid(&quot;getselectedrowindex&quot;);
									var details = grid.jqxGrid(&quot;getrowdata&quot;, selectedIndex);
									var mapID = details.id;
									$(&quot;#contentActionsTitleElem&quot;).html(mygis.Utilities.format(&quot;{0}: {1} &#x27;{2}&#x27;&quot;,title,strings.MapManager.mapSettingsLabel,details.mapName));
									mygis.Admin.MapManager.getMapDetails(mapID);
							}else{
									mygis.Admin.MapManager.getMapDetails();		
							}
							router(&quot;amenu_Maps_Config_Tab&quot;,0);
							
							break;
						case &quot;amenu_Help_Manual&quot;:
							router(&quot;amenu_Help_Manual&quot;);
							break;
						default:
							mygis.Admin.UI.activateTab(&quot;&quot;);
							$(&quot;#contentActionsTitle&quot;).attr(&quot;class&quot;,&quot;&quot;);
							$(&quot;#contentToolbar&quot;).empty();
							
							displayNotify(msg_errFeatureNotImplemented);
							break;
				}
			}
		},
		
		&#x2F;**
			Creates the generic action buttons for each menu item
			@method createGenericActions
			@param {String} menuItem The menuItem to create actions for
		**&#x2F;
		createGenericActions: function(menuItem){
				var actionCount=0;
				var actionIDs=[];
				var actionTexts = [];
				var actionClasses = [];
				var actionHandlers = [];
				var disabled=[];
				var replacement=$(&quot;&lt;div &#x2F;&gt;&quot;);
				switch(menuItem){
						case &quot;amenu_Apps_Manager&quot;:
								actionCount = 4;
								actionIDs = [
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;new&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;edit&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;style&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;delete&quot;)
								];
								actionTexts = [
															 strings.AppManager.amenu_Apps_Manager_ActionNew,
															 strings.AppManager.amenu_Apps_Manager_ActionEdit,
															 strings.AppManager.amenu_Apps_Manager_ActionStyle,
															 strings.AppManager.amenu_Apps_Manager_ActionDelete
								];
								actionClasses = [&quot;imgNew&quot;,&quot;imgSettings&quot;,&quot;imgStyle&quot;,&quot;imgDelete&quot;];
								actionHandlers = [
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;new&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;edit&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;style&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;delete&quot;)
								];
								disabled = [false,true,true,true];
								break;
						case &quot;amenu_Apps_Config&quot;:
								actionCount = 2;
								actionIDs = [
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;save&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;cancel&quot;)
								];
								actionTexts = [
															 strings.AppManager.amenu_Apps_Config_ActionSave,
															 strings.AppManager.amenu_Apps_Config_ActionCancel
								];
								actionClasses = [&quot;imgSave&quot;,&quot;imgReset&quot;];
								actionHandlers = [
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;save&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;cancel&quot;)
								];
								disabled = [true,false];
								mygis.Admin.UI.setTabs($(&quot;#editAppForm&quot;).find(&quot;.sectionHeader&quot;).clone());
								$(&quot;#editAppName&quot;).bind(&quot;focus&quot;,mygis.Admin.AppManager.Apps.inputStore);
								$(&quot;#editAppAlias&quot;).bind(&quot;focus&quot;,mygis.Admin.AppManager.Apps.inputStore);
								$(&quot;#editAppWelcomeText&quot;).bind(&quot;focus&quot;,mygis.Admin.AppManager.inputStore);
								$(&quot;#editAppName&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.AppManager.Apps.inputChanged);
								$(&quot;#editAppAlias&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.AppManager.Apps.inputChanged);
								$(&quot;#editAppWelcomeText&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.AppManager.Apps.inputChanged);
								$(&quot;#chooseHost&quot;).bind(&quot;blur&quot;,mygis.Admin.AppManager.checkAliasValidity);
								$(&quot;#choosePort&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.AppManager.checkPortValidity);
								break;
						case &quot;amenu_Maps_Manager&quot;:
								actionCount = 3;
								actionIDs = [
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;new&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;edit&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;delete&quot;)
								];
								actionTexts = [
															 strings.AppManager.amenu_Maps_Manager_ActionNew,
															 strings.AppManager.amenu_Maps_Manager_ActionEdit,
															 strings.AppManager.amenu_Maps_Manager_ActionDelete
								];
								actionClasses = [&quot;imgNew&quot;,&quot;imgSettings&quot;,&quot;imgDelete&quot;];
								actionHandlers = [
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;new&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;edit&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;delete&quot;)
								];
								disabled = [false,true,true];
								break;
						case &quot;amenu_Maps_Config&quot;:
								actionCount = 2;
								actionIDs = [
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;save&quot;),
									mygis.Utilities.format(&quot;{0}_{1}&quot;,menuItem,&quot;cancel&quot;)
								];
								actionTexts = [
															 strings.AppManager.amenu_Apps_Config_ActionSave,
															 strings.AppManager.amenu_Apps_Config_ActionCancel
								];
								actionClasses = [&quot;imgSave&quot;,&quot;imgReset&quot;];
								actionHandlers = [
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;save&quot;),
									mygis.Utilities.format(&quot;router(&#x27;{0}&#x27;,&#x27;{1}&#x27;);return false;&quot;,menuItem,&quot;cancel&quot;)
								];
								disabled = [true,false];
								mygis.Admin.UI.setTabs($(&quot;#editMapForm&quot;).find(&quot;.sectionHeader&quot;).clone());
								$(&quot;#editMapName&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapDescription&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapExtent&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapCenter&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapZoom&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapDeveloper&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapOwner&quot;).bind(&quot;propertychange keyup input paste&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								$(&quot;#editMapDefaultBG&quot;).bind(&quot;change&quot;,mygis.Admin.MapManager.Maps.inputChanged);
								break;
					
				}
				for (var i=0;i&lt;actionCount;i++){
					replacement.append(mygis.Admin.UI.btnGenerator(actionIDs[i],actionClasses[i],actionTexts[i],actionHandlers[i],disabled[i]));
				}
				if (actionCount&gt;0){
					$(&quot;#contentToolbar&quot;).html(replacement.html());
				}
		},
		
		&#x2F;**
			Generates a button for the &quot;generic actions&quot;
			
			@method btnGenerator
			@param {String} id The generated id on the element
			@param {String} imageClass The additional class the element should have (in order to display an image)
			@param {String} text The text that will be displayed for the button
			@param {String} action A function that should be attached at the &quot;onclick&quot; event
			@param {Boolean} disabled If the button starts disabled.
			@return {Element} The generated element.
		**&#x2F;
		btnGenerator: function(id,imageClass,text, action,disabled){
			var retvalue = $(&quot;&lt;a &#x2F;&gt;&quot;);
			retvalue.attr(&quot;href&quot;,&quot;#&quot;);
			retvalue.attr(&quot;id&quot;,id);
			retvalue.attr(&quot;title&quot;,text);
			if (disabled){
				retvalue.attr(&quot;class&quot;,&quot;adminGenericAction disabled&quot;);
			}else{
				retvalue.attr(&quot;class&quot;,&quot;adminGenericAction&quot;);
			}
			if (action){
				retvalue.attr(&quot;onclick&quot;,action);
			}
			var imgElement = $(&quot;&lt;span &#x2F;&gt;&quot;);
			imgElement.attr(&quot;class&quot;,mygis.Utilities.format(&quot;adminActionImg {0}&quot;,imageClass));
			
			retvalue.append(imgElement);
			retvalue.append(text);
			return retvalue;
		},
		
		&#x2F;**
			Handles the off-page loading of the administration interface
			@method loadAdministration
		**&#x2F;
		loadAdministration: function(){
			if ($(&quot;#page_administration&quot;).children().length==0){
				mygis.Utilities.blockUI();
				loadFragment(&quot;page_administration&quot;,mygis.Admin.UI.initialize);
			}else{
				mygis.Admin.UI.initialize();
			}
		},
		
		&#x2F;**
			Initializes the interface (menus,tabs,grids, handlers etc)
			@method initialize
		**&#x2F;
		initialize: function(){
			mygis.Utilities.unblockUI();
			internalConfig.isAdminInterfaceLoaded=true;
			$(&quot;#menuTabs&quot;).jqxMenu({ 
				width: &#x27;635&#x27;, 
				height: &#x27;30&#x27;, 
				mode: &#x27;horizontal&#x27;, 
				showTopLevelArrows: true, 
				theme: &#x27;classic&#x27; 
			});
			$(&quot;#menuTabs&quot;).bind(&#x27;itemclick&#x27;,function(event){
													MakeTimeout(mygis.Admin.UI.menuClick,event,800,this);
													});
													&#x2F;&#x2F;mygis.Admin.UI.menuClick);
			
			&#x2F;&#x2F;$(&quot;#editAppForm&quot;).bind(&quot;expandingItem&quot;,mygis.Admin.AppManager.expandDetails)
			mygis.Admin.UI.switchToAdmin();
			mygis.Admin.UI.menuClick(null,&quot;amenu_Apps_Manager&quot;);	&#x2F;&#x2F;TODO: first item
		},
		
		&#x2F;**
			Hides the application interface and shows the admin.
			@method switchToAdmin
		**&#x2F;
		switchToAdmin: function(){
			if (internalConfig.isAdminInterfaceLoaded){
				$(&quot;#page_effect&quot;).hide();
				$(&quot;#page_userProfile&quot;).hide();
				$(&quot;#page_administration&quot;).show();
				var activeTab = $(&quot;#contentLinkTabsRound&quot;).find(&quot;.sectionHeader.active&quot;);
				if (activeTab){
						switch (mygis.Admin.UI.internalConfig.lastMenuActive){
								case 0:
										if (activeTab.index()&gt;=0){
												mygis.Admin.AppManager.createGrid(activeTab.index());
										}
										break;
								case 1:
										if (activeTab.index()&gt;=0){
												mygis.Admin.MapManager.createGrid(activeTab.index());
										}
						}
						
						
				}
			}else{
				mygis.Admin.UI.loadAdministration();
			}
		},
		
		
		&#x2F;**
			Forces a redraw of the page logos, as well as the logos in the &quot;edit app settings&quot; dialog
			@method refreshPageLogos
		**&#x2F;
		refreshPageLogos: function(){
			var images = $(&quot;.domainLogoWrapper2&quot;).find(&quot;img&quot;);
			$.each(images,function(i,v){
				var prevSrc = v.src;
				if (prevSrc){
						if (prevSrc.indexOf(&quot;&amp;ut=&quot;)&gt;-1){
								prevSrc= prevSrc.substring(0,prevSrc.indexOf(&quot;&amp;ut=&quot;));
						}
						v.src=prevSrc + &quot;&amp;ut=&quot;+new Date().getTime();
				}
			});
			images = $(&quot;#editAppForm .editAppRow&quot;).find(&quot;img&quot;);
			$.each(images,function(i,v){
				var prevSrc = v.src;
				if (prevSrc){
					prevSrc = prevSrc.substring(0,prevSrc.indexOf(&quot;&amp;qSize=&quot;)+10);
					v.src=prevSrc + &quot;&amp;ut=&quot;+new Date().getTime();
				}
			});
		},
		
		&#x2F;**
		 * Resets the tabs under each menu to blank status
		 * @method resetTabs
		 *&#x2F;
		resetTabs: function(){
			$(&quot;#contentLinkTabsRound&quot;).empty();
			$(&quot;#contentLinkTabs&quot;).css(&quot;display&quot;,&quot;none&quot;);
			$(&quot;#contentSpecificToolbar&quot;).empty();
		},
		
		&#x2F;**
		 * Sets the tabs under each menu to the specific content
		 * @method setTabs
		 * @param {Mixed} htmlElement any valid input for jQuery&#x27;s &#x27;append&#x27; method
		 *&#x2F;
		setTabs: function(htmlElement){
			$(&quot;#contentLinkTabsRound&quot;).empty();
			$(&quot;#contentLinkTabsRound&quot;).append(htmlElement);
			$(&quot;#contentLinkTabs&quot;).css(&quot;display&quot;,&quot;table-row&quot;);
		},
		
		&#x2F;**
		 * Handles the clicking of the &quot;OK&quot; button in Admin popups
		 * @method acceptWindow
		 *&#x2F;
		acceptWindow: function(){
				var myconfig = mygis.Admin.UI.dialogConfig;
				if (myconfig.checkfn!=null){
						if (myconfig.checkfn()){
								$(myconfig.windowTitle).dialog(&#x27;close&#x27;);
								myconfig.callbackfn.call(myconfig.object,&quot;ok&quot;);
								mygis.Admin.UI.resetDialog();
						}
				}
		},
		
		&#x2F;**
		 * Handles the clicking of the &quot;CANCEL&quot; button in Admin popups
		 * @method closeWindow
		 *&#x2F;
		closeWindow: function(){
				var myconfig = mygis.Admin.UI.dialogConfig;
				if (myconfig.callbackfn!=null){
						$(myconfig.windowTitle).dialog(&#x27;close&#x27;);
						myconfig.callbackfn.call(null,null);
						mygis.Admin.UI.resetDialog();
				}
				$(myconfig.windowTitle).dialog(&#x27;close&#x27;);
		},
		
		&#x2F;**
		 * Resets the dialog config object
		 * @method resetDialog
		 *&#x2F;
		resetDialog: function(){
				var myconfig = mygis.Admin.UI.dialogConfig;
				myconfig.checkfn=null;
				myconfig.callbackfn=null;
				myconfig.objectCount=-1;
				myconfig.object=null;
				myconfig.windowTitle=null;
		},
		
		&#x2F;**
		 * Used to track popup dialogs&#x27; config object
		 * @property dialogConfig
		 * @type {Object}
		 *&#x2F;
		dialogConfig: {
				&#x2F;** 
				 * @property checkfn
				 * @type {Function}
				 *&#x2F;
				checkfn: null,
				
				&#x2F;** 
				 * @property callbackfn
				 * @type {Function}
				 *&#x2F;
				callbackfn: null,
				
				&#x2F;** 
				 * @property objectCount
				 * @type {Integer}
				 *&#x2F;
				objectCount: -1,
				
				&#x2F;** 
				 * @property object
				 * @type {Object}
				 *&#x2F;
				object: null,
				
				&#x2F;**
				 * @property windowTitle
				 * @type {String}
				 *&#x2F;
				windowTitle: null
		}
	},
	
	&#x2F;**
	 * Contains utility functions for administration
	 * @class mygis.Admin.Utilities
	 * @static
	 *&#x2F;
	Utilities: {
		&#x2F;**
		 * Gets the current application&#x27;s id
		 *@method getAppID
		 *@returns {Integer} The applications id
		 *&#x2F;
		getAppID: function(){
				var records = $(&quot;#myAppGrid&quot;).jqxGrid(&#x27;source&#x27;).records;
				var found=false;
				var i=0;
				var retvalue = -1;
				while (!found &amp;&amp; i&lt;records.length){
						if (records[i].appPrefix==currentAppName){
								found=true;
								retvalue = records[i].appID;
						}
						i++;
				}
				return retvalue;
		},
		
		&#x2F;**
		 * Outputs an rgba css string
		 * @method getRGBA
		 * @param {String} hexColor The hexadecimal color code
		 * @param {Integer} opacity The percentage based opacity. EG 45 means 0.45 opacity
		 *&#x2F;
		getRGBA: function(hexColor,opacity){
				var rgbColor = mygis.Utilities.hexToRGB(hexColor);
				var myopacity = parseInt(opacity);
				var rgbaString = &quot;rgba(&quot;
							+rgbColor[0]+&quot;,&quot;
							+rgbColor[1]+&quot;,&quot;
							+rgbColor[2]+&quot;,&quot;
							+(myopacity&#x2F;100)+&quot;)&quot;;
				return rgbaString;
		}
	}
	
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
